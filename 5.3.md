# 5.3 é€é Spring AI ç”Ÿæˆç¾å¥³åœ–

> **æœ¬ç« é‡é»**ï¼šå­¸ç¿’ä½¿ç”¨ Spring AI çš„åœ–ç‰‡ç”ŸæˆåŠŸèƒ½ï¼ŒæŒæ¡æ–‡å­—è½‰åœ–ç‰‡ï¼ˆText-to-Imageï¼‰æŠ€è¡“ï¼Œå»ºç«‹å®Œæ•´çš„ AI åœ–ç‰‡ç”Ÿæˆæ‡‰ç”¨ï¼Œæ¢ç´¢ AI çš„å‰µä½œèƒ½åŠ›ã€‚

## ğŸ¯ å­¸ç¿’ç›®æ¨™

å®Œæˆæœ¬ç« å­¸ç¿’å¾Œï¼Œæ‚¨å°‡èƒ½å¤ ï¼š

- ğŸ¯ **ç†è§£åœ–ç‰‡ç”ŸæˆæŠ€è¡“**ï¼šæŒæ¡æ–‡å­—è½‰åœ–ç‰‡çš„æ ¸å¿ƒåŸç†å’Œæ‡‰ç”¨å ´æ™¯
- ğŸ¯ **é¸æ“‡åˆé©çš„ç”Ÿæˆæ¨¡å‹**ï¼šäº†è§£å„ç¨®åœ–ç‰‡ç”Ÿæˆ AI æ¨¡å‹çš„ç‰¹é»å’Œæˆæœ¬
- ğŸ¯ **å¯¦ç¾åœ–ç‰‡ç”ŸæˆåŠŸèƒ½**ï¼šå»ºç«‹å®Œæ•´çš„åœ–ç‰‡ç”Ÿæˆ API å’Œç®¡ç†ç³»çµ±
- ğŸ¯ **å„ªåŒ–ç”Ÿæˆå“è³ª**ï¼šæŒæ¡æç¤ºè©å·¥ç¨‹å’Œåƒæ•¸èª¿æ•´æŠ€å·§
- ğŸ¯ **ä¼æ¥­ç´šæ‡‰ç”¨è¨­è¨ˆ**ï¼šå»ºç«‹å¯å•†ç”¨çš„åœ–ç‰‡ç”Ÿæˆæœå‹™æ¶æ§‹

---

## 5.3.1 AI åœ–ç‰‡ç”Ÿæˆçš„é©å‘½æ€§å½±éŸ¿

### æ–‡ç”Ÿåœ– AI å°‡æœƒæ˜¯æœ€å¤§åœ–åº«

![AI åœ–ç‰‡ç”Ÿæˆ](https://ithelp.ithome.com.tw/upload/images/20240810/20161290xVSyazJmHj.png)

æ˜¨å¤©å­¸äº†å¦‚ä½•ä¸Šå‚³åœ–ç‰‡çµ¦ AI è¾¨è­˜ï¼Œä»Šå¤©æˆ‘å€‘è®“ AI ä¾†ç”¢ç”Ÿåœ–ç‰‡å§ï¼AI åœ–ç‰‡ç”ŸæˆæŠ€è¡“æ­£åœ¨å¾¹åº•æ”¹è®Šå‰µæ„ç”¢æ¥­ï¼Œå¾æ¦‚å¿µè¨­è¨ˆåˆ°å•†æ¥­æ’åœ–ï¼ŒAI éƒ½èƒ½åœ¨å¹¾ç§’é˜å…§ç”Ÿæˆé«˜å“è³ªçš„åœ–ç‰‡ã€‚

### AI åœ–ç‰‡ç”Ÿæˆçš„æ ¸å¿ƒåƒ¹å€¼

**1. å‰µæ„ç„¡é™åˆ¶**
- ğŸ¨ **å³æ™‚å‰µä½œ**ï¼šå¾æ–‡å­—æè¿°åˆ°è¦–è¦ºå‘ˆç¾ï¼Œå¹¾ç§’é˜å®Œæˆ
- ğŸŒˆ **é¢¨æ ¼å¤šæ¨£**ï¼šæ”¯æ´å¯«å¯¦ã€å¡é€šã€æ²¹ç•«ã€æ°´å½©ç­‰å„ç¨®é¢¨æ ¼
- ğŸ”„ **å¿«é€Ÿè¿­ä»£**ï¼šè¼•é¬†èª¿æ•´å’Œå„ªåŒ–å‰µä½œå…§å®¹
- ğŸ’¡ **éˆæ„Ÿæ¿€ç™¼**ï¼šAI èƒ½æä¾›æ„æƒ³ä¸åˆ°çš„å‰µæ„çµ„åˆ

**2. æˆæœ¬æ•ˆç›Šé¡¯è‘—**
- ğŸ’° **é™ä½æˆæœ¬**ï¼šç„¡éœ€è˜è«‹å°ˆæ¥­è¨­è¨ˆå¸«æˆ–è³¼è²·ç‰ˆæ¬Šåœ–ç‰‡
- â° **ç¯€çœæ™‚é–“**ï¼šå¾æ•¸å¤©çš„è¨­è¨ˆé€±æœŸç¸®çŸ­åˆ°å¹¾åˆ†é˜
- ğŸ“ˆ **è¦æ¨¡åŒ–ç”Ÿç”¢**ï¼šæ‰¹æ¬¡ç”Ÿæˆå¤§é‡åœ–ç‰‡å…§å®¹
- ğŸ¯ **å®¢è£½åŒ–ç¨‹åº¦é«˜**ï¼šç²¾ç¢ºç¬¦åˆç‰¹å®šéœ€æ±‚

**3. æ‡‰ç”¨å ´æ™¯å»£æ³›**
- ğŸ›’ **é›»å•†æ‡‰ç”¨**ï¼šå•†å“å±•ç¤ºåœ–ã€å»£å‘Šç´ æã€å“ç‰Œè¦–è¦º
- ğŸ“š **å…§å®¹å‰µä½œ**ï¼šéƒ¨è½æ ¼é…åœ–ã€ç¤¾ç¾¤åª’é«”ç´ æã€ç°¡å ±åœ–ç‰‡
- ğŸ® **éŠæˆ²é–‹ç™¼**ï¼šè§’è‰²è¨­è¨ˆã€å ´æ™¯æ¦‚å¿µåœ–ã€é“å…·ç´ æ
- ğŸ¢ **ä¼æ¥­æ‡‰ç”¨**ï¼šè¡ŒéŠ·ç´ æã€ç”¢å“åŸå‹ã€è¦–è¦ºåŒ–å ±å‘Š

---

## 5.3.2 Spring AI æ”¯æ´çš„åœ–ç‰‡ç”Ÿæˆæ¨¡å‹

### ä¸»è¦æ”¯æ´çš„ AI æœå‹™å•†

| æœå‹™å•† | æ¨¡å‹ | ç‰¹è‰² | æˆæœ¬ | æ¨è–¦åº¦ | é©ç”¨å ´æ™¯ |
|--------|------|------|------|--------|----------|
| **OpenAI** | DALL-E 3 | é«˜å“è³ªã€ç†è§£è¤‡é›œæŒ‡ä»¤ | é«˜ | â­â­â­â­â­ | å°ˆæ¥­è¨­è¨ˆã€å•†æ¥­ç”¨é€” |
| **Stability AI** | Stable Diffusion | é–‹æºã€å¯æœ¬åœ°éƒ¨ç½² | ä¸­ | â­â­â­â­ | è‡ªä¸»æ§åˆ¶ã€å®¢è£½åŒ– |
| **ZhiPu AI** | CogView-3 | ä¸­æ–‡å‹å–„ã€ä¾¿å®œ | ä½ | â­â­â­ | å­¸ç¿’æ¸¬è©¦ã€ä¸­æ–‡å…§å®¹ |
| **QianFan** | æ–‡å¿ƒä¸€è¨€ | ç™¾åº¦æœå‹™ã€æœ¬åœŸåŒ– | ä½ | â­â­ | å¤§é™¸å¸‚å ´æ‡‰ç”¨ |
| **Midjourney** | V6 | è—è¡“æ€§å¼·ã€ç¤¾ç¾¤æ´»èº | ä¸­ | â­â­â­â­ | è—è¡“å‰µä½œã€æ¦‚å¿µè¨­è¨ˆ |

### æˆæœ¬æ•ˆç›Šåˆ†æ

æ ¹æ“šæœ€æ–°æ¸¬è©¦æ•¸æ“šï¼Œä»¥ä¸‹æ˜¯å„æœå‹™å•†çš„æˆæœ¬å°æ¯”ï¼š

```
ğŸ’° æˆæœ¬æ’åºï¼ˆæ¯å¼µåœ–ç‰‡ï¼‰ï¼š
1. ZhiPu AI: å…è²»é¡åº¦ + Â¥0.01-0.05
2. Stability AI: $0.002-0.01
3. QianFan: Â¥0.02-0.08
4. Midjourney: $0.05-0.15
5. OpenAI DALL-E 3: $0.040-0.080

ğŸ¯ æ¨è–¦ç­–ç•¥ï¼š
- å­¸ç¿’æ¸¬è©¦ï¼šZhiPu AIï¼ˆå…è²»é¡åº¦å……è¶³ï¼‰
- å•†æ¥­æ‡‰ç”¨ï¼šOpenAI DALL-E 3ï¼ˆå“è³ªæœ€ä½³ï¼‰
- å¤§é‡ç”Ÿæˆï¼šStability AIï¼ˆæˆæœ¬æœ€ä½ï¼‰
- è—è¡“å‰µä½œï¼šMidjourneyï¼ˆé¢¨æ ¼ç¨ç‰¹ï¼‰
```

### æ¨¡å‹èƒ½åŠ›å°æ¯”

| èƒ½åŠ›ç¶­åº¦ | DALL-E 3 | Stable Diffusion | CogView-3 | æ–‡å¿ƒä¸€è¨€ |
|----------|----------|------------------|-----------|----------|
| **åœ–ç‰‡å“è³ª** | 9/10 | 8/10 | 7/10 | 6/10 |
| **æŒ‡ä»¤ç†è§£** | 9/10 | 7/10 | 8/10 | 7/10 |
| **ä¸­æ–‡æ”¯æ´** | 7/10 | 6/10 | 9/10 | 9/10 |
| **ç”Ÿæˆé€Ÿåº¦** | 8/10 | 9/10 | 8/10 | 7/10 |
| **é¢¨æ ¼å¤šæ¨£æ€§** | 8/10 | 9/10 | 7/10 | 6/10 |
| **æˆæœ¬æ•ˆç›Š** | 6/10 | 9/10 | 9/10 | 8/10 |

---

## 5.3.3 ZhiPu AI æ•´åˆå¯¦æˆ°

### ç”³è«‹å’Œé…ç½®

**1. ç”³è«‹ API Key**

å‰å¾€ ZhiPu AI å®˜ç¶² [https://open.bigmodel.cn/](https://open.bigmodel.cn/) è¨»å†Šå¾Œï¼Œåœ¨ API å¯†é‘°é é¢å–å¾—ä½ çš„ API Keyã€‚

![ZhiPu AI API Key](https://ithelp.ithome.com.tw/upload/images/20240806/20161290qkPNJ0Ho4Y.png)

**2. å¼•å…¥ä¾è³´**

åœ¨ `pom.xml` ä¸­æ·»åŠ  ZhiPu AI ä¾è³´ï¼š

```xml
<!-- ä½¿ç”¨ Spring AI BOM ç®¡ç†ç‰ˆæœ¬ -->
<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>org.springframework.ai</groupId>
            <artifactId>spring-ai-bom</artifactId>
            <version>1.0.0</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>

<dependencies>
    <!-- Spring AI ZhiPu AI Starter -->
    <dependency>
        <groupId>org.springframework.ai</groupId>
        <artifactId>spring-ai-zhipuai-spring-boot-starter</artifactId>
    </dependency>
    
    <!-- Spring Boot Web -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    
    <!-- Spring Boot Validation -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-validation</artifactId>
    </dependency>
    
    <!-- Lombok -->
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
        <optional>true</optional>
    </dependency>
</dependencies>
```

**3. è¨­å®šå°ˆæ¡ˆåƒæ•¸**

åœ¨ `application.yml` ä¸­é…ç½®ï¼š

```yaml
spring:
  application:
    name: ai-image-generator
  ai:
    zhipuai:
      api-key: ${ZHIPUAI_API_KEY}
      base-url: https://open.bigmodel.cn/api/paas/v4
      image:
        options:
          model: cogview-3
          width: 1024
          height: 1024
          quality: standard
          style: vivid

# æ‡‰ç”¨ç¨‹å¼é…ç½®
app:
  image:
    generation:
      max-batch-size: 5
      default-timeout: 30s
      cache-enabled: true
      output-directory: ./generated-images

# æ—¥èªŒé…ç½®
logging:
  level:
    org.springframework.ai: DEBUG
    com.example: DEBUG
```

---

## 5.3.4 åŸºç¤åœ–ç‰‡ç”ŸæˆåŠŸèƒ½

### ç°¡å–®åœ–ç‰‡ç”Ÿæˆ API

```java
package com.example.controller;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.ai.image.Image;
import org.springframework.ai.image.ImageModel;
import org.springframework.ai.image.ImagePrompt;
import org.springframework.ai.image.ImageResponse;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/image")
@RequiredArgsConstructor
@Slf4j
public class ImageGenerationController {
    
    private final ImageModel imageModel;
    
    /**
     * åŸºç¤åœ–ç‰‡ç”Ÿæˆ
     * @param prompt åœ–ç‰‡æè¿°
     * @return HTML æ ¼å¼çš„åœ–ç‰‡å±•ç¤ºé é¢
     */
    @GetMapping("/generate")
    public ResponseEntity<String> generateImage(@RequestParam String prompt) {
        try {
            log.info("é–‹å§‹ç”Ÿæˆåœ–ç‰‡ï¼Œæç¤ºè©ï¼š{}", prompt);
            
            // å»ºç«‹åœ–ç‰‡ç”Ÿæˆè«‹æ±‚
            ImagePrompt imagePrompt = new ImagePrompt(prompt);
            
            // å‘¼å« AI æ¨¡å‹ç”Ÿæˆåœ–ç‰‡
            ImageResponse response = imageModel.call(imagePrompt);
            Image image = response.getResult().getOutput();
            
            // å»ºç«‹ HTML å›æ‡‰
            String htmlResponse = String.format("""
                <!DOCTYPE html>
                <html lang="zh-TW">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>AI åœ–ç‰‡ç”Ÿæˆçµæœ</title>
                    <style>
                        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
                        .container { text-align: center; }
                        .image-container { margin: 20px 0; }
                        .generated-image { max-width: 100%%; height: auto; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
                        .prompt { background: #f5f5f5; padding: 15px; border-radius: 5px; margin: 20px 0; }
                        .info { color: #666; font-size: 14px; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <h1>ğŸ¨ AI åœ–ç‰‡ç”Ÿæˆçµæœ</h1>
                        <div class="prompt">
                            <h3>ğŸ“ æç¤ºè©</h3>
                            <p><strong>%s</strong></p>
                        </div>
                        <div class="image-container">
                            <img src="%s" alt="%s" class="generated-image">
                        </div>
                        <div class="info">
                            <p>ğŸ¤– ç”± Spring AI + ZhiPu AI ç”Ÿæˆ</p>
                            <p>â° ç”Ÿæˆæ™‚é–“ï¼š%s</p>
                        </div>
                    </div>
                </body>
                </html>
                """, 
                prompt, 
                image.getUrl(), 
                prompt,
                java.time.LocalDateTime.now().format(
                    java.time.format.DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss")
                )
            );
            
            log.info("åœ–ç‰‡ç”ŸæˆæˆåŠŸï¼ŒURLï¼š{}", image.getUrl());
            
            return ResponseEntity.ok()
                    .contentType(MediaType.TEXT_HTML)
                    .body(htmlResponse);
            
        } catch (Exception e) {
            log.error("åœ–ç‰‡ç”Ÿæˆå¤±æ•—", e);
            
            String errorHtml = String.format("""
                <!DOCTYPE html>
                <html lang="zh-TW">
                <head>
                    <meta charset="UTF-8">
                    <title>ç”Ÿæˆå¤±æ•—</title>
                    <style>body { font-family: Arial, sans-serif; text-align: center; padding: 50px; }</style>
                </head>
                <body>
                    <h1>âŒ åœ–ç‰‡ç”Ÿæˆå¤±æ•—</h1>
                    <p>éŒ¯èª¤è¨Šæ¯ï¼š%s</p>
                    <p><a href="javascript:history.back()">è¿”å›é‡è©¦</a></p>
                </body>
                </html>
                """, e.getMessage());
            
            return ResponseEntity.badRequest()
                    .contentType(MediaType.TEXT_HTML)
                    .body(errorHtml);
        }
    }
    
    /**
     * JSON æ ¼å¼çš„åœ–ç‰‡ç”Ÿæˆ API
     * @param request ç”Ÿæˆè«‹æ±‚
     * @return JSON æ ¼å¼çš„å›æ‡‰
     */
    @PostMapping("/generate-json")
    public ResponseEntity<ImageGenerationResponse> generateImageJson(
            @RequestBody @Valid ImageGenerationRequest request) {
        
        try {
            log.info("JSON API åœ–ç‰‡ç”Ÿæˆè«‹æ±‚ï¼š{}", request.getPrompt());
            
            ImagePrompt imagePrompt = new ImagePrompt(request.getPrompt());
            ImageResponse response = imageModel.call(imagePrompt);
            Image image = response.getResult().getOutput();
            
            ImageGenerationResponse result = ImageGenerationResponse.builder()
                    .success(true)
                    .imageUrl(image.getUrl())
                    .prompt(request.getPrompt())
                    .model("cogview-3")
                    .timestamp(java.time.LocalDateTime.now())
                    .build();
            
            return ResponseEntity.ok(result);
            
        } catch (Exception e) {
            log.error("JSON API åœ–ç‰‡ç”Ÿæˆå¤±æ•—", e);
            
            ImageGenerationResponse errorResult = ImageGenerationResponse.builder()
                    .success(false)
                    .error(e.getMessage())
                    .prompt(request.getPrompt())
                    .timestamp(java.time.LocalDateTime.now())
                    .build();
            
            return ResponseEntity.badRequest().body(errorResult);
        }
    }
}
```

### è«‹æ±‚å’Œå›æ‡‰ DTO

```java
package com.example.dto;

import lombok.Data;
import lombok.Builder;
import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.Size;
import java.time.LocalDateTime;

@Data
public class ImageGenerationRequest {
    
    @NotBlank(message = "æç¤ºè©ä¸èƒ½ç‚ºç©º")
    @Size(max = 1000, message = "æç¤ºè©é•·åº¦ä¸èƒ½è¶…é 1000 å­—å…ƒ")
    private String prompt;
    
    private String style = "vivid";  // vivid, natural
    private String quality = "standard";  // standard, hd
    private Integer width = 1024;
    private Integer height = 1024;
    private String model = "cogview-3";
}

@Data
@Builder
public class ImageGenerationResponse {
    private boolean success;
    private String imageUrl;
    private String prompt;
    private String model;
    private String style;
    private String quality;
    private Integer width;
    private Integer height;
    private String error;
    private LocalDateTime timestamp;
}
```

---

## 5.3.5 é€²éšåœ–ç‰‡ç”ŸæˆåŠŸèƒ½

### æ‰¹æ¬¡åœ–ç‰‡ç”Ÿæˆ

```java
package com.example.service;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.ai.image.Image;
import org.springframework.ai.image.ImageModel;
import org.springframework.ai.image.ImagePrompt;
import org.springframework.ai.image.ImageResponse;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.concurrent.CompletableFuture;
import java.util.stream.Collectors;

@Service
@RequiredArgsConstructor
@Slf4j
public class BatchImageGenerationService {
    
    private final ImageModel imageModel;
    
    /**
     * æ‰¹æ¬¡ç”Ÿæˆåœ–ç‰‡
     * @param prompts æç¤ºè©åˆ—è¡¨
     * @return ç”Ÿæˆçµæœåˆ—è¡¨
     */
    public List<BatchImageResult> batchGenerate(List<String> prompts) {
        log.info("é–‹å§‹æ‰¹æ¬¡ç”Ÿæˆ {} å¼µåœ–ç‰‡", prompts.size());
        
        List<CompletableFuture<BatchImageResult>> futures = prompts.stream()
                .map(this::generateImageAsync)
                .collect(Collectors.toList());
        
        // ç­‰å¾…æ‰€æœ‰ä»»å‹™å®Œæˆ
        CompletableFuture<Void> allFutures = CompletableFuture.allOf(
                futures.toArray(new CompletableFuture[0])
        );
        
        return allFutures.thenApply(v -> 
                futures.stream()
                        .map(CompletableFuture::join)
                        .collect(Collectors.toList())
        ).join();
    }
    
    /**
     * éåŒæ­¥ç”Ÿæˆå–®å¼µåœ–ç‰‡
     */
    private CompletableFuture<BatchImageResult> generateImageAsync(String prompt) {
        return CompletableFuture.supplyAsync(() -> {
            try {
                ImagePrompt imagePrompt = new ImagePrompt(prompt);
                ImageResponse response = imageModel.call(imagePrompt);
                Image image = response.getResult().getOutput();
                
                return BatchImageResult.builder()
                        .prompt(prompt)
                        .imageUrl(image.getUrl())
                        .success(true)
                        .timestamp(java.time.LocalDateTime.now())
                        .build();
                
            } catch (Exception e) {
                log.error("æ‰¹æ¬¡ç”Ÿæˆå¤±æ•—ï¼š{}", prompt, e);
                
                return BatchImageResult.builder()
                        .prompt(prompt)
                        .success(false)
                        .error(e.getMessage())
                        .timestamp(java.time.LocalDateTime.now())
                        .build();
            }
        });
    }
    
    @Data
    @Builder
    public static class BatchImageResult {
        private String prompt;
        private String imageUrl;
        private boolean success;
        private String error;
        private java.time.LocalDateTime timestamp;
    }
}
```

### åœ–ç‰‡é¢¨æ ¼å’Œå“è³ªæ§åˆ¶

```java
package com.example.service;

import lombok.RequiredArgsConstructor;
import org.springframework.ai.image.ImageModel;
import org.springframework.ai.image.ImageOptions;
import org.springframework.ai.image.ImagePrompt;
import org.springframework.ai.zhipuai.ZhiPuAiImageOptions;
import org.springframework.stereotype.Service;

@Service
@RequiredArgsConstructor
public class AdvancedImageGenerationService {
    
    private final ImageModel imageModel;
    
    /**
     * ç”Ÿæˆç¾å¥³åœ–ç‰‡ï¼ˆé«˜å“è³ªï¼‰
     * @param description ç¾å¥³æè¿°
     * @param style é¢¨æ ¼é¸æ“‡
     * @return åœ–ç‰‡ URL
     */
    public String generateBeautyImage(String description, BeautyStyle style) {
        // å»ºæ§‹å°ˆæ¥­çš„ç¾å¥³åœ–ç‰‡æç¤ºè©
        String enhancedPrompt = buildBeautyPrompt(description, style);
        
        // è¨­å®šé«˜å“è³ªé¸é …
        ZhiPuAiImageOptions options = ZhiPuAiImageOptions.builder()
                .withModel("cogview-3")
                .withWidth(1024)
                .withHeight(1024)
                .withQuality("hd")
                .withStyle("vivid")
                .build();
        
        ImagePrompt imagePrompt = new ImagePrompt(enhancedPrompt, options);
        return imageModel.call(imagePrompt).getResult().getOutput().getUrl();
    }
    
    /**
     * å»ºæ§‹ç¾å¥³åœ–ç‰‡æç¤ºè©
     */
    private String buildBeautyPrompt(String description, BeautyStyle style) {
        String basePrompt = "A beautiful woman, " + description;
        
        String stylePrompt = switch (style) {
            case REALISTIC -> ", photorealistic, high quality, professional photography, natural lighting, detailed features";
            case ANIME -> ", anime style, manga art, beautiful anime girl, detailed anime artwork, vibrant colors";
            case PORTRAIT -> ", professional portrait, studio lighting, elegant pose, high-end fashion photography";
            case ARTISTIC -> ", artistic style, oil painting, renaissance art, classical beauty, masterpiece quality";
            case MODERN -> ", modern style, contemporary fashion, urban setting, trendy outfit, stylish appearance";
        };
        
        String qualityPrompt = ", 8k resolution, ultra detailed, masterpiece, best quality, highly detailed";
        
        return basePrompt + stylePrompt + qualityPrompt;
    }
    
    /**
     * ç”Ÿæˆå•†æ¥­ç”¨é€”åœ–ç‰‡
     * @param productDescription ç”¢å“æè¿°
     * @param businessType å•†æ¥­é¡å‹
     * @return åœ–ç‰‡ URL
     */
    public String generateBusinessImage(String productDescription, BusinessType businessType) {
        String businessPrompt = buildBusinessPrompt(productDescription, businessType);
        
        ZhiPuAiImageOptions options = ZhiPuAiImageOptions.builder()
                .withModel("cogview-3")
                .withWidth(1024)
                .withHeight(768)  // å•†æ¥­åœ–ç‰‡å¸¸ç”¨æ¯”ä¾‹
                .withQuality("hd")
                .withStyle("natural")
                .build();
        
        ImagePrompt imagePrompt = new ImagePrompt(businessPrompt, options);
        return imageModel.call(imagePrompt).getResult().getOutput().getUrl();
    }
    
    private String buildBusinessPrompt(String description, BusinessType type) {
        String basePrompt = description;
        
        String businessStyle = switch (type) {
            case ECOMMERCE -> ", product photography, white background, professional lighting, commercial quality";
            case MARKETING -> ", marketing material, eye-catching design, professional layout, brand-focused";
            case SOCIAL_MEDIA -> ", social media post, engaging visual, trendy design, shareable content";
            case PRESENTATION -> ", business presentation, clean design, professional appearance, corporate style";
            case ADVERTISEMENT -> ", advertisement design, compelling visual, marketing appeal, brand promotion";
        };
        
        return basePrompt + businessStyle + ", high quality, professional, commercial use";
    }
    
    public enum BeautyStyle {
        REALISTIC, ANIME, PORTRAIT, ARTISTIC, MODERN
    }
    
    public enum BusinessType {
        ECOMMERCE, MARKETING, SOCIAL_MEDIA, PRESENTATION, ADVERTISEMENT
    }
}
```

---

## 5.3.6 OpenAI DALL-E 3 æ•´åˆ

### DALL-E 3 é…ç½®

```java
package com.example.config;

import org.springframework.ai.image.ImageModel;
import org.springframework.ai.openai.OpenAiImageModel;
import org.springframework.ai.openai.api.OpenAiImageApi;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Profile;

@Configuration
public class ImageModelConfig {
    
    @Value("${spring.ai.openai.api-key}")
    private String openaiApiKey;
    
    /**
     * OpenAI DALL-E 3 æ¨¡å‹é…ç½®ï¼ˆé«˜å“è³ªï¼‰
     */
    @Bean("dalleImageModel")
    @Profile("dalle")
    public ImageModel dalleImageModel() {
        return new OpenAiImageModel(
            new OpenAiImageApi(openaiApiKey),
            org.springframework.ai.openai.OpenAiImageOptions.builder()
                .withModel("dall-e-3")
                .withQuality("hd")
                .withStyle("vivid")
                .withSize("1024x1024")
                .build()
        );
    }
    
    /**
     * å¤šæ¨¡å‹è·¯ç”±æœå‹™
     */
    @Bean
    public MultiModelImageService multiModelImageService(
            @Qualifier("zhipuImageModel") ImageModel zhipuModel,
            @Qualifier("dalleImageModel") ImageModel dalleModel) {
        return new MultiModelImageService(zhipuModel, dalleModel);
    }
}
```

### å¤šæ¨¡å‹è·¯ç”±æœå‹™

```java
package com.example.service;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.ai.image.ImageModel;
import org.springframework.ai.image.ImagePrompt;
import org.springframework.stereotype.Service;

@Service
@RequiredArgsConstructor
@Slf4j
public class MultiModelImageService {
    
    private final ImageModel zhipuModel;
    private final ImageModel dalleModel;
    
    /**
     * æ™ºèƒ½æ¨¡å‹é¸æ“‡
     * @param prompt æç¤ºè©
     * @param quality å“è³ªè¦æ±‚
     * @return åœ–ç‰‡ URL
     */
    public String generateWithBestModel(String prompt, QualityLevel quality) {
        ImageModel selectedModel = selectModel(quality, prompt);
        
        try {
            ImagePrompt imagePrompt = new ImagePrompt(prompt);
            return selectedModel.call(imagePrompt).getResult().getOutput().getUrl();
            
        } catch (Exception e) {
            log.warn("ä¸»è¦æ¨¡å‹å¤±æ•—ï¼Œå˜—è©¦å‚™ç”¨æ¨¡å‹ï¼š{}", e.getMessage());
            
            // é™ç´šåˆ°å‚™ç”¨æ¨¡å‹
            ImageModel fallbackModel = (selectedModel == dalleModel) ? zhipuModel : dalleModel;
            ImagePrompt imagePrompt = new ImagePrompt(prompt);
            return fallbackModel.call(imagePrompt).getResult().getOutput().getUrl();
        }
    }
    
    private ImageModel selectModel(QualityLevel quality, String prompt) {
        // æ ¹æ“šå“è³ªè¦æ±‚å’Œå…§å®¹è¤‡é›œåº¦é¸æ“‡æ¨¡å‹
        if (quality == QualityLevel.PREMIUM || isComplexPrompt(prompt)) {
            log.info("é¸æ“‡ DALL-E 3 æ¨¡å‹ï¼ˆé«˜å“è³ªï¼‰");
            return dalleModel;
        } else {
            log.info("é¸æ“‡ ZhiPu AI æ¨¡å‹ï¼ˆç¶“æ¿Ÿå‹ï¼‰");
            return zhipuModel;
        }
    }
    
    private boolean isComplexPrompt(String prompt) {
        // åˆ¤æ–·æç¤ºè©è¤‡é›œåº¦
        return prompt.length() > 100 || 
               prompt.contains("detailed") || 
               prompt.contains("professional") ||
               prompt.contains("high quality");
    }
    
    public enum QualityLevel {
        BASIC, STANDARD, PREMIUM
    }
}
```

---

## 5.3.7 ä¼æ¥­ç´šåœ–ç‰‡ç®¡ç†ç³»çµ±

### åœ–ç‰‡å„²å­˜å’Œç®¡ç†

```java
package com.example.service;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.UUID;

@Service
@RequiredArgsConstructor
@Slf4j
public class ImageStorageService {
    
    @Value("${app.image.output-directory:./generated-images}")
    private String outputDirectory;
    
    private final RestTemplate restTemplate = new RestTemplate();
    
    /**
     * ä¸‹è¼‰ä¸¦å„²å­˜åœ–ç‰‡
     * @param imageUrl åœ–ç‰‡ URL
     * @param prompt åŸå§‹æç¤ºè©
     * @return æœ¬åœ°æª”æ¡ˆè·¯å¾‘
     */
    public String downloadAndSaveImage(String imageUrl, String prompt) {
        try {
            // å»ºç«‹è¼¸å‡ºç›®éŒ„
            Path outputPath = Paths.get(outputDirectory);
            if (!Files.exists(outputPath)) {
                Files.createDirectories(outputPath);
            }
            
            // ç”Ÿæˆæª”æ¡ˆåç¨±
            String fileName = generateFileName(prompt);
            Path filePath = outputPath.resolve(fileName);
            
            // ä¸‹è¼‰åœ–ç‰‡
            byte[] imageBytes = restTemplate.getForObject(imageUrl, byte[].class);
            if (imageBytes != null) {
                Files.write(filePath, imageBytes);
                log.info("åœ–ç‰‡å·²å„²å­˜ï¼š{}", filePath.toString());
                return filePath.toString();
            }
            
            throw new RuntimeException("ç„¡æ³•ä¸‹è¼‰åœ–ç‰‡");
            
        } catch (IOException e) {
            log.error("åœ–ç‰‡å„²å­˜å¤±æ•—", e);
            throw new RuntimeException("åœ–ç‰‡å„²å­˜å¤±æ•—ï¼š" + e.getMessage());
        }
    }
    
    /**
     * ç”Ÿæˆæª”æ¡ˆåç¨±
     */
    private String generateFileName(String prompt) {
        String timestamp = LocalDateTime.now().format(
            DateTimeFormatter.ofPattern("yyyyMMdd_HHmmss")
        );
        String uuid = UUID.randomUUID().toString().substring(0, 8);
        String sanitizedPrompt = sanitizePrompt(prompt);
        
        return String.format("%s_%s_%s.png", timestamp, uuid, sanitizedPrompt);
    }
    
    /**
     * æ¸…ç†æç¤ºè©ä½œç‚ºæª”æ¡ˆåç¨±
     */
    private String sanitizePrompt(String prompt) {
        return prompt.replaceAll("[^a-zA-Z0-9\u4e00-\u9fa5]", "_")
                    .substring(0, Math.min(prompt.length(), 20));
    }
    
    /**
     * æ‰¹æ¬¡ä¸‹è¼‰åœ–ç‰‡
     */
    public List<String> batchDownloadImages(List<BatchImageGenerationService.BatchImageResult> results) {
        return results.stream()
                .filter(BatchImageGenerationService.BatchImageResult::isSuccess)
                .map(result -> downloadAndSaveImage(result.getImageUrl(), result.getPrompt()))
                .collect(java.util.stream.Collectors.toList());
    }
}
```

### åœ–ç‰‡å¿«å–ç³»çµ±

```java
package com.example.service;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.cache.annotation.Cacheable;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.stereotype.Service;

import java.security.MessageDigest;
import java.time.Duration;

@Service
@RequiredArgsConstructor
@Slf4j
public class ImageCacheService {
    
    private final RedisTemplate<String, Object> redisTemplate;
    private final ImageModel imageModel;
    
    /**
     * å¸¶å¿«å–çš„åœ–ç‰‡ç”Ÿæˆ
     */
    @Cacheable(value = "generatedImages", key = "#root.target.generateCacheKey(#prompt, #options)")
    public String generateImageWithCache(String prompt, ImageGenerationOptions options) {
        String cacheKey = generateCacheKey(prompt, options);
        
        // æª¢æŸ¥å¿«å–
        String cachedUrl = (String) redisTemplate.opsForValue().get(cacheKey);
        if (cachedUrl != null) {
            log.info("å¾å¿«å–è¿”å›åœ–ç‰‡ï¼š{}", prompt);
            return cachedUrl;
        }
        
        // ç”Ÿæˆæ–°åœ–ç‰‡
        String imageUrl = generateImage(prompt, options);
        
        // å„²å­˜åˆ°å¿«å–ï¼ˆ24å°æ™‚ï¼‰
        redisTemplate.opsForValue().set(cacheKey, imageUrl, Duration.ofHours(24));
        
        return imageUrl;
    }
    
    /**
     * ç”Ÿæˆå¿«å–éµ
     */
    public String generateCacheKey(String prompt, ImageGenerationOptions options) {
        try {
            String combined = prompt + "|" + options.toString();
            MessageDigest md = MessageDigest.getInstance("MD5");
            byte[] hash = md.digest(combined.getBytes());
            
            StringBuilder sb = new StringBuilder();
            for (byte b : hash) {
                sb.append(String.format("%02x", b));
            }
            return "image:" + sb.toString();
            
        } catch (Exception e) {
            return "image:" + Math.abs(prompt.hashCode());
        }
    }
    
    private String generateImage(String prompt, ImageGenerationOptions options) {
        // å¯¦éš›çš„åœ–ç‰‡ç”Ÿæˆé‚è¼¯
        ImagePrompt imagePrompt = new ImagePrompt(prompt);
        return imageModel.call(imagePrompt).getResult().getOutput().getUrl();
    }
}
```

---

## 5.3.8 å¯¦éš›æ‡‰ç”¨å ´æ™¯

### é›»å•†å•†å“åœ–ç‰‡ç”Ÿæˆ

```java
@RestController
@RequestMapping("/api/ecommerce")
@RequiredArgsConstructor
public class EcommerceImageController {
    
    private final AdvancedImageGenerationService imageService;
    
    /**
     * ç”Ÿæˆå•†å“å±•ç¤ºåœ–
     * @param productName å•†å“åç¨±
     * @param category å•†å“é¡åˆ¥
     * @param style å±•ç¤ºé¢¨æ ¼
     * @return å•†å“åœ–ç‰‡ URL
     */
    @PostMapping("/product-image")
    public ResponseEntity<ProductImageResponse> generateProductImage(
            @RequestBody ProductImageRequest request) {
        
        try {
            String prompt = buildProductPrompt(request);
            String imageUrl = imageService.generateBusinessImage(
                prompt, 
                AdvancedImageGenerationService.BusinessType.ECOMMERCE
            );
            
            ProductImageResponse response = ProductImageResponse.builder()
                    .success(true)
                    .imageUrl(imageUrl)
                    .productName(request.getProductName())
                    .category(request.getCategory())
                    .style(request.getStyle())
                    .timestamp(LocalDateTime.now())
                    .build();
            
            return ResponseEntity.ok(response);
            
        } catch (Exception e) {
            log.error("å•†å“åœ–ç‰‡ç”Ÿæˆå¤±æ•—", e);
            
            ProductImageResponse errorResponse = ProductImageResponse.builder()
                    .success(false)
                    .error(e.getMessage())
                    .build();
            
            return ResponseEntity.badRequest().body(errorResponse);
        }
    }
    
    private String buildProductPrompt(ProductImageRequest request) {
        return String.format(
            "%s, %s category, %s style, product photography, white background, " +
            "professional lighting, high quality, commercial use, detailed, 4k resolution",
            request.getProductName(),
            request.getCategory(),
            request.getStyle()
        );
    }
}

@Data
public class ProductImageRequest {
    private String productName;
    private String category;
    private String style;
    private String description;
    private List<String> features;
}

@Data
@Builder
public class ProductImageResponse {
    private boolean success;
    private String imageUrl;
    private String productName;
    private String category;
    private String style;
    private String error;
    private LocalDateTime timestamp;
}
```

### ç¤¾ç¾¤åª’é«”å…§å®¹ç”Ÿæˆ

```java
@RestController
@RequestMapping("/api/social-media")
@RequiredArgsConstructor
public class SocialMediaController {
    
    private final AdvancedImageGenerationService imageService;
    
    /**
     * ç”Ÿæˆç¤¾ç¾¤åª’é«”è²¼æ–‡åœ–ç‰‡
     */
    @PostMapping("/post-image")
    public ResponseEntity<SocialMediaImageResponse> generatePostImage(
            @RequestBody SocialMediaRequest request) {
        
        try {
            String prompt = buildSocialMediaPrompt(request);
            String imageUrl = imageService.generateBusinessImage(
                prompt,
                AdvancedImageGenerationService.BusinessType.SOCIAL_MEDIA
            );
            
            return ResponseEntity.ok(
                SocialMediaImageResponse.builder()
                    .success(true)
                    .imageUrl(imageUrl)
                    .platform(request.getPlatform())
                    .theme(request.getTheme())
                    .build()
            );
            
        } catch (Exception e) {
            return ResponseEntity.badRequest().body(
                SocialMediaImageResponse.builder()
                    .success(false)
                    .error(e.getMessage())
                    .build()
            );
        }
    }
    
    private String buildSocialMediaPrompt(SocialMediaRequest request) {
        String platformStyle = switch (request.getPlatform().toLowerCase()) {
            case "instagram" -> "Instagram post, square format, trendy, aesthetic";
            case "facebook" -> "Facebook post, engaging, social media friendly";
            case "twitter" -> "Twitter header, professional, clean design";
            case "linkedin" -> "LinkedIn post, professional, business-oriented";
            default -> "social media post, engaging visual";
        };
        
        return String.format(
            "%s, %s theme, %s, high quality, eye-catching, shareable content",
            request.getContent(),
            request.getTheme(),
            platformStyle
        );
    }
}
```

---

## ğŸ“ æœ¬ç« é‡é»å›é¡§

1. **åœ–ç‰‡ç”ŸæˆæŠ€è¡“ç†è§£**ï¼šæŒæ¡äº†æ–‡å­—è½‰åœ–ç‰‡çš„æ ¸å¿ƒåŸç†å’Œæ‡‰ç”¨åƒ¹å€¼
2. **å¤šæ¨¡å‹æ•´åˆ**ï¼šå­¸æœƒäº† ZhiPu AIã€OpenAI DALL-E 3 ç­‰å¤šç¨®æ¨¡å‹çš„ä½¿ç”¨
3. **ä¼æ¥­ç´šåŠŸèƒ½**ï¼šå»ºç«‹äº†å®Œæ•´çš„åœ–ç‰‡ç”Ÿæˆã€å„²å­˜å’Œç®¡ç†ç³»çµ±
4. **å¯¦éš›æ‡‰ç”¨å ´æ™¯**ï¼šå¯¦ç¾äº†é›»å•†ã€ç¤¾ç¾¤åª’é«”ç­‰å•†æ¥­æ‡‰ç”¨
5. **æ•ˆèƒ½å„ªåŒ–**ï¼šæŒæ¡äº†å¿«å–ã€æ‰¹æ¬¡è™•ç†ç­‰å„ªåŒ–æŠ€è¡“

### æŠ€è¡“è¦é»ç¸½çµ

| æŠ€è¡“é» | é‡è¦æ€§ | å¯¦ç¾é›£åº¦ | ä½¿ç”¨å ´æ™¯ |
|--------|--------|----------|----------|
| **åŸºç¤åœ–ç‰‡ç”Ÿæˆ** | â­â­â­ | ä½ | æ‰€æœ‰åœ–ç‰‡ç”Ÿæˆæ‡‰ç”¨ |
| **å¤šæ¨¡å‹æ•´åˆ** | â­â­â­ | ä¸­ | ä¼æ¥­ç´šæ‡‰ç”¨ |
| **æ‰¹æ¬¡è™•ç†** | â­â­ | ä¸­ | å¤§é‡å…§å®¹ç”Ÿæˆ |
| **å¿«å–ç³»çµ±** | â­â­ | ä¸­ | æ•ˆèƒ½å„ªåŒ– |
| **åœ–ç‰‡ç®¡ç†** | â­â­ | é«˜ | ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½² |
| **å•†æ¥­æ‡‰ç”¨** | â­â­â­ | é«˜ | å¯¦éš›æ¥­å‹™å ´æ™¯ |

### æˆæœ¬æ§åˆ¶å»ºè­°

1. **æ¨¡å‹é¸æ“‡ç­–ç•¥**ï¼šæ ¹æ“šå“è³ªéœ€æ±‚é¸æ“‡åˆé©çš„æ¨¡å‹
2. **å¿«å–æ©Ÿåˆ¶**ï¼šé¿å…é‡è¤‡ç”Ÿæˆç›¸åŒå…§å®¹
3. **æ‰¹æ¬¡è™•ç†**ï¼šæé«˜ç”Ÿæˆæ•ˆç‡ï¼Œé™ä½å–®ä½æˆæœ¬
4. **å“è³ªæ§åˆ¶**ï¼šå¹³è¡¡å“è³ªå’Œæˆæœ¬çš„é—œä¿‚

### ä¸‹ä¸€æ­¥å­¸ç¿’æ–¹å‘

åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘å€‘å°‡å­¸ç¿’å¦‚ä½•å»ºç«‹å­—å¹•ç”¢ç”Ÿå™¨ï¼Œæ¢ç´¢éŸ³è¨Šè½‰æ–‡å­—æŠ€è¡“ï¼Œç‚ºå¤šåª’é«”å…§å®¹è™•ç†æä¾›å®Œæ•´çš„è§£æ±ºæ–¹æ¡ˆã€‚

---

**åƒè€ƒè³‡æ–™ï¼š**
- [Spring AI Image Generation Documentation](https://docs.spring.io/spring-ai/reference/api/imageclient.html)
- [OpenAI DALL-E 3 API](https://platform.openai.com/docs/guides/images)
- [ZhiPu AI CogView Documentation](https://open.bigmodel.cn/dev/api#cogview)
- [Stability AI API Reference](https://platform.stability.ai/docs/api-reference)