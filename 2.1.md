# 2.1 Spring MVC API 開發基礎

> **第二章導讀**：本章將帶您掌握 Spring MVC 在現代 API 開發中的核心技術，從基礎架構到實際應用，為 Spring AI 整合奠定堅實基礎。

## 🎯 學習目標

完成本章學習後，您將能夠：

- 🎯 **理解現代化 API 架構**：掌握從傳統 MVC 到 API 優先架構的演進脈絡
- 🎯 **精通 Spring MVC 開發**：熟練運用 Spring MVC 進行現代化 API 開發
- 🎯 **區分控制器註解差異**：深入了解 @RestController 與 @Controller 的本質區別
- 🎯 **掌握 JSON 自動處理機制**：理解 Spring MVC 如何自動處理 JSON 序列化和反序列化
- 🎯 **為 Spring AI 做準備**：建立適合 AI 服務整合的 API 架構基礎

---

## 2.1.1 現代化 API 架構概述

### 為什麼需要現代化 API 架構？

在數位轉型的浪潮中，傳統的單體應用架構已無法滿足現代業務需求。特別是在 AI 應用興起的今天，我們需要更靈活、可擴展的架構來支援複雜的 AI 服務整合。

**傳統架構的局限**：
- 前後端緊密耦合，開發效率受限
- 單一技術棧，無法採用最適合的技術
- 擴展性差，難以應對 AI 服務的高併發需求
- 維護成本高，系統複雜度隨業務增長而急劇上升

**現代化需求驅動**：
- 📱 **多端統一**：Web、手機 App、小程式、IoT 設備等多平台支援
- 🔗 **系統整合**：與第三方服務、微服務、雲端平台的無縫整合
- ⚡ **敏捷開發**：前後端團隊並行開發，縮短產品上市時間
- 🤖 **AI 就緒**：支援 AI 服務的特殊需求，如流式處理、大資料分析

### 現代化 API 架構的核心價值

**前後端分離**：
- 技術棧獨立選擇，前端可採用 React、Vue 等現代框架
- 開發團隊並行作業，提升整體開發效率
- 部署策略靈活，支援獨立擴展和版本管理

**API 優先設計**：
- 統一的資料介面，支援多種客戶端
- 標準化的通訊協定，降低整合成本
- 可重用的服務組件，提升開發效率

---

## 2.1.2 Spring MVC 在現代 API 開發中的定位

### 為什麼選擇 Spring MVC？

Spring MVC 作為 Java 生態系統中最成熟的 Web 框架，在現代 API 開發中扮演著關鍵角色，特別適合作為 Spring AI 應用的基礎架構：

**技術成熟度**：
- 經過十多年的發展和驗證，技術穩定可靠
- 豐富的社群資源和最佳實踐經驗
- 完整的生態系統支援，涵蓋安全、測試、監控等各個面向

**企業級特性**：
- 強大的依賴注入和 AOP 支援
- 完善的事務管理和資料存取抽象
- 內建安全框架整合，滿足企業安全需求

**AI 整合友好**：
- 支援異步處理，適合 AI 服務的長時間運算
- 靈活的資料格式處理，支援 AI 所需的多媒體內容
- 強大的攔截器機制，便於實現 AI 服務的監控和日誌

---

## 2.1.3 傳統 Web 開發 vs API 開發

讓我們先了解傳統 Web 開發與現代 API 開發的根本差異：

| 特性 | 傳統 Web 開發 | 現代 API 開發 |
|------|---------------|---------------|
| **回應格式** | HTML 頁面 | JSON/XML 資料 |
| **客戶端** | 瀏覽器 | 多種客戶端（Web、Mobile、AI） |
| **狀態管理** | 有狀態（Session） | 無狀態（Stateless） |
| **資料傳輸** | 表單提交 | JSON/XML 負載 |
| **錯誤處理** | 錯誤頁面 | 結構化錯誤回應 |
| **AI 支援** | 不適合 | 天然支援 AI 服務整合 |

---

## 2.1.4 Spring MVC 核心架構

### DispatcherServlet：API 請求的統一入口

在 API 開發中，DispatcherServlet 扮演著前端控制器的角色，負責接收所有 HTTP 請求並進行統一分發。

**DispatcherServlet 的核心功能**：
1. **請求接收**：接收所有進入應用程式的 HTTP 請求
2. **路由分發**：根據請求資訊找到對應的處理器
3. **結果處理**：處理控制器的執行結果並生成回應
4. **異常處理**：統一處理請求處理過程中的異常

### @RestController vs @Controller：API 開發的關鍵差異

這是 Spring MVC API 開發中最重要的概念之一：

| 特性 | @Controller | @RestController |
|------|-------------|------------------|
| **組成** | 單一註解 | `@Controller` + `@ResponseBody` |
| **回應類型** | 視圖名稱 | 直接資料 |
| **序列化** | 需手動處理 | 自動 JSON 序列化 |
| **適用場景** | 傳統 Web 應用 | RESTful API |
| **AI 整合** | 不適合 | 完美支援 |

**範例：基本 API 控制器**
```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    private final UserService userService;
    
    public UserController(UserService userService) {
        this.userService = userService;
    }
    
    /**
     * 獲取使用者列表
     */
    @GetMapping
    public List<User> getUsers() {
        return userService.findAll();
    }
    
    /**
     * 根據 ID 獲取使用者
     */
    @GetMapping("/{id}")
    public User getUser(@PathVariable Long id) {
        return userService.findById(id);
    }
    
    /**
     * 建立新使用者
     */
    @PostMapping
    public User createUser(@RequestBody User user) {
        return userService.save(user);
    }
}
```

💡 **重點提示**：使用 `@RestController` 後，所有方法的返回值都會自動轉換為 JSON 格式，無需額外配置。

---

## 2.1.5 JSON 自動處理機制

### Spring MVC 的 JSON 序列化

Spring MVC 內建了強大的 JSON 處理機制，透過 Jackson 函式庫實現自動序列化和反序列化：

**自動序列化**：
- 控制器方法返回的 Java 物件自動轉換為 JSON
- 支援複雜的物件結構，包括巢狀物件和集合
- 可透過註解客製化序列化行為

**自動反序列化**：
- HTTP 請求體中的 JSON 自動轉換為 Java 物件
- 支援資料驗證和型別轉換
- 提供詳細的錯誤訊息

**範例：JSON 處理**
```java
@RestController
@RequestMapping("/api/products")
public class ProductController {
    
    /**
     * 接收 JSON 資料並自動轉換為 Product 物件
     */
    @PostMapping
    public Product createProduct(@RequestBody Product product) {
        // Spring MVC 自動將 JSON 轉換為 Product 物件
        return productService.save(product);
        // 返回的 Product 物件自動轉換為 JSON
    }
    
    /**
     * 返回複雜的 JSON 結構
     */
    @GetMapping("/summary")
    public Map<String, Object> getProductSummary() {
        Map<String, Object> summary = new HashMap<>();
        summary.put("totalProducts", productService.count());
        summary.put("categories", productService.getCategories());
        summary.put("topProducts", productService.getTopProducts());
        return summary; // 自動轉換為 JSON
    }
}
```

---

## 2.1.6 為 Spring AI 做準備

### AI 服務的特殊需求

在設計 API 架構時，我們需要考慮 Spring AI 的特殊需求：

**流式處理支援**：
- AI 對話服務通常需要流式回應
- 支援 Server-Sent Events (SSE)
- 異步處理長時間運算

**多媒體內容處理**：
- 支援圖片、音訊、影片等多媒體輸入
- 大型檔案上傳和處理
- 內容類型的自動識別

**錯誤處理和重試機制**：
- AI 服務可能出現暫時性錯誤
- 需要智能重試和降級策略
- 提供詳細的錯誤診斷資訊

### 架構設計考量

**可擴展性**：
```java
@RestController
@RequestMapping("/api/ai")
public class AIController {
    
    /**
     * 為未來的 AI 服務預留介面
     */
    @PostMapping("/chat")
    public ResponseEntity<String> chat(@RequestBody ChatRequest request) {
        // 預留給 Spring AI 整合
        return ResponseEntity.ok("準備整合 Spring AI");
    }
}
```

**異步處理準備**：
```java
@RestController
@RequestMapping("/api/async")
public class AsyncController {
    
    /**
     * 異步處理範例，適合 AI 長時間運算
     */
    @PostMapping("/process")
    public CompletableFuture<ProcessResult> processAsync(@RequestBody ProcessRequest request) {
        return CompletableFuture.supplyAsync(() -> {
            // 模擬長時間處理
            return new ProcessResult("處理完成");
        });
    }
}
```

---

## 📝 本章重點回顧

1. **現代化 API 架構**：理解了從傳統 MVC 到 API 優先架構的演進
2. **Spring MVC 優勢**：掌握了 Spring MVC 在 API 開發中的核心價值
3. **@RestController**：學會了使用 @RestController 建立 RESTful API
4. **JSON 處理**：理解了 Spring MVC 的自動 JSON 序列化機制
5. **AI 整合準備**：為後續 Spring AI 整合奠定了架構基礎

### 下一步學習方向

在下一章中，我們將學習 RESTful API 的設計原則和最佳實踐，進一步提升 API 的設計品質，為 Spring AI 的複雜應用場景做好準備。

---

**參考資料：**
- [Spring MVC Reference Guide](https://docs.spring.io/spring-framework/docs/current/reference/html/web.html)
- [Spring Boot Web Development](https://docs.spring.io/spring-boot/docs/current/reference/html/web.html)
- [RESTful API Design Best Practices](https://restfulapi.net/)