# 5.1 懶得打字問 AI？用提示詞範本吧

> **本章重點**：學習使用提示詞範本（Prompt Template）來標準化和優化 AI 互動，提升提示詞的品質和一致性，為個性化 ChatBot 奠定基礎。

## 🎯 學習目標

完成本章學習後，您將能夠：

- 🎯 **理解提示詞範本的重要性**：掌握「Garbage in, Garbage out」原則在 AI 中的應用
- 🎯 **使用 PromptTemplate 類別**：學會建立和使用動態提示詞範本
- 🎯 **整合 ChatClient API**：將範本與現代化的 ChatClient 流暢 API 結合
- 🎯 **建立範本庫**：設計可重複使用的提示詞範本系統
- 🎯 **優化提示詞品質**：掌握提示詞設計的最佳實踐

---

## 5.1.1 為什麼需要提示詞範本？

### Garbage in, Garbage out

![提示詞範本](https://ithelp.ithome.com.tw/upload/images/20240810/201612907PBWefpaFK.jpg)

**Garbage in, Garbage out** 也適用在 AI 領域。有些人就是不知如何問 AI，得到的解答自然也不具參考價值，這時提示詞範本就派上用場了。

### 提示詞範本的核心價值

**1. 標準化互動模式**
```
❌ 不良提示詞：
"告訴我關於 Spring Boot"

✅ 優質提示詞範本：
"作為一個資深的 Java 開發專家，請詳細說明 {topic} 的核心概念、
主要特性、使用場景，並提供一個實際的程式碼範例。
請用繁體中文回答，並確保內容適合 {experience_level} 開發者。"
```

**2. 提升回應品質**
- 🎯 **明確的角色設定**：讓 AI 扮演特定專業角色
- 📋 **結構化要求**：指定回應的格式和內容結構
- 🌍 **語言和風格**：統一回應的語言和表達風格
- 🎚️ **難度控制**：根據使用者程度調整內容深度

**3. 提高開發效率**
- 🔄 **可重複使用**：一次設計，多次使用
- 🛠️ **參數化設計**：透過變數動態調整內容
- 📚 **範本庫管理**：建立企業級提示詞資產
- 🚀 **快速部署**：減少重複的提示詞設計工作

---

## 5.1.2 PromptTemplate 基礎使用

### 基本範本語法

使用佔位符 `{變數名}` 定義動態內容：

```java
// 定義範本字串
String template = """
    作為一個資深的技術專家，請詳細說明 {topic} 的相關知識。

    請包含：
    1. 核心概念
    2. 主要特性
    3. 實際應用場景

    目標受眾：{level} 開發者
    """;

// 建立 PromptTemplate 並填入變數
PromptTemplate promptTemplate = new PromptTemplate(template);
Map<String, Object> variables = Map.of("topic", "Spring Boot", "level", "中級");
Prompt prompt = promptTemplate.create(variables);
```

### 與 ChatClient 整合

```java
// 簡化的範本使用方式
return chatClient.prompt("請問 {framework} 目前有哪些版本？")
    .user(Map.of("framework", "Spring Boot"))
    .call()
    .content();
```

> 💡 **完整範例**：詳見 `code-examples/chapter5-spring-ai-advanced/src/main/java/com/example/service/PromptTemplateService.java`

---

## 5.1.3 進階範本設計

### 多參數範本

根據不同場景創建特定用途的範本：

```java
// 程式碼生成範本
String codeTemplate = """
    你是 {language} 開發專家。
    請生成 {functionality} 的程式碼實現。
    """;

// 錯誤診斷範本
String diagTemplate = """
    你是 {technology} 專家。
    分析以下錯誤：{errorMessage}
    請提供原因和解決方法。
    """;
```

### 條件式範本

根據使用者程度動態選擇範本：

```java
String template = switch (level) {
    case "初級" -> "你是耐心的導師。請用簡單語言說明 {topic}";
    case "中級" -> "你是技術專家。請說明 {topic} 的核心原理和應用";
    default -> "你是資深架構師。請深度分析 {topic} 的實現原理";
};
```

> 💡 **更多範本設計**：詳見 `code-examples/chapter5-spring-ai-advanced/` 中的工具類

---

## 5.1.4 範本庫管理系統

### 預定義範本庫

在配置文件中定義常用範本：

```java
@ConfigurationProperties(prefix = "app.prompt.templates")
public class PromptTemplateConfig {
    private Map<String, String> library = Map.of(
        "explain", "作為 {role} 專家，請詳細說明 {topic}。包括核心概念、特性和範例。",
        "code-review", "你是 {language} 程式碼審查專家。審查代碼：{code}，提供品質評估和改進建議。",
        "troubleshoot", "你是 {technology} 故障排除專家。分析問題：{problem}，提供解決方案。"
    );
}
```

### 範本管理服務

核心方法：

```java
@Service
public class PromptTemplateManager {
    // 根據名稱創建 Prompt
    public Prompt createPrompt(String templateName, Map<String, Object> variables) { ... }

    // 動態註冊新範本
    public void registerTemplate(String name, String template) { ... }

    // 驗證範本語法
    public boolean validateTemplate(String template, Map<String, Object> variables) { ... }
}
```

> 詳見 `code-examples/chapter5-spring-ai-advanced/src/main/java/com/example/service/PromptTemplateManager.java`

---

## 5.1.5 實際應用範例

### 客服支援範本

```java
// 技術支援範本
String supportTemplate = """
    你是 {product} 的技術支援專家。

    問題：{issue}
    嚴重程度：{severity}

    請提供：
    ## 🔍 問題理解
    ## 🛠️ 解決方案
    ## 📋 後續追蹤
    """;

// 在 Controller 中使用
Prompt prompt = templateManager.createPrompt("technical-support",
    Map.of("product", "Spring Boot", "issue", "啟動失敗", "severity", "high"));
```

### 教育訓練範本

```java
// 課程設計範本
String lessonTemplate = """
    你是經驗豐富的 {subject} 教師。
    為 {level} 學生設計 {duration} 分鐘課程。

    包含：課程目標、大綱、教學活動、評量方式、課後作業
    """;
```

> 💡 **完整應用範例**：詳見 `code-examples/chapter5-spring-ai-advanced/src/main/java/com/example/controller/TemplateController.java`

---

## 5.1.6 範本設計最佳實踐

### 設計原則

**1. 清晰的角色定義**
```java
// ✅ 好的範本：明確的身份和背景
String template = """
    你是擁有10年經驗的 Spring Boot 架構師。
    請針對 {question} 提供專業建議。
    """;

// ❌ 不好的範本：模糊不清
String template = "請回答 {question}";
```

**2. 結構化輸出格式**
```java
String template = """
    請按照以下格式回答：
    ## 🎯 核心概念
    ## 🔧 實作方法
    ## 💡 最佳實踐
    ## ⚠️ 注意事項
    """;
```

**3. 參數驗證和預設值**
```java
// 驗證必要參數
validateRequiredParameters(template, variables);

// 設定預設值
result.putIfAbsent("language", "繁體中文");
result.putIfAbsent("style", "專業且友善");
```

### 效能優化

**快取編譯後的範本**：
```java
// 使用 ConcurrentHashMap 快取已編譯的範本
private final Map<String, PromptTemplate> templateCache = new ConcurrentHashMap<>();

PromptTemplate template = templateCache.computeIfAbsent(templateKey,
    key -> new PromptTemplate(templateContent));
```

**批次處理**：
```java
// 並行處理多個範本
variablesList.parallelStream()
    .map(template::create)
    .collect(Collectors.toList());
```

---

## 📝 本章重點回顧

1. **提示詞範本的價值**：理解了「Garbage in, Garbage out」原則和範本的重要性
2. **PromptTemplate 使用**：掌握了基本和進階的範本建立方法
3. **ChatClient 整合**：學會了將範本與現代化的 ChatClient API 結合
4. **範本庫管理**：建立了企業級的範本管理系統
5. **最佳實踐**：掌握了範本設計、驗證和優化的最佳實踐

### 關鍵技術要點

| 技術點 | 重要性 | 實現難度 | 使用場景 |
|--------|--------|----------|----------|
| **基礎範本** | ⭐⭐⭐ | 低 | 所有 AI 應用 |
| **參數化設計** | ⭐⭐⭐ | 中 | 動態內容生成 |
| **範本庫管理** | ⭐⭐ | 中 | 企業級應用 |
| **條件式範本** | ⭐⭐ | 高 | 複雜業務邏輯 |
| **效能優化** | ⭐ | 中 | 高併發場景 |

### 下一步學習方向

在下一章中，我們將學習如何處理多模態資料，讓 AI 不僅能理解文字，還能處理圖片、音訊等多種媒體格式，進一步提升 ChatBot 的智能化程度。

---

**參考資料：**
- [Spring AI Prompt Template Documentation](https://docs.spring.io/spring-ai/reference/api/prompt.html)
- [ChatClient API Reference](https://docs.spring.io/spring-ai/reference/api/chatclient.html)
- [Prompt Engineering Best Practices](https://platform.openai.com/docs/guides/prompt-engineering)