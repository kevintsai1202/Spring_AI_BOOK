# 5.3 é€é Spring AI ç”Ÿæˆç¾å¥³åœ–

> **å°æ‡‰ç« ç¯€**: Day12
> **å°æ‡‰ç¯„ä¾‹**: `chapter5-image-generation`
> **é›£åº¦**: â­â­â­â˜†â˜†

---

## ğŸ“š æœ¬ç« æ¦‚è¦

AI åœ–ç‰‡ç”ŸæˆæŠ€è¡“æ­£åœ¨å¾¹åº•æ”¹è®Šå‰µæ„ç”¢æ¥­ã€‚é€é Spring AI çš„åœ–ç‰‡ç”Ÿæˆ APIï¼Œæˆ‘å€‘å¯ä»¥è¼•é¬†å»ºç«‹æ–‡å­—è½‰åœ–ç‰‡ï¼ˆText-to-Imageï¼‰æ‡‰ç”¨ï¼Œå¾æ¦‚å¿µè¨­è¨ˆåˆ°å•†æ¥­æ’åœ–ï¼ŒAI éƒ½èƒ½åœ¨å¹¾ç§’é˜å…§ç”Ÿæˆé«˜å“è³ªçš„åœ–ç‰‡ã€‚

**å­¸ç¿’ç›®æ¨™**ï¼š
- ç†è§£ AI åœ–ç‰‡ç”Ÿæˆçš„æ ¸å¿ƒåŸç†å’Œæ‡‰ç”¨å ´æ™¯
- æŒæ¡ Spring AI çš„åœ–ç‰‡ç”Ÿæˆ API ä½¿ç”¨æ–¹å¼
- å­¸æœƒé¸æ“‡åˆé©çš„åœ–ç‰‡ç”Ÿæˆæ¨¡å‹
- å¯¦ç¾å®Œæ•´çš„åœ–ç‰‡ç”Ÿæˆå’Œç®¡ç†åŠŸèƒ½
- å»ºç«‹ä¼æ¥­ç´šçš„åœ–ç‰‡ç”Ÿæˆæœå‹™æ¶æ§‹

---

## 5.3.1 AI åœ–ç‰‡ç”Ÿæˆçš„é©å‘½æ€§å½±éŸ¿

### æ–‡ç”Ÿåœ– AI å°‡æœƒæ˜¯æœ€å¤§åœ–åº«

![AI åœ–ç‰‡ç”Ÿæˆ](https://ithelp.ithome.com.tw/upload/images/20240810/20161290xVSyazJmHj.png)

æ˜¨å¤©å­¸äº†å¦‚ä½•ä¸Šå‚³åœ–ç‰‡çµ¦ AI è¾¨è­˜ï¼Œä»Šå¤©æˆ‘å€‘è®“ AI ä¾†ç”¢ç”Ÿåœ–ç‰‡å§ï¼AI åœ–ç‰‡ç”ŸæˆæŠ€è¡“æ­£åœ¨å¾¹åº•æ”¹è®Šå‰µæ„ç”¢æ¥­ï¼Œå¾æ¦‚å¿µè¨­è¨ˆåˆ°å•†æ¥­æ’åœ–ï¼ŒAI éƒ½èƒ½åœ¨å¹¾ç§’é˜å…§ç”Ÿæˆé«˜å“è³ªçš„åœ–ç‰‡ã€‚

### AI åœ–ç‰‡ç”Ÿæˆçš„æ ¸å¿ƒåƒ¹å€¼

**1. å‰µæ„ç„¡é™åˆ¶**
- ğŸ¨ **å³æ™‚å‰µä½œ**ï¼šå¾æ–‡å­—æè¿°åˆ°è¦–è¦ºå‘ˆç¾ï¼Œå¹¾ç§’é˜å®Œæˆ
- ğŸŒˆ **é¢¨æ ¼å¤šæ¨£**ï¼šæ”¯æ´å¯«å¯¦ã€å¡é€šã€æ²¹ç•«ã€æ°´å½©ç­‰å„ç¨®é¢¨æ ¼
- ğŸ”„ **å¿«é€Ÿè¿­ä»£**ï¼šè¼•é¬†èª¿æ•´å’Œå„ªåŒ–å‰µä½œå…§å®¹
- ğŸ’¡ **éˆæ„Ÿæ¿€ç™¼**ï¼šAI èƒ½æä¾›æ„æƒ³ä¸åˆ°çš„å‰µæ„çµ„åˆ

**2. æˆæœ¬æ•ˆç›Šé¡¯è‘—**
- ğŸ’° **é™ä½æˆæœ¬**ï¼šç„¡éœ€è˜è«‹å°ˆæ¥­è¨­è¨ˆå¸«æˆ–è³¼è²·ç‰ˆæ¬Šåœ–ç‰‡
- â° **ç¯€çœæ™‚é–“**ï¼šå¾æ•¸å¤©çš„è¨­è¨ˆé€±æœŸç¸®çŸ­åˆ°å¹¾åˆ†é˜
- ğŸ“ˆ **è¦æ¨¡åŒ–ç”Ÿç”¢**ï¼šæ‰¹æ¬¡ç”Ÿæˆå¤§é‡åœ–ç‰‡å…§å®¹
- ğŸ¯ **å®¢è£½åŒ–ç¨‹åº¦é«˜**ï¼šç²¾ç¢ºç¬¦åˆç‰¹å®šéœ€æ±‚

**3. æ‡‰ç”¨å ´æ™¯å»£æ³›**
- ğŸ›’ **é›»å•†æ‡‰ç”¨**ï¼šå•†å“å±•ç¤ºåœ–ã€å»£å‘Šç´ æã€å“ç‰Œè¦–è¦º
- ğŸ“š **å…§å®¹å‰µä½œ**ï¼šéƒ¨è½æ ¼é…åœ–ã€ç¤¾ç¾¤åª’é«”ç´ æã€ç°¡å ±åœ–ç‰‡
- ğŸ® **éŠæˆ²é–‹ç™¼**ï¼šè§’è‰²è¨­è¨ˆã€å ´æ™¯æ¦‚å¿µåœ–ã€é“å…·ç´ æ
- ğŸ¢ **ä¼æ¥­æ‡‰ç”¨**ï¼šè¡ŒéŠ·ç´ æã€ç”¢å“åŸå‹ã€è¦–è¦ºåŒ–å ±å‘Š

### åœ–ç‰‡ç”Ÿæˆå·¥ä½œæµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ¶
    participant C as Controller
    participant S as Service
    participant API as Image Model API
    participant ST as Storage

    U->>C: æäº¤ç”Ÿæˆè«‹æ±‚
    C->>C: é©—è­‰åƒæ•¸
    C->>S: èª¿ç”¨ç”Ÿæˆæœå‹™
    S->>API: ç™¼é€ç”Ÿæˆè«‹æ±‚
    API->>API: AI ç”Ÿæˆåœ–ç‰‡
    API-->>S: è¿”å›åœ–ç‰‡ URL
    S->>ST: å„²å­˜åœ–ç‰‡è³‡è¨Š
    S-->>C: å›æ‡‰çµæœ
    C-->>U: é¡¯ç¤ºç”Ÿæˆçš„åœ–ç‰‡

    Note over API: DALL-E 3, Stable Diffusion<br/>ç­‰åœ–ç‰‡ç”Ÿæˆæ¨¡å‹
```

---

## 5.3.2 Spring AI æ”¯æ´çš„åœ–ç‰‡ç”Ÿæˆæ¨¡å‹

### ä¸»è¦æ”¯æ´çš„ AI æœå‹™å•†

| æœå‹™å•† | æ¨¡å‹ | ç‰¹è‰² | æˆæœ¬ | æ¨è–¦åº¦ | é©ç”¨å ´æ™¯ |
|--------|------|------|------|--------|----------|
| **OpenAI** | DALL-E 3 | é«˜å“è³ªã€ç†è§£è¤‡é›œæŒ‡ä»¤ | é«˜ | â­â­â­â­â­ | å°ˆæ¥­è¨­è¨ˆã€å•†æ¥­ç”¨é€” |
| **Stability AI** | Stable Diffusion | é–‹æºã€å¯æœ¬åœ°éƒ¨ç½² | ä¸­ | â­â­â­â­ | è‡ªä¸»æ§åˆ¶ã€å®¢è£½åŒ– |
| **ZhiPu AI** | CogView-3 | ä¸­æ–‡å‹å–„ã€ä¾¿å®œ | ä½ | â­â­â­ | å­¸ç¿’æ¸¬è©¦ã€ä¸­æ–‡å…§å®¹ |
| **QianFan** | æ–‡å¿ƒä¸€è¨€ | ç™¾åº¦æœå‹™ã€æœ¬åœŸåŒ– | ä½ | â­â­ | å¤§é™¸å¸‚å ´æ‡‰ç”¨ |
| **Midjourney** | V6 | è—è¡“æ€§å¼·ã€ç¤¾ç¾¤æ´»èº | ä¸­ | â­â­â­â­ | è—è¡“å‰µä½œã€æ¦‚å¿µè¨­è¨ˆ |

### æˆæœ¬æ•ˆç›Šåˆ†æ

```mermaid
graph LR
    A[é¸æ“‡åœ–ç‰‡ç”Ÿæˆæ¨¡å‹] --> B{ä¸»è¦è€ƒé‡?}
    B -->|æˆæœ¬å„ªå…ˆ| C[ZhiPu AI / QianFan]
    B -->|å“è³ªå„ªå…ˆ| D[DALL-E 3]
    B -->|å®¢è£½åŒ–| E[Stable Diffusion]
    B -->|è—è¡“æ€§| F[Midjourney]

    C --> G[é©åˆï¼šå­¸ç¿’æ¸¬è©¦<br/>å¤§é‡ç”Ÿæˆ]
    D --> H[é©åˆï¼šå•†æ¥­æ‡‰ç”¨<br/>å°ˆæ¥­è¨­è¨ˆ]
    E --> I[é©åˆï¼šæœ¬åœ°éƒ¨ç½²<br/>è‡ªä¸»æ§åˆ¶]
    F --> J[é©åˆï¼šè—è¡“å‰µä½œ<br/>æ¦‚å¿µè¨­è¨ˆ]

    style C fill:#e8f5e9
    style D fill:#e3f2fd
    style E fill:#fff9c4
    style F fill:#fce4ec
```

**æˆæœ¬æ’åºï¼ˆæ¯å¼µåœ–ç‰‡ï¼‰**ï¼š
1. ZhiPu AI: å…è²»é¡åº¦ + Â¥0.01-0.05
2. Stability AI: $0.002-0.01
3. QianFan: Â¥0.02-0.08
4. Midjourney: $0.05-0.15
5. OpenAI DALL-E 3: $0.040-0.080

### æ¨¡å‹èƒ½åŠ›å°æ¯”

| èƒ½åŠ›ç¶­åº¦ | DALL-E 3 | Stable Diffusion | CogView-3 | æ–‡å¿ƒä¸€è¨€ |
|----------|----------|------------------|-----------|----------|
| **åœ–ç‰‡å“è³ª** | 9/10 | 8/10 | 7/10 | 6/10 |
| **æŒ‡ä»¤ç†è§£** | 9/10 | 7/10 | 8/10 | 7/10 |
| **ä¸­æ–‡æ”¯æ´** | 7/10 | 6/10 | 9/10 | 9/10 |
| **ç”Ÿæˆé€Ÿåº¦** | 8/10 | 9/10 | 8/10 | 7/10 |
| **é¢¨æ ¼å¤šæ¨£æ€§** | 8/10 | 9/10 | 7/10 | 6/10 |
| **æˆæœ¬æ•ˆç›Š** | 6/10 | 9/10 | 9/10 | 8/10 |

---

## 5.3.3 OpenAI DALL-E 3 æ•´åˆ

### å°ˆæ¡ˆé…ç½®

```yaml
# å°æ‡‰ç¯„ä¾‹: chapter5-image-generation/src/main/resources/application.yml

spring:
  application:
    name: spring-ai-image-generation
  ai:
    openai:
      api-key: ${OPENAI_API_KEY}
      image:
        options:
          model: dall-e-3
          size: 1024x1024
          quality: standard
          style: natural
          response-format: url
```

**é…ç½®èªªæ˜**ï¼š
- **model**: `dall-e-3` æˆ– `dall-e-2`
- **size**: `1024x1024`, `1024x1792`, `1792x1024`
- **quality**: `standard` æˆ– `hd`ï¼ˆé«˜æ¸…ï¼Œæˆæœ¬æ›´é«˜ï¼‰
- **style**: `natural`ï¼ˆè‡ªç„¶ï¼‰æˆ– `vivid`ï¼ˆé®®è±”ï¼‰
- **response-format**: `url` æˆ– `b64_json`

### åœ–ç‰‡ç”Ÿæˆæœå‹™å¯¦ç¾

```java
// å°æ‡‰ç¯„ä¾‹: chapter5-image-generation/.../ImageGenerationServiceImpl.java:28

@Service
@RequiredArgsConstructor
@Slf4j
public class ImageGenerationServiceImpl implements ImageGenerationService {

    private final ImageModel imageModel;

    /**
     * åŸºç¤åœ–ç‰‡ç”Ÿæˆ
     */
    @Override
    public ImageGenerationResponse generateImage(ImageGenerationRequest request) {
        try {
            log.info("é–‹å§‹ç”Ÿæˆåœ–ç‰‡ï¼š{}", request.getPrompt());

            // å»ºç«‹åœ–ç‰‡ç”Ÿæˆé¸é …
            ImageOptions options = ImageOptionsBuilder.builder()
                    .withModel("dall-e-3")
                    .withWidth(request.getWidth())
                    .withHeight(request.getHeight())
                    .withQuality(request.getQuality())
                    .withStyle(request.getStyle())
                    .build();

            // å»ºç«‹æç¤ºè©
            ImagePrompt imagePrompt = new ImagePrompt(
                    request.getPrompt(),
                    options
            );

            // ç”Ÿæˆåœ–ç‰‡
            ImageResponse response = imageModel.call(imagePrompt);

            // æå–åœ–ç‰‡ URL
            String imageUrl = response.getResult()
                    .getOutput()
                    .getUrl();

            log.info("åœ–ç‰‡ç”ŸæˆæˆåŠŸï¼š{}", imageUrl);

            return ImageGenerationResponse.builder()
                    .success(true)
                    .imageUrl(imageUrl)
                    .prompt(request.getPrompt())
                    .model("dall-e-3")
                    .timestamp(LocalDateTime.now())
                    .build();

        } catch (Exception e) {
            log.error("åœ–ç‰‡ç”Ÿæˆå¤±æ•—", e);
            return ImageGenerationResponse.builder()
                    .success(false)
                    .error("åœ–ç‰‡ç”Ÿæˆå¤±æ•—ï¼š" + e.getMessage())
                    .timestamp(LocalDateTime.now())
                    .build();
        }
    }
}
```

**å¯¦ç¾è¦é»**ï¼š
1. **ImageOptions å»ºç«‹**ï¼šè¨­å®šåœ–ç‰‡å¤§å°ã€å“è³ªã€é¢¨æ ¼ç­‰åƒæ•¸
2. **ImagePrompt å»ºç«‹**ï¼šåŒ…å«æç¤ºè©å’Œé¸é …
3. **èª¿ç”¨ ImageModel**ï¼šåŸ·è¡Œåœ–ç‰‡ç”Ÿæˆ
4. **æå–çµæœ**ï¼šå¾ ImageResponse ä¸­å–å¾—åœ–ç‰‡ URL
5. **éŒ¯èª¤è™•ç†**ï¼šæ•ç²ç•°å¸¸ä¸¦æä¾›å‹å–„çš„éŒ¯èª¤è¨Šæ¯

### REST API å¯¦ç¾

```java
// å°æ‡‰ç¯„ä¾‹: chapter5-image-generation/.../ImageGenerationController.java:30

@RestController
@RequestMapping("/api/images")
@RequiredArgsConstructor
@Slf4j
public class ImageGenerationController {

    private final ImageGenerationService imageGenerationService;

    /**
     * ç”Ÿæˆåœ–ç‰‡
     */
    @PostMapping("/generate")
    public ResponseEntity<ImageGenerationResponse> generateImage(
            @RequestBody @Valid ImageGenerationRequest request) {

        log.info("æ”¶åˆ°åœ–ç‰‡ç”Ÿæˆè«‹æ±‚ï¼š{}", request.getPrompt());

        ImageGenerationResponse response = imageGenerationService
                .generateImage(request);

        return response.isSuccess()
                ? ResponseEntity.ok(response)
                : ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                        .body(response);
    }

    /**
     * æ‰¹æ¬¡ç”Ÿæˆåœ–ç‰‡
     */
    @PostMapping("/batch-generate")
    public ResponseEntity<List<ImageGenerationResponse>> batchGenerate(
            @RequestBody List<String> prompts) {

        log.info("æ‰¹æ¬¡ç”Ÿæˆ {} å¼µåœ–ç‰‡", prompts.size());

        List<ImageGenerationResponse> responses = prompts.stream()
                .map(prompt -> {
                    ImageGenerationRequest request = ImageGenerationRequest.builder()
                            .prompt(prompt)
                            .width(1024)
                            .height(1024)
                            .quality("standard")
                            .style("natural")
                            .build();
                    return imageGenerationService.generateImage(request);
                })
                .collect(Collectors.toList());

        return ResponseEntity.ok(responses);
    }
}
```

---

## 5.3.4 é€²éšåŠŸèƒ½å¯¦ç¾

### ç”¢å“åœ–ç‰‡ç”Ÿæˆæœå‹™

```java
// å°æ‡‰ç¯„ä¾‹: chapter5-image-generation/.../ImageGenerationServiceImpl.java:80

/**
 * ç”¢å“åœ–ç‰‡ç”Ÿæˆï¼ˆå¸¶æç¤ºè©å„ªåŒ–ï¼‰
 */
@Override
public ProductImageResponse generateProductImage(ProductImageRequest request) {
    try {
        log.info("ç”Ÿæˆç”¢å“åœ–ç‰‡ï¼š{} - {}",
                request.getProductName(), request.getCategory());

        // å»ºç«‹å„ªåŒ–çš„æç¤ºè©
        String optimizedPrompt = buildProductPrompt(request);

        // å»ºç«‹åœ–ç‰‡é¸é …
        ImageOptions options = ImageOptionsBuilder.builder()
                .withModel("dall-e-3")
                .withWidth(1024)
                .withHeight(1024)
                .withQuality("hd")  // ç”¢å“åœ–ä½¿ç”¨é«˜å“è³ª
                .withStyle("natural")
                .build();

        // ç”Ÿæˆåœ–ç‰‡
        ImagePrompt imagePrompt = new ImagePrompt(optimizedPrompt, options);
        ImageResponse response = imageModel.call(imagePrompt);

        String imageUrl = response.getResult().getOutput().getUrl();

        log.info("ç”¢å“åœ–ç‰‡ç”ŸæˆæˆåŠŸï¼š{}", imageUrl);

        return ProductImageResponse.builder()
                .success(true)
                .productName(request.getProductName())
                .category(request.getCategory())
                .imageUrl(imageUrl)
                .prompt(optimizedPrompt)
                .generatedAt(LocalDateTime.now())
                .build();

    } catch (Exception e) {
        log.error("ç”¢å“åœ–ç‰‡ç”Ÿæˆå¤±æ•—", e);
        return ProductImageResponse.builder()
                .success(false)
                .error("ç”Ÿæˆå¤±æ•—ï¼š" + e.getMessage())
                .generatedAt(LocalDateTime.now())
                .build();
    }
}

/**
 * å»ºç«‹å„ªåŒ–çš„ç”¢å“æç¤ºè©
 */
private String buildProductPrompt(ProductImageRequest request) {
    StringBuilder prompt = new StringBuilder();

    prompt.append("A professional product photo of ")
            .append(request.getProductName());

    if (request.getCategory() != null) {
        prompt.append(" (").append(request.getCategory()).append(")");
    }

    if (request.getStyle() != null) {
        prompt.append(", ").append(request.getStyle()).append(" style");
    }

    if (request.getBackground() != null) {
        prompt.append(", on ").append(request.getBackground())
                .append(" background");
    }

    prompt.append(", high quality, detailed, professional lighting, "
            + "commercial photography, 4K resolution");

    if (request.getAdditionalDetails() != null) {
        prompt.append(", ").append(request.getAdditionalDetails());
    }

    return prompt.toString();
}
```

**æç¤ºè©å„ªåŒ–ç­–ç•¥**ï¼š
1. **å°ˆæ¥­è¡“èª**ï¼šä½¿ç”¨ "professional product photo"ã€"commercial photography"
2. **å“è³ªæè¿°**ï¼šåŠ å…¥ "high quality"ã€"4K resolution"
3. **ç´°ç¯€æ§åˆ¶**ï¼šæŒ‡å®šèƒŒæ™¯ã€å…‰ç·šã€é¢¨æ ¼ç­‰
4. **å®¢è£½åŒ–**ï¼šæ ¹æ“šç”¢å“é¡åˆ¥èª¿æ•´æè¿°

### åœ–ç‰‡å“è³ªå„ªåŒ–é…ç½®

```java
// å°æ‡‰ç¯„ä¾‹: chapter5-image-generation/.../ImageModelConfig.java

@Configuration
public class ImageModelConfig {

    /**
     * æ¨™æº–å“è³ªåœ–ç‰‡ç”Ÿæˆæ¨¡å‹
     */
    @Bean
    @Primary
    public ImageOptions defaultImageOptions() {
        return ImageOptionsBuilder.builder()
                .withModel("dall-e-3")
                .withWidth(1024)
                .withHeight(1024)
                .withQuality("standard")
                .withStyle("natural")
                .build();
    }

    /**
     * é«˜å“è³ªåœ–ç‰‡ç”Ÿæˆæ¨¡å‹ï¼ˆç”¨æ–¼é‡è¦å ´åˆï¼‰
     */
    @Bean("hdImageOptions")
    public ImageOptions hdImageOptions() {
        return ImageOptionsBuilder.builder()
                .withModel("dall-e-3")
                .withWidth(1024)
                .withHeight(1792)  // ç›´å¼é«˜è§£æåº¦
                .withQuality("hd")
                .withStyle("vivid")
                .build();
    }
}
```

---

## 5.3.5 æœ€ä½³å¯¦è¸

### æç¤ºè©å·¥ç¨‹æŠ€å·§

```java
/**
 * æç¤ºè©å„ªåŒ–å™¨
 */
@Service
public class PromptOptimizer {

    /**
     * å„ªåŒ–åœ–ç‰‡ç”Ÿæˆæç¤ºè©
     */
    public String optimizePrompt(String userPrompt, String purpose) {
        StringBuilder optimized = new StringBuilder();

        // æ ¹æ“šç”¨é€”æ·»åŠ å‰ç¶´
        String prefix = switch (purpose.toLowerCase()) {
            case "product" -> "A professional product photograph of ";
            case "portrait" -> "A high-quality portrait of ";
            case "landscape" -> "A stunning landscape photo of ";
            case "abstract" -> "An abstract artistic representation of ";
            default -> "";
        };

        optimized.append(prefix).append(userPrompt);

        // æ·»åŠ å“è³ªæè¿°
        optimized.append(", high resolution, detailed, "
                + "professional quality, beautiful lighting");

        // æ ¹æ“šç”¨é€”æ·»åŠ å¾Œç¶´
        String suffix = switch (purpose.toLowerCase()) {
            case "product" -> ", white background, commercial photography";
            case "portrait" -> ", natural lighting, bokeh background";
            case "landscape" -> ", golden hour, cinematic";
            case "abstract" -> ", vibrant colors, creative composition";
            default -> "";
        };

        optimized.append(suffix);

        return optimized.toString();
    }
}
```

### éŒ¯èª¤è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶

```java
/**
 * å¸¶é‡è©¦æ©Ÿåˆ¶çš„åœ–ç‰‡ç”Ÿæˆ
 */
@Service
public class RobustImageGenerationService {

    private final ImageModel imageModel;
    private static final int MAX_RETRIES = 3;

    public ImageGenerationResponse generateWithRetry(
            ImageGenerationRequest request) {

        int retries = 0;
        Exception lastException = null;

        while (retries < MAX_RETRIES) {
            try {
                ImagePrompt prompt = createImagePrompt(request);
                ImageResponse response = imageModel.call(prompt);

                return ImageGenerationResponse.builder()
                        .success(true)
                        .imageUrl(response.getResult().getOutput().getUrl())
                        .build();

            } catch (Exception e) {
                lastException = e;
                retries++;
                log.warn("åœ–ç‰‡ç”Ÿæˆå¤±æ•—ï¼Œç¬¬ {} æ¬¡é‡è©¦", retries);

                if (retries < MAX_RETRIES) {
                    try {
                        Thread.sleep(1000 * retries);  // æŒ‡æ•¸é€€é¿
                    } catch (InterruptedException ie) {
                        Thread.currentThread().interrupt();
                        break;
                    }
                }
            }
        }

        log.error("åœ–ç‰‡ç”Ÿæˆæœ€çµ‚å¤±æ•—", lastException);
        return ImageGenerationResponse.builder()
                .success(false)
                .error("ç”Ÿæˆå¤±æ•—ï¼Œå·²é‡è©¦ " + MAX_RETRIES + " æ¬¡")
                .build();
    }
}
```

---

## ğŸ“ æœ¬ç« é‡é»å›é¡§

1. **åœ–ç‰‡ç”Ÿæˆç†è§£**ï¼šæŒæ¡äº† AI åœ–ç‰‡ç”Ÿæˆçš„åŸç†å’Œæ‡‰ç”¨å ´æ™¯
2. **æ¨¡å‹é¸æ“‡**ï¼šäº†è§£äº†ä¸åŒåœ–ç‰‡ç”Ÿæˆæ¨¡å‹çš„ç‰¹é»å’Œæˆæœ¬
3. **API å¯¦ç¾**ï¼šå»ºç«‹äº†å®Œæ•´çš„åœ–ç‰‡ç”Ÿæˆ REST API
4. **é€²éšåŠŸèƒ½**ï¼šå¯¦ç¾äº†ç”¢å“åœ–ç‰‡ç”Ÿæˆå’Œæç¤ºè©å„ªåŒ–
5. **æœ€ä½³å¯¦è¸**ï¼šæŒæ¡äº†éŒ¯èª¤è™•ç†å’Œå“è³ªå„ªåŒ–æŠ€å·§

### æŠ€è¡“è¦é»ç¸½çµ

| æŠ€è¡“é» | é‡è¦æ€§ | å¯¦ç¾é›£åº¦ | ä½¿ç”¨å ´æ™¯ |
|--------|--------|----------|----------|
| **åŸºç¤ç”Ÿæˆ** | â­â­â­ | ä½ | æ‰€æœ‰åœ–ç‰‡ç”Ÿæˆæ‡‰ç”¨ |
| **æç¤ºè©å„ªåŒ–** | â­â­â­ | ä¸­ | æå‡ç”Ÿæˆå“è³ª |
| **æ‰¹æ¬¡è™•ç†** | â­â­ | ä¸­ | å¤§é‡åœ–ç‰‡ç”Ÿæˆ |
| **éŒ¯èª¤è™•ç†** | â­â­â­ | ä¸­ | ç”Ÿç”¢ç’°å¢ƒç©©å®šæ€§ |
| **æˆæœ¬æ§åˆ¶** | â­â­ | ä½ | å•†æ¥­æ‡‰ç”¨ |

### æœ€ä½³å¯¦è¸å»ºè­°

**1. æç¤ºè©è¨­è¨ˆ**
- âœ… ä½¿ç”¨å°ˆæ¥­è¡“èªæå‡å“è³ª
- âœ… æ˜ç¢ºæŒ‡å®šé¢¨æ ¼å’Œç´°ç¯€
- âœ… æ ¹æ“šç”¨é€”å„ªåŒ–æç¤ºè©
- âœ… æ¸¬è©¦ä¸åŒçš„æè¿°æ–¹å¼

**2. æˆæœ¬å„ªåŒ–**
- âœ… æ ¹æ“šéœ€æ±‚é¸æ“‡å“è³ªç­‰ç´š
- âœ… ä½¿ç”¨å¿«å–é¿å…é‡è¤‡ç”Ÿæˆ
- âœ… æ‰¹æ¬¡è™•ç†é™ä½å–®åƒ¹
- âœ… ç›£æ§ API ä½¿ç”¨é‡

**3. å“è³ªæ§åˆ¶**
- âœ… é©—è­‰ç”Ÿæˆçµæœ
- âœ… æä¾›é‡æ–°ç”Ÿæˆé¸é …
- âœ… å„²å­˜æˆåŠŸçš„æç¤ºè©
- âœ… å»ºç«‹æç¤ºè©è³‡æ–™åº«

### å¯¦å‹™æŠ€å·§

```java
// âœ… å¥½çš„å¯¦è¸ï¼šè©³ç´°çš„æç¤ºè©
String prompt = "A professional product photo of a modern wireless headphone, "
        + "black color, on white background, "
        + "professional lighting, commercial photography, "
        + "high resolution, 4K quality, detailed texture";

// âŒ ä¸å¥½çš„å¯¦è¸ï¼šéæ–¼ç°¡å–®
String prompt = "headphone";

// âœ… å¥½çš„å¯¦è¸ï¼šå®Œæ•´çš„éŒ¯èª¤è™•ç†
try {
    ImageResponse response = imageModel.call(prompt);
    return response.getResult().getOutput().getUrl();
} catch (Exception e) {
    log.error("åœ–ç‰‡ç”Ÿæˆå¤±æ•—", e);
    return fallbackImageUrl;  // æä¾›å‚™ç”¨åœ–ç‰‡
}
```

### ä¸‹ä¸€æ­¥å­¸ç¿’æ–¹å‘

åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘å€‘å°‡å­¸ç¿’åœ–ç‰‡ç·¨è¼¯åŠŸèƒ½ï¼ŒåŒ…æ‹¬åœ–ç‰‡ä¿®æ”¹ã€é¢¨æ ¼è½‰æ›ç­‰é€²éšæŠ€è¡“ï¼Œé€²ä¸€æ­¥æ“´å±• AI åœ–ç‰‡è™•ç†èƒ½åŠ›ã€‚

---

**åƒè€ƒè³‡æ–™ï¼š**
- [Spring AI Image Generation Documentation](https://docs.spring.io/spring-ai/reference/api/image.html)
- [OpenAI DALL-E API](https://platform.openai.com/docs/guides/images)
- [Stability AI Documentation](https://platform.stability.ai/docs)
- å®Œæ•´ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼š`code-examples/chapter5-image-generation`
