
# 5.3 透過 Spring AI 生成美女圖

> **本章重點**：學習使用 Spring AI 的圖片生成功能，掌握文字轉圖片（Text-to-Image）技術，建立完整的 AI 圖片生成應用，探索 AI 的創作能力。

## 🎯 學習目標

完成本章學習後，您將能夠：

- 🎯 **理解圖片生成技術**：掌握文字轉圖片的核心原理和應用場景
- 🎯 **選擇合適的生成模型**：了解各種圖片生成 AI 模型的特點和成本
- 🎯 **實現圖片生成功能**：建立完整的圖片生成 API 和管理系統
- 🎯 **優化生成品質**：掌握提示詞工程和參數調整技巧
- 🎯 **企業級應用設計**：建立可商用的圖片生成服務架構

---

## 5.3.1 AI 圖片生成的革命性影響

### 文生圖 AI 將會是最大圖庫

![AI 圖片生成](https://ithelp.ithome.com.tw/upload/images/20240810/20161290xVSyazJmHj.png)

昨天學了如何上傳圖片給 AI 辨識，今天我們讓 AI 來產生圖片吧！AI 圖片生成技術正在徹底改變創意產業，從概念設計到商業插圖，AI 都能在幾秒鐘內生成高品質的圖片。

### AI 圖片生成的核心價值

**1. 創意無限制**
- 🎨 **即時創作**：從文字描述到視覺呈現，幾秒鐘完成
- 🌈 **風格多樣**：支援寫實、卡通、油畫、水彩等各種風格
- 🔄 **快速迭代**：輕鬆調整和優化創作內容
- 💡 **靈感激發**：AI 能提供意想不到的創意組合

**2. 成本效益顯著**
- 💰 **降低成本**：無需聘請專業設計師或購買版權圖片
- ⏰ **節省時間**：從數天的設計週期縮短到幾分鐘
- 📈 **規模化生產**：批次生成大量圖片內容
- 🎯 **客製化程度高**：精確符合特定需求

**3. 應用場景廣泛**
- 🛒 **電商應用**：商品展示圖、廣告素材、品牌視覺
- 📚 **內容創作**：部落格配圖、社群媒體素材、簡報圖片
- 🎮 **遊戲開發**：角色設計、場景概念圖、道具素材
- 🏢 **企業應用**：行銷素材、產品原型、視覺化報告

---

## 5.3.2 Spring AI 支援的圖片生成模型

### 主要支援的 AI 服務商

| 服務商 | 模型 | 特色 | 成本 | 推薦度 | 適用場景 |
|--------|------|------|------|--------|----------|
| **OpenAI** | DALL-E 3 | 高品質、理解複雜指令 | 高 | ⭐⭐⭐⭐⭐ | 專業設計、商業用途 |
| **Stability AI** | Stable Diffusion | 開源、可本地部署 | 中 | ⭐⭐⭐⭐ | 自主控制、客製化 |
| **ZhiPu AI** | CogView-3 | 中文友善、便宜 | 低 | ⭐⭐⭐ | 學習測試、中文內容 |
| **QianFan** | 文心一言 | 百度服務、本土化 | 低 | ⭐⭐ | 大陸市場應用 |
| **Midjourney** | V6 | 藝術性強、社群活躍 | 中 | ⭐⭐⭐⭐ | 藝術創作、概念設計 |

### 成本效益分析

根據最新測試數據，以下是各服務商的成本對比：

```
💰 成本排序（每張圖片）：
1. ZhiPu AI: 免費額度 + ¥0.01-0.05
2. Stability AI: $0.002-0.01
3. QianFan: ¥0.02-0.08
4. Midjourney: $0.05-0.15
5. OpenAI DALL-E 3: $0.040-0.080

🎯 推薦策略：
- 學習測試：ZhiPu AI（免費額度充足）
- 商業應用：OpenAI DALL-E 3（品質最佳）
- 大量生成：Stability AI（成本最低）
- 藝術創作：Midjourney（風格獨特）
```

### 模型能力對比

| 能力維度 | DALL-E 3 | Stable Diffusion | CogView-3 | 文心一言 |
|----------|----------|------------------|-----------|----------|
| **圖片品質** | 9/10 | 8/10 | 7/10 | 6/10 |
| **指令理解** | 9/10 | 7/10 | 8/10 | 7/10 |
| **中文支援** | 7/10 | 6/10 | 9/10 | 9/10 |
| **生成速度** | 8/10 | 9/10 | 8/10 | 7/10 |
| **風格多樣性** | 8/10 | 9/10 | 7/10 | 6/10 |
| **成本效益** | 6/10 | 9/10 | 9/10 | 8/10 |

---

## 5.3.3 ZhiPu AI 整合實戰

### 申請和配置

**1. 申請 API Key**

前往 ZhiPu AI 官網 [https://open.bigmodel.cn/](https://open.bigmodel.cn/) 註冊後，在 API 密鑰頁面取得你的 API Key。

![ZhiPu AI API Key](https://ithelp.ithome.com.tw/upload/images/20240806/20161290qkPNJ0Ho4Y.png)

**2. 引入依賴**

在 `pom.xml` 中添加 ZhiPu AI 依賴：

```xml
<!-- 使用 Spring AI BOM 管理版本 -->
<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>org.springframework.ai</groupId>
            <artifactId>spring-ai-bom</artifactId>
            <version>1.0.0</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>

<dependencies>
    <!-- Spring AI ZhiPu AI Starter -->
    <dependency>
        <groupId>org.springframework.ai</groupId>
        <artifactId>spring-ai-zhipuai-spring-boot-starter</artifactId>
    </dependency>
    
    <!-- Spring Boot Web -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    
    <!-- Spring Boot Validation -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-validation</artifactId>
    </dependency>
    
    <!-- Lombok -->
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
        <optional>true</optional>
    </dependency>
</dependencies>
```

**3. 設定專案參數**

在 `application.yml` 中配置：

```yaml
spring:
  application:
    name: ai-image-generator
  ai:
    zhipuai:
      api-key: ${ZHIPUAI_API_KEY}
      base-url: https://open.bigmodel.cn/api/paas/v4
      image:
        options:
          model: cogview-3
          width: 1024
          height: 1024
          quality: standard
          style: vivid

# 應用程式配置
app:
  image:
    generation:
      max-batch-size: 5
      default-timeout: 30s
      cache-enabled: true
      output-directory: ./generated-images

# 日誌配置
logging:
  level:
    org.springframework.ai: DEBUG
    com.example: DEBUG
```

---

## 5.3.4 基礎圖片生成功能

### 簡單圖片生成 API

```java

@RestController
@RequestMapping("/api/image")
@RequiredArgsConstructor
@Slf4j
public class ImageGenerationController {
    
    private final ImageModel imageModel;
    
    /**
     * 基礎圖片生成
     * @param prompt 圖片描述
     * @return HTML 格式的圖片展示頁面
     */
    @GetMapping("/generate")
    public ResponseEntity<String> generateImage(@RequestParam String prompt) {
        try {
            log.info("開始生成圖片，提示詞：{}", prompt);
            
            // 建立圖片生成請求
            ImagePrompt imagePrompt = new ImagePrompt(prompt);
            
            // 呼叫 AI 模型生成圖片
            ImageResponse response = imageModel.call(imagePrompt);
            Image image = response.getResult().getOutput();
            
            // 建立 HTML 回應
            String htmlResponse = String.format("""
                <!DOCTYPE html>
                <html lang="zh-TW">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>AI 圖片生成結果</title>
                    <style>
                        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
                        .container { text-align: center; }
                        .image-container { margin: 20px 0; }
                        .generated-image { max-width: 100%%; height: auto; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
                        .prompt { background: #f5f5f5; padding: 15px; border-radius: 5px; margin: 20px 0; }
                        .info { color: #666; font-size: 14px; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <h1>🎨 AI 圖片生成結果</h1>
                        <div class="prompt">
                            <h3>📝 提示詞</h3>
                            <p><strong>%s</strong></p>
                        </div>
                        <div class="image-container">
                            <img src="%s" alt="%s" class="generated-image">
                        </div>
                        <div class="info">
                            <p>🤖 由 Spring AI + ZhiPu AI 生成</p>
                            <p>⏰ 生成時間：%s</p>
                        </div>
                    </div>
                </body>
                </html>
                """, 
                prompt, 
                image.getUrl(), 
                prompt,
                java.time.LocalDateTime.now().format(
                    java.time.format.DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss")
                )
            );
            
            return ResponseEntity.ok()
                    .contentType(MediaType.TEXT_HTML)
                    .body(htmlResponse);
            
        } catch (Exception e) {
                       
            return ResponseEntity.badRequest()
                    .contentType(MediaType.TEXT_HTML)
                    .body(e.message());
        }
    }
    
    /**
     * JSON 格式的圖片生成 API
     * @param request 生成請求
     * @return JSON 格式的回應
     */
    @PostMapping("/generate-json")
    public ResponseEntity<ImageGenerationResponse> generateImageJson(
            @RequestBody @Valid ImageGenerationRequest request) {
        
        try {
            log.info("JSON API 圖片生成請求：{}", request.getPrompt());
            
            ImagePrompt imagePrompt = new ImagePrompt(request.getPrompt());
            ImageResponse response = imageModel.call(imagePrompt);
            Image image = response.getResult().getOutput();
            
            ImageGenerationResponse result = ImageGenerationResponse.builder()
                    .success(true)
                    .imageUrl(image.getUrl())
                    .prompt(request.getPrompt())
                    .model("cogview-3")
                    .timestamp(java.time.LocalDateTime.now())
                    .build();
            
            return ResponseEntity.ok(result);
            
        } catch (Exception e) {
            log.error("JSON API 圖片生成失敗", e);
            
            ImageGenerationResponse errorResult = ImageGenerationResponse.builder()
                    .success(false)
                    .error(e.getMessage())
                    .prompt(request.getPrompt())
                    .timestamp(java.time.LocalDateTime.now())
                    .build();
            
            return ResponseEntity.badRequest().body(errorResult);
        }
    }
}
```
---
## 5.3.5 進階圖片生成功能

### 批次圖片生成

```java
@Service
@RequiredArgsConstructor
@Slf4j
public class BatchImageGenerationService {
    
    private final ImageModel imageModel;
    
    /**
     * 批次生成圖片
     * @param prompts 提示詞列表
     * @return 生成結果列表
     */
    public List<BatchImageResult> batchGenerate(List<String> prompts) {
        log.info("開始批次生成 {} 張圖片", prompts.size());
        
        List<CompletableFuture<BatchImageResult>> futures = prompts.stream()
                .map(this::generateImageAsync)
                .collect(Collectors.toList());
        
        // 等待所有任務完成
        CompletableFuture<Void> allFutures = CompletableFuture.allOf(
                futures.toArray(new CompletableFuture[0])
        );
        
        return allFutures.thenApply(v -> 
                futures.stream()
                        .map(CompletableFuture::join)
                        .collect(Collectors.toList())
        ).join();
    }
    
    /**
     * 非同步生成單張圖片
     */
    private CompletableFuture<BatchImageResult> generateImageAsync(String prompt) {
        return CompletableFuture.supplyAsync(() -> {
            try {
                ImagePrompt imagePrompt = new ImagePrompt(prompt);
                ImageResponse response = imageModel.call(imagePrompt);
                Image image = response.getResult().getOutput();
                
                return BatchImageResult.builder()
                        .prompt(prompt)
                        .imageUrl(image.getUrl())
                        .success(true)
                        .timestamp(java.time.LocalDateTime.now())
                        .build();
                
            } catch (Exception e) {
                log.error("批次生成失敗：{}", prompt, e);
                
                return BatchImageResult.builder()
                        .prompt(prompt)
                        .success(false)
                        .error(e.getMessage())
                        .timestamp(java.time.LocalDateTime.now())
                        .build();
            }
        });
    }
}
```

### 圖片風格和品質控制

```java
@Service
@RequiredArgsConstructor
public class AdvancedImageGenerationService {
    
    private final ImageModel imageModel;
    
    /**
     * 生成美女圖片（高品質）
     * @param description 美女描述
     * @param style 風格選擇
     * @return 圖片 URL
     */
    public String generateBeautyImage(String description, BeautyStyle style) {
        // 建構專業的美女圖片提示詞
        String enhancedPrompt = buildBeautyPrompt(description, style);
        
        // 設定高品質選項
        ZhiPuAiImageOptions options = ZhiPuAiImageOptions.builder()
                .withModel("cogview-3")
                .withWidth(1024)
                .withHeight(1024)
                .withQuality("hd")
                .withStyle("vivid")
                .build();
        
        ImagePrompt imagePrompt = new ImagePrompt(enhancedPrompt, options);
        return imageModel.call(imagePrompt).getResult().getOutput().getUrl();
    }
    
    /**
     * 建構美女圖片提示詞
     */
    private String buildBeautyPrompt(String description, BeautyStyle style) {
        String basePrompt = "A beautiful woman, " + description;
        
        String stylePrompt = switch (style) {
            case REALISTIC -> ", photorealistic, high quality, professional photography, natural lighting, detailed features";
            case ANIME -> ", anime style, manga art, beautiful anime girl, detailed anime artwork, vibrant colors";
            case PORTRAIT -> ", professional portrait, studio lighting, elegant pose, high-end fashion photography";
            case ARTISTIC -> ", artistic style, oil painting, renaissance art, classical beauty, masterpiece quality";
            case MODERN -> ", modern style, contemporary fashion, urban setting, trendy outfit, stylish appearance";
        };
        
        String qualityPrompt = ", 8k resolution, ultra detailed, masterpiece, best quality, highly detailed";
        
        return basePrompt + stylePrompt + qualityPrompt;
    }
```

---

## 5.3.6 OpenAI DALL-E 3 整合

### DALL-E 3 配置

```java
@Configuration
public class ImageModelConfig {
    
    @Value("${spring.ai.openai.api-key}")
    private String openaiApiKey;
    
    /**
     * OpenAI DALL-E 3 模型配置（高品質）
     */
    @Bean("dalleImageModel")
    @Profile("dalle")
    public ImageModel dalleImageModel() {
        return new OpenAiImageModel(
            new OpenAiImageApi(openaiApiKey),
            org.springframework.ai.openai.OpenAiImageOptions.builder()
                .withModel("dall-e-3")
                .withQuality("hd")
                .withStyle("vivid")
                .withSize("1024x1024")
                .build()
        );
    }
}
```
---
## 📝 本章重點回顧

1. **圖片生成技術理解**：掌握了文字轉圖片的核心原理和應用價值
2. **多模型整合**：學會了 ZhiPu AI、OpenAI DALL-E 3 等多種模型的使用

### 下一步學習方向

在下一章中，我們將學習如何建立字幕產生器，探索音訊轉文字技術，為多媒體內容處理提供完整的解決方案。


> 💡 **詳細實現**：詳見 `code-examples/chapter5-spring-ai-advanced/src/main/java/com/example/` 中的圖片處理服務

---

## 📝 本章重點回顧

1. **圖片生成技術理解**：掌握了文字轉圖片的核心原理和應用價值
2. **多模型整合**：學會了 ZhiPu AI、OpenAI DALL-E 3、Gemini 2.5 Flash Image 等多種模型的使用

---

**參考資料：**
- [Spring AI Image Generation Documentation](https://docs.spring.io/spring-ai/reference/api/imageclient.html)
- [OpenAI DALL-E 3 API](https://platform.openai.com/docs/guides/images)
- [Gemini 2.5 Flash Image 官方文檔](https://ai.google.dev/gemini-api/docs/image-generation)
- [ZhiPu AI CogView Documentation](https://open.bigmodel.cn/dev/api#cogview)
- [Stability AI API Reference](https://platform.stability.ai/docs/api-reference)