# 4.1 取得 AI 入門鑰匙 API key

> **對應章節**: Day11
> **對應範例**: `chapter4-spring-ai-intro`
> **難度**: ⭐⭐☆☆☆

---

## 📚 本章概要

API Key 是使用 AI 服務的入場券。本章將帶您了解如何申請和配置各種 AI 服務的 API 金鑰，並掌握安全管理和成本控制的最佳實踐。

**學習目標**:
- 理解 API Key 的重要性與工作原理
- 掌握主流 AI 服務提供商的申請流程
- 學會安全地配置和管理 API 金鑰
- 了解不同模型的定價策略和成本控制
- 建立多服務提供商的彈性切換機制

---

## 4.1.1 為什麼需要 API Key？

### 開啟 AI 的鑰匙

![AI API Key](https://ithelp.ithome.com.tw/upload/images/20240810/20161290sQLWvAdoDT.jpg)

平常使用 ChatGPT 或其他類似的對話 AI 都可直接使用，大不了額度沒了會降為效果比較差的模型，不過要進行程式開發就需要先申請 API key，除非使用本地的 LLM。

### 沒有 API Key 會怎樣？

```
問題場景: 開發 AI 應用程式時

❌ 沒有 API Key:
- 無法程式化呼叫 AI 服務
- 無法整合進企業系統
- 無法控制成本和用量
- 無法追蹤使用紀錄

✅ 有了 API Key:
- 可以透過程式呼叫 AI
- 整合進任何應用系統
- 精確控制預算和配額
- 完整的使用分析報告
```

**API Key 的重要性**：
- 🔐 **身份認證**：證明您有權限使用 AI 服務
- 💰 **計費管理**：追蹤和控制 API 使用成本
- 🚦 **流量控制**：管理 API 呼叫頻率和配額
- 📊 **使用統計**：監控 API 使用情況和效能
- 🛡️ **安全保護**：防止未授權的 API 存取

### AI 服務成本革命

原本凱文大叔測試 AI 都以本地 LLM 或是一些免費的服務為主，不過 2025 年 8 月 [OpenAI 正式發布 GPT-5](https://openai.com/index/introducing-gpt-5/) 系列模型後就完全改觀了：

**GPT-5 革命性優勢**：
- 🚀 **統一系統**：結合推理和快速回應的統一 AI 模型
- 💡 **超強性能**：數學能力 94.6%，編程能力 74.9%，減少 45% 錯誤率
- 💰 **彈性定價**：GPT-5 Nano 只需 $0.05/百萬 Token，超低成本入門
- ⚡ **多層選擇**：從 Nano 到完整版 GPT-5，滿足不同需求
- 🎯 **降低門檻**：讓原本猶豫不決的開發人員一起加入 AI 的賽道

---

## 4.1.2 主要 AI 服務提供商

### OpenAI - 業界標竿

**申請步驟**：
1. **註冊帳號**：前往 [OpenAI Platform](https://platform.openai.com/)
2. **驗證身份**：提供手機號碼進行驗證
3. **建立 API Key**：
   - 點擊右上角個人頭像
   - 選擇「View API keys」
   - 點擊「Create new secret key」
   - 為 Key 命名（如：spring-ai-demo）
   - 複製並安全保存 API Key

**重要提醒**：
```
⚠️ API Key 只會顯示一次，請務必立即複製並安全保存！
```

**OpenAI 模型選擇**：

| 模型 | 適用場景 | 成本 | 特點 | 定價 (每百萬 Token) |
|------|----------|------|------|-------------------|
| **GPT-5** | 最複雜任務、專業級應用 | 極高 | 🚀 2025最新旗艦，統一推理系統 | 輸入$1.25 / 輸出$10 |
| **GPT-5 Mini** | 平衡型選擇、商業應用 | 中高 | ⚡ 中等性能，支援推理功能 | 輸入$0.25 / 輸出$2 |
| **GPT-5 Nano** | 開發測試、輕量應用 | 低 | 💡 輕量高效，入門推薦 | 輸入$0.05 / 輸出$0.40 |
| **o1** | 複雜推理、數學、編程 | 極高 | 🧠 深度思考推理專家 | - |
| **GPT-4o mini** | 舊版輕量選擇 | 低 | 📊 經典性價比選擇 | - |

### Groq - 高速推理

**特色**：
- ⚡ **超高速度**：推理速度極快
- 🆓 **免費使用**：目前提供免費服務
- 🎯 **開發友好**：適合開發和測試階段

**申請步驟**：
1. 前往 [Groq Console](https://console.groq.com/)
2. 使用 Google 或 GitHub 帳號登入
3. 在 API Keys 頁面建立新的 API Key
4. 複製並保存 API Key

### Google Gemini - Google 的智能選擇

**特色**：
- 🧠 **多模態能力**：支援文字、圖片、音訊等多模態輸入
- 🚀 **持續創新**：Google 持續投入 AI 領域，模型不斷進化
- 🎯 **生態整合**：與 Google Cloud 生態系統無縫整合

**申請步驟**：
1. **註冊帳號**：前往 [Google AI Studio](https://makersuite.google.com/app/apikey)
2. **建立 API Key**：
   - 登入後點擊「Create API key in new project」
   - 複製並安全保存 API Key

**Gemini 模型選擇**：

| 模型 | 適用場景 | 成本 | 特點 |
|------|----------|------|------|
| **gemini-2.5-pro** | 複雜任務、專業級應用 | 中高 | 性能強大，支援多模態 |
| **gemini-2.5-flash** | 輕量應用、快速回應 | 低 | 速度快，成本效益高 |

### Anthropic Claude - 最新智能選擇

**2025 年最強寫程式 AI**：
- 🧠 **Claude 4 系列**：業界最新的智能模型
- 🎯 **多模態能力**：支援文字、圖片、PDF 處理
- 💡 **思考功能**：Claude Opus 4.1 具備透明推理過程
- 🔧 **工具整合**：完整支援函數調用和工具使用
- 💰 **彈性定價**：從便宜的 Haiku 到強大的 Opus

**申請步驟**：
1. **註冊帳號**：前往 [Anthropic Console](https://console.anthropic.com/)
2. **建立 API Key**：
   - 登入後進入 [API Keys](https://console.anthropic.com/settings/keys)
   - 點擊「Create Key」
   - 為 Key 命名並設定權限
   - 複製並安全保存 API Key

**Claude 模型選擇**：

| 模型 | 適用場景 | 成本 | 特點 |
|------|----------|------|------|
| **Claude Opus 4.1** | 最複雜的推理任務 | 極高 | 最強智能，編碼專家 |
| **Claude Sonnet 4** | 平衡型選擇 | 高 | 高效能，100萬 Token 語境 |

---

## 4.1.3 API Key 配置與管理

### Spring Boot 配置方式

**1. application.yml 配置**

以下是 `application.yml` 中配置 AI 服務 API Key 的範例。這些鍵值會從環境變數中讀取，確保敏感資訊不會硬編碼在程式碼中。

```yaml
# 對應範例: chapter4-spring-ai-intro/.../application.yml:3-24
spring:
  application:
    name: spring-ai-intro
  ai:
    openai:
      api-key: ${OPENAI_API_KEY}           # 從環境變數讀取
      base-url: https://api.openai.com
      chat:
        options:
          model: gpt-4o-mini                # 預設模型
          temperature: 0.7                  # 創意度
          max-tokens: 1000                  # 最大輸出長度
          stream: true                      # 啟用流式輸出

# 應用程式配置
server:
  port: 8080
  servlet:
    encoding:
      charset: UTF-8                        # 確保中文正常顯示
      enabled: true
      force: true
```

**環境變數說明**:
- `${OPENAI_API_KEY}`: 從系統環境變數或 `.env` 檔案讀取
- 使用 `:` 設定預設值，例如 `${GROQ_API_KEY:}` 表示可選配置

**2. 環境變數設定**

建議使用 `.env` 檔案或系統環境變數來管理 API Key。

```bash
# .env 檔案範例 (code-examples/chapter4-spring-ai-intro/.env.example)
OPENAI_API_KEY=sk-your-openai-api-key-here
GROQ_API_KEY=gsk-your-groq-api-key-here
GEMINI_API_KEY=your-gemini-api-key-here
```

**3. IDE 環境變數配置**

在 STS4 或 IntelliJ IDEA 中，您可以透過 Run/Debug Configurations 來設定環境變數。

### 安全最佳實踐

**1. 絕不將 API Key 寫入程式碼**

始終透過環境變數或 Spring 的 `@Value` 註解來注入 API Key。

```java
// ❌ 錯誤做法 - 硬編碼 API Key
public class BadExample {
    private static final String API_KEY = "sk-1234567890abcdef"; // 危險！
}

// ✅ 正確做法 - 使用環境變數注入
// 對應範例: chapter4-spring-ai-intro/.../config/AiConfig.java:18-25
@Configuration
public class AiConfig {

    @Value("${spring.ai.openai.api-key}")
    private String openaiApiKey;                     // OpenAI API Key

    @Value("${spring.ai.groq.api-key:}")
    private String groqApiKey;                       // Groq API Key (可選)

    /**
     * 自定義 ChatClient 配置
     */
    @Bean
    public ChatClient chatClient(ChatClient.Builder builder) {
        return builder
                .defaultSystem("你是一個友善且專業的 AI 助手")
                .build();
    }
}
```

**2. 使用 .env 檔案（開發環境）**

將 `.env` 檔案加入 `.gitignore`，避免意外提交到版本控制系統。

---

## 4.1.4 成本控制與監控

### OpenAI 成本管理

**1. 設定使用限制**

在 OpenAI Platform 設定月度預算上限和使用量警告通知。

**2. 模型選擇策略**

在 `application.yml` 中選擇成本效益高的模型，例如 `gpt-4o-mini`。

### 使用量監控

Spring Boot Actuator 和 Micrometer 可以幫助您監控 AI API 的呼叫次數和回應時間。

---

### 容錯機制

您可以實作模型路由服務，在一個模型失敗時自動切換到另一個模型，提高系統的可用性。

---

## 📝 本章重點回顧

### API Key 管理核心
✅ 身份認證 - 證明使用 AI 服務的權限
✅ 成本控制 - 追蹤和管理 API 使用成本
✅ 安全配置 - 透過環境變數保護敏感資訊
✅ 多模型支援 - 彈性切換不同的 AI 服務提供商

### 主要 AI 服務提供商
- **OpenAI**: 業界標竿，GPT-5 系列最新模型
- **Groq**: 高速推理，免費使用，適合開發測試
- **Google Gemini**: 多模態能力，與 Google Cloud 整合
- **Anthropic Claude**: 最強編碼能力，支援100萬 Token 語境

### 配置最佳實踐
- 使用 `application.yml` + 環境變數管理 API Key
- 絕不硬編碼 API Key 在程式碼中
- 將 `.env` 檔案加入 `.gitignore`
- 設定使用限制和預算警告

### 成本優化建議
- 開發階段: 使用 Groq（免費）或 GPT-4o-mini
- 生產環境: 根據任務複雜度選擇適當模型
- 設定合理的 max-tokens 限制
- 實作快取機制避免重複呼叫

---

## 🚀 下一步

👉 [4.2 Hello AI World](./4.2.md) - 建立第一個 Spring AI 應用程式

---

**相關章節**:
- ← 上一章: [4.0 Spring AI 的誕生與價值](./4.0.md)
- → 下一章: [4.2 Hello AI World](./4.2.md)

**參考資料：**
- [OpenAI Platform Documentation](https://platform.openai.com/docs)
- [Groq API Documentation](https://console.groq.com/docs)
- [Spring AI Reference Guide](https://docs.spring.io/spring-ai/reference/)
- [Google AI Studio](https://makersuite.google.com/)
- [Anthropic Console](https://console.anthropic.com/)
