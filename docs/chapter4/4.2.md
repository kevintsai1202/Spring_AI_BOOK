# 4.2 Hello AI World

> **å°æ‡‰ç« ç¯€**: Day12
> **å°æ‡‰ç¯„ä¾‹**: `chapter4-spring-ai-intro`
> **é›£åº¦**: â­â­â­â˜†â˜†

---

## ğŸ“š æœ¬ç« æ¦‚è¦

Hello World æ˜¯æ¯å€‹é–‹ç™¼è€…æ¥è§¸æ–°æŠ€è¡“çš„ç¬¬ä¸€æ­¥ã€‚æœ¬ç« å°‡å¸¶æ‚¨å»ºç«‹ç¬¬ä¸€å€‹ Spring AI æ‡‰ç”¨ç¨‹å¼ï¼Œå¯¦ç¾èˆ‡ AI æ¨¡å‹çš„åŸºæœ¬å°è©±åŠŸèƒ½ã€‚

**å­¸ç¿’ç›®æ¨™**:
- ç†è§£ Spring AI çš„æ¶æ§‹è¨­è¨ˆ
- æŒæ¡ ChatClient å’Œ ChatModel çš„ä½¿ç”¨æ–¹æ³•
- å»ºç«‹å¯é‹è¡Œçš„ AI å°è©± RESTful API
- å­¸æœƒé…ç½®å°ˆæ¡ˆä¾è³´å’Œ AI æœå‹™åƒæ•¸
- é©—è­‰ AI æ‡‰ç”¨ç¨‹å¼çš„æ­£ç¢ºæ€§

---

## 4.2.1 Spring AI æ¶æ§‹æ¦‚è¿°

### Hello AI World

![Hello AI World](https://ithelp.ithome.com.tw/upload/images/20240810/201612902bf1GgYwyV.jpg)

å¯«ç¨‹å¼ä¸å…ä¿—è¦ä¾†å€‹ Hello Worldï¼Œä¾æ“šé–‹ç™¼ Spring Boot ç¨‹å¼çš„ç¶“é©—ï¼Œæˆ‘å€‘åªéœ€å®šç¾©è®Šæ•¸ï¼Œä¸¦é€éè‡ªå‹•æ³¨å…¥çš„æ©Ÿåˆ¶å°±èƒ½é–‹å§‹ä½¿ç”¨ï¼Œç‚ºäº†æ¸¬è©¦æ–¹ä¾¿ç›´æ¥å¯«å€‹ APIã€‚

### Spring AI 1.0 GA æ¶æ§‹èªªæ˜

åœ¨ Spring AI 1.0 æ­£å¼ç‰ˆä¸­ï¼ŒChatClient å’Œ ChatModel çš„é—œä¿‚å¦‚ä¸‹ï¼š

```mermaid
graph TD
    subgraph ChatClient
        CC_API[Fluent API]
        CC_METHODS[Call Chain: prompt, user, call, content]
        CC_API --> CC_METHODS
    end

    CC_METHODS --> CM_NODE

    subgraph ChatModel
        CM_NODE[ChatModel]
        CM_PROVIDERS[AI Providers: OpenAI, Azure, Google, etc.]
        CM_NODE --> CM_PROVIDERS
    end
```

**æ ¸å¿ƒçµ„ä»¶èªªæ˜**ï¼š
- **ChatModel**: æä¾›åº•å±¤çš„ AI æ¨¡å‹ä»‹é¢ï¼Œæ˜¯èˆ‡å„ç¨® AI æä¾›å•†ï¼ˆOpenAIã€Azureã€Google ç­‰ï¼‰æºé€šçš„æ ¸å¿ƒæŠ½è±¡å±¤
- **ChatClient**: æä¾›æ›´é«˜ç´šçš„ Fluent APIï¼Œé¡ä¼¼æ–¼ Spring ç”Ÿæ…‹ç³»çµ±ä¸­çš„ RestClientã€WebClient å’Œ JdbcClientï¼Œå…§éƒ¨ä¾è³´ ChatModel ä¾†åŸ·è¡Œå¯¦éš›çš„ AI å‘¼å«

---

## 4.2.2 å°ˆæ¡ˆå»ºç«‹èˆ‡ä¾è³´é…ç½®

### Maven ä¾è³´é…ç½®

é¦–å…ˆç¢ºä¿ä½¿ç”¨æœ€æ–°çš„ Spring AI ç‰ˆæœ¬ã€‚åœ¨ `pom.xml` ä¸­åŠ å…¥å¿…è¦çš„ä¾è³´ï¼š

```xml
<!-- å°æ‡‰ç¯„ä¾‹: chapter4-spring-ai-intro/pom.xml -->
<project>
    <properties>
        <java.version>21</java.version>
        <spring-ai.version>1.0.0-M4</spring-ai.version>
    </properties>

    <!-- Spring AI BOM ç®¡ç†ä¾è³´ç‰ˆæœ¬ -->
    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>org.springframework.ai</groupId>
                <artifactId>spring-ai-bom</artifactId>
                <version>${spring-ai.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
        </dependencies>
    </dependencyManagement>

    <dependencies>
        <!-- Spring AI OpenAI Starter - æ ¸å¿ƒä¾è³´ -->
        <dependency>
            <groupId>org.springframework.ai</groupId>
            <artifactId>spring-ai-openai-spring-boot-starter</artifactId>
        </dependency>

        <!-- Spring Boot Web - æä¾› RESTful API -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <!-- WebFlux - æµå¼è¼¸å‡ºå¿…éœ€ -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-webflux</artifactId>
        </dependency>

        <!-- Lombok - ç°¡åŒ–ç¨‹å¼ç¢¼ -->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>
    </dependencies>
</project>
```

**ä¾è³´èªªæ˜**:
- `spring-ai-openai-spring-boot-starter`: æä¾› OpenAI æ•´åˆå’Œè‡ªå‹•é…ç½®
- `spring-boot-starter-webflux`: æ”¯æ´éŸ¿æ‡‰å¼ç·¨ç¨‹å’Œæµå¼è¼¸å‡º
- `spring-ai-bom`: çµ±ä¸€ç®¡ç† Spring AI ç›¸é—œä¾è³´çš„ç‰ˆæœ¬

### é…ç½®æª”æ¡ˆè¨­å®š

åœ¨ `application.yml` ä¸­è¨­å®š AI æœå‹™é…ç½®ï¼Œä¾‹å¦‚ OpenAI çš„ API Key å’Œæ¨¡å‹é¸æ“‡ï¼š

```yaml
# ä¾†è‡ª code-examples/chapter4-spring-ai-intro/src/main/resources/application.yml
spring:
  application:
    name: spring-ai-intro
  ai:
    openai:
      api-key: ${OPENAI_API_KEY}
      base-url: https://api.openai.com
      chat:
        options:
          model: gpt-4o-mini
          temperature: 0.7
          max-tokens: 1000
          stream: true  # å•Ÿç”¨æµå¼è¼¸å‡º

# æ‡‰ç”¨ç¨‹å¼é…ç½®
server:
  port: 8080
```

---

## 4.2.3 ä½¿ç”¨ ChatClient å¯¦ç¾ AI å°è©±

### åŸºæœ¬ AI æ§åˆ¶å™¨

ä½¿ç”¨ç¾ä»£åŒ–çš„ ChatClient Fluent API ä¾†å»ºç«‹ AI å°è©±ç«¯é»ï¼š

```java
// ä¾†è‡ª code-examples/chapter4-spring-ai-intro/src/main/java/com/example/springai/controller/AiController.java
// ... (package and imports omitted for brevity)

@RestController
@RequestMapping("/api/ai")
@RequiredArgsConstructor
@Slf4j
public class AiController {
    
    private final ChatClient chatClient;

    /**
     * åŸºæœ¬ AI å°è©±ç«¯é»
     * @param prompt ä½¿ç”¨è€…è¼¸å…¥çš„æç¤ºè©
     * @return AI çš„å›æ‡‰
     */
    @GetMapping("/chat")
    public String chat(@RequestParam String prompt) {
        log.info("æ”¶åˆ° AI å°è©±è«‹æ±‚ï¼š{}", prompt);
        
        String response = chatClient.prompt()
                .user(prompt)
                .call()
                .content();
        
        log.info("AI å›æ‡‰ï¼š{}", response);
        return response;
    }
}
```

### è«‹æ±‚ DTO é¡åˆ¥

ç”¨æ–¼æ¥æ”¶å¸¶æœ‰ç³»çµ±æç¤ºè©çš„èŠå¤©è«‹æ±‚ï¼š

```java
// ä¾†è‡ª code-examples/chapter4-spring-ai-intro/src/main/java/com/example/springai/dto/ChatRequest.java
// ... (package and imports omitted for brevity)

@Data
public class ChatRequest {
    private String systemMessage;
    private String userMessage;
}
```

### ç¨‹å¼ç¢¼é‡é»èªªæ˜

**æ ¸å¿ƒè¨»è§£**ï¼š
- **@RestController**: å°ˆé–€ç”¨ä¾†é–‹ç™¼ API çš„æ¨™è¨»
- **@RequiredArgsConstructor**: Lombok æä¾›çš„å¿«é€Ÿæ¨™è¨»ï¼Œå¯å¹«æˆ‘å€‘å¯«ä¸€å€‹å»ºæ§‹å­ä¸¦å°‡ final è®Šæ•¸ç•¶ä½œåƒæ•¸
- **@Slf4j**: Lombok æä¾›çš„æ—¥èªŒæ¨™è¨»

**ChatClient Fluent API**ï¼š
- **chatClient.prompt()**: é–‹å§‹å»ºç«‹èŠå¤©è«‹æ±‚çš„ Fluent API
- **system()**: è¨­å®šç³»çµ±æç¤ºè©ï¼ˆå®šç¾© AI çš„è§’è‰²å’Œè¡Œç‚ºï¼‰
- **user()**: è¨­å®šä½¿ç”¨è€…è¨Šæ¯
- **call()**: åŸ·è¡ŒåŒæ­¥è«‹æ±‚
- **content()**: å–å¾—å›æ‡‰å…§å®¹

---

## 4.2.4 ChatClient è‡ªå‹•é…ç½®èˆ‡å®¢è£½åŒ–

Spring Boot æœƒè‡ªå‹•ç‚ºæˆ‘å€‘é…ç½® ChatClientï¼Œä½†æˆ‘å€‘ä¹Ÿå¯ä»¥é€é `AiConfig` é¡åˆ¥è‡ªå®šç¾©é…ç½®ï¼Œä¾‹å¦‚è¨­å®šé è¨­çš„ç³»çµ±æç¤ºè©æˆ–å‰µå»ºå°ˆç”¨çš„ ChatClient å¯¦ä¾‹ï¼š

```java
// ä¾†è‡ª code-examples/chapter4-spring-ai-intro/src/main/java/com/example/springai/config/AiConfig.java
// ... (package and imports omitted for brevity)

@Configuration
public class AiConfig {
    
    /**
     * è‡ªå®šç¾© ChatClient é…ç½® (é è¨­)
     */
    @Bean
    public ChatClient chatClient(ChatClient.Builder builder) {
        return builder
                .defaultSystem("ä½ æ˜¯ä¸€å€‹å‹å–„ä¸”å°ˆæ¥­çš„ AI åŠ©æ‰‹ï¼Œ" +
                             "å°ˆé–€å”åŠ© Java Spring Boot é–‹ç™¼ã€‚" +
                             "è«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ï¼Œä¸¦æä¾›å¯¦ç”¨çš„ç¨‹å¼ç¢¼ç¯„ä¾‹ã€‚")
                .build();
    }
}
```

### ä½¿ç”¨ç‰¹å®šçš„ ChatClient

æ‚¨å¯ä»¥é€é `@Qualifier` è¨»è§£ä¾†æ³¨å…¥ç‰¹å®šçš„ ChatClient å¯¦ä¾‹ï¼š

```java
// ç¯„ä¾‹ï¼šåœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨ codeChatClient
@RestController
@RequestMapping("/api/code")
@RequiredArgsConstructor
public class CodeGeneratorController {
   
    @Qualifier("codeChatClient")
    private final ChatClient codeChatClient;
   
    @GetMapping("/generate")
    public String generateCode(@RequestParam String description) {
        return codeChatClient.prompt()
                .user("è«‹æ ¹æ“šä»¥ä¸‹æè¿°ç”Ÿæˆ Java ç¨‹å¼ç¢¼ï¼š" + description)
                .call()
                .content();
    }
}
```

---

## 4.2.5 ChatModel ç›´æ¥ä½¿ç”¨æ–¹å¼

å¦‚æœéœ€è¦æ›´ç›´æ¥çš„æ§åˆ¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ `ChatModel`ã€‚`ChatModelService` ç¤ºç¯„äº†å¦‚ä½•ä½¿ç”¨åº•å±¤çš„ `ChatModel` APIï¼š

```java
// ä¾†è‡ª code-examples/chapter4-spring-ai-intro/src/main/java/com/example/springai/service/ChatModelService.java
// ... (package and imports omitted for brevity)

@Service
@RequiredArgsConstructor
@Slf4j
public class ChatModelService {

    private final ChatModel chatModel;
    /**
     * ç°¡å–®å­—ä¸²å‘¼å«
     */
    public String simpleCall(String message) {
        return chatModel.call(message);
    }
}
```

---

## 4.2.6 æ¸¬è©¦ AI æ‡‰ç”¨ç¨‹å¼

### ä½¿ç”¨ Postman / curl æ¸¬è©¦

æ‚¨å¯ä»¥é€é Postman æˆ– `curl` å‘½ä»¤ä¾†æ¸¬è©¦ä¸Šè¿° API ç«¯é»ã€‚

**åŸºæœ¬å°è©±æ¸¬è©¦**
```bash
curl -X GET "http://localhost:8080/api/ai/chat?prompt=ä½ å¥½ï¼Œè«‹ä»‹ç´¹ä¸€ä¸‹Spring AI"
```

**Hello World æ¸¬è©¦**
```bash
curl -X GET "http://localhost:8080/api/ai/hello-world"
```

**å¸¶ç³»çµ±æç¤ºè©çš„å°è©±**
```bash
curl -X POST "http://localhost:8080/api/ai/chat/system" \
     -H "Content-Type: application/json" \
     -d '{
       "systemMessage": "ä½ æ˜¯ä¸€å€‹è³‡æ·±çš„Javaé–‹ç™¼å°ˆå®¶",
       "userMessage": "è«‹è§£é‡‹Spring Bootçš„è‡ªå‹•é…ç½®åŸç†"
     }'
```

### å–®å…ƒæ¸¬è©¦

æ‚¨å¯ä»¥ç‚ºæ§åˆ¶å™¨ç·¨å¯«å–®å…ƒæ¸¬è©¦ï¼Œç¢ºä¿ API è¡Œç‚ºç¬¦åˆé æœŸã€‚

```java
//ç¯„ä¾‹ï¼šAiController çš„å–®å…ƒæ¸¬è©¦
@SpringBootTest
@AutoConfigureWebMvc
class AiControllerTest {
   
    @Autowired
    private MockMvc mockMvc;
   
    @Test
    void testChatEndpoint() throws Exception {
        mockMvc.perform(get("/api/ai/chat")
                .param("prompt", "Hello"))
                .andExpect(status().isOk())
                .andExpect(content().string(org.hamcrest.Matchers.not(org.hamcrest.Matchers.emptyString())));
    }
}
```

---

## 4.2.7 ChatClient vs ChatModel ä½¿ç”¨æ™‚æ©Ÿ

### é¸æ“‡æŒ‡å—

**ä½¿ç”¨ ChatClient ç•¶ä½ éœ€è¦**ï¼š
- âœ… è¤‡é›œçš„æç¤ºè©çµ„åˆ
- âœ… ç³»çµ±æç¤ºè©è¨­å®š
- âœ… æµå¼è¼¸å‡ºï¼ˆä¸‹ä¸€ç« ä»‹ç´¹ï¼‰
- âœ… æ›´è±å¯Œçš„ API åŠŸèƒ½
- âœ… ç¾ä»£åŒ–çš„ Fluent API é«”é©—

**ä½¿ç”¨ ChatModel ç•¶ä½ éœ€è¦**ï¼š
- âœ… ç°¡å–®ç›´æ¥çš„ AI å‘¼å«
- âœ… æ›´åº•å±¤çš„æ§åˆ¶
- âœ… åŸå§‹çš„ Prompt ç‰©ä»¶æ“ä½œ
- âœ… è‡ªå®šç¾©è¤‡é›œçš„æç¤ºè©æ¨¡æ¿

---

## ğŸ“ æœ¬ç« é‡é»å›é¡§

### Spring AI æ¶æ§‹
âœ… ChatClient - é«˜ç´š Fluent APIï¼Œé¡ä¼¼ RestClient/WebClient
âœ… ChatModel - åº•å±¤æŠ½è±¡ä»‹é¢ï¼Œçµ±ä¸€ä¸åŒ AI æä¾›å•†
âœ… Provider Implementations - å„ AI æœå‹™çš„å…·é«”å¯¦ç¾
âœ… è‡ªå‹•é…ç½® - Spring Boot è‡ªå‹•æ³¨å…¥ ChatClient

### ChatClient vs ChatModel
**ä½¿ç”¨ ChatClient ç•¶ä½ éœ€è¦**:
- âœ… è¤‡é›œçš„æç¤ºè©çµ„åˆ
- âœ… ç³»çµ±æç¤ºè©è¨­å®š
- âœ… ç¾ä»£åŒ–çš„ Fluent API é«”é©—
- âœ… å…§å»ºéŒ¯èª¤è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶

**ä½¿ç”¨ ChatModel ç•¶ä½ éœ€è¦**:
- âœ… ç°¡å–®ç›´æ¥çš„ AI å‘¼å«
- âœ… æ›´åº•å±¤çš„æ§åˆ¶
- âœ… åŸå§‹çš„ Prompt ç‰©ä»¶æ“ä½œ

### å°ˆæ¡ˆé…ç½®è¦é»
- Maven ä¾è³´: spring-ai-openai-spring-boot-starter
- ç’°å¢ƒè®Šæ•¸: ${OPENAI_API_KEY}
- æ¨¡å‹é¸æ“‡: gpt-4o-miniï¼ˆå…¥é–€æ¨è–¦ï¼‰
- WebFlux: æµå¼è¼¸å‡ºå¿…éœ€ä¾è³´

### å¯¦ä½œé‡é»
```java
// æ ¸å¿ƒæ¨¡å¼: ChatClient Fluent API
chatClient.prompt()
    .user("ä½¿ç”¨è€…è¨Šæ¯")     // è¨­å®šä½¿ç”¨è€…è¼¸å…¥
    .call()                  // åŸ·è¡ŒåŒæ­¥å‘¼å«
    .content();              // å–å¾—å›æ‡‰å…§å®¹
```

---

## ğŸš€ ä¸‹ä¸€æ­¥

ğŸ‘‰ [4.3 æµå¼è¼¸å‡º](./4.3.md) - å¯¦ç¾ ChatGPT èˆ¬çš„å³æ™‚å›æ‡‰æ•ˆæœ

---

**ç›¸é—œç« ç¯€**:
- â† ä¸Šä¸€ç« : [4.1 å–å¾— AI å…¥é–€é‘°åŒ™](./4.1.md)
- â†’ ä¸‹ä¸€ç« : [4.3 æµå¼è¼¸å‡º](./4.3.md)

**åƒè€ƒè³‡æ–™ï¼š**
- [Spring AI ChatClient Documentation](https://docs.spring.io/spring-ai/reference/api/chatclient.html)
- [Spring AI ChatModel Documentation](https://docs.spring.io/spring-ai/reference/api/chatmodel.html)
- [OpenAI Spring Boot Starter](https://docs.spring.io/spring-ai/reference/api/chat/openai-chat.html)
