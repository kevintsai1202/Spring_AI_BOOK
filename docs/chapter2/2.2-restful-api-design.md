# 2.2 RESTful API è¨­è¨ˆåŸå‰‡

> **å­¸ç¿’é‡é»**ï¼šæŒæ¡ REST æ¶æ§‹ç´„æŸã€HTTP æ–¹æ³•èªç¾©åŒ–ä½¿ç”¨å’Œè³‡æºå°å‘è¨­è¨ˆ

---

## 2.2.1 REST æ¶æ§‹ç´„æŸæ¢ä»¶

### REST å…­å¤§æ ¸å¿ƒåŸå‰‡

```mermaid
graph TD
    REST[REST è¨­è¨ˆåŸå‰‡]

    REST --> P1[è³‡æºå°å‘<br/>Resource-Oriented]
    REST --> P2[çµ±ä¸€ä»‹é¢<br/>Uniform Interface]
    REST --> P3[ç„¡ç‹€æ…‹<br/>Stateless]
    REST --> P4[å¯å¿«å–<br/>Cacheable]
    REST --> P5[åˆ†å±¤ç³»çµ±<br/>Layered System]
    REST --> P6[è¶…åª’é«”é©…å‹•<br/>HATEOAS]

    P1 --> P1A[URI è­˜åˆ¥è³‡æº]
    P1 --> P1B[è³‡æºè¡¨ç¾å½¢å¼]
    P1 --> P1C[JSON/XML]

    P2 --> P2A[HTTP æ¨™æº–æ–¹æ³•]
    P2 --> P2B[GET POST PUT DELETE]
    P2 --> P2C[çµ±ä¸€çš„éŒ¯èª¤è™•ç†]

    P3 --> P3A[æ¯å€‹è«‹æ±‚ç¨ç«‹]
    P3 --> P3B[ä¸ä¾è³´ Session]
    P3 --> P3C[å¯æ“´å±•æ€§å¼·]

    P4 --> P4A[HTTP Cache-Control]
    P4 --> P4B[ETag æ©Ÿåˆ¶]
    P4 --> P4C[æå‡æ•ˆèƒ½]

    P5 --> P5A[å®¢æˆ¶ç«¯-ä¼ºæœå™¨åˆ†é›¢]
    P5 --> P5B[æ”¯æ´ä¸­ä»‹å±¤]
    P5 --> P5C[è² è¼‰å¹³è¡¡]

    P6 --> P6A[è¶…é€£çµå°èˆª]
    P6 --> P6B[API å¯æ¢ç´¢]
    P6 --> P6C[é¬†æ•£è€¦åˆ]

    style REST fill:#ff6b6b,color:#fff
    style P1 fill:#4ecdc4,color:#fff
    style P2 fill:#45b7d1,color:#fff
    style P3 fill:#f9ca24,color:#333
    style P4 fill:#6c5ce7,color:#fff
    style P5 fill:#a29bfe,color:#fff
    style P6 fill:#fd79a8,color:#fff
```

> ğŸ“Š **REST åŸå‰‡åœ–**ï¼šè«‹åƒè€ƒ [images/2.2-rest-principles.md](./images/2.2-rest-principles.md)

### æ ¸å¿ƒç´„æŸèªªæ˜

| ç´„æŸæ¢ä»¶ | èªªæ˜ | å„ªå‹¢ |
|----------|------|------|
| **å®¢æˆ¶ç«¯-ä¼ºæœå™¨** | åˆ†é›¢ä½¿ç”¨è€…ä»‹é¢å’Œè³‡æ–™å„²å­˜ | æé«˜å¯ç§»æ¤æ€§å’Œå¯æ“´å±•æ€§ |
| **ç„¡ç‹€æ…‹** | æ¯å€‹è«‹æ±‚åŒ…å«å®Œæ•´è³‡è¨Š | æé«˜å¯è¦‹æ€§ã€å¯é æ€§ã€å¯æ“´å±•æ€§ |
| **å¯å¿«å–** | å›æ‡‰å¯æ¨™è¨˜ç‚ºå¯å¿«å– | æé«˜ç¶²è·¯æ•ˆç‡å’Œä½¿ç”¨è€…é«”é©— |
| **çµ±ä¸€ä»‹é¢** | ä½¿ç”¨çµ±ä¸€çš„ä»‹é¢ç´„æŸ | ç°¡åŒ–æ¶æ§‹ï¼Œæé«˜å¯è¦‹æ€§ |
| **åˆ†å±¤ç³»çµ±** | æ¶æ§‹ç”±åˆ†å±¤çµ„æˆ | æé«˜å¯æ“´å±•æ€§å’Œå®‰å…¨æ€§ |

---

## 2.2.2 HTTP æ–¹æ³•èªç¾©åŒ–ä½¿ç”¨

### HTTP æ–¹æ³•èˆ‡ CRUD å°æ‡‰

```mermaid
flowchart LR
    subgraph "CRUD æ“ä½œ"
        CREATE["ğŸ“ CREATE<br/>(å»ºç«‹)"]
        READ["ğŸ“– READ<br/>(è®€å–)"]
        UPDATE["âœï¸ UPDATE<br/>(æ›´æ–°)"]
        DELETE["ğŸ—‘ï¸ DELETE<br/>(åˆªé™¤)"]
    end

    subgraph "HTTP æ–¹æ³•"
        POST["POST"]
        GET["GET"]
        PUT["PUT"]
        PATCH["PATCH"]
        DEL["DELETE"]
    end

    subgraph "URI ç¯„ä¾‹"
        EX1["/api/users<br/>æ–°å¢ä½¿ç”¨è€…"]
        EX2["/api/users<br/>æŸ¥è©¢æ‰€æœ‰ä½¿ç”¨è€…"]
        EX3["/api/users/1<br/>æŸ¥è©¢å–®ä¸€ä½¿ç”¨è€…"]
        EX4["/api/users/1<br/>å®Œæ•´æ›´æ–°"]
        EX5["/api/users/1<br/>éƒ¨åˆ†æ›´æ–°"]
        EX6["/api/users/1<br/>åˆªé™¤ä½¿ç”¨è€…"]
    end

    CREATE ==>|å°æ‡‰| POST
    READ ==>|å°æ‡‰| GET
    UPDATE ==>|å°æ‡‰| PUT
    UPDATE ==>|å°æ‡‰| PATCH
    DELETE ==>|å°æ‡‰| DEL

    POST --> EX1
    GET --> EX2
    GET --> EX3
    PUT --> EX4
    PATCH --> EX5
    DEL --> EX6

    style CREATE fill:#66bb6a,color:#fff,stroke:#2e7d32,stroke-width:3px
    style READ fill:#42a5f5,color:#fff,stroke:#1565c0,stroke-width:3px
    style UPDATE fill:#ffa726,color:#fff,stroke:#e65100,stroke-width:3px
    style DELETE fill:#ef5350,color:#fff,stroke:#c62828,stroke-width:3px

    style POST fill:#66bb6a,color:#fff
    style GET fill:#42a5f5,color:#fff
    style PUT fill:#ffa726,color:#fff
    style PATCH fill:#ffb74d,color:#fff
    style DEL fill:#ef5350,color:#fff
```

> ğŸ“Š **HTTP æ–¹æ³•å°æ‡‰åœ–**ï¼šè«‹åƒè€ƒ [images/2.2-http-methods.md](./images/2.2-http-methods.md)

### æ–¹æ³•ç‰¹æ€§å°ç…§è¡¨

| HTTP æ–¹æ³• | ç”¨é€” | å†ªç­‰æ€§ | å®‰å…¨æ€§ | å…¸å‹ä½¿ç”¨å ´æ™¯ |
|-----------|------|--------|--------|--------------|
| **GET** | ç²å–è³‡æº | âœ… | âœ… | æŸ¥è©¢è³‡æ–™ã€ç²å–åˆ—è¡¨ |
| **POST** | å»ºç«‹è³‡æº | âŒ | âŒ | æ–°å¢è³‡æ–™ã€æäº¤è¡¨å–® |
| **PUT** | æ›´æ–°/æ›¿æ›è³‡æº | âœ… | âŒ | å®Œæ•´æ›´æ–°è³‡æº |
| **PATCH** | éƒ¨åˆ†æ›´æ–°è³‡æº | âŒ | âŒ | éƒ¨åˆ†æ¬„ä½æ›´æ–° |
| **DELETE** | åˆªé™¤è³‡æº | âœ… | âŒ | åˆªé™¤è³‡æ–™ |

---

## 2.2.3 å®Œæ•´ CRUD æ“ä½œå¯¦ç¾

### åŸºç¤ç¯„ä¾‹

```java
@RestController
@RequestMapping("/api/v1/users")
public class UserRestController {

    private final UserService userService;

    // 1. æŸ¥è©¢åˆ—è¡¨ - GET /api/v1/users
    @GetMapping
    public ResponseEntity<List<UserDto>> getUsers(
            @RequestParam(defaultValue = "0") int page,
            @RequestParam(defaultValue = "20") int size) {
        Page<User> userPage = userService.findAll(PageRequest.of(page, size));
        return ResponseEntity.ok(userMapper.toDtoList(userPage.getContent()));
    }

    // 2. æŸ¥è©¢å–®ä¸€è³‡æº - GET /api/v1/users/{id}
    @GetMapping("/{id}")
    public ResponseEntity<UserDto> getUserById(@PathVariable Long id) {
        User user = userService.findById(id);
        return ResponseEntity.ok(userMapper.toDto(user));
    }

    // 3. å»ºç«‹è³‡æº - POST /api/v1/users
    @PostMapping
    public ResponseEntity<UserDto> createUser(@Valid @RequestBody CreateUserRequest request) {
        User user = userService.create(request);
        return ResponseEntity
                .created(URI.create("/api/v1/users/" + user.getId()))
                .body(userMapper.toDto(user));
    }

    // 4. å®Œæ•´æ›´æ–° - PUT /api/v1/users/{id}
    @PutMapping("/{id}")
    public ResponseEntity<UserDto> updateUser(
            @PathVariable Long id,
            @Valid @RequestBody UpdateUserRequest request) {
        User user = userService.update(id, request);
        return ResponseEntity.ok(userMapper.toDto(user));
    }

    // 5. éƒ¨åˆ†æ›´æ–° - PATCH /api/v1/users/{id}
    @PatchMapping("/{id}")
    public ResponseEntity<UserDto> patchUser(
            @PathVariable Long id,
            @RequestBody Map<String, Object> updates) {
        User user = userService.patch(id, updates);
        return ResponseEntity.ok(userMapper.toDto(user));
    }

    // 6. åˆªé™¤è³‡æº - DELETE /api/v1/users/{id}
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteUser(@PathVariable Long id) {
        userService.delete(id);
        return ResponseEntity.noContent().build();
    }
}
```

> ğŸ’¡ **è¨­è¨ˆè¦é»**ï¼š
> - GET ç”¨æ–¼æŸ¥è©¢ï¼Œæ‡‰è©²æ˜¯å®‰å…¨ä¸”å†ªç­‰çš„
> - POST ç”¨æ–¼å»ºç«‹ï¼Œè¿”å› 201 Created å’Œ Location æ¨™é ­
> - PUT ç”¨æ–¼å®Œæ•´æ›´æ–°ï¼Œå¿…é ˆæä¾›æ‰€æœ‰æ¬„ä½
> - PATCH ç”¨æ–¼éƒ¨åˆ†æ›´æ–°ï¼Œåªæ›´æ–°æŒ‡å®šæ¬„ä½
> - DELETE ç”¨æ–¼åˆªé™¤ï¼Œè¿”å› 204 No Content

> ğŸ“ **å®Œæ•´å¯¦ä½œ**ï¼šåƒè€ƒ [code-examples/chapter2-spring-mvc-api/src/main/java/com/example/springmvc/controller/](../../code-examples/chapter2-spring-mvc-api/src/main/java/com/example/springmvc/controller/)

---

## 2.2.4 URL è¨­è¨ˆè¦ç¯„

### å‘½åè¦å‰‡

âœ… **å¥½çš„è¨­è¨ˆ**ï¼š
```
GET    /api/v1/users              # ä½¿ç”¨è¤‡æ•¸åè©
GET    /api/v1/users/123          # ä½¿ç”¨ ID è­˜åˆ¥è³‡æº
GET    /api/v1/users/123/orders   # ä½¿ç”¨éšå±¤è¡¨ç¤ºé—œè¯
POST   /api/v1/users              # å»ºç«‹ä½¿ç”¨ POST
```

âŒ **æ‡‰é¿å…çš„è¨­è¨ˆ**ï¼š
```
GET    /api/v1/getUsers           # é¿å…å‹•è©
GET    /api/v1/user               # é¿å…å–®æ•¸
GET    /api/v1/users?action=get   # é¿å…æŸ¥è©¢åƒæ•¸è¡¨ç¤ºå‹•ä½œ
POST   /api/v1/createUser         # é¿å…åœ¨ URL ä¸­ä½¿ç”¨å‹•ä½œ
```

### ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥

**URL ç‰ˆæœ¬æ§åˆ¶**ï¼ˆæ¨è–¦ï¼‰ï¼š
```java
@RequestMapping("/api/v1/users")  // ç‰ˆæœ¬ 1
@RequestMapping("/api/v2/users")  // ç‰ˆæœ¬ 2
```

**æ¨™é ­ç‰ˆæœ¬æ§åˆ¶**ï¼š
```java
@GetMapping(headers = "API-Version=1")
```

---

## 2.2.5 HTTP ç‹€æ…‹ç¢¼æœ€ä½³å¯¦è¸

### å¸¸ç”¨ç‹€æ…‹ç¢¼

| ç‹€æ…‹ç¢¼ | èªªæ˜ | ä½¿ç”¨å ´æ™¯ |
|--------|------|----------|
| **200 OK** | æˆåŠŸ | GETã€PUTã€PATCH æˆåŠŸ |
| **201 Created** | å·²å»ºç«‹ | POST æˆåŠŸå»ºç«‹è³‡æº |
| **204 No Content** | ç„¡å…§å®¹ | DELETE æˆåŠŸ |
| **400 Bad Request** | éŒ¯èª¤è«‹æ±‚ | è«‹æ±‚åƒæ•¸éŒ¯èª¤ |
| **401 Unauthorized** | æœªæˆæ¬Š | éœ€è¦èº«ä»½é©—è­‰ |
| **403 Forbidden** | ç¦æ­¢è¨ªå• | æ¬Šé™ä¸è¶³ |
| **404 Not Found** | æ‰¾ä¸åˆ° | è³‡æºä¸å­˜åœ¨ |
| **500 Internal Server Error** | ä¼ºæœå™¨éŒ¯èª¤ | ç³»çµ±ç•°å¸¸ |

### ç‹€æ…‹ç¢¼ä½¿ç”¨ç¯„ä¾‹

```java
@RestController
public class ProductController {

    // 200 OK - æŸ¥è©¢æˆåŠŸ
    @GetMapping("/products/{id}")
    public ResponseEntity<Product> getProduct(@PathVariable Long id) {
        return ResponseEntity.ok(productService.findById(id));
    }

    // 201 Created - å»ºç«‹æˆåŠŸ
    @PostMapping("/products")
    public ResponseEntity<Product> createProduct(@RequestBody Product product) {
        Product created = productService.create(product);
        return ResponseEntity
                .created(URI.create("/products/" + created.getId()))
                .body(created);
    }

    // 204 No Content - åˆªé™¤æˆåŠŸ
    @DeleteMapping("/products/{id}")
    public ResponseEntity<Void> deleteProduct(@PathVariable Long id) {
        productService.delete(id);
        return ResponseEntity.noContent().build();
    }

    // 404 Not Found - è³‡æºä¸å­˜åœ¨
    @ExceptionHandler(ResourceNotFoundException.class)
    public ResponseEntity<ErrorResponse> handleNotFound(ResourceNotFoundException ex) {
        return ResponseEntity
                .status(HttpStatus.NOT_FOUND)
                .body(new ErrorResponse(ex.getMessage()));
    }
}
```

> ğŸ“ **å®Œæ•´éŒ¯èª¤è™•ç†**ï¼šåƒè€ƒ [code-examples/chapter2-spring-mvc-api/src/main/java/com/example/springmvc/exception/](../../code-examples/chapter2-spring-mvc-api/src/main/java/com/example/springmvc/exception/)

---

## ğŸ“ æœ¬ç¯€é‡é»

1. âœ… **REST ç´„æŸ**ï¼šç†è§£ REST å…­å¤§æ ¸å¿ƒåŸå‰‡
2. âœ… **HTTP æ–¹æ³•**ï¼šæŒæ¡ GETã€POSTã€PUTã€PATCHã€DELETE çš„æ­£ç¢ºç”¨æ³•
3. âœ… **URL è¨­è¨ˆ**ï¼šå­¸æœƒè³‡æºå°å‘çš„ URL å‘½åè¦ç¯„
4. âœ… **ç‹€æ…‹ç¢¼**ï¼šæ­£ç¢ºä½¿ç”¨ HTTP ç‹€æ…‹ç¢¼å›æ‡‰å®¢æˆ¶ç«¯
5. âœ… **ç‰ˆæœ¬æ§åˆ¶**ï¼šäº†è§£ API ç‰ˆæœ¬ç®¡ç†ç­–ç•¥

---

## ğŸ”— ç›¸é—œè³‡æº

- **å®Œæ•´ç¨‹å¼ç¢¼**ï¼š[code-examples/chapter2-spring-mvc-api/](../../code-examples/chapter2-spring-mvc-api/)
- **æ¶æ§‹åœ–è¡¨**ï¼š[images/](./images/)
- **RESTful API è¨­è¨ˆæŒ‡å—**ï¼š[RESTful API Design](https://restfulapi.net/)

---

**ä¸Šä¸€ç¯€**ï¼š[2.1 Spring MVC API é–‹ç™¼åŸºç¤](./2.1-spring-mvc-basics.md)
**ä¸‹ä¸€ç¯€**ï¼š[2.3 ç•°å¸¸è™•ç†èˆ‡çµ±ä¸€å›æ‡‰](./2.3-exception-handling.md)
