# 2.1 Spring MVC API é–‹ç™¼åŸºç¤

> **å­¸ç¿’é‡é»**ï¼šæŒæ¡ Spring MVC æ ¸å¿ƒæ¶æ§‹ã€@RestController ç”¨æ³•å’Œ JSON è™•ç†æ©Ÿåˆ¶

---

## 2.1.1 MVC æ¶æ§‹æ¦‚è¿°

### MVC ä¸‰å±¤æ¶æ§‹

```mermaid
graph TB
    User([ä½¿ç”¨è€…/ç€è¦½å™¨])

    subgraph Controller["Controller å±¤"]
        C1[æ¥æ”¶ HTTP è«‹æ±‚]
        C2[è™•ç†æ¥­å‹™é‚è¼¯]
        C3[é¸æ“‡ View]
    end

    subgraph Model["Model å±¤"]
        M1[æ¥­å‹™é‚è¼¯]
        M2[è³‡æ–™å­˜å–]
        M3[è³‡æ–™é©—è­‰]
    end

    subgraph View["View å±¤"]
        V1[æ¸²æŸ“é é¢]
        V2[JSON å›æ‡‰]
        V3[æ¨¡æ¿å¼•æ“]
    end

    DB[(è³‡æ–™åº«)]

    User -->|1. ç™¼é€è«‹æ±‚| C1
    C1 --> C2
    C2 -->|2. å‘¼å« Model| M1
    M1 --> M2
    M2 <-->|3. è³‡æ–™æ“ä½œ| DB
    M2 -->|4. è¿”å›è³‡æ–™| C2
    C2 -->|5. é¸æ“‡ View| C3
    C3 -->|6. å‚³éè³‡æ–™| V1
    V1 -->|7. è¿”å›å›æ‡‰| User

    style Controller fill:#e3f2fd
    style Model fill:#fff9c4
    style View fill:#f3e5f5
    style DB fill:#e8f5e9
```

> ğŸ“Š **æ¶æ§‹åœ–èªªæ˜**ï¼šè«‹åƒè€ƒ [images/2.1-mvc-architecture.md](./images/2.1-mvc-architecture.md)

**MVC ä¸‰å±¤è·è²¬**ï¼š

1. **Modelï¼ˆæ¨¡å‹ï¼‰**ï¼šæ¥­å‹™é‚è¼¯å’Œè³‡æ–™è™•ç†
2. **Viewï¼ˆè¦–åœ–ï¼‰**ï¼šå‘ˆç¾è³‡æ–™çµ¦ä½¿ç”¨è€…
3. **Controllerï¼ˆæ§åˆ¶å™¨ï¼‰**ï¼šè™•ç†ä½¿ç”¨è€…è¼¸å…¥ä¸¦å”èª¿ Model å’Œ View

### ç¾ä»£æ¶æ§‹ï¼šView å±¤çš„è®ŠåŒ–

> ğŸ“Œ **é‡è¦è§€å¿µ**ï¼šåœ¨å‚³çµ± MVC æ¶æ§‹ä¸­ï¼ŒView å±¤ç”±å¾Œç«¯è² è²¬ï¼ˆå¦‚ JSPã€Thymeleafï¼‰ã€‚ä½†åœ¨**ç¾ä»£å‰å¾Œç«¯åˆ†é›¢æ¶æ§‹**ä¸‹ï¼š

**å‚³çµ± MVC**ï¼š
```
ç€è¦½å™¨ â†’ Spring MVC Controller â†’ Model â†’ View (JSP/Thymeleaf) â†’ HTML â†’ ç€è¦½å™¨
```

**ç¾ä»£å‰å¾Œç«¯åˆ†é›¢**ï¼š
```
å‰ç«¯æ¡†æ¶(React/Vue) â†’ Spring Boot API â†’ Model â†’ JSON â†’ å‰ç«¯æ¡†æ¶ â†’ ç€è¦½å™¨
                        (@RestController)
```

**é—œéµå·®ç•°**ï¼š
- âŒ Spring Boot **ä¸å†**è² è²¬ View å±¤çš„æ¸²æŸ“
- âœ… Spring Boot **åªè² è²¬**æä¾› RESTful APIï¼Œè¼¸å‡º JSON è³‡æ–™
- âœ… View å±¤ç”±å‰ç«¯æ¡†æ¶ï¼ˆReactã€Vueã€Angularï¼‰ç¨ç«‹è™•ç†
- âœ… Spring MVC çš„ Model-View è§£è€¦ï¼Œå°ˆæ³¨æ–¼ Model-Controller

> ğŸ’¡ **æœ¬æ›¸å®šä½**ï¼šå› æ­¤æœ¬æ›¸å°ˆæ³¨æ–¼å¦‚ä½•ä½¿ç”¨ Spring Boot å»ºç«‹ RESTful APIï¼Œä¸æ¶‰åŠå‚³çµ± View æŠ€è¡“ï¼ˆJSPã€Thymeleafï¼‰çš„å…§å®¹ã€‚

---

## 2.1.2 DispatcherServlet å·¥ä½œæµç¨‹

Spring MVC çš„æ ¸å¿ƒæ˜¯ DispatcherServletï¼Œå®ƒä½œç‚ºå‰ç«¯æ§åˆ¶å™¨è² è²¬æ‰€æœ‰ HTTP è«‹æ±‚çš„çµ±ä¸€åˆ†ç™¼ã€‚

```mermaid
sequenceDiagram
    participant Client as å®¢æˆ¶ç«¯
    participant DS as DispatcherServlet
    participant HM as HandlerMapping
    participant HA as HandlerAdapter
    participant Controller as Controller
    participant ViewResolver as ViewResolver
    participant View as View

    Client->>DS: 1. ç™¼é€ HTTP è«‹æ±‚
    activate DS

    DS->>HM: 2. æŸ¥è©¢ Handler
    activate HM
    HM-->>DS: 3. è¿”å› HandlerExecutionChain
    deactivate HM

    DS->>HA: 4. ç²å–é©é…å™¨
    activate HA
    HA->>Controller: 5. åŸ·è¡Œ Handler
    activate Controller
    Controller->>Controller: 6. è™•ç†æ¥­å‹™é‚è¼¯
    Controller-->>HA: 7. è¿”å› ModelAndView
    deactivate Controller
    HA-->>DS: 8. è¿”å› ModelAndView
    deactivate HA

    DS->>ViewResolver: 9. è§£æ View
    activate ViewResolver
    ViewResolver-->>DS: 10. è¿”å› View ç‰©ä»¶
    deactivate ViewResolver

    DS->>View: 11. æ¸²æŸ“ View
    activate View
    View-->>DS: 12. è¿”å›æ¸²æŸ“çµæœ
    deactivate View

    DS-->>Client: 13. è¿”å› HTTP å›æ‡‰
    deactivate DS

    Note over DS,Controller: Spring MVC æ ¸å¿ƒæµç¨‹
    Note over Client,DS: æ‰€æœ‰è«‹æ±‚éƒ½ç¶“é DispatcherServlet
```

> ğŸ“Š **æµç¨‹åœ–èªªæ˜**ï¼šè«‹åƒè€ƒ [images/2.1-dispatcher-servlet.md](./images/2.1-dispatcher-servlet.md)

---

## 2.1.3 å‚³çµ± Web vs API é–‹ç™¼

### ç¾ä»£é–‹ç™¼è¶¨å‹¢ï¼šå‰å¾Œç«¯åˆ†é›¢

åœ¨ç¾ä»£ Web æ‡‰ç”¨é–‹ç™¼ä¸­ï¼Œ**å‰å¾Œç«¯åˆ†é›¢**å·²æˆç‚ºä¸»æµæ¶æ§‹æ¨¡å¼ï¼š

**å‰å¾Œç«¯åˆ†é›¢æ¶æ§‹**ï¼š
- ğŸ”¹ **å¾Œç«¯ï¼ˆSpring Bootï¼‰**ï¼šå°ˆæ³¨æ–¼æä¾› RESTful APIï¼Œåªè¼¸å‡º JSON è³‡æ–™
- ğŸ”¹ **å‰ç«¯ï¼ˆReact/Vue/Angularï¼‰**ï¼šè² è²¬ UI å‘ˆç¾å’Œä½¿ç”¨è€…äº’å‹•
- ğŸ”¹ **æºé€šæ–¹å¼**ï¼šé€é HTTP/HTTPS çš„ JSON æ ¼å¼é€²è¡Œè³‡æ–™äº¤æ›

**ç‚ºä»€éº¼å‰å¾Œç«¯åˆ†é›¢ï¼Ÿ**
- âœ… **è·è²¬åˆ†é›¢**ï¼šå¾Œç«¯å°ˆæ³¨æ¥­å‹™é‚è¼¯ï¼Œå‰ç«¯å°ˆæ³¨ä½¿ç”¨è€…é«”é©—
- âœ… **é–‹ç™¼æ•ˆç‡**ï¼šå‰å¾Œç«¯åœ˜éšŠå¯ä¸¦è¡Œé–‹ç™¼
- âœ… **æŠ€è¡“é¸å‹éˆæ´»**ï¼šå‰å¾Œç«¯å¯ç¨ç«‹é¸æ“‡æŠ€è¡“æ£§
- âœ… **å¤šç«¯æ”¯æ´**ï¼šåŒä¸€å€‹ API å¯ä¾› Webã€Mobileã€AI ç­‰å¤šç¨®å®¢æˆ¶ç«¯ä½¿ç”¨

> ğŸ’¡ **é‡é»**ï¼šç¾ä»£ Spring Boot é–‹ç™¼è¼ƒå°‘ä½¿ç”¨å‚³çµ±çš„ Viewï¼ˆå¦‚ JSPã€Thymeleafï¼‰ï¼Œè€Œæ˜¯èšç„¦æ–¼ API é–‹ç™¼ï¼Œé€é `@RestController` è¼¸å‡º JSON æ ¼å¼è³‡æ–™ã€‚

### æ¶æ§‹å°æ¯”

| ç‰¹æ€§ | å‚³çµ± Web é–‹ç™¼ | ç¾ä»£å‰å¾Œç«¯åˆ†é›¢é–‹ç™¼ |
|------|---------------|-------------------|
| **å›æ‡‰æ ¼å¼** | HTML é é¢ï¼ˆServer-Side Renderingï¼‰ | JSON è³‡æ–™ï¼ˆClient-Side Renderingï¼‰ |
| **å®¢æˆ¶ç«¯** | ä¸»è¦æ˜¯ç€è¦½å™¨ | å¤šç¨®å®¢æˆ¶ç«¯ï¼ˆWebã€Mobileã€IoTã€AIï¼‰ |
| **ç‹€æ…‹ç®¡ç†** | æœ‰ç‹€æ…‹ï¼ˆSessionï¼‰ | ç„¡ç‹€æ…‹ï¼ˆStatelessï¼Œä½¿ç”¨ JWTï¼‰ |
| **è³‡æ–™å‚³è¼¸** | è¡¨å–®æäº¤ | JSON/XML è² è¼‰ |
| **éŒ¯èª¤è™•ç†** | éŒ¯èª¤é é¢ | çµæ§‹åŒ–éŒ¯èª¤å›æ‡‰ï¼ˆJSONï¼‰ |
| **é–‹ç™¼æ¨¡å¼** | å¾Œç«¯åŒ…å« View å±¤ | å¾Œç«¯åªæä¾› API |
| **éƒ¨ç½²æ–¹å¼** | æ•´é«”éƒ¨ç½² | å‰å¾Œç«¯ç¨ç«‹éƒ¨ç½² |

---

## 2.1.4 @RestController vs @Controller

### æ ¸å¿ƒå·®ç•°

åœ¨å‰å¾Œç«¯åˆ†é›¢çš„æ¶æ§‹ä¸‹ï¼Œæˆ‘å€‘ä¸»è¦ä½¿ç”¨ `@RestController` ä¾†å»ºç«‹ APIï¼š

| ç‰¹æ€§ | @Controller | @RestController |
|------|-------------|------------------|
| **çµ„æˆ** | å–®ä¸€è¨»è§£ | `@Controller` + `@ResponseBody` |
| **å›æ‡‰é¡å‹** | è¦–åœ–åç¨±ï¼ˆå¦‚ JSPï¼‰ | ç›´æ¥è³‡æ–™ï¼ˆJSON/XMLï¼‰ |
| **åºåˆ—åŒ–** | éœ€æ‰‹å‹•è™•ç† | è‡ªå‹• JSON åºåˆ—åŒ– |
| **é©ç”¨å ´æ™¯** | å‚³çµ± Web æ‡‰ç”¨ï¼ˆSSRï¼‰ | å‰å¾Œç«¯åˆ†é›¢çš„ RESTful API â­ |
| **View å±¤** | éœ€è¦é…ç½® View Resolver | ä¸éœ€è¦ View å±¤ |

> ğŸ’¡ **æœ¬æ›¸é‡é»**ï¼šæˆ‘å€‘å°ˆæ³¨æ–¼ `@RestController` çš„ä½¿ç”¨ï¼Œå› ç‚ºç¾ä»£é–‹ç™¼ä»¥å‰å¾Œç«¯åˆ†é›¢ç‚ºä¸»ï¼ŒSpring Boot ä¸»è¦è² è²¬æä¾› APIï¼Œä¸å†è™•ç† View å±¤çš„æ¸²æŸ“ã€‚

### åŸºæœ¬ç¯„ä¾‹

```java
@RestController
@RequestMapping("/api/users")
public class UserController {

    private final UserService userService;

    public UserController(UserService userService) {
        this.userService = userService;
    }

    // å–å¾—æ‰€æœ‰ä½¿ç”¨è€…
    @GetMapping
    public List<User> getUsers() {
        return userService.findAll();
    }

    // æ ¹æ“š ID å–å¾—ä½¿ç”¨è€…
    @GetMapping("/{id}")
    public User getUser(@PathVariable Long id) {
        return userService.findById(id);
    }

    // å»ºç«‹æ–°ä½¿ç”¨è€…
    @PostMapping
    public User createUser(@RequestBody User user) {
        return userService.save(user);
    }
}
```

> ğŸ’¡ **é‡é»**ï¼šä½¿ç”¨ `@RestController` å¾Œï¼Œæ‰€æœ‰æ–¹æ³•çš„è¿”å›å€¼éƒ½æœƒè‡ªå‹•è½‰æ›ç‚º JSON æ ¼å¼

> ğŸ“ **å®Œæ•´ç¨‹å¼ç¢¼**ï¼šåƒè€ƒ [code-examples/chapter2-spring-mvc-api/src/main/java/com/example/springmvc/controller/](../../code-examples/chapter2-spring-mvc-api/src/main/java/com/example/springmvc/controller/)

---

## 2.1.5 JSON è‡ªå‹•è™•ç†

Spring MVC é€é Jackson å‡½å¼åº«å¯¦ç¾è‡ªå‹• JSON åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼š

### è‡ªå‹•åºåˆ—åŒ–ç¯„ä¾‹

```java
@RestController
@RequestMapping("/api/products")
public class ProductController {

    // JSON è‡ªå‹•è½‰æ›
    @PostMapping
    public Product createProduct(@RequestBody Product product) {
        // è«‹æ±‚ï¼šJSON â†’ Product ç‰©ä»¶
        return productService.save(product);
        // å›æ‡‰ï¼šProduct ç‰©ä»¶ â†’ JSON
    }

    // è¤‡é›œçµæ§‹è‡ªå‹•è™•ç†
    @GetMapping("/summary")
    public Map<String, Object> getProductSummary() {
        Map<String, Object> summary = new HashMap<>();
        summary.put("totalProducts", productService.count());
        summary.put("categories", productService.getCategories());
        return summary; // è‡ªå‹•è½‰ç‚º JSON
    }
}
```

**è‡ªå‹•è™•ç†çš„å„ªé»**ï¼š
- âœ… ç„¡éœ€æ‰‹å‹•åºåˆ—åŒ–/ååºåˆ—åŒ–
- âœ… æ”¯æ´è¤‡é›œç‰©ä»¶çµæ§‹
- âœ… è‡ªå‹•å‹åˆ¥è½‰æ›å’Œé©—è­‰
- âœ… æä¾›è©³ç´°éŒ¯èª¤è¨Šæ¯

> ğŸ“ **å®Œæ•´ç¯„ä¾‹**ï¼šåƒè€ƒ [code-examples/chapter2-spring-mvc-api/](../../code-examples/chapter2-spring-mvc-api/)

---

## 2.1.6 ç‚º Spring AI åšæº–å‚™

### AI æœå‹™çš„ç‰¹æ®Šéœ€æ±‚

åœ¨è¨­è¨ˆ API æ¶æ§‹æ™‚ï¼Œéœ€è€ƒæ…® Spring AI çš„ç‰¹æ®Šéœ€æ±‚ï¼š

**æµå¼è™•ç†æ”¯æ´**ï¼š
```java
@RestController
@RequestMapping("/api/ai")
public class AIController {

    // é ç•™ç•°æ­¥è™•ç†ä»‹é¢
    @PostMapping("/process")
    public CompletableFuture<ProcessResult> processAsync(@RequestBody ProcessRequest request) {
        return CompletableFuture.supplyAsync(() -> {
            // é©åˆ AI é•·æ™‚é–“é‹ç®—
            return new ProcessResult("è™•ç†å®Œæˆ");
        });
    }
}
```

**æ ¸å¿ƒè€ƒé‡**ï¼š
- æ”¯æ´ Server-Sent Events (SSE) æµå¼å›æ‡‰
- å¤šåª’é«”å…§å®¹è™•ç†èƒ½åŠ›
- éŒ¯èª¤è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶
- ç•°æ­¥è™•ç†æ”¯æ´

---

## ğŸ“ æœ¬ç¯€é‡é»

1. âœ… **MVC æ¶æ§‹**ï¼šç†è§£ Modelã€Viewã€Controller ä¸‰å±¤åˆ†é›¢
2. âœ… **DispatcherServlet**ï¼šæŒæ¡ Spring MVC è«‹æ±‚è™•ç†æµç¨‹
3. âœ… **@RestController**ï¼šå­¸æœƒå»ºç«‹ RESTful API
4. âœ… **JSON è™•ç†**ï¼šç†è§£è‡ªå‹•åºåˆ—åŒ–/ååºåˆ—åŒ–æ©Ÿåˆ¶
5. âœ… **AI æ•´åˆæº–å‚™**ï¼šç‚º Spring AI å¥ å®šæ¶æ§‹åŸºç¤

---

## ğŸ”— ç›¸é—œè³‡æº

- **å®Œæ•´ç¨‹å¼ç¢¼**ï¼š[code-examples/chapter2-spring-mvc-api/](../../code-examples/chapter2-spring-mvc-api/)
- **æ¶æ§‹åœ–è¡¨**ï¼š[images/](./images/)
- **Spring MVC æ–‡æª”**ï¼š[Spring MVC Reference](https://docs.spring.io/spring-framework/docs/current/reference/html/web.html)

---

**ä¸‹ä¸€ç¯€**ï¼š[2.2 RESTful API è¨­è¨ˆåŸå‰‡](./2.2-restful-api-design.md)
