# 2.1 Spring MVC API é–‹ç™¼åŸºç¤

> **å°æ‡‰ç¯„ä¾‹**: `chapter2-spring-mvc-api`
> **é›£åº¦**: â­â­â­â˜†â˜†

---

## ğŸ“š æœ¬ç« æ¦‚è¦

æœ¬ç« å°‡æ·±å…¥ä»‹ç´¹ Spring MVC çš„æ ¸å¿ƒæ¶æ§‹ï¼Œå­¸ç¿’å¦‚ä½•ä½¿ç”¨ `@RestController` å»ºç«‹ç¾ä»£åŒ–çš„ RESTful APIã€‚åœ¨å‰å¾Œç«¯åˆ†é›¢çš„æ¶æ§‹ä¸‹ï¼ŒSpring Boot å°ˆæ³¨æ–¼æä¾› API æœå‹™ï¼Œè¼¸å‡º JSON æ ¼å¼è³‡æ–™ä¾›å‰ç«¯æ¡†æ¶æˆ–å…¶ä»–å®¢æˆ¶ç«¯ä½¿ç”¨ã€‚

**å­¸ç¿’ç›®æ¨™**:
- ç†è§£ MVC ä¸‰å±¤æ¶æ§‹çš„è¨­è¨ˆç†å¿µ
- æŒæ¡ DispatcherServlet çš„è«‹æ±‚è™•ç†æµç¨‹
- å­¸æœƒä½¿ç”¨ @RestController å»ºç«‹ API
- ç†è§£ JSON è‡ªå‹•åºåˆ—åŒ–æ©Ÿåˆ¶
- ç‚º Spring AI æ•´åˆå¥ å®š API åŸºç¤

---

## ğŸ¯ MVC æ¶æ§‹æ¦‚è¿°

### MVC ä¸‰å±¤è·è²¬åŠƒåˆ†

MVCï¼ˆModel-View-Controllerï¼‰æ˜¯ä¸€ç¨®ç¶“å…¸çš„è»Ÿé«”æ¶æ§‹æ¨¡å¼ï¼Œå°‡æ‡‰ç”¨ç¨‹å¼åŠƒåˆ†ç‚ºä¸‰å€‹æ ¸å¿ƒçµ„ä»¶ï¼š

```mermaid
graph TB
    User([ä½¿ç”¨è€…/ç€è¦½å™¨])

    subgraph Controller["Controller å±¤"]
        C1[æ¥æ”¶ HTTP è«‹æ±‚]
        C2[è™•ç†æ¥­å‹™é‚è¼¯]
        C3[é¸æ“‡ View]
    end

    subgraph Model["Model å±¤"]
        M1[æ¥­å‹™é‚è¼¯]
        M2[è³‡æ–™å­˜å–]
        M3[è³‡æ–™é©—è­‰]
    end

    subgraph View["View å±¤"]
        V1[æ¸²æŸ“é é¢]
        V2[JSON å›æ‡‰]
        V3[æ¨¡æ¿å¼•æ“]
    end

    DB[(è³‡æ–™åº«)]

    User -->|1. ç™¼é€è«‹æ±‚| C1
    C1 --> C2
    C2 -->|2. å‘¼å« Model| M1
    M1 --> M2
    M2 <-->|3. è³‡æ–™æ“ä½œ| DB
    M2 -->|4. è¿”å›è³‡æ–™| C2
    C2 -->|5. é¸æ“‡ View| C3
    C3 -->|6. å‚³éè³‡æ–™| V1
    V1 -->|7. è¿”å›å›æ‡‰| User

    style Controller fill:#e3f2fd
    style Model fill:#fff9c4
    style View fill:#f3e5f5
    style DB fill:#e8f5e9
```

**MVC ä¸‰å±¤è©³ç´°èªªæ˜**:

1. **Modelï¼ˆæ¨¡å‹å±¤ï¼‰**:
   - è² è²¬æ¥­å‹™é‚è¼¯è™•ç†å’Œè³‡æ–™ç®¡ç†
   - åŒ…å«è³‡æ–™é©—è­‰ã€è¨ˆç®—ã€è³‡æ–™åº«æ“ä½œ
   - èˆ‡ Controller è§£è€¦ï¼Œå¯ç¨ç«‹æ¸¬è©¦

2. **Viewï¼ˆè¦–åœ–å±¤ï¼‰**:
   - è² è²¬å‘ˆç¾è³‡æ–™çµ¦ä½¿ç”¨è€…
   - å‚³çµ±ï¼šJSPã€Thymeleaf ç­‰æ¨¡æ¿å¼•æ“
   - ç¾ä»£ï¼šJSON è³‡æ–™è¼¸å‡º

3. **Controllerï¼ˆæ§åˆ¶å™¨å±¤ï¼‰**:
   - æ¥æ”¶ä¸¦è™•ç†ä½¿ç”¨è€…è«‹æ±‚
   - å”èª¿ Model å’Œ View
   - æ§åˆ¶æ‡‰ç”¨ç¨‹å¼æµç¨‹

---

## ğŸ”„ ç¾ä»£æ¶æ§‹ï¼šå‰å¾Œç«¯åˆ†é›¢

### æ¶æ§‹æ¼”é€²

åœ¨ç¾ä»£ Web æ‡‰ç”¨é–‹ç™¼ä¸­ï¼Œ**å‰å¾Œç«¯åˆ†é›¢**å·²æˆç‚ºä¸»æµæ¶æ§‹æ¨¡å¼ã€‚é€™ç¨®æ¶æ§‹ä¸‹ï¼ŒSpring Boot çš„è§’è‰²ç™¼ç”Ÿäº†é‡è¦è®ŠåŒ–ï¼š

**å‚³çµ± MVC æ¶æ§‹**:
```
ç€è¦½å™¨
  â†“ è«‹æ±‚
Spring MVC Controller
  â†“
Modelï¼ˆæ¥­å‹™é‚è¼¯ï¼‰
  â†“
Viewï¼ˆJSP/Thymeleafï¼‰
  â†“ HTML
ç€è¦½å™¨é¡¯ç¤ºé é¢
```

**ç¾ä»£å‰å¾Œç«¯åˆ†é›¢æ¶æ§‹**:
```
å‰ç«¯æ¡†æ¶ï¼ˆReact/Vue/Angularï¼‰
  â†“ HTTPè«‹æ±‚
Spring Boot RESTful API
  â†“
Modelï¼ˆæ¥­å‹™é‚è¼¯ï¼‰
  â†“ JSONè³‡æ–™
å‰ç«¯æ¡†æ¶
  â†“
ç€è¦½å™¨é¡¯ç¤ºé é¢
```

### é—œéµå·®ç•°å°æ¯”

| ç‰¹æ€§ | å‚³çµ± Web é–‹ç™¼ | ç¾ä»£å‰å¾Œç«¯åˆ†é›¢é–‹ç™¼ |
|------|---------------|-------------------|
| **å›æ‡‰æ ¼å¼** | HTML é é¢ï¼ˆServer-Side Renderingï¼‰ | JSON è³‡æ–™ï¼ˆClient-Side Renderingï¼‰ |
| **å®¢æˆ¶ç«¯** | ä¸»è¦æ˜¯ç€è¦½å™¨ | å¤šç¨®å®¢æˆ¶ç«¯ï¼ˆWebã€Mobileã€IoTã€AIï¼‰ |
| **ç‹€æ…‹ç®¡ç†** | æœ‰ç‹€æ…‹ï¼ˆSessionï¼‰ | ç„¡ç‹€æ…‹ï¼ˆStatelessï¼Œä½¿ç”¨ JWTï¼‰ |
| **è³‡æ–™å‚³è¼¸** | è¡¨å–®æäº¤ | JSON/XML è² è¼‰ |
| **éŒ¯èª¤è™•ç†** | éŒ¯èª¤é é¢ | çµæ§‹åŒ–éŒ¯èª¤å›æ‡‰ï¼ˆJSONï¼‰ |
| **é–‹ç™¼æ¨¡å¼** | å¾Œç«¯åŒ…å« View å±¤ | å¾Œç«¯åªæä¾› API |
| **éƒ¨ç½²æ–¹å¼** | æ•´é«”éƒ¨ç½² | å‰å¾Œç«¯ç¨ç«‹éƒ¨ç½² |
| **Spring Boot è§’è‰²** | è² è²¬å®Œæ•´çš„ MVC | åªè² è²¬ MCï¼ˆModel-Controllerï¼‰ |

**ç‚ºä»€éº¼å‰å¾Œç«¯åˆ†é›¢ï¼Ÿ**
- âœ… **è·è²¬åˆ†é›¢**: å¾Œç«¯å°ˆæ³¨æ¥­å‹™é‚è¼¯ï¼Œå‰ç«¯å°ˆæ³¨ä½¿ç”¨è€…é«”é©—
- âœ… **é–‹ç™¼æ•ˆç‡**: å‰å¾Œç«¯åœ˜éšŠå¯ä¸¦è¡Œé–‹ç™¼
- âœ… **æŠ€è¡“é¸å‹éˆæ´»**: å‰å¾Œç«¯å¯ç¨ç«‹é¸æ“‡æŠ€è¡“æ£§
- âœ… **å¤šç«¯æ”¯æ´**: åŒä¸€å€‹ API å¯ä¾› Webã€Mobileã€AI ç­‰å¤šç¨®å®¢æˆ¶ç«¯ä½¿ç”¨
- âœ… **æ“´å±•æ€§å¼·**: å‰å¾Œç«¯å¯ç¨ç«‹æ“´å±•å’Œéƒ¨ç½²

> ğŸ’¡ **æœ¬æ›¸å®šä½**: å› æ­¤æœ¬æ›¸å°ˆæ³¨æ–¼å¦‚ä½•ä½¿ç”¨ Spring Boot å»ºç«‹ RESTful APIï¼Œä¸æ¶‰åŠå‚³çµ± View æŠ€è¡“ï¼ˆJSPã€Thymeleafï¼‰çš„å…§å®¹ã€‚

---

## ğŸ”§ DispatcherServlet å·¥ä½œæµç¨‹

### å‰ç«¯æ§åˆ¶å™¨æ¨¡å¼

Spring MVC çš„æ ¸å¿ƒæ˜¯ `DispatcherServlet`ï¼Œå®ƒä½œç‚ºå‰ç«¯æ§åˆ¶å™¨ï¼ˆFront Controllerï¼‰è² è²¬æ‰€æœ‰ HTTP è«‹æ±‚çš„çµ±ä¸€åˆ†ç™¼å’Œè™•ç†ã€‚é€™æ˜¯ä¸€ç¨®å…¸å‹çš„è¨­è¨ˆæ¨¡å¼ï¼Œå°‡è«‹æ±‚è™•ç†çš„é€šç”¨é‚è¼¯é›†ä¸­ç®¡ç†ã€‚

```mermaid
sequenceDiagram
    participant Client as å®¢æˆ¶ç«¯
    participant DS as DispatcherServlet
    participant HM as HandlerMapping
    participant HA as HandlerAdapter
    participant Controller as Controller
    participant Model as Model
    participant Jackson as Jackson

    Client->>DS: 1. ç™¼é€ HTTP è«‹æ±‚
    activate DS

    DS->>HM: 2. æŸ¥è©¢è™•ç†å™¨
    activate HM
    Note over HM: æ ¹æ“š URL æ‰¾åˆ°<br/>å°æ‡‰çš„ Controller
    HM-->>DS: 3. è¿”å› HandlerExecutionChain
    deactivate HM

    DS->>HA: 4. ç²å–è™•ç†å™¨é©é…å™¨
    activate HA
    HA->>Controller: 5. åŸ·è¡Œè™•ç†å™¨
    activate Controller
    Controller->>Model: 6. å‘¼å«æ¥­å‹™é‚è¼¯
    activate Model
    Model-->>Controller: 7. è¿”å›è™•ç†çµæœ
    deactivate Model
    Controller-->>HA: 8. è¿”å›çµæœç‰©ä»¶
    deactivate Controller
    HA-->>DS: 9. è¿”å› ModelAndView/Object
    deactivate HA

    DS->>Jackson: 10. JSON åºåˆ—åŒ–
    activate Jackson
    Jackson-->>DS: 11. è¿”å› JSON å­—ä¸²
    deactivate Jackson

    DS-->>Client: 12. è¿”å› HTTP å›æ‡‰
    deactivate DS

    Note over DS,Controller: Spring MVC æ ¸å¿ƒæµç¨‹
    Note over Client,DS: æ‰€æœ‰è«‹æ±‚çµ±ä¸€å…¥å£
```

**æµç¨‹è©³è§£**:

1. **è«‹æ±‚æ¥æ”¶**: DispatcherServlet æ¥æ”¶æ‰€æœ‰ HTTP è«‹æ±‚
2. **è™•ç†å™¨æ˜ å°„**: HandlerMapping æ ¹æ“š URL æ‰¾åˆ°å°æ‡‰çš„ Controller æ–¹æ³•
3. **è™•ç†å™¨é©é…**: HandlerAdapter é©é…ä¸åŒé¡å‹çš„è™•ç†å™¨
4. **æ¥­å‹™è™•ç†**: Controller åŸ·è¡Œæ¥­å‹™é‚è¼¯
5. **çµæœè™•ç†**: å°æ–¼ @RestControllerï¼Œç›´æ¥è¿”å›è³‡æ–™ç‰©ä»¶
6. **JSON åºåˆ—åŒ–**: Jackson è‡ªå‹•å°‡ Java ç‰©ä»¶è½‰æ›ç‚º JSON
7. **å›æ‡‰è¿”å›**: å°‡ JSON è³‡æ–™è¿”å›çµ¦å®¢æˆ¶ç«¯

> ğŸ’¡ **é‡é»**: åœ¨å‰å¾Œç«¯åˆ†é›¢æ¶æ§‹ä¸‹ï¼Œä¸å†éœ€è¦ ViewResolver è§£æè¦–åœ–ï¼Œè€Œæ˜¯ç›´æ¥ç”± Jackson åºåˆ—åŒ–ç‚º JSON è¿”å›ã€‚

---

## ğŸ­ @RestController vs @Controller

### æ ¸å¿ƒå·®ç•°

åœ¨å‰å¾Œç«¯åˆ†é›¢çš„æ¶æ§‹ä¸‹ï¼Œæˆ‘å€‘ä¸»è¦ä½¿ç”¨ `@RestController` ä¾†å»ºç«‹ APIï¼š

```mermaid
graph LR
    subgraph "å‚³çµ± Controller"
        A[Controllerè¨»è§£]
        A --> B[è¿”å›è¦–åœ–åç¨±]
        B --> C[ViewResolver]
        C --> D[JSP/Thymeleaf]
        D --> E[HTML é é¢]
    end

    subgraph "RESTful Controller"
        F[RestControllerè¨»è§£]
        F --> G[è‡ªå‹•åŠ ä¸Š<br/>ResponseBody]
        G --> H[è¿”å›è³‡æ–™ç‰©ä»¶]
        H --> I[Jackson åºåˆ—åŒ–]
        I --> J[JSON è³‡æ–™]
    end

    style A fill:#fff4e6
    style F fill:#e1f5ff
    style J fill:#e8f5e9
```

**è¨»è§£å°æ¯”**:

| ç‰¹æ€§ | @Controller | @RestController |
|------|-------------|------------------|
| **çµ„æˆ** | å–®ä¸€è¨»è§£ | @Controller + @ResponseBody |
| **å›æ‡‰é¡å‹** | è¦–åœ–åç¨±ï¼ˆå¦‚ "user/list"ï¼‰ | ç›´æ¥è³‡æ–™ï¼ˆè‡ªå‹•è½‰ JSONï¼‰ |
| **åºåˆ—åŒ–** | éœ€æ‰‹å‹•è™•ç†æˆ–åŠ  @ResponseBody | è‡ªå‹• JSON åºåˆ—åŒ– |
| **é©ç”¨å ´æ™¯** | å‚³çµ± Web æ‡‰ç”¨ï¼ˆSSRï¼‰ | å‰å¾Œç«¯åˆ†é›¢çš„ RESTful API â­ |
| **View å±¤** | éœ€è¦é…ç½® ViewResolver | ä¸éœ€è¦ View å±¤ |
| **Content-Type** | text/html | application/json |

### åŸºæœ¬ç¯„ä¾‹

```java
// å°æ‡‰ç¯„ä¾‹: chapter2-spring-mvc-api/.../api/UserRestController.java:15

@RestController
@RequestMapping("/api/v1/users")
public class UserRestController {

    private final UserService userService;

    public UserRestController(UserService userService) {
        this.userService = userService;
    }

    // å–å¾—æ‰€æœ‰ä½¿ç”¨è€…ï¼ˆæ”¯æ´åˆ†é ï¼‰
    @GetMapping
    public ResponseEntity<PagedResponse<UserDto>> getUsers(
            @RequestParam(defaultValue = "0") int page,
            @RequestParam(defaultValue = "20") int size) {

        Page<User> userPage = userService.findAll(
            PageRequest.of(page, size)
        );

        // è‡ªå‹•è½‰æ›ç‚º JSON æ ¼å¼
        return ResponseEntity.ok(
            PagedResponse.of(userPage, UserDto::from)
        );
    }

    // æ ¹æ“š ID å–å¾—ä½¿ç”¨è€…
    @GetMapping("/{id}")
    public ResponseEntity<UserDto> getUser(@PathVariable Long id) {
        User user = userService.findById(id);
        return ResponseEntity.ok(UserDto.from(user));
    }

    // å»ºç«‹æ–°ä½¿ç”¨è€…
    @PostMapping
    public ResponseEntity<UserDto> createUser(
            @RequestBody @Valid CreateUserRequest request) {

        User user = userService.create(request);

        // è¿”å› 201 Created å’Œ Location æ¨™é ­
        return ResponseEntity
            .created(URI.create("/api/v1/users/" + user.getId()))
            .body(UserDto.from(user));
    }
}
```

**ç¨‹å¼ç¢¼é‡é»**:
- âœ… `@RestController` è‡ªå‹•å°‡è¿”å›å€¼è½‰æ›ç‚º JSON
- âœ… ä½¿ç”¨ `ResponseEntity<T>` æ§åˆ¶ HTTP ç‹€æ…‹ç¢¼å’Œæ¨™é ­
- âœ… æ”¯æ´åˆ†é æŸ¥è©¢ï¼Œé¿å…ä¸€æ¬¡è¿”å›å¤§é‡è³‡æ–™
- âœ… POST è«‹æ±‚è¿”å› 201 Created å’Œè³‡æº URI

> ğŸ“ **å®Œæ•´ç¨‹å¼ç¢¼**: åƒè€ƒ [code-examples/chapter2-spring-mvc-api/src/main/java/com/example/api/](../../code-examples/chapter2-spring-mvc-api/src/main/java/com/example/api/)

---

## ğŸ”„ JSON è‡ªå‹•è™•ç†æ©Ÿåˆ¶

### Jackson åºåˆ—åŒ–åŸç†

Spring MVC é€é Jackson å‡½å¼åº«å¯¦ç¾è‡ªå‹• JSON åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚é€™å€‹éç¨‹å®Œå…¨è‡ªå‹•ï¼Œç„¡éœ€æ‰‹å‹•ç·¨å¯« JSON è½‰æ›ç¨‹å¼ç¢¼ã€‚

```mermaid
graph TD
    subgraph "è«‹æ±‚è™•ç†æµç¨‹"
        A[å®¢æˆ¶ç«¯ç™¼é€ JSON]
        A --> B[Jackson ååºåˆ—åŒ–]
        B --> C[Java ç‰©ä»¶]
        C --> D[Controller è™•ç†]
        D --> E[è¿”å› Java ç‰©ä»¶]
        E --> F[Jackson åºåˆ—åŒ–]
        F --> G[è¿”å› JSON çµ¦å®¢æˆ¶ç«¯]
    end

    subgraph "Jackson åŠŸèƒ½"
        H[è‡ªå‹•å‹åˆ¥è½‰æ›]
        I[æ—¥æœŸæ ¼å¼åŒ–]
        J[æ¬„ä½å‘½åè½‰æ›]
        K[null å€¼è™•ç†]
        L[é›†åˆå’ŒåµŒå¥—ç‰©ä»¶]
    end

    style A fill:#e1f5ff
    style C fill:#e8f5e9
    style E fill:#e8f5e9
    style G fill:#e1f5ff
```

### è‡ªå‹•åºåˆ—åŒ–ç¯„ä¾‹

```java
// å°æ‡‰ç¯„ä¾‹: chapter2-spring-mvc-api/.../api/ProductRestController.java:20

@RestController
@RequestMapping("/api/v1/products")
public class ProductRestController {

    private final ProductService productService;

    // JSON è‡ªå‹•è½‰æ›ç¯„ä¾‹
    @PostMapping
    public ResponseEntity<ProductDto> createProduct(
            @RequestBody @Valid CreateProductRequest request) {

        // è«‹æ±‚: JSON â†’ CreateProductRequest ç‰©ä»¶ï¼ˆè‡ªå‹•ååºåˆ—åŒ–ï¼‰
        // Jackson è‡ªå‹•å°‡ JSON è½‰æ›ç‚º Java ç‰©ä»¶

        Product product = productService.create(request);
        ProductDto dto = ProductDto.from(product);

        // å›æ‡‰: ProductDto ç‰©ä»¶ â†’ JSONï¼ˆè‡ªå‹•åºåˆ—åŒ–ï¼‰
        // Jackson è‡ªå‹•å°‡ Java ç‰©ä»¶è½‰æ›ç‚º JSON

        URI location = ServletUriComponentsBuilder
            .fromCurrentRequest()
            .path("/{id}")
            .buildAndExpand(product.getId())
            .toUri();

        return ResponseEntity.created(location).body(dto);
    }

    // è¤‡é›œçµæ§‹è‡ªå‹•è™•ç†
    @GetMapping("/summary")
    public ResponseEntity<ProductSummary> getProductSummary() {
        ProductSummary summary = ProductSummary.builder()
            .totalProducts(productService.count())
            .categories(productService.getCategories())
            .topProducts(productService.getTopProducts(10))
            .statistics(productService.getStatistics())
            .build();

        // è¤‡é›œçš„åµŒå¥—ç‰©ä»¶ä¹Ÿæœƒè‡ªå‹•è½‰ç‚º JSON
        return ResponseEntity.ok(summary);
    }

    // åˆ—è¡¨å’Œé›†åˆè‡ªå‹•è™•ç†
    @GetMapping
    public ResponseEntity<List<ProductDto>> getProducts() {
        List<Product> products = productService.findAll();

        // List<ProductDto> è‡ªå‹•è½‰ç‚º JSON é™£åˆ—
        List<ProductDto> dtos = products.stream()
            .map(ProductDto::from)
            .collect(Collectors.toList());

        return ResponseEntity.ok(dtos);
    }
}
```

**JSON ç¯„ä¾‹**:

**è«‹æ±‚ JSON**:
```json
{
  "name": "Spring Boot å¯¦æˆ°",
  "price": 680,
  "category": "æ›¸ç±",
  "stock": 100,
  "description": "æ·±å…¥å­¸ç¿’ Spring Boot"
}
```

**å›æ‡‰ JSON**:
```json
{
  "id": 1,
  "name": "Spring Boot å¯¦æˆ°",
  "price": 680,
  "category": "æ›¸ç±",
  "stock": 100,
  "description": "æ·±å…¥å­¸ç¿’ Spring Boot",
  "createdAt": "2025-10-30T10:30:00",
  "updatedAt": "2025-10-30T10:30:00"
}
```

**è‡ªå‹•è™•ç†çš„å„ªé»**:
- âœ… **ç„¡éœ€æ‰‹å‹•è½‰æ›**: ä¸éœ€è¦å¯« JSON è§£æç¨‹å¼ç¢¼
- âœ… **æ”¯æ´è¤‡é›œçµæ§‹**: åµŒå¥—ç‰©ä»¶ã€é›†åˆã€Map ç­‰
- âœ… **è‡ªå‹•å‹åˆ¥è½‰æ›**: Stringã€æ•¸å­—ã€æ—¥æœŸç­‰è‡ªå‹•è½‰æ›
- âœ… **é©—è­‰æ•´åˆ**: æ­é… @Valid é€²è¡Œè³‡æ–™é©—è­‰
- âœ… **éŒ¯èª¤æç¤º**: æä¾›æ¸…æ¥šçš„éŒ¯èª¤è¨Šæ¯

### è‡ªè¨‚ Jackson é…ç½®

```java
// å°æ‡‰ç¯„ä¾‹: chapter2-spring-mvc-api/.../config/JacksonConfig.java

@Configuration
public class JacksonConfig {

    @Bean
    public ObjectMapper objectMapper() {
        ObjectMapper mapper = new ObjectMapper();

        // æ—¥æœŸæ ¼å¼åŒ–
        mapper.setDateFormat(new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"));

        // null å€¼ä¸åºåˆ—åŒ–
        mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);

        // é§å³°å‘½åè½‰ä¸‹åŠƒç·š
        mapper.setPropertyNamingStrategy(PropertyNamingStrategies.SNAKE_CASE);

        // æœªçŸ¥å±¬æ€§ä¸æ‹‹ç•°å¸¸
        mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);

        return mapper;
    }
}
```

---

## ğŸš€ ç‚º Spring AI åšæº–å‚™

### AI æ‡‰ç”¨çš„ API ç‰¹æ®Šéœ€æ±‚

åœ¨è¨­è¨ˆ Spring Boot API æ™‚ï¼Œæˆ‘å€‘éœ€è¦æå‰è€ƒæ…® Spring AI çš„æ•´åˆéœ€æ±‚ã€‚AI æ‡‰ç”¨é€šå¸¸éœ€è¦è™•ç†å¤§é‡è³‡æ–™ã€é•·æ™‚é–“é‹ç®—å’Œæµå¼å›æ‡‰ã€‚

**æ¶æ§‹è¨­è¨ˆè€ƒé‡**:

```mermaid
graph TD
    A[å‰ç«¯æ‡‰ç”¨]

    subgraph "API å±¤"
        B[æ¨™æº– REST API]
        C[AI åŠŸèƒ½ API]
    end

    subgraph "æœå‹™å±¤"
        D[æ¥­å‹™æœå‹™]
        E[AI æœå‹™]
    end

    subgraph "AI æ•´åˆå±¤"
        F[Spring AI]
        G[å‘é‡è³‡æ–™åº«]
        H[LLM æ¨¡å‹]
    end

    A --> B
    A --> C
    B --> D
    C --> E
    E --> F
    F --> G
    F --> H

    style C fill:#fff4e6
    style E fill:#fff4e6
    style F fill:#e1f5ff
```

### ç•°æ­¥è™•ç†æ”¯æ´

AI æ¨¡å‹é€šå¸¸éœ€è¦è¼ƒé•·çš„è™•ç†æ™‚é–“ï¼Œå› æ­¤éœ€è¦æ”¯æ´ç•°æ­¥è™•ç†ï¼š

```java
// å°æ‡‰ç¯„ä¾‹: chapter2-spring-mvc-api/.../api/AIController.java

@RestController
@RequestMapping("/api/ai")
public class AIController {

    private final AIService aiService;

    // ç•°æ­¥è™•ç† - é©åˆ AI é•·æ™‚é–“é‹ç®—
    @PostMapping("/process")
    public CompletableFuture<ProcessResult> processAsync(
            @RequestBody ProcessRequest request) {

        return CompletableFuture.supplyAsync(() -> {
            // AI æ¨¡å‹æ¨ç†å¯èƒ½éœ€è¦å¹¾ç§’åˆ°å¹¾åç§’
            return aiService.process(request);
        });
    }

    // Server-Sent Events - æµå¼å›æ‡‰
    @GetMapping(value = "/stream", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
    public Flux<String> streamResponse(@RequestParam String prompt) {
        // é©åˆ LLM æµå¼è¼¸å‡º
        return aiService.streamGenerate(prompt);
    }
}
```

**æ ¸å¿ƒè€ƒé‡**:
- âœ… **ç•°æ­¥è™•ç†**: ä½¿ç”¨ `CompletableFuture` æˆ– `@Async` æ”¯æ´é•·æ™‚é–“é‹ç®—
- âœ… **æµå¼å›æ‡‰**: æ”¯æ´ Server-Sent Events (SSE) å¯¦ç¾æµå¼è¼¸å‡º
- âœ… **å¤šåª’é«”è™•ç†**: æ”¯æ´åœ–ç‰‡ã€éŸ³è¨Šã€è¦–è¨Šç­‰å¤šåª’é«”å…§å®¹
- âœ… **éŒ¯èª¤è™•ç†**: å®Œå–„çš„é‡è©¦å’Œå®¹éŒ¯æ©Ÿåˆ¶
- âœ… **ç›£æ§æ—¥èªŒ**: è¨˜éŒ„ AI æ¨¡å‹èª¿ç”¨å’Œæ€§èƒ½æŒ‡æ¨™

### API è¨­è¨ˆé ç•™

```java
// é ç•™ AI åŠŸèƒ½çš„ API çµæ§‹
@RestController
@RequestMapping("/api/v1")
public class UnifiedController {

    // æ¨™æº–æ¥­å‹™ API
    @GetMapping("/products")
    public ResponseEntity<List<ProductDto>> getProducts() {
        // å‚³çµ±æ¥­å‹™é‚è¼¯
    }

    // AI å¢å¼· APIï¼ˆé ç•™ï¼‰
    @PostMapping("/ai/recommend")
    public ResponseEntity<List<ProductDto>> getAIRecommendations(
            @RequestBody RecommendRequest request) {
        // æœªä¾†æ•´åˆ AI æ¨è–¦åŠŸèƒ½
    }

    // AI å°è©± APIï¼ˆé ç•™ï¼‰
    @PostMapping("/ai/chat")
    public ResponseEntity<ChatResponse> chat(
            @RequestBody ChatRequest request) {
        // æœªä¾†æ•´åˆ LLM å°è©±åŠŸèƒ½
    }
}
```

---

## ğŸ“ æœ¬ç¯€é‡é»å›é¡§

### æ ¸å¿ƒçŸ¥è­˜é»

1. **MVC æ¶æ§‹** - ç†è§£ Modelã€Viewã€Controller ä¸‰å±¤åˆ†é›¢è¨­è¨ˆ
2. **å‰å¾Œç«¯åˆ†é›¢** - æŒæ¡ç¾ä»£ Web æ‡‰ç”¨æ¶æ§‹æ¨¡å¼
3. **DispatcherServlet** - ç†è§£ Spring MVC è«‹æ±‚è™•ç†æµç¨‹
4. **@RestController** - å­¸æœƒå»ºç«‹ RESTful API
5. **JSON è‡ªå‹•è™•ç†** - æŒæ¡ Jackson åºåˆ—åŒ–æ©Ÿåˆ¶
6. **AI æ•´åˆæº–å‚™** - ç‚º Spring AI å¥ å®šæ¶æ§‹åŸºç¤

### æŠ€è¡“è¦é»

- âœ… å‰å¾Œç«¯åˆ†é›¢ä¸‹ï¼ŒSpring Boot å°ˆæ³¨æ–¼æä¾› API æœå‹™
- âœ… `@RestController` = `@Controller` + `@ResponseBody`
- âœ… Jackson è‡ªå‹•è™•ç† JSON åºåˆ—åŒ–/ååºåˆ—åŒ–
- âœ… ä½¿ç”¨ `ResponseEntity<T>` æ§åˆ¶ HTTP ç‹€æ…‹ç¢¼å’Œæ¨™é ­
- âœ… æ”¯æ´ç•°æ­¥è™•ç†å’Œæµå¼å›æ‡‰ï¼Œç‚º AI æ•´åˆåšæº–å‚™

---

## ğŸš€ ä¸‹ä¸€æ­¥

ğŸ‘‰ [2.2 RESTful API è¨­è¨ˆåŸå‰‡](./2.2-restful-api-design.md) - å­¸ç¿’è³‡æºå°å‘çš„ API è¨­è¨ˆ
ğŸ‘‰ [2.3 API è«‹æ±‚èˆ‡å›æ‡‰è™•ç†](./2.3-request-response-handling.md) - æŒæ¡è«‹æ±‚åƒæ•¸å’Œçµ±ä¸€å›æ‡‰æ ¼å¼

---

## ğŸ“š åƒè€ƒè³‡æº

**å®˜æ–¹æ–‡ä»¶**:
- [Spring MVC Reference](https://docs.spring.io/spring-framework/docs/current/reference/html/web.html)
- [Jackson Documentation](https://github.com/FasterXML/jackson-docs)

**ç¯„ä¾‹ç¨‹å¼ç¢¼**:
- [å®Œæ•´å°ˆæ¡ˆç¨‹å¼ç¢¼](../../code-examples/chapter2-spring-mvc-api)
- [UserRestController.java](../../code-examples/chapter2-spring-mvc-api/src/main/java/com/example/api/UserRestController.java)
- [ProductRestController.java](../../code-examples/chapter2-spring-mvc-api/src/main/java/com/example/api/ProductRestController.java)

---

**ç›¸é—œç« ç¯€**:
- â† ä¸Šä¸€ç« : [1.4 ç¬¬ä¸€å€‹ Spring Boot æ‡‰ç”¨](../chapter1/1.4-ç¬¬ä¸€å€‹Spring-Bootæ‡‰ç”¨.md)
- â†’ ä¸‹ä¸€ç« : [2.2 RESTful API è¨­è¨ˆåŸå‰‡](./2.2-restful-api-design.md)
