# DispatcherServlet 工作流程

```mermaid
sequenceDiagram
    participant Client as 客戶端
    participant DS as DispatcherServlet
    participant HM as HandlerMapping
    participant HA as HandlerAdapter
    participant Controller as Controller
    participant ViewResolver as ViewResolver
    participant View as View

    Client->>DS: 1. 發送 HTTP 請求
    activate DS

    DS->>HM: 2. 查詢 Handler
    activate HM
    HM-->>DS: 3. 返回 HandlerExecutionChain
    deactivate HM

    DS->>HA: 4. 獲取適配器
    activate HA
    HA->>Controller: 5. 執行 Handler
    activate Controller
    Controller->>Controller: 6. 處理業務邏輯
    Controller-->>HA: 7. 返回 ModelAndView
    deactivate Controller
    HA-->>DS: 8. 返回 ModelAndView
    deactivate HA

    DS->>ViewResolver: 9. 解析 View
    activate ViewResolver
    ViewResolver-->>DS: 10. 返回 View 物件
    deactivate ViewResolver

    DS->>View: 11. 渲染 View
    activate View
    View-->>DS: 12. 返回渲染結果
    deactivate View

    DS-->>Client: 13. 返回 HTTP 回應
    deactivate DS

    Note over DS,Controller: Spring MVC 核心流程
    Note over Client,DS: 所有請求都經過 DispatcherServlet
```

## 說明

DispatcherServlet 是 Spring MVC 的前端控制器（Front Controller），負責接收所有 HTTP 請求並分發給適當的處理器。

## 處理流程

1. **接收請求**：客戶端發送 HTTP 請求到 DispatcherServlet
2. **查詢處理器**：DispatcherServlet 詢問 HandlerMapping 來找到處理請求的 Handler
3. **獲取適配器**：獲取能夠執行該 Handler 的 HandlerAdapter
4. **執行處理器**：HandlerAdapter 調用 Controller 處理業務邏輯
5. **返回模型和視圖**：Controller 返回 ModelAndView 物件
6. **解析視圖**：ViewResolver 根據視圖名稱解析出具體的 View 物件
7. **渲染視圖**：View 渲染頁面並生成最終回應
8. **返回回應**：DispatcherServlet 將結果返回給客戶端

## 核心組件

- **DispatcherServlet**：前端控制器，Spring MVC 的核心
- **HandlerMapping**：處理器映射，決定哪個 Controller 處理請求
- **HandlerAdapter**：處理器適配器，執行 Controller
- **Controller**：控制器，處理業務邏輯
- **ViewResolver**：視圖解析器，解析視圖名稱
- **View**：視圖，渲染最終回應
