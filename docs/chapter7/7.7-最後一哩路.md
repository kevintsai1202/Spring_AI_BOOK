# 7.7 RAG çš„æœ€å¾Œä¸€å“©è·¯

> **å°æ‡‰ç« ç¯€**: Day24
> **å°æ‡‰ç¯„ä¾‹**: `chapter7-rag` (éƒ¨ç½²é…ç½®)
> **é›£åº¦**: â­â­â­â­â­

---

## ğŸ“š æœ¬ç« æ¦‚è¦

å‰é¢ç« ç¯€æˆ‘å€‘å­¸ç¿’äº† RAG ç³»çµ±çš„**é–‹ç™¼å’Œå¯¦ç¾**ã€‚ä½†è¦è®“ RAG ç³»çµ±çœŸæ­£åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­ç©©å®šé‹è¡Œ,é‚„éœ€è¦èµ°å®Œ**æœ€å¾Œä¸€å“©è·¯**: éƒ¨ç½²ã€ç›£æ§ã€å„ªåŒ–ã€‚æœ¬ç« å°‡å¸¶ä½ å®Œæˆ RAG ç³»çµ±å¾é–‹ç™¼åˆ°ç”Ÿç”¢çš„æœ€å¾Œéšæ®µã€‚

**å­¸ç¿’ç›®æ¨™**:
- æŒæ¡ RAG ç³»çµ±çš„å®¹å™¨åŒ–éƒ¨ç½²
- ç†è§£å¿«å–å’Œæ•ˆèƒ½å„ªåŒ–ç­–ç•¥
- å­¸ç¿’ç›£æ§æŒ‡æ¨™å’Œå‘Šè­¦è¨­å®š
- äº†è§£æ•…éšœæ’é™¤å’Œæœ€ä½³å¯¦è¸

---

## ğŸ¯ ç”Ÿç”¢ç’°å¢ƒçš„æŒ‘æˆ°

### å¾é–‹ç™¼åˆ°ç”Ÿç”¢çš„å·®è·

```mermaid
graph LR
    subgraph Dev["ğŸ’» é–‹ç™¼ç’°å¢ƒ"]
        D1["å–®æ©Ÿéƒ¨ç½²"] --> D2["é–‹ç™¼è€…è‡ªæ¸¬"] --> D3["åŠŸèƒ½OKå³å¯"]
    end

    subgraph Prod["ğŸ¢ ç”Ÿç”¢ç’°å¢ƒ"]
        P1["åˆ†æ•£å¼éƒ¨ç½²"] --> P2["7x24 é«˜å¯ç”¨"] --> P3["æ•ˆèƒ½+å®‰å…¨+ç›£æ§"]
    end

    Dev --> Gap["âš ï¸ å·®è·"]
    Gap --> Prod

    style Dev fill:#e1f5ff,stroke:#0288d1
    style Gap fill:#ffebee,stroke:#c62828,stroke-width:3px
    style Prod fill:#c8e6c9,stroke:#388e3c
```

**ç”Ÿç”¢ç’°å¢ƒè¦æ±‚**:

| é¢å‘ | é–‹ç™¼ç’°å¢ƒ | ç”Ÿç”¢ç’°å¢ƒ |
|------|---------|---------|
| **å¯ç”¨æ€§** | å¶çˆ¾é‡å•ŸOK | 99.9% å¯ç”¨æ€§ |
| **æ•ˆèƒ½** | å›æ‡‰æ™‚é–“ < 5ç§’ | å›æ‡‰æ™‚é–“ < 2ç§’ |
| **ä¸¦ç™¼** | 1-10 QPS | 100-1000+ QPS |
| **ç›£æ§** | æ—¥èªŒæŸ¥çœ‹ | å³æ™‚ç›£æ§+å‘Šè­¦ |
| **å®‰å…¨** | åŸºæœ¬é©—è­‰ | å®Œæ•´å®‰å…¨æ§åˆ¶ |
| **æˆæœ¬** | ä¸è€ƒæ…® | API å‘¼å«æˆæœ¬é‡è¦ |

---

## ğŸ³ å®¹å™¨åŒ–éƒ¨ç½²

### Docker Compose å¿«é€Ÿéƒ¨ç½²

Spring AI RAG ç³»çµ±é€šå¸¸åŒ…å«ä»¥ä¸‹çµ„ä»¶:
- **æ‡‰ç”¨æœå‹™**: Spring Boot æ‡‰ç”¨
- **å‘é‡è³‡æ–™åº«**: Neo4j (æˆ–å…¶ä»–)
- **å¿«å–**: Redis
- **ç›£æ§**: Prometheus + Grafana

**docker-compose.yml ç¤ºä¾‹**:

```yaml
# docker-compose.yml
version: '3.8'

services:
  # Spring AI RAG æ‡‰ç”¨
  rag-app:
    build: .
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - SPRING_AI_OPENAI_API_KEY=${OPENAI_API_KEY}
      - SPRING_AI_VECTORSTORE_NEO4J_URI=bolt://neo4j:7687
      - SPRING_AI_VECTORSTORE_NEO4J_USERNAME=neo4j
      - SPRING_AI_VECTORSTORE_NEO4J_PASSWORD=${NEO4J_PASSWORD}
      - SPRING_DATA_REDIS_HOST=redis
      - SPRING_DATA_REDIS_PORT=6379
    depends_on:
      - neo4j
      - redis
    volumes:
      - ./logs:/app/logs
    networks:
      - rag-network
    restart: unless-stopped

  # Neo4j å‘é‡è³‡æ–™åº«
  neo4j:
    image: neo4j:5.15-community
    ports:
      - "7474:7474"  # HTTP
      - "7687:7687"  # Bolt
    environment:
      - NEO4J_AUTH=neo4j/${NEO4J_PASSWORD}
      - NEO4J_PLUGINS=["apoc"]
    volumes:
      - neo4j_data:/data
    networks:
      - rag-network
    restart: unless-stopped

  # Redis å¿«å–
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    command: redis-server --requirepass ${REDIS_PASSWORD}
    volumes:
      - redis_data:/data
    networks:
      - rag-network
    restart: unless-stopped

  # Prometheus ç›£æ§
  prometheus:
    image: prom/prometheus:latest
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    networks:
      - rag-network
    restart: unless-stopped

  # Grafana è¦–è¦ºåŒ–
  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD}
    volumes:
      - grafana_data:/var/lib/grafana
    networks:
      - rag-network
    restart: unless-stopped

volumes:
  neo4j_data:
  redis_data:
  prometheus_data:
  grafana_data:

networks:
  rag-network:
    driver: bridge
```

### Dockerfile

```dockerfile
# Dockerfile
FROM openjdk:21-jdk-slim

WORKDIR /app

# è¤‡è£½æ‡‰ç”¨ç¨‹å¼
COPY target/*.jar app.jar

# å»ºç«‹é root ä½¿ç”¨è€… (å®‰å…¨æ€§)
RUN groupadd -r appuser && useradd -r -g appuser appuser
RUN chown -R appuser:appuser /app
USER appuser

# å¥åº·æª¢æŸ¥
HEALTHCHECK --interval=30s --timeout=10s --retries=3 \
    CMD curl -f http://localhost:8080/actuator/health || exit 1

EXPOSE 8080

# å•Ÿå‹•æ‡‰ç”¨
ENTRYPOINT ["java", "-jar", "-Dspring.profiles.active=prod", "app.jar"]
```

### å•Ÿå‹•å‘½ä»¤

```powershell
# è¨­å®šç’°å¢ƒè®Šæ•¸
$env:OPENAI_API_KEY="sk-..."
$env:NEO4J_PASSWORD="your-password"
$env:REDIS_PASSWORD="your-password"
$env:GRAFANA_PASSWORD="admin"

# å•Ÿå‹•æ‰€æœ‰æœå‹™
docker-compose up -d

# æŸ¥çœ‹æ—¥èªŒ
docker-compose logs -f rag-app

# åœæ­¢æœå‹™
docker-compose down

# é‡å•Ÿå–®ä¸€æœå‹™
docker-compose restart rag-app
```

---

## âš¡ æ•ˆèƒ½å„ªåŒ–ç­–ç•¥

### 1. æŸ¥è©¢å¿«å–

**å•é¡Œ**: ç›¸åŒæˆ–ç›¸ä¼¼çš„æŸ¥è©¢é‡è¤‡å‘¼å« OpenAI API,æµªè²»æˆæœ¬å’Œæ™‚é–“ã€‚

**è§£æ±ºæ–¹æ¡ˆ**: Redis å¿«å–æŸ¥è©¢çµæœ

```java
// å°æ‡‰ç¯„ä¾‹: å¿«å–å„ªåŒ–æ¦‚å¿µ

/**
 * RAG æŸ¥è©¢å¿«å–æœå‹™
 */
@Service
@RequiredArgsConstructor
public class RagCacheService {

    private final RedisTemplate<String, QueryResult> redisTemplate;
    private static final Duration CACHE_TTL = Duration.ofHours(24);

    /**
     * å¸¶å¿«å–çš„ RAG æŸ¥è©¢
     */
    public String queryWithCache(String userQuestion) {
        // 1. ç”Ÿæˆå¿«å–éµ (åŸºæ–¼å•é¡Œé›œæ¹Š)
        String cacheKey = "rag:query:" + generateHash(userQuestion);

        // 2. æª¢æŸ¥å¿«å–
        QueryResult cachedResult = redisTemplate.opsForValue().get(cacheKey);
        if (cachedResult != null) {
            log.info("âœ… å¿«å–å‘½ä¸­: {}", userQuestion);
            return cachedResult.getAnswer();
        }

        // 3. å¿«å–æœªå‘½ä¸­,åŸ·è¡Œ RAG æŸ¥è©¢
        String answer = executeRagQuery(userQuestion);

        // 4. å­˜å…¥å¿«å–
        QueryResult result = new QueryResult(userQuestion, answer);
        redisTemplate.opsForValue().set(cacheKey, result, CACHE_TTL);

        return answer;
    }

    /**
     * ç”ŸæˆæŸ¥è©¢é›œæ¹Š (ç›¸ä¼¼å•é¡Œæ‡‰ç”¢ç”Ÿç›¸åŒé›œæ¹Š)
     */
    private String generateHash(String question) {
        // æ¨™æº–åŒ–å•é¡Œ (ç§»é™¤æ¨™é»ã€å°å¯«åŒ–)
        String normalized = question
            .toLowerCase()
            .replaceAll("[^a-z0-9\\u4e00-\\u9fa5\\s]", "")
            .trim();

        return DigestUtils.md5Hex(normalized);
    }
}
```

**æ•ˆæœ**:
- âœ… å¿«å–å‘½ä¸­ç‡ 50%+
- âœ… å›æ‡‰æ™‚é–“å¾ 2ç§’ é™è‡³ 50ms (40å€æå‡)
- âœ… API æˆæœ¬é™ä½ 50%+

### 2. å‘é‡æª¢ç´¢å„ªåŒ–

**ç­–ç•¥**: èª¿æ•´ `topK` å’Œ `similarityThreshold`

```java
/**
 * å‘é‡æª¢ç´¢åƒæ•¸å„ªåŒ–
 */
@Configuration
public class VectorStoreConfig {

    @Bean
    public ChatClient ragChatClient(ChatModel chatModel, VectorStore vectorStore) {
        return ChatClient.builder(chatModel)
            .defaultAdvisors(
                new QuestionAnswerAdvisor(
                    vectorStore,
                    SearchRequest.defaults()
                        .withTopK(5)                    // æª¢ç´¢ Top 5 æœ€ç›¸ä¼¼æ–‡æª”
                        .withSimilarityThreshold(0.75)  // ç›¸ä¼¼åº¦é–€æª» 0.75
                )
            )
            .build();
    }
}
```

**åƒæ•¸å»ºè­°**:

| åƒæ•¸ | å»ºè­°å€¼ | èªªæ˜ |
|-----|-------|------|
| **topK** | 3-5 | å¤ªå°‘æœƒéºæ¼è³‡è¨Š,å¤ªå¤šæœƒç”¢ç”Ÿå™ªéŸ³ |
| **similarityThreshold** | 0.7-0.8 | éä½æœƒå¼•å…¥ä¸ç›¸é—œæ–‡æª”,éé«˜æœƒæ‰¾ä¸åˆ°çµæœ |

**æ¸¬è©¦æ–¹æ³•**:
```java
// æ¸¬è©¦ä¸åŒåƒæ•¸çµ„åˆçš„æ•ˆæœ
@Test
public void testVectorSearchParameters() {
    String query = "å¦‚ä½•ä½¿ç”¨ Spring AI?";

    // æ¸¬è©¦ä¸åŒ topK
    for (int topK : List.of(3, 5, 10)) {
        // æ¸¬è©¦ä¸åŒ threshold
        for (double threshold : List.of(0.6, 0.7, 0.8)) {
            SearchRequest request = SearchRequest.query(query)
                .withTopK(topK)
                .withSimilarityThreshold(threshold);

            List<Document> results = vectorStore.similaritySearch(request);

            System.out.printf("topK=%d, threshold=%.1f: æ‰¾åˆ° %d å€‹çµæœ%n",
                topK, threshold, results.size());
        }
    }
}
```

### 3. é€£æ¥æ± å„ªåŒ–

```yaml
# application-prod.yml
spring:
  # Neo4j é€£æ¥æ± 
  neo4j:
    pool:
      max-connection-pool-size: 50
      connection-acquisition-timeout: 60s

  # Redis é€£æ¥æ± 
  data:
    redis:
      lettuce:
        pool:
          max-active: 20
          max-idle: 10
          min-idle: 5
          max-wait: 2s

  # HTTP é€£ç·šæ±  (OpenAI API)
  ai:
    openai:
      http:
        connection-timeout: 10s
        read-timeout: 60s
        max-connections: 20
```

---

## ğŸ“Š ç›£æ§èˆ‡å‘Šè­¦

### Spring Boot Actuator è¨­å®š

```yaml
# application.yml
management:
  endpoints:
    web:
      exposure:
        include: health,metrics,prometheus,info
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true
```

### é—œéµç›£æ§æŒ‡æ¨™

```java
/**
 * RAG ç³»çµ±è‡ªå®šç¾©ç›£æ§æŒ‡æ¨™
 */
@Service
@RequiredArgsConstructor
public class RagMetricsService {

    private final MeterRegistry meterRegistry;

    /**
     * è¨˜éŒ„ RAG æŸ¥è©¢æŒ‡æ¨™
     */
    public void recordQueryMetrics(String question, QueryResult result) {
        // 1. æŸ¥è©¢æ¬¡æ•¸è¨ˆæ•¸
        meterRegistry.counter("rag.query.count",
            "status", result.isSuccess() ? "success" : "failure"
        ).increment();

        // 2. æŸ¥è©¢å»¶é²
        meterRegistry.timer("rag.query.duration",
            "type", "full_query"
        ).record(result.getDuration());

        // 3. Token ä½¿ç”¨é‡
        meterRegistry.counter("rag.tokens.used",
            "type", "total"
        ).increment(result.getTokensUsed());

        // 4. å¿«å–å‘½ä¸­ç‡
        if (result.isCacheHit()) {
            meterRegistry.counter("rag.cache.hits").increment();
        } else {
            meterRegistry.counter("rag.cache.misses").increment();
        }

        // 5. æª¢ç´¢åˆ°çš„æ–‡æª”æ•¸é‡
        meterRegistry.summary("rag.retrieval.documents.count")
            .record(result.getRetrievedDocumentsCount());

        // 6. API æˆæœ¬ (ä¼°ç®—)
        double estimatedCost = calculateCost(result.getTokensUsed());
        meterRegistry.counter("rag.api.cost.usd")
            .increment(estimatedCost);
    }

    /**
     * è¨ˆç®— API æˆæœ¬ (OpenAI gpt-4o å®šåƒ¹)
     */
    private double calculateCost(int tokens) {
        // gpt-4o: è¼¸å…¥ $0.005/1K tokens, è¼¸å‡º $0.015/1K tokens
        // ç°¡åŒ–è¨ˆç®—: å¹³å‡ $0.01/1K tokens
        return (tokens / 1000.0) * 0.01;
    }
}
```

### Prometheus é…ç½®

```yaml
# prometheus.yml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'spring-ai-rag'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['rag-app:8080']
```

### Grafana é—œéµå„€è¡¨æ¿

**å»ºè­°ç›£æ§é¢æ¿**:

1. **æŸ¥è©¢æ•ˆèƒ½**:
   - å¹³å‡å›æ‡‰æ™‚é–“ (Target: < 2ç§’)
   - P95 å›æ‡‰æ™‚é–“ (Target: < 5ç§’)
   - æŸ¥è©¢æˆåŠŸç‡ (Target: > 95%)

2. **å¿«å–æ•ˆèƒ½**:
   - å¿«å–å‘½ä¸­ç‡ (Target: > 40%)
   - å¿«å–å¤§å°

3. **è³‡æºä½¿ç”¨**:
   - CPU ä½¿ç”¨ç‡ (Target: < 70%)
   - è¨˜æ†¶é«”ä½¿ç”¨ç‡ (Target: < 80%)
   - JVM Heap ä½¿ç”¨

4. **æˆæœ¬ç›£æ§**:
   - æ¯æ—¥ Token ä½¿ç”¨é‡
   - æ¯æ—¥ API æˆæœ¬
   - æ¯æŸ¥è©¢å¹³å‡æˆæœ¬

5. **å‘é‡è³‡æ–™åº«**:
   - Neo4j é€£ç·šæ•¸
   - æŸ¥è©¢å»¶é²
   - è³‡æ–™åº«å¤§å°

### å‘Šè­¦è¦å‰‡

```yaml
# Prometheus å‘Šè­¦è¦å‰‡
groups:
  - name: rag_alerts
    rules:
      # æŸ¥è©¢å¤±æ•—ç‡éé«˜
      - alert: HighQueryFailureRate
        expr: rate(rag_query_count{status="failure"}[5m]) > 0.1
        for: 5m
        annotations:
          summary: "RAG æŸ¥è©¢å¤±æ•—ç‡éé«˜"
          description: "æœ€è¿‘ 5 åˆ†é˜å¤±æ•—ç‡ > 10%"

      # å›æ‡‰æ™‚é–“éæ…¢
      - alert: SlowQueryResponse
        expr: histogram_quantile(0.95, rate(rag_query_duration_bucket[5m])) > 5
        for: 5m
        annotations:
          summary: "RAG æŸ¥è©¢å›æ‡‰æ™‚é–“éæ…¢"
          description: "P95 å›æ‡‰æ™‚é–“ > 5ç§’"

      # æ¯æ—¥æˆæœ¬éé«˜
      - alert: HighDailyCost
        expr: sum(increase(rag_api_cost_usd[1d])) > 100
        annotations:
          summary: "æ¯æ—¥ API æˆæœ¬éé«˜"
          description: "æ¯æ—¥æˆæœ¬ > $100"
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œé€ŸæŸ¥è¡¨

| å•é¡Œ | å¯èƒ½åŸå›  | è§£æ±ºæ–¹æ³• |
|------|---------|---------|
| **å›æ‡‰æ™‚é–“æ…¢** | âŒ æœªä½¿ç”¨å¿«å–<br/>âŒ topK è¨­å¤ªå¤§<br/>âŒ ç¶²è·¯å»¶é² | âœ… å•Ÿç”¨ Redis å¿«å–<br/>âœ… èª¿æ•´ topK åˆ° 3-5<br/>âœ… æª¢æŸ¥ç¶²è·¯é€£ç·š |
| **æ‰¾ä¸åˆ°ç›¸é—œè³‡è¨Š** | âŒ similarityThreshold å¤ªé«˜<br/>âŒ è³‡æ–™æœªæ­£ç¢ºå‘é‡åŒ–<br/>âŒ Embedding æ¨¡å‹ä¸åŒ¹é… | âœ… é™ä½ threshold åˆ° 0.7<br/>âœ… æª¢æŸ¥ ETL Pipeline<br/>âœ… ç¢ºèª Embedding æ¨¡å‹ |
| **è¨˜æ†¶é«”æº¢ä½ (OOM)** | âŒ å‘é‡è³‡æ–™åº«å¤ªå¤§<br/>âŒ å¿«å–æœªé™åˆ¶å¤§å° | âœ… å¢åŠ  JVM Heap<br/>âœ… è¨­å®š Redis maxmemory |
| **API æˆæœ¬éé«˜** | âŒ å¿«å–å‘½ä¸­ç‡ä½<br/>âŒ ä½¿ç”¨æ˜‚è²´æ¨¡å‹ | âœ… å„ªåŒ–å¿«å–ç­–ç•¥<br/>âœ… è€ƒæ…® gpt-4o-mini |
| **Neo4j é€£ç·šå¤±æ•—** | âŒ é€£ç·šæ± è€—ç›¡<br/>âŒ ç¶²è·¯å•é¡Œ | âœ… å¢åŠ  pool size<br/>âœ… æª¢æŸ¥é˜²ç«ç‰†è¨­å®š |

### é™¤éŒ¯æŠ€å·§

```java
/**
 * RAG æŸ¥è©¢é™¤éŒ¯è³‡è¨Š
 */
@RestController
@RequestMapping("/api/debug")
public class RagDebugController {

    @Autowired
    private VectorStore vectorStore;

    @Autowired
    private ChatClient chatClient;

    /**
     * é™¤éŒ¯: æŸ¥çœ‹å‘é‡æª¢ç´¢çµæœ
     */
    @GetMapping("/vector-search")
    public Map<String, Object> debugVectorSearch(@RequestParam String query) {
        SearchRequest request = SearchRequest.query(query)
            .withTopK(10)
            .withSimilarityThreshold(0.5);

        List<Document> results = vectorStore.similaritySearch(request);

        // è¿”å›è©³ç´°è³‡è¨Š
        return Map.of(
            "query", query,
            "found_documents", results.size(),
            "documents", results.stream()
                .map(doc -> Map.of(
                    "content_preview", doc.getContent().substring(0, Math.min(200, doc.getContent().length())),
                    "metadata", doc.getMetadata()
                ))
                .toList()
        );
    }

    /**
     * é™¤éŒ¯: æ¸¬è©¦ Embedding
     */
    @GetMapping("/embedding")
    public Map<String, Object> debugEmbedding(@RequestParam String text) {
        // å–å¾— Embedding (å¦‚æœ Spring AI æ”¯æ´ç›´æ¥å­˜å–)
        // é€™è£¡ç¤ºç¯„æ¦‚å¿µ
        return Map.of(
            "text", text,
            "text_length", text.length(),
            "estimated_tokens", text.length() / 4  // ç°¡åŒ–ä¼°ç®—
        );
    }
}
```

---

## ğŸ“ æœ¬ç« é‡é»å›é¡§

### ç”Ÿç”¢éƒ¨ç½²æª¢æŸ¥æ¸…å–®

```mermaid
graph TB
    subgraph Deployment["ğŸ“¦ éƒ¨ç½²"]
        D1["âœ… Docker Compose / K8s"]
        D2["âœ… ç’°å¢ƒè®Šæ•¸è¨­å®š"]
        D3["âœ… Health Check"]
    end

    subgraph Performance["âš¡ æ•ˆèƒ½"]
        P1["âœ… Redis å¿«å–"]
        P2["âœ… é€£æ¥æ± å„ªåŒ–"]
        P3["âœ… åƒæ•¸èª¿æ ¡"]
    end

    subgraph Monitoring["ğŸ“Š ç›£æ§"]
        M1["âœ… Prometheus + Grafana"]
        M2["âœ… é—œéµæŒ‡æ¨™"]
        M3["âœ… å‘Šè­¦è¦å‰‡"]
    end

    subgraph Security["ğŸ”’ å®‰å…¨"]
        S1["âœ… API Key ä¿è­·"]
        S2["âœ… é root ä½¿ç”¨è€…"]
        S3["âœ… HTTPS"]
    end

    style Deployment fill:#e1f5ff,stroke:#0288d1
    style Performance fill:#fff4e6,stroke:#f57c00
    style Monitoring fill:#c8e6c9,stroke:#388e3c
    style Security fill:#ffebee,stroke:#c62828
```

### æ•ˆèƒ½å„ªåŒ–ç¸½çµ

| å„ªåŒ–ç­–ç•¥ | æ•ˆæœæå‡ | å¯¦æ–½é›£åº¦ |
|---------|---------|---------|
| **Redis å¿«å–** | â¬†ï¸ 40å€ (å‘½ä¸­æ™‚) | â­â­â˜†â˜†â˜† |
| **topK èª¿æ•´** | â¬†ï¸ 20-30% | â­â˜†â˜†â˜†â˜† |
| **é€£æ¥æ± å„ªåŒ–** | â¬†ï¸ 15-25% | â­â­â˜†â˜†â˜† |
| **ä¸¦è¡ŒæŸ¥è©¢** | â¬†ï¸ 2-3å€ | â­â­â­â˜†â˜† |

### æˆæœ¬å„ªåŒ–å»ºè­°

1. **å¿«å–ç­–ç•¥**: å¿«å–å‘½ä¸­ç‡æ¯æå‡ 10%,æˆæœ¬é™ä½ç´„ 10%
2. **æ¨¡å‹é¸æ“‡**:
   - gpt-4o: é«˜å“è³ª,é«˜æˆæœ¬
   - gpt-4o-mini: å¹³è¡¡é¸æ“‡ (æˆæœ¬é™ä½ 60%)
   - gpt-3.5-turbo: ä½æˆæœ¬ (æˆæœ¬é™ä½ 90%,ä½†å“è³ªä¸‹é™)
3. **Embedding æ¨¡å‹**:
   - text-embedding-3-large: é«˜å“è³ª (1536ç¶­)
   - text-embedding-3-small: ä½æˆæœ¬ (512ç¶­,æˆæœ¬é™ä½ 80%)

---

## ğŸ“ ç¬¬7ç« ç¸½çµ

æ­å–œ!ä½ å·²ç¶“å®Œæˆäº† Spring AI RAG ç³»çµ±çš„å®Œæ•´å­¸ç¿’æ—…ç¨‹:

```mermaid
graph LR
    A["7.1<br/>RAG æµç¨‹"] --> B["7.2<br/>å…§å®¹å‘é‡åŒ–"]
    B --> C["7.3-7.4<br/>ETL è³‡æ–™æå–"]
    C --> D["7.5<br/>è³‡æ–™å„ªåŒ–"]
    D --> E["7.6<br/>ä¼æ¥­è³‡æ–™æº"]
    E --> F["7.7<br/>éƒ¨ç½²ä¸Šç·š"]

    style F fill:#c8e6c9,stroke:#388e3c,stroke-width:3px
```

**ä½ å·²ç¶“æŒæ¡**:
- âœ… RAG æ ¸å¿ƒæ¦‚å¿µèˆ‡ Spring AI å¯¦ç¾
- âœ… å‘é‡åŒ–æŠ€è¡“èˆ‡ Embedding æ¨¡å‹
- âœ… ETL Pipeline èˆ‡å¤šæ ¼å¼æ–‡æª”è™•ç†
- âœ… è³‡æ–™æ¸…ç†ã€åˆ†å¡Šã€å…ƒè³‡æ–™å¢å¼·
- âœ… ä¼æ¥­è³‡æ–™æºæ•´åˆç­–ç•¥
- âœ… ç”Ÿç”¢éƒ¨ç½²èˆ‡æ•ˆèƒ½å„ªåŒ–

**ä¸‹ä¸€æ­¥**:
- ğŸ“š **ç¬¬8ç« **: RAG é€²éšæŠ€è¡“ (æ··åˆæª¢ç´¢ã€é‡æ’åº)
- ğŸ”§ **ç¬¬9ç« **: MCP å”è­°æ•´åˆ
- ğŸš€ **å¯¦æˆ°å°ˆæ¡ˆ**: å»ºæ§‹ä¼æ¥­ç´š RAG æ‡‰ç”¨

**æç¤º**: RAG ç³»çµ±çš„å„ªåŒ–æ˜¯æŒçºŒçš„éç¨‹,æ ¹æ“šå¯¦éš›ä½¿ç”¨æƒ…æ³ä¸æ–·èª¿æ•´!

---

**åƒè€ƒè³‡æ–™**:
- [Docker Documentation](https://docs.docker.com/)
- [Kubernetes Documentation](https://kubernetes.io/docs/)
- [Spring Boot Actuator](https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html)
- [Prometheus Documentation](https://prometheus.io/docs/)
- [å°æ‡‰ç¯„ä¾‹å°ˆæ¡ˆ](../../code-examples/chapter7-rag)
