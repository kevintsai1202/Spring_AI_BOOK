# 7.6 ä¼æ¥­ RAG çœŸæ­£çš„è³‡æ–™ä¾†æº

> **å°æ‡‰ç« ç¯€**: Day23
> **å°æ‡‰ç¯„ä¾‹**: `chapter7-rag` (æ¦‚å¿µæ¶æ§‹)
> **é›£åº¦**: â­â­â­â­â­

---

## ğŸ“š æœ¬ç« æ¦‚è¦

å‰é¢ç« ç¯€æˆ‘å€‘å­¸ç¿’äº†å¦‚ä½•è™•ç†**éœæ…‹æ–‡æª”** (PDFã€Wordã€Excel)ã€‚ä½†åœ¨çœŸå¯¦ä¼æ¥­ç’°å¢ƒä¸­,çŸ¥è­˜åº«çš„è³‡æ–™ä¾†æºé ä¸æ­¢é€™äº›:è³‡æ–™åº«ã€APIã€SaaS ç³»çµ±ã€å…§éƒ¨æ–‡æª”ç³»çµ±...ã€‚æœ¬ç« å°‡å¸¶ä½ äº†è§£å¦‚ä½•æ•´åˆé€™äº›**å‹•æ…‹ã€åˆ†æ•£çš„ä¼æ¥­è³‡æ–™ä¾†æº**ã€‚

**å­¸ç¿’ç›®æ¨™**:
- ç†è§£ä¼æ¥­è³‡æ–™ä¾†æºçš„è¤‡é›œæ€§
- æŒæ¡å¤šè³‡æ–™æºæ•´åˆæ¶æ§‹
- äº†è§£å³æ™‚è³‡æ–™åŒæ­¥ç­–ç•¥
- å­¸ç¿’è³‡æ–™å®‰å…¨èˆ‡æ¬Šé™æ§åˆ¶

---

## ğŸ¯ ä¼æ¥­ RAG çš„è³‡æ–™æŒ‘æˆ°

### çœŸå¯¦å ´æ™¯

```mermaid
graph TB
    subgraph UserQuery["ğŸ‘¤ ä½¿ç”¨è€…æŸ¥è©¢"]
        Q["æˆ‘æƒ³äº†è§£å®¢æˆ¶ A çš„<br/>æœ€æ–°è¨‚å–®ç‹€æ…‹å’Œ<br/>æ­·å²äº¤æ˜“è¨˜éŒ„"]
    end

    subgraph DataSources["ğŸ“Š è³‡æ–™ä¾†æº (åˆ†æ•£åœ¨å¤šå€‹ç³»çµ±)"]
        D1["ğŸ—„ï¸ MySQL<br/>(è¨‚å–®è³‡æ–™åº«)"]
        D2["ğŸ“„ SharePoint<br/>(åˆç´„æ–‡æª”)"]
        D3["â˜ï¸ Salesforce<br/>(å®¢æˆ¶è³‡è¨Š)"]
        D4["ğŸ“§ Email System<br/>(æºé€šç´€éŒ„)"]
        D5["ğŸ“Š Excel Reports<br/>(è²¡å‹™å ±è¡¨)"]
    end

    subgraph Challenge["âš ï¸ æŒ‘æˆ°"]
        C1["è³‡æ–™åˆ†æ•£<br/>åœ¨ 5+ å€‹ç³»çµ±"]
        C2["æ ¼å¼ä¸ä¸€è‡´<br/>(çµæ§‹åŒ–+éçµæ§‹åŒ–)"]
        C3["å³æ™‚æ€§è¦æ±‚<br/>(è¨‚å–®ç‹€æ…‹éœ€å³æ™‚)"]
        C4["æ¬Šé™æ§åˆ¶<br/>(ä¸åŒè§’è‰²çœ‹åˆ°ä¸åŒè³‡æ–™)"]
        C5["è³‡æ–™å®‰å…¨<br/>(æ•æ„Ÿè³‡è¨Šä¿è­·)"]
    end

    Q --> DataSources
    DataSources --> Challenge

    style UserQuery fill:#e1f5ff,stroke:#0288d1
    style DataSources fill:#fff4e6,stroke:#f57c00
    style Challenge fill:#ffebee,stroke:#c62828
```

### ä¼æ¥­è³‡æ–™ä¾†æºé¡å‹

| è³‡æ–™ä¾†æºé¡å‹ | ç¯„ä¾‹ | è³‡æ–™ç‰¹æ€§ | æ•´åˆé›£åº¦ |
|------------|------|---------|---------|
| **çµæ§‹åŒ–è³‡æ–™åº«** | MySQL, PostgreSQL, Oracle | çµæ§‹åŒ–,æŸ¥è©¢å¿« | â­â­â˜†â˜†â˜† |
| **NoSQL è³‡æ–™åº«** | MongoDB, Elasticsearch | åŠçµæ§‹åŒ–,éˆæ´» | â­â­â­â˜†â˜† |
| **SaaS ç³»çµ±** | Salesforce, HubSpot, Zendesk | é€é API å­˜å– | â­â­â­â­â˜† |
| **æ–‡æª”ç®¡ç†ç³»çµ±** | SharePoint, Google Drive, Confluence | éçµæ§‹åŒ–æ–‡æª” | â­â­â­â˜†â˜† |
| **éƒµä»¶èˆ‡é€šè¨Š** | Email, Slack, Teams | æºé€šç´€éŒ„ | â­â­â­â­â˜† |
| **ERP/CRM ç³»çµ±** | SAP, Oracle ERP | è¤‡é›œæ¥­å‹™é‚è¼¯ | â­â­â­â­â­ |

**é—œéµå·®ç•°**:
- ğŸ“„ **éœæ…‹æ–‡æª”**: ä¸€æ¬¡æ€§åŒ¯å…¥,è¼ƒå°‘æ›´æ–°
- ğŸ”„ **ä¼æ¥­ç³»çµ±**: è³‡æ–™æŒçºŒè®ŠåŒ–,éœ€è¦**å³æ™‚æˆ–å®šæœŸåŒæ­¥**

---

## ğŸ—ï¸ ä¼æ¥­è³‡æ–™æ•´åˆæ¶æ§‹

### å¤šå±¤æ¶æ§‹è¨­è¨ˆ

```mermaid
graph TB
    subgraph Layer1["ğŸ’¬ æ‡‰ç”¨å±¤ (Application)"]
        A1["RAG å•ç­”ä»‹é¢"] --> A2["æŸ¥è©¢è™•ç†"] --> A3["å›æ‡‰ç”Ÿæˆ"]
    end

    subgraph Layer2["ğŸ” è³‡æ–™å­˜å–å±¤ (Data Access)"]
        B1["çµ±ä¸€è³‡æ–™å­˜å– API<br/>(Unified Data Access)"]
        B2["ğŸ”’ èº«ä»½é©—è­‰<br/>(Authentication)"]
        B3["ğŸ›¡ï¸ æˆæ¬Šç®¡ç†<br/>(Authorization)"]
        B4["ğŸ’¾ å¿«å–æ©Ÿåˆ¶<br/>(Caching)"]
    end

    subgraph Layer3["ğŸ”„ è³‡æ–™è™•ç†å±¤ (Processing)"]
        C1["å³æ™‚è³‡æ–™åŒæ­¥<br/>(Real-time Sync)"]
        C2["ETL Pipeline"]
        C3["è³‡æ–™å“è³ªç›£æ§"]
        C4["è®Šæ›´è³‡æ–™æ•ç²<br/>(CDC)"]
    end

    subgraph Layer4["ğŸ’¾ å„²å­˜å±¤ (Storage)"]
        D1["Vector Store<br/>(å‘é‡è³‡æ–™åº«)"]
        D2["Search Engine<br/>(å…¨æ–‡æª¢ç´¢)"]
        D3["Data Lake<br/>(åŸå§‹è³‡æ–™æ¹–)"]
    end

    subgraph Layer5["ğŸ“Š è³‡æ–™ä¾†æºå±¤ (Sources)"]
        E1["ğŸ—„ï¸ è³‡æ–™åº«<br/>(Databases)"]
        E2["â˜ï¸ SaaS<br/>(Cloud Services)"]
        E3["ğŸ“„ æ–‡æª”ç³»çµ±<br/>(Document Systems)"]
        E4["ğŸ”Œ å¤–éƒ¨ API<br/>(External APIs)"]
    end

    Layer1 --> Layer2
    Layer2 --> Layer3
    Layer3 --> Layer4
    Layer4 --> Layer5

    style Layer1 fill:#e1f5ff,stroke:#0288d1
    style Layer2 fill:#fff4e6,stroke:#f57c00
    style Layer3 fill:#e1bee7,stroke:#8e24aa
    style Layer4 fill:#c8e6c9,stroke:#388e3c
    style Layer5 fill:#ffccbc,stroke:#e64a19
```

### è³‡æ–™ä¾†æºç®¡ç†æœå‹™ (æ¦‚å¿µ)

```java
// å°æ‡‰ç¯„ä¾‹: ä¼æ¥­ç´šæ¶æ§‹æ¦‚å¿µ

/**
 * ä¼æ¥­è³‡æ–™ä¾†æºç®¡ç†å™¨
 */
@Service
@Slf4j
public class EnterpriseDataSourceManager {

    private final Map<String, DataSourceConnector> connectors = new ConcurrentHashMap<>();

    /**
     * è¨»å†Šè³‡æ–™ä¾†æº
     */
    public void registerDataSource(DataSourceConfig config) {
        log.info("è¨»å†Šè³‡æ–™ä¾†æº: {}", config.getName());

        // 1. é©—è­‰é…ç½®
        validateConfig(config);

        // 2. å®‰å…¨æª¢æŸ¥
        validateSecurity(config);

        // 3. å»ºç«‹é€£æ¥å™¨
        DataSourceConnector connector = createConnector(config);

        // 4. æ¸¬è©¦é€£æ¥
        if (!connector.testConnection()) {
            throw new DataSourceException("é€£æ¥æ¸¬è©¦å¤±æ•—");
        }

        // 5. è¨»å†Šåˆ°ç³»çµ±
        connectors.put(config.getName(), connector);

        log.info("âœ… è³‡æ–™ä¾†æºè¨»å†ŠæˆåŠŸ: {}", config.getName());
    }

    /**
     * å»ºç«‹å°æ‡‰é¡å‹çš„é€£æ¥å™¨
     */
    private DataSourceConnector createConnector(DataSourceConfig config) {
        return switch (config.getType()) {
            case MYSQL -> new MySQLConnector(config);
            case POSTGRESQL -> new PostgreSQLConnector(config);
            case MONGODB -> new MongoDBConnector(config);
            case REST_API -> new RestApiConnector(config);
            case SALESFORCE -> new SalesforceConnector(config);
            case SHAREPOINT -> new SharePointConnector(config);
            default -> throw new UnsupportedOperationException(
                "ä¸æ”¯æ´çš„è³‡æ–™ä¾†æºé¡å‹: " + config.getType()
            );
        };
    }
}

/**
 * è³‡æ–™ä¾†æºé…ç½®
 */
@Data
@Builder
public class DataSourceConfig {
    private String name;                    // è³‡æ–™ä¾†æºåç¨±
    private DataSourceType type;            // é¡å‹
    private String connectionString;        // é€£æ¥å­—ä¸²
    private SecurityConfig security;        // å®‰å…¨é…ç½®
    private SyncConfig sync;                // åŒæ­¥é…ç½®

    @Data
    @Builder
    public static class SecurityConfig {
        private String username;
        private String password;
        private boolean sslEnabled;
        private String certificatePath;
    }

    @Data
    @Builder
    public static class SyncConfig {
        private boolean enabled;            // æ˜¯å¦å•Ÿç”¨åŒæ­¥
        private Duration interval;          // åŒæ­¥é–“éš”
        private SyncMode mode;              // åŒæ­¥æ¨¡å¼
    }
}

enum DataSourceType {
    MYSQL, POSTGRESQL, MONGODB,            // è³‡æ–™åº«
    REST_API, GRAPHQL_API,                 // API
    SALESFORCE, HUBSPOT, ZENDESK,          // SaaS
    SHAREPOINT, GOOGLE_DRIVE, CONFLUENCE   // æ–‡æª”ç³»çµ±
}

enum SyncMode {
    FULL_SYNC,          // å…¨é‡åŒæ­¥ (é©åˆå°é‡è³‡æ–™)
    INCREMENTAL_SYNC,   // å¢é‡åŒæ­¥ (åªåŒæ­¥è®Šæ›´)
    REAL_TIME_SYNC      // å³æ™‚åŒæ­¥ (ä½¿ç”¨ CDC)
}
```

---

## ğŸ”„ è³‡æ–™åŒæ­¥ç­–ç•¥

### ä¸‰ç¨®åŒæ­¥æ¨¡å¼å°æ¯”

```mermaid
graph TB
    subgraph Full["1ï¸âƒ£ å…¨é‡åŒæ­¥ (Full Sync)"]
        F1["æ¯æ¬¡åŒæ­¥æ‰€æœ‰è³‡æ–™"] --> F2["âœ… ç°¡å–®å¯é <br/>âŒ æ•ˆç‡ä½ä¸‹"]
    end

    subgraph Incremental["2ï¸âƒ£ å¢é‡åŒæ­¥ (Incremental)"]
        I1["åªåŒæ­¥è®Šæ›´çš„è³‡æ–™<br/>(åŸºæ–¼æ™‚é–“æˆ³)"] --> I2["âœ… æ•ˆç‡é«˜<br/>âš ï¸ éœ€è¦æ™‚é–“æˆ³æ¬„ä½"]
    end

    subgraph RealTime["3ï¸âƒ£ å³æ™‚åŒæ­¥ (Real-time CDC)"]
        R1["æ•ç²è³‡æ–™åº«è®Šæ›´æ—¥èªŒ<br/>(binlog/WAL)"] --> R2["âœ… å³æ™‚æ€§æœ€é«˜<br/>âš ï¸ è¤‡é›œåº¦é«˜"]
    end

    style Full fill:#ffccbc,stroke:#e64a19
    style Incremental fill:#fff4e6,stroke:#f57c00
    style RealTime fill:#c8e6c9,stroke:#388e3c
```

| åŒæ­¥æ¨¡å¼ | å»¶é²æ™‚é–“ | è³‡æºæ¶ˆè€— | å¯¦ç¾é›£åº¦ | é©ç”¨å ´æ™¯ |
|---------|---------|---------|---------|---------|
| **å…¨é‡åŒæ­¥** | åˆ†é˜-å°æ™‚ç´š | é«˜ | â­â˜†â˜†â˜†â˜† | å°å‹è³‡æ–™é›†,ä½æ›´æ–°é »ç‡ |
| **å¢é‡åŒæ­¥** | åˆ†é˜ç´š | ä¸­ | â­â­â­â˜†â˜† | **æ¨è–¦**,å¤§éƒ¨åˆ†ä¼æ¥­å ´æ™¯ |
| **å³æ™‚åŒæ­¥ (CDC)** | ç§’ç´š | ä½ | â­â­â­â­â­ | é«˜å³æ™‚æ€§éœ€æ±‚ (å¦‚è¨‚å–®ç³»çµ±) |

### å¢é‡åŒæ­¥å¯¦ç¾ (æ¨è–¦æ–¹æ¡ˆ)

```java
/**
 * å¢é‡è³‡æ–™åŒæ­¥æœå‹™
 */
@Service
@Slf4j
@RequiredArgsConstructor
public class IncrementalSyncService {

    private final DataSourceConnector dataSource;
    private final VectorStore vectorStore;
    private final SyncStateRepository syncStateRepository;

    /**
     * åŸ·è¡Œå¢é‡åŒæ­¥
     */
    @Scheduled(fixedDelay = 300000)  // æ¯ 5 åˆ†é˜åŸ·è¡Œä¸€æ¬¡
    public void performIncrementalSync() {
        log.info("ğŸ”„ é–‹å§‹å¢é‡åŒæ­¥...");

        try {
            // 1. å–å¾—ä¸Šæ¬¡åŒæ­¥æ™‚é–“
            LocalDateTime lastSyncTime = syncStateRepository.getLastSyncTime("orders");
            log.debug("ä¸Šæ¬¡åŒæ­¥æ™‚é–“: {}", lastSyncTime);

            // 2. æŸ¥è©¢è®Šæ›´è³‡æ–™ (SQL ç¤ºä¾‹)
            String query = """
                SELECT * FROM orders
                WHERE updated_at > ?
                ORDER BY updated_at ASC
                """;

            List<OrderRecord> changedRecords = dataSource.query(query, lastSyncTime);
            log.info("ğŸ“Š ç™¼ç¾ {} ç­†è®Šæ›´è³‡æ–™", changedRecords.size());

            if (changedRecords.isEmpty()) {
                return;  // æ²’æœ‰è®Šæ›´,ç›´æ¥è¿”å›
            }

            // 3. è½‰æ›ç‚º Document
            List<Document> documents = changedRecords.stream()
                .map(this::convertToDocument)
                .toList();

            // 4. ETL Transform (åˆ†å¡Šã€å¢å¼·å…ƒè³‡æ–™)
            documents = performTransform(documents);

            // 5. å¯«å…¥å‘é‡è³‡æ–™åº«
            vectorStore.write(documents);

            // 6. æ›´æ–°åŒæ­¥ç‹€æ…‹
            LocalDateTime newSyncTime = changedRecords.get(changedRecords.size() - 1)
                .getUpdatedAt();
            syncStateRepository.updateLastSyncTime("orders", newSyncTime);

            log.info("âœ… å¢é‡åŒæ­¥å®Œæˆ: {} ç­†è³‡æ–™", documents.size());

        } catch (Exception e) {
            log.error("âŒ å¢é‡åŒæ­¥å¤±æ•—", e);
            // è¨˜éŒ„å¤±æ•—,ç¨å¾Œé‡è©¦
        }
    }

    /**
     * å°‡è³‡æ–™åº«è¨˜éŒ„è½‰æ›ç‚º Document
     */
    private Document convertToDocument(OrderRecord record) {
        String content = String.format("""
            è¨‚å–®ç·¨è™Ÿ: %s
            å®¢æˆ¶: %s
            ç”¢å“: %s
            é‡‘é¡: %s
            ç‹€æ…‹: %s
            å‚™è¨»: %s
            """,
            record.getOrderId(),
            record.getCustomerName(),
            record.getProductName(),
            record.getAmount(),
            record.getStatus(),
            record.getNotes()
        );

        Map<String, Object> metadata = Map.of(
            "document_type", "ORDER",
            "order_id", record.getOrderId(),
            "customer_id", record.getCustomerId(),
            "created_at", record.getCreatedAt().toString(),
            "updated_at", record.getUpdatedAt().toString(),
            "status", record.getStatus(),
            "source", "mysql_orders_table"
        );

        return new Document(content, metadata);
    }

    /**
     * ETL Transform è™•ç†
     */
    private List<Document> performTransform(List<Document> documents) {
        // 1. æ–‡æœ¬åˆ†å¡Š (å¦‚æœéœ€è¦)
        // 2. å…ƒè³‡æ–™å¢å¼·
        // 3. æ•æ„Ÿè³‡è¨Šè„«æ•
        return documents;  // ç°¡åŒ–ç¤ºä¾‹
    }
}

/**
 * åŒæ­¥ç‹€æ…‹å­˜å„²
 */
@Repository
public interface SyncStateRepository {
    LocalDateTime getLastSyncTime(String tableName);
    void updateLastSyncTime(String tableName, LocalDateTime syncTime);
}
```

**å¢é‡åŒæ­¥é—œéµé»**:
1. âœ… **æ™‚é–“æˆ³æ¬„ä½**: è¡¨å¿…é ˆæœ‰ `updated_at` æˆ– `modified_date` æ¬„ä½
2. âœ… **ç´¢å¼•å„ªåŒ–**: åœ¨æ™‚é–“æˆ³æ¬„ä½å»ºç«‹ç´¢å¼•,æå‡æŸ¥è©¢æ•ˆèƒ½
3. âœ… **å†ªç­‰æ€§**: ç¢ºä¿é‡è¤‡åŸ·è¡Œä¸æœƒç”¢ç”Ÿé‡è¤‡è³‡æ–™
4. âœ… **ç‹€æ…‹ç®¡ç†**: è¨˜éŒ„ä¸Šæ¬¡åŒæ­¥æ™‚é–“,é¿å…éºæ¼

---

## ğŸ”’ è³‡æ–™å®‰å…¨èˆ‡æ¬Šé™æ§åˆ¶

### å¤šå±¤å®‰å…¨æ¶æ§‹

```mermaid
graph TB
    subgraph User["ğŸ‘¤ ä½¿ç”¨è€…è«‹æ±‚"]
        U1["ä½¿ç”¨è€… A<br/>(éŠ·å”®ç¶“ç†)<br/>æŸ¥è©¢å®¢æˆ¶è¨‚å–®"]
    end

    subgraph Security["ğŸ”’ å®‰å…¨å±¤"]
        S1["1ï¸âƒ£ èº«ä»½é©—è­‰<br/>(Authentication)"]
        S2["2ï¸âƒ£ è§’è‰²é©—è­‰<br/>(Role-Based Access)"]
        S3["3ï¸âƒ£ è³‡æ–™éæ¿¾<br/>(Row-Level Security)"]
        S4["4ï¸âƒ£ æ•æ„Ÿè³‡è¨Šè„«æ•<br/>(Data Masking)"]
    end

    subgraph Data["ğŸ“Š è³‡æ–™"]
        D1["âœ… åªè¿”å›è©²ç¶“ç†<br/>è² è²¬çš„å®¢æˆ¶è¨‚å–®"]
        D2["âœ… éš±è—ä¿¡ç”¨å¡è™Ÿ<br/>(é¡¯ç¤ºæœ«4ç¢¼)"]
    end

    User --> Security
    Security --> Data

    S1 --> S2 --> S3 --> S4

    style User fill:#e1f5ff,stroke:#0288d1
    style Security fill:#fff4e6,stroke:#f57c00
    style Data fill:#c8e6c9,stroke:#388e3c
```

### æ¬Šé™æ§åˆ¶å¯¦ç¾ (æ¦‚å¿µ)

```java
/**
 * è³‡æ–™å­˜å–æ¬Šé™æ§åˆ¶
 */
@Service
@RequiredArgsConstructor
public class DataAccessControlService {

    private final UserService userService;

    /**
     * æ ¹æ“šä½¿ç”¨è€…è§’è‰²éæ¿¾æŸ¥è©¢çµæœ
     */
    public SearchRequest applyAccessControl(SearchRequest request, String userId) {
        User user = userService.getUserById(userId);

        // æ ¹æ“šè§’è‰²æ·»åŠ éæ¿¾æ¢ä»¶
        String filterExpression = buildFilterExpression(user);

        return SearchRequest.from(request)
            .withFilterExpression(filterExpression)
            .build();
    }

    /**
     * å»ºç«‹éæ¿¾è¡¨é”å¼
     */
    private String buildFilterExpression(User user) {
        StringBuilder filter = new StringBuilder();

        // åŸºæ–¼è§’è‰²çš„éæ¿¾
        switch (user.getRole()) {
            case SALES_MANAGER:
                // åªèƒ½çœ‹åˆ°è‡ªå·±åœ˜éšŠçš„è³‡æ–™
                filter.append("team_id == '").append(user.getTeamId()).append("'");
                break;

            case CUSTOMER_SERVICE:
                // åªèƒ½çœ‹åˆ°å®¢æœç›¸é—œè³‡æ–™
                filter.append("department == 'CS'");
                break;

            case ADMIN:
                // ç®¡ç†å“¡å¯ä»¥çœ‹æ‰€æœ‰è³‡æ–™
                break;

            default:
                // é è¨­:åªèƒ½çœ‹å…¬é–‹è³‡æ–™
                filter.append("visibility == 'public'");
        }

        return filter.toString();
    }

    /**
     * æ•æ„Ÿè³‡è¨Šè„«æ•
     */
    public List<Document> maskSensitiveData(List<Document> documents, User user) {
        // ä¸æ˜¯ç®¡ç†å“¡å°±è„«æ•
        if (user.getRole() != Role.ADMIN) {
            return documents.stream()
                .map(this::maskDocument)
                .toList();
        }
        return documents;
    }

    private Document maskDocument(Document doc) {
        String content = doc.getContent();

        // ä¿¡ç”¨å¡è™Ÿè„«æ•
        content = content.replaceAll(
            "\\b\\d{4}[-\\s]?\\d{4}[-\\s]?\\d{4}[-\\s](\\d{4})\\b",
            "**** **** **** $1"
        );

        // èº«åˆ†è­‰è™Ÿè„«æ•
        content = content.replaceAll(
            "\\b([A-Z])(\\d{8})(\\d)\\b",
            "$1********$3"
        );

        // é›»è©±è™Ÿç¢¼è„«æ•
        content = content.replaceAll(
            "\\b(\\d{2,4})[-\\s]?(\\d{3,4})[-\\s]?(\\d{3,4})\\b",
            "$1-****-$3"
        );

        return new Document(content, doc.getMetadata());
    }
}
```

**å®‰å…¨æœ€ä½³å¯¦è¸**:
- âœ… **æœ€å°æ¬Šé™åŸå‰‡**: é è¨­æ‹’çµ•,æ˜ç¢ºæˆæ¬Š
- âœ… **è³‡æ–™è„«æ•**: æ ¹æ“šè§’è‰²è‡ªå‹•è„«æ•æ•æ„Ÿè³‡è¨Š
- âœ… **å¯©è¨ˆæ—¥èªŒ**: è¨˜éŒ„æ‰€æœ‰è³‡æ–™å­˜å–è¡Œç‚º
- âœ… **åŠ å¯†å‚³è¼¸**: ä½¿ç”¨ HTTPS/TLS ä¿è­·è³‡æ–™å‚³è¼¸

---

## ğŸ“Š è³‡æ–™åŒæ­¥ç›£æ§

### ç›£æ§æŒ‡æ¨™

```java
/**
 * è³‡æ–™åŒæ­¥ç›£æ§æœå‹™
 */
@Service
@RequiredArgsConstructor
public class SyncMonitoringService {

    private final MeterRegistry meterRegistry;

    /**
     * è¨˜éŒ„åŒæ­¥æŒ‡æ¨™
     */
    public void recordSyncMetrics(SyncResult result) {
        // 1. åŒæ­¥æˆåŠŸ/å¤±æ•—è¨ˆæ•¸
        if (result.isSuccess()) {
            meterRegistry.counter("data_sync.success",
                "source", result.getSourceName()
            ).increment();
        } else {
            meterRegistry.counter("data_sync.failures",
                "source", result.getSourceName()
            ).increment();
        }

        // 2. åŒæ­¥è¨˜éŒ„æ•¸
        meterRegistry.counter("data_sync.records_processed",
            "source", result.getSourceName()
        ).increment(result.getRecordsProcessed());

        // 3. åŒæ­¥è€—æ™‚
        meterRegistry.timer("data_sync.duration",
            "source", result.getSourceName()
        ).record(result.getDuration());

        // 4. è³‡æ–™å»¶é² (æœ€æ–°è³‡æ–™çš„æ™‚é–“æˆ³ vs ç•¶å‰æ™‚é–“)
        Duration dataLag = Duration.between(result.getLatestDataTime(), LocalDateTime.now());
        meterRegistry.gauge("data_sync.lag_seconds",
            List.of(Tag.of("source", result.getSourceName())),
            dataLag.getSeconds()
        );
    }
}
```

**ç›£æ§å‘Šè­¦è¦å‰‡**:
- âš ï¸ åŒæ­¥å¤±æ•—ç‡ > 5%
- âš ï¸ è³‡æ–™å»¶é² > 10 åˆ†é˜
- âš ï¸ åŒæ­¥è€—æ™‚ > 5 åˆ†é˜

---

## ğŸ“ æœ¬ç« é‡é»å›é¡§

### ä¼æ¥­è³‡æ–™ä¾†æºæ•´åˆé—œéµ

```mermaid
mindmap
  root((ä¼æ¥­ RAG<br/>è³‡æ–™ä¾†æº))
    è³‡æ–™ä¾†æºé¡å‹
      çµæ§‹åŒ–è³‡æ–™åº«
      SaaS ç³»çµ±
      æ–‡æª”ç®¡ç†ç³»çµ±
      API æ•´åˆ
    åŒæ­¥ç­–ç•¥
      å…¨é‡åŒæ­¥
      å¢é‡åŒæ­¥ â­
      å³æ™‚åŒæ­¥ CDC
    å®‰å…¨æ§åˆ¶
      èº«ä»½é©—è­‰
      è§’è‰²æˆæ¬Š
      è³‡æ–™è„«æ•
      å¯©è¨ˆæ—¥èªŒ
    ç›£æ§é‹ç¶­
      åŒæ­¥ç‹€æ…‹
      è³‡æ–™å“è³ª
      æ•ˆèƒ½æŒ‡æ¨™
      å‘Šè­¦é€šçŸ¥
```

### å¯¦æ–½å»ºè­°

| éšæ®µ | é‡é»ä»»å‹™ | é æœŸæˆæœ |
|-----|---------|---------|
| **ç¬¬ä¸€éšæ®µ** | æ•´åˆ 1-2 å€‹æ ¸å¿ƒè³‡æ–™åº« | åŸºç¤è³‡æ–™åŒæ­¥ |
| **ç¬¬äºŒéšæ®µ** | å¯¦ç¾å¢é‡åŒæ­¥æ©Ÿåˆ¶ | æ•ˆèƒ½æå‡ 3-5å€ |
| **ç¬¬ä¸‰éšæ®µ** | æ·»åŠ æ¬Šé™æ§åˆ¶ | è³‡æ–™å®‰å…¨åˆè¦ |
| **ç¬¬å››éšæ®µ** | æ•´åˆæ›´å¤š SaaS ç³»çµ± | å®Œæ•´çŸ¥è­˜åº« |

### æŠ€è¡“é¸å‹å»ºè­°

**è³‡æ–™åº«æ•´åˆ**:
- âœ… **JDBC**: æœ€æˆç†Ÿ,æ”¯æ´æ‰€æœ‰é—œè¯å¼è³‡æ–™åº«
- âœ… **Spring Data**: ç°¡åŒ–é–‹ç™¼,æ¨è–¦ä½¿ç”¨

**API æ•´åˆ**:
- âœ… **RestTemplate/WebClient**: Spring å®˜æ–¹æ¨è–¦
- âœ… **Feign**: å®£å‘Šå¼ API å®¢æˆ¶ç«¯

**å³æ™‚åŒæ­¥ (CDC)**:
- âœ… **Debezium**: æ¥­ç•Œæ¨™æº–,æ”¯æ´å¤šç¨®è³‡æ–™åº«
- âœ… **Maxwell**: MySQL binlog è§£æ,è¼•é‡ç´š

---

## ğŸš€ ä¸‹ä¸€æ­¥

åœ¨ **7.7 æœ€å¾Œä¸€å“©è·¯** ä¸­,æˆ‘å€‘å°‡å­¸ç¿’:
- ğŸ¯ **æ··åˆæª¢ç´¢**: çµåˆå‘é‡æª¢ç´¢å’Œå…¨æ–‡æª¢ç´¢
- ğŸ“Š **çµæœé‡æ’åº (Reranking)**: æå‡æª¢ç´¢ç²¾æº–åº¦
- âš¡ **æ•ˆèƒ½å„ªåŒ–**: å¿«å–ç­–ç•¥å’ŒæŸ¥è©¢å„ªåŒ–
- ğŸ“ˆ **ç›£æ§èˆ‡è©•ä¼°**: RAG ç³»çµ±å“è³ªæŒ‡æ¨™

**æç¤º**: ä¼æ¥­ç´š RAG ç³»çµ±çš„æˆåŠŸ,70% å–æ±ºæ–¼è³‡æ–™æ•´åˆçš„å“è³ª!

---

**åƒè€ƒè³‡æ–™**:
- [Debezium CDC Platform](https://debezium.io/)
- [Spring Data Documentation](https://spring.io/projects/spring-data)
- [Salesforce API](https://developer.salesforce.com/docs/apis)
- [å°æ‡‰ç¯„ä¾‹å°ˆæ¡ˆ](../../code-examples/chapter7-rag)
