# 3.3 API æ–‡ä»¶åŒ–èˆ‡æ¸¬è©¦

> **å­¸ç¿’é‡é»**ï¼šæŒæ¡ Swagger/OpenAPI è‡ªå‹•æ–‡ä»¶ç”Ÿæˆå’Œ API æ¸¬è©¦å·¥å…·ä½¿ç”¨

---

## 3.3.1 ç‚ºä»€éº¼éœ€è¦ API æ–‡ä»¶ï¼Ÿ

API æ–‡ä»¶å°±åƒæ˜¯ã€Œä½¿ç”¨æŒ‡å—ã€ï¼Œå°æ–¼é–‹ç™¼åœ˜éšŠå”ä½œå’Œç¬¬ä¸‰æ–¹æ•´åˆè‡³é—œé‡è¦ï¼š

**æ²’æœ‰æ–‡ä»¶çš„ç—›é»**ï¼š
- âŒ API åšä»€éº¼åŠŸèƒ½ä¸æ¸…æ¥š
- âŒ åƒæ•¸æ ¼å¼ä¸æ˜ç¢º
- âŒ å›å‚³è³‡æ–™çµæ§‹æœªçŸ¥
- âŒ éŒ¯èª¤ç¢¼å’Œè™•ç†æ–¹å¼ä¸æ˜

**æœ‰æ–‡ä»¶çš„å„ªå‹¢**ï¼š
- âœ… å‰å¾Œç«¯å”ä½œæ•ˆç‡æå‡
- âœ… æ¸›å°‘æºé€šæˆæœ¬
- âœ… æ–°æˆå“¡å¿«é€Ÿä¸Šæ‰‹
- âœ… æ”¯æ´ç¬¬ä¸‰æ–¹æ•´åˆ

---

## 3.3.2 æ•´åˆ Swagger/OpenAPI

> âš ï¸ **é‡è¦èªªæ˜**ï¼šSwagger/OpenAPI **ä¸¦é** Spring Boot å…§å»ºåŠŸèƒ½ï¼Œè€Œæ˜¯**ç¬¬ä¸‰æ–¹å¥—ä»¶**ã€‚éœ€è¦æ‰‹å‹•æ·»åŠ ä¾è³´ä¸¦æŒ‡å®šç‰ˆæœ¬è™Ÿã€‚

### SpringDoc vs Springfox

ç›®å‰ä¸»æµçš„ Spring Boot OpenAPI æ•´åˆæ–¹æ¡ˆæœ‰å…©ç¨®ï¼š

| æ–¹æ¡ˆ | ç‹€æ…‹ | é©ç”¨ç‰ˆæœ¬ | æ¨è–¦åº¦ |
|------|------|----------|--------|
| **SpringDoc** | âœ… æ´»èºç¶­è­· | Spring Boot 3.x | â­â­â­â­â­ æ¨è–¦ |
| **Springfox** | âŒ åœæ­¢ç¶­è­· | Spring Boot 2.x | ä¸æ¨è–¦ |

> ğŸ’¡ **æœ¬æ›¸ä½¿ç”¨ SpringDoc**ï¼šå› ç‚ºå®ƒæ˜¯ç›®å‰å”¯ä¸€æ”¯æ´ Spring Boot 3.x çš„æ´»èºå°ˆæ¡ˆï¼Œä¸¦ä¸”ç¬¦åˆæœ€æ–°çš„ OpenAPI 3.0 è¦ç¯„ã€‚

### 1. æ·»åŠ ä¾è³´

```xml
<!-- pom.xml -->
<!-- âš ï¸ å¿…é ˆæ˜ç¢ºæŒ‡å®šç‰ˆæœ¬è™Ÿï¼ŒSpringDoc ä¸åœ¨ Spring Boot çš„ä¾è³´ç®¡ç†ä¸­ -->
<dependency>
    <groupId>org.springdoc</groupId>
    <artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
    <version>2.2.0</version>  <!-- æ˜ç¢ºæŒ‡å®šç‰ˆæœ¬ï¼Œé Spring Boot å…§å»ºå¥—ä»¶ -->
</dependency>
```

**ç‰ˆæœ¬é¸æ“‡å»ºè­°**ï¼š

| Spring Boot ç‰ˆæœ¬ | SpringDoc ç‰ˆæœ¬ | èªªæ˜ |
|------------------|----------------|------|
| 3.0.x - 3.2.x | 2.2.0+ | æœ¬æ›¸ä½¿ç”¨ç‰ˆæœ¬ |
| 2.x | 1.7.0 | èˆŠç‰ˆæœ¬ï¼Œä¸å»ºè­°æ–°å°ˆæ¡ˆä½¿ç”¨ |

> ğŸ“¦ **ç‚ºä»€éº¼è¦æŒ‡å®šç‰ˆæœ¬ï¼Ÿ**
> - SpringDoc æ˜¯ç¬¬ä¸‰æ–¹å¥—ä»¶ï¼Œä¸åŒ…å«åœ¨ Spring Boot çš„ `spring-boot-dependencies` BOM ä¸­
> - å¦‚æœä¸æŒ‡å®šç‰ˆæœ¬è™Ÿï¼ŒMaven å°‡ç„¡æ³•è§£æä¾è³´
> - ä¸åŒç‰ˆæœ¬çš„ SpringDoc æ”¯æ´ä¸åŒçš„ Spring Boot ç‰ˆæœ¬

### 2. åŸºæœ¬é…ç½®

```java
@Configuration
public class OpenApiConfig {

    @Bean
    public OpenAPI customOpenAPI() {
        return new OpenAPI()
                .info(new Info()
                        .title("ä¼æ¥­ç´šåŠŸèƒ½ API")
                        .version("1.0.0")
                        .description("è³‡æ–™é©—è­‰ã€æª”æ¡ˆè™•ç†èˆ‡ API æ–‡ä»¶åŒ–ç¯„ä¾‹")
                        .contact(new Contact()
                                .name("é–‹ç™¼åœ˜éšŠ")
                                .email("dev@example.com")
                                .url("https://example.com"))
                        .license(new License()
                                .name("MIT License")
                                .url("https://opensource.org/licenses/MIT")))
                .servers(Arrays.asList(
                        new Server().url("http://localhost:8080").description("é–‹ç™¼ç’°å¢ƒ"),
                        new Server().url("https://api.example.com").description("ç”Ÿç”¢ç’°å¢ƒ")
                ));
    }
}
```

### 3. è¨ªå• Swagger UI

æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•å¾Œï¼š
- **Swagger UI**: http://localhost:8080/swagger-ui.html
- **API æ–‡ä»¶**: http://localhost:8080/v3/api-docs

---

## 3.3.3 ä½¿ç”¨ Swagger è¨»è§£

### æ§åˆ¶å™¨æ–‡ä»¶åŒ–

```java
/**
 * ä½¿ç”¨è€…ç®¡ç†æ§åˆ¶å™¨
 * å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Swagger è¨»è§£ç‚º API ç”Ÿæˆæ–‡ä»¶
 */
@RestController
@RequestMapping("/api/users")
@Tag(name = "ä½¿ç”¨è€…ç®¡ç†", description = "ä½¿ç”¨è€…ç›¸é—œçš„ CRUD æ“ä½œ")
public class UserController {

    // ğŸ“ API æ–¹æ³•æ–‡ä»¶åŒ–
    @Operation(
        summary = "ç²å–æ‰€æœ‰ä½¿ç”¨è€…",
        description = "ç²å–ç³»çµ±ä¸­æ‰€æœ‰ä½¿ç”¨è€…çš„åˆ—è¡¨ï¼Œæ”¯æ´åˆ†é å’Œæ’åº"
    )
    @ApiResponses(value = {
        @ApiResponse(responseCode = "200", description = "æˆåŠŸç²å–ä½¿ç”¨è€…åˆ—è¡¨"),
        @ApiResponse(responseCode = "500", description = "ä¼ºæœå™¨å…§éƒ¨éŒ¯èª¤")
    })
    @GetMapping
    public ResponseEntity<ApiResponse<List<User>>> getAllUsers(
            @Parameter(description = "é ç¢¼ï¼Œå¾ 0 é–‹å§‹", example = "0")
            @RequestParam(defaultValue = "0") int page,

            @Parameter(description = "æ¯é å¤§å°", example = "10")
            @RequestParam(defaultValue = "10") int size) {
        // å¯¦ä½œç•¥...
        return ResponseEntity.ok(ApiResponse.success("ç²å–æˆåŠŸ", users));
    }

    // ğŸ“ POST è«‹æ±‚æ–‡ä»¶åŒ–
    @Operation(summary = "å»ºç«‹æ–°ä½¿ç”¨è€…", description = "å»ºç«‹ä¸€å€‹æ–°çš„ä½¿ç”¨è€…å¸³è™Ÿ")
    @ApiResponse(responseCode = "201", description = "ä½¿ç”¨è€…å»ºç«‹æˆåŠŸ")
    @PostMapping
    public ResponseEntity<ApiResponse<User>> createUser(
            @Parameter(description = "ä½¿ç”¨è€…å»ºç«‹è«‹æ±‚", required = true)
            @Valid @RequestBody CreateUserRequest request) {
        // å¯¦ä½œç•¥...
        return ResponseEntity.status(HttpStatus.CREATED).body(ApiResponse.success("å»ºç«‹æˆåŠŸ", user));
    }
}
```

### è³‡æ–™æ¨¡å‹æ–‡ä»¶åŒ–

```java
/**
 * ğŸ“ ä½¿ç”¨ @Schema è¨»è§£ç‚ºè³‡æ–™æ¨¡å‹æ·»åŠ æ–‡ä»¶
 */
@Schema(description = "ä½¿ç”¨è€…è³‡è¨Š")
public class User {

    @Schema(description = "ä½¿ç”¨è€… ID", example = "1", accessMode = Schema.AccessMode.READ_ONLY)
    private Long id;

    @Schema(description = "ä½¿ç”¨è€…åç¨±", example = "å¼µå°æ˜", requiredMode = Schema.RequiredMode.REQUIRED)
    private String name;

    @Schema(description = "é›»å­éƒµä»¶åœ°å€", example = "ming@example.com")
    private String email;

    // Getters and Setters
}

/**
 * ğŸ“ çµåˆé©—è­‰è¨»è§£å’Œæ–‡ä»¶è¨»è§£
 */
@Schema(description = "å»ºç«‹ä½¿ç”¨è€…è«‹æ±‚")
public class CreateUserRequest {

    @Schema(description = "ä½¿ç”¨è€…åç¨±", example = "å¼µå°æ˜", requiredMode = Schema.RequiredMode.REQUIRED)
    @NotBlank(message = "ä½¿ç”¨è€…åç¨±ä¸èƒ½ç‚ºç©º")
    private String name;

    @Schema(description = "é›»å­éƒµä»¶åœ°å€", example = "ming@example.com", requiredMode = Schema.RequiredMode.REQUIRED)
    @Email(message = "é›»å­éƒµä»¶æ ¼å¼ä¸æ­£ç¢º")
    private String email;

    // Getters and Setters
}
```

> ğŸ’¡ **é‡é»**ï¼šSwagger è¨»è§£èˆ‡æ¥­å‹™é‚è¼¯åˆ†é›¢ï¼Œåªéœ€åœ¨é¡åˆ¥å’Œæ–¹æ³•ä¸Šæ·»åŠ æ–‡ä»¶æ¨™è¨»ï¼Œæ–‡ä»¶æœƒè‡ªå‹•ç”Ÿæˆ

---

## 3.3.4 API æ¸¬è©¦å·¥å…·

### ä½¿ç”¨ curl æ¸¬è©¦

```bash
# GET è«‹æ±‚
curl -X GET "http://localhost:8080/api/users?page=0&size=10"

# POST è«‹æ±‚ï¼ˆJSONï¼‰
curl -X POST "http://localhost:8080/api/users" \
     -H "Content-Type: application/json" \
     -d '{"name": "æ¸¬è©¦ä½¿ç”¨è€…", "email": "test@example.com"}'

# æª”æ¡ˆä¸Šå‚³
curl -X POST "http://localhost:8080/api/files/upload" -F "file=@test.jpg"
```

### ä½¿ç”¨ Postman æˆ– Swagger UI æ¸¬è©¦

**æ¨è–¦æ–¹å¼**ï¼š
- âœ… **Swagger UI**ï¼šå…§å»ºæ¸¬è©¦ä»‹é¢ï¼ˆhttp://localhost:8080/swagger-ui.htmlï¼‰
- âœ… **Postman**ï¼šåŠŸèƒ½å®Œæ•´çš„ API æ¸¬è©¦å·¥å…·
- âœ… **curl**ï¼šå‘½ä»¤åˆ—å¿«é€Ÿæ¸¬è©¦

> ğŸ’¡ **æç¤º**ï¼šSwagger UI æä¾›å³æ™‚æ¸¬è©¦åŠŸèƒ½ï¼Œå¯ç›´æ¥åœ¨æ–‡ä»¶é é¢æ¸¬è©¦ API

---

## 3.3.5 API æ¸¬è©¦é¡å‹

| æ¸¬è©¦é¡å‹ | ç›®çš„ | æ¸¬è©¦ç¯„åœ | é©ç”¨å ´æ™¯ |
|----------|------|----------|----------|
| **åŠŸèƒ½æ¸¬è©¦** | é©—è­‰ API åŠŸèƒ½æ­£ç¢ºæ€§ | å–®ä¸€ API ç«¯é» | åŸºæœ¬ CRUD æ“ä½œ |
| **æ•´åˆæ¸¬è©¦** | é©—è­‰ç³»çµ±é–“å”ä½œ | å¤šå€‹ API ç«¯é» | æ¥­å‹™æµç¨‹æ¸¬è©¦ |
| **æ•ˆèƒ½æ¸¬è©¦** | é©—è­‰å›æ‡‰æ™‚é–“å’Œååé‡ | ç³»çµ±è² è¼‰èƒ½åŠ› | é«˜ä½µç™¼å ´æ™¯ |
| **å®‰å…¨æ¸¬è©¦** | é©—è­‰å®‰å…¨æ©Ÿåˆ¶ | èªè­‰æˆæ¬Šæ©Ÿåˆ¶ | æ•æ„Ÿè³‡æ–™ä¿è­· |

---

## ğŸ“ æœ¬ç¯€é‡é»

1. âœ… **API æ–‡ä»¶é‡è¦æ€§**ï¼šç†è§£æ–‡ä»¶å°åœ˜éšŠå”ä½œçš„åƒ¹å€¼
2. âœ… **Swagger æ•´åˆ**ï¼šæŒæ¡ SpringDoc OpenAPI é…ç½®
3. âœ… **è¨»è§£ä½¿ç”¨**ï¼šå­¸æœƒä½¿ç”¨ @Operationã€@Schema ç­‰è¨»è§£
4. âœ… **æ¸¬è©¦å·¥å…·**ï¼šç†Ÿç·´ä½¿ç”¨ curlã€Postman å’Œ Swagger UI

**Swagger è¨»è§£é€ŸæŸ¥è¡¨**ï¼š

| è¨»è§£ | ç”¨é€” | é©ç”¨ç¯„åœ |
|------|------|----------|
| `@Tag` | API åˆ†çµ„ | æ§åˆ¶å™¨é¡åˆ¥ |
| `@Operation` | API æè¿° | æ§åˆ¶å™¨æ–¹æ³• |
| `@Parameter` | åƒæ•¸èªªæ˜ | æ–¹æ³•åƒæ•¸ |
| `@Schema` | è³‡æ–™æ¨¡å‹ | é¡åˆ¥ã€æ¬„ä½ |
| `@ApiResponse` | å›æ‡‰èªªæ˜ | æ§åˆ¶å™¨æ–¹æ³• |

---

## ğŸ”— ç›¸é—œè³‡æº

- **å®Œæ•´ç¨‹å¼ç¢¼**ï¼š[code-examples/chapter3-enterprise-features/](../../code-examples/chapter3-enterprise-features/)
- **Swagger é…ç½®**ï¼š[OpenApiConfig.java](../../code-examples/chapter3-enterprise-features/src/main/java/com/example/enterprise/config/)
- **æ§åˆ¶å™¨ç¯„ä¾‹**ï¼š[UserController.java](../../code-examples/chapter3-enterprise-features/src/main/java/com/example/enterprise/controller/)
- **å®˜æ–¹æ–‡ä»¶**ï¼š[SpringDoc OpenAPI](https://springdoc.org/)

---

**ä¸Šä¸€ç¯€**ï¼š[3.2 æª”æ¡ˆä¸Šå‚³èˆ‡ä¸‹è¼‰](./3.2-file-upload-download.md)
**å›åˆ°ç›®éŒ„**ï¼š[ç¬¬3ç«  README](./README.md)
