# 6.5 å‘é‡è³‡æ–™åº«é¸æ“‡æŒ‡å—

> **å°æ‡‰ç« ç¯€**: Day21
> **å°æ‡‰ç¯„ä¾‹**: `chapter6-memory-vector`
> **é›£åº¦**: â­â­â­â˜†â˜†

---

## ğŸ“š æœ¬ç« æ¦‚è¦

Spring AI 1.0 GA æ”¯æ´è¶…é 20 ç¨®å‘é‡è³‡æ–™åº«,å¦‚ä½•é¸æ“‡é©åˆä¼æ¥­éœ€æ±‚çš„æ–¹æ¡ˆæ˜¯å¯¦ç¾ RAG ç³»çµ±çš„é—œéµã€‚æœ¬ç« æä¾›å®Œæ•´çš„é¸æ“‡æŒ‡å—å’Œéƒ¨ç½²æ–¹æ¡ˆã€‚

**å­¸ç¿’ç›®æ¨™**:
- äº†è§£å‘é‡è³‡æ–™åº«çš„åŸºæœ¬æ¦‚å¿µ
- æŒæ¡ Spring AI æ”¯æ´çš„ä¸»æµå‘é‡è³‡æ–™åº«
- å­¸æœƒæ ¹æ“šå ´æ™¯é¸æ“‡åˆé©çš„æ–¹æ¡ˆ
- äº†è§£ Docker Compose å¿«é€Ÿéƒ¨ç½²

---

## ğŸ¯ ä»€éº¼æ˜¯å‘é‡è³‡æ–™åº«?

### å‚³çµ±è³‡æ–™åº« vs å‘é‡è³‡æ–™åº«

```
å‚³çµ±SQLæŸ¥è©¢:
SELECT * FROM products WHERE name LIKE '%Spring%'
â†’ åªèƒ½æ‰¾åˆ°åŒ…å« "Spring" é€™å€‹å­—çš„å•†å“

å‘é‡è³‡æ–™åº«æŸ¥è©¢:
search("Spring æ¡†æ¶é–‹ç™¼")
â†’ å¯ä»¥æ‰¾åˆ°: "Spring Boot"ã€"Java æ¡†æ¶"ã€"å¾Œç«¯é–‹ç™¼" ç­‰èªç¾©ç›¸é—œçš„å…§å®¹
```

### æ ¸å¿ƒæ¦‚å¿µ

```mermaid
graph LR
    A[åŸå§‹æ–‡æœ¬] --> B[Embedding Model]
    B --> C[å‘é‡ 1536ç¶­]
    C --> D[å‘é‡è³‡æ–™åº«]
    E[æŸ¥è©¢æ–‡æœ¬] --> B
    B --> F[æŸ¥è©¢å‘é‡]
    F --> D
    D --> G[ç›¸ä¼¼åº¦æœå°‹]
    G --> H[Top-K çµæœ]

    style A fill:#e1f5ff
    style D fill:#fff4e6
    style H fill:#e8f5e9
```

**å‘é‡åŒ–ç¯„ä¾‹**:
```
æ–‡æœ¬: "Spring AI å¾ˆæ£’"
å‘é‡: [0.123, -0.456, 0.789, ..., 0.321] (1536ç¶­)

æ–‡æœ¬: "Spring AI is great"
å‘é‡: [0.125, -0.452, 0.791, ..., 0.319] (ç›¸ä¼¼!)
```

---

## ğŸ“Š Spring AI 1.1 æ”¯æ´çš„å‘é‡è³‡æ–™åº«

### å®Œæ•´æ¸…å–®

| é¡åˆ¥ | è³‡æ–™åº« | ç‰¹é» | é©ç”¨å ´æ™¯ |
|------|--------|------|---------|
| **å°ˆç”¨å‘é‡DB** | Pinecone | â˜ï¸ é›²ç«¯æ‰˜ç®¡ã€è‡ªå‹•æ“´å±• | é›²ç«¯å„ªå…ˆã€å¤§è¦æ¨¡ |
| | Qdrant | âš¡ é«˜æ€§èƒ½ã€é–‹æº | è‡ªä¸»éƒ¨ç½²ã€é«˜QPS |
| | Weaviate | ğŸ” èªç¾©æœå°‹ã€GraphQL | çŸ¥è­˜åœ–è­œ |
| | Milvus | ğŸ“ˆ è¶…å¤§è¦æ¨¡ã€åˆ†æ•£å¼ | å„„ç´šè³‡æ–™ |
| | Chroma | ğŸ¨ ç°¡å–®æ˜“ç”¨ã€å…§åµŒ | å¿«é€ŸåŸå‹ |
| **å‚³çµ±DB+å‘é‡** | pgvector | ğŸ˜ PostgreSQL æ“´å±• | å·²æœ‰ PG ç’°å¢ƒ |
| | Redis | âš¡ å¿«å–+å‘é‡ | é«˜æ€§èƒ½å¿«å– |
| | Elasticsearch | ğŸ” å…¨æ–‡+å‘é‡ | æ··åˆæœå°‹ |
| | MongoDB | ğŸƒ æ–‡æª”+å‘é‡ | å·²æœ‰ Mongo ç’°å¢ƒ |
| **åœ–å½¢DB** | Neo4j | ğŸ•¸ï¸ åœ–è­œ+å‘é‡ | çŸ¥è­˜åœ–è­œã€é—œä¿‚ |
| **é›²ç«¯æ–¹æ¡ˆ** | Azure Cosmos | â˜ï¸ Azure ç”Ÿæ…‹ | Azure ç”¨æˆ¶ |
| | AWS OpenSearch | â˜ï¸ AWS ç”Ÿæ…‹ | AWS ç”¨æˆ¶ |

### é…ç½®ç¯„ä¾‹

```yaml
# application.yml - å‘é‡è³‡æ–™åº«é…ç½®
spring:
  ai:
    vectorstore:
      # === å°ˆç”¨å‘é‡è³‡æ–™åº« ===
      pinecone:
        api-key: ${PINECONE_API_KEY}
        environment: us-east1-gcp
        index-name: knowledge-base

      qdrant:
        url: http://localhost:6333
        api-key: ${QDRANT_API_KEY}
        collection-name: documents

      weaviate:
        url: http://localhost:8080
        api-key: ${WEAVIATE_API_KEY}
        class-name: Document

      # === å‚³çµ±è³‡æ–™åº«+å‘é‡ ===
      pgvector:
        url: jdbc:postgresql://localhost:5432/vectordb
        username: postgres
        password: ${DB_PASSWORD}
        dimensions: 1536

      redis:
        url: redis://localhost:6379
        index-name: doc-index

      # === åœ–å½¢è³‡æ–™åº« ===
      neo4j:
        uri: bolt://localhost:7687
        username: neo4j
        password: ${NEO4J_PASSWORD}
```

---

## ğŸ³ Docker Compose å¿«é€Ÿéƒ¨ç½²

### å®Œæ•´ç’°å¢ƒé…ç½®

```yaml
# å°æ‡‰ç¯„ä¾‹: chapter6-memory-vector/docker/docker-compose.yml

version: '3.8'

services:
  # === PostgreSQL + pgvector ===
  postgres-vector:
    image: pgvector/pgvector:pg16
    container_name: postgres-vector
    environment:
      POSTGRES_DB: vectordb
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  # === Qdrant (æ¨è–¦) ===
  qdrant:
    image: qdrant/qdrant:latest
    container_name: qdrant
    ports:
      - "6333:6333"   # REST API
      - "6334:6334"   # gRPC
    volumes:
      - qdrant_data:/qdrant/storage

  # === Neo4j ===
  neo4j:
    image: neo4j:5.13-community
    container_name: neo4j
    ports:
      - "7474:7474"  # HTTP
      - "7687:7687"  # Bolt
    environment:
      NEO4J_AUTH: neo4j/password
    volumes:
      - neo4j_data:/data

  # === Redis Stack ===
  redis-stack:
    image: redis/redis-stack:latest
    container_name: redis-stack
    ports:
      - "6379:6379"
      - "8001:8001"  # RedisInsight
    volumes:
      - redis_data:/data

  # === Elasticsearch ===
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0
    container_name: elasticsearch
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
      - "ES_JAVA_OPTS=-Xms1g -Xmx1g"
    ports:
      - "9200:9200"
    volumes:
      - es_data:/usr/share/elasticsearch/data

volumes:
  postgres_data:
  qdrant_data:
  neo4j_data:
  redis_data:
  es_data:
```

### å•Ÿå‹•å‘½ä»¤

```bash
# å•Ÿå‹•æ‰€æœ‰æœå‹™
docker-compose up -d

# å•Ÿå‹•ç‰¹å®šæœå‹™
docker-compose up -d qdrant neo4j

# æŸ¥çœ‹ç‹€æ…‹
docker-compose ps

# æŸ¥çœ‹æ—¥èªŒ
docker-compose logs -f qdrant

# åœæ­¢æœå‹™
docker-compose down
```

---

## ğŸ¯ é¸æ“‡æ±ºç­–æ¨¹

### æ ¹æ“šå ´æ™¯é¸æ“‡

```mermaid
graph TD
    A[é–‹å§‹é¸æ“‡] --> B{å·²æœ‰è³‡æ–™åº«?}
    B -->|æœ‰PostgreSQL| C[pgvector]
    B -->|æœ‰MongoDB| D[MongoDB Atlas]
    B -->|æœ‰Redis| E[Redis Stack]
    B -->|æ²’æœ‰| F{éƒ¨ç½²æ–¹å¼?}

    F -->|é›²ç«¯æ‰˜ç®¡| G[Pinecone/Weaviate]
    F -->|è‡ªä¸»éƒ¨ç½²| H{è³‡æ–™è¦æ¨¡?}

    H -->|å°å‹ <100è¬| I[Qdrant/Chroma]
    H -->|ä¸­å‹ <1000è¬| J[Qdrant/pgvector]
    H -->|å¤§å‹ >1000è¬| K[Milvus/Qdrant Cluster]

    style A fill:#e1f5ff
    style C fill:#e8f5e9
    style I fill:#e8f5e9
    style G fill:#fff4e6
```

### è©³ç´°å»ºè­°

**1. é–‹ç™¼/æ¸¬è©¦ç’°å¢ƒ**
```java
@Bean
@Profile("dev")
public VectorStore devVectorStore(EmbeddingModel embeddingModel) {
    // ä½¿ç”¨ç°¡å–®çš„è¨˜æ†¶é«”ç‰ˆæœ¬
    return new SimpleVectorStore(embeddingModel);
}
```

**æ¨è–¦**: InMemory æˆ– Chroma
- âœ… ç„¡éœ€é¡å¤–ä¾è³´
- âœ… å¿«é€Ÿå•Ÿå‹•
- âš ï¸ é‡å•Ÿä¸Ÿå¤±

**2. ä¸­å°å‹ä¼æ¥­ (<100è¬æ–‡æª”)**
```yaml
spring:
  ai:
    vectorstore:
      pgvector:
        url: jdbc:postgresql://localhost:5432/vectordb
```

**æ¨è–¦**: pgvector æˆ– Qdrant
- âœ… PostgreSQL ç©©å®šå¯é 
- âœ… æ˜“æ–¼ç¶­è­·
- âœ… æˆæœ¬ä½

**3. å¤§è¦æ¨¡ä¼æ¥­ (>100è¬æ–‡æª”)**
```yaml
spring:
  ai:
    vectorstore:
      qdrant:
        url: http://qdrant-cluster:6333
        # åˆ†æ•£å¼é…ç½®
```

**æ¨è–¦**: Qdrant Cluster æˆ– Milvus
- âœ… é«˜æ€§èƒ½
- âœ… æ°´å¹³æ“´å±•
- âœ… æ”¯æ´å„„ç´šè³‡æ–™

**4. é›²ç«¯å„ªå…ˆ**
```yaml
spring:
  ai:
    vectorstore:
      pinecone:
        api-key: ${PINECONE_API_KEY}
```

**æ¨è–¦**: Pinecone æˆ– Weaviate Cloud
- âœ… ç„¡éœ€ç¶­è­·
- âœ… è‡ªå‹•æ“´å±•
- âš ï¸ æˆæœ¬è¼ƒé«˜

---

## ğŸ’» Spring AI å‹•æ…‹é…ç½®

### çµ±ä¸€é…ç½®ç®¡ç†

```java
// å°æ‡‰ç¯„ä¾‹: chapter6-memory-vector (æ¦‚å¿µ)

@Configuration
@EnableConfigurationProperties(VectorStoreProperties.class)
public class VectorStoreConfig {

    @Bean
    @ConditionalOnProperty(name = "app.vectorstore.type", havingValue = "pgvector")
    public VectorStore pgVectorStore(
            JdbcTemplate jdbcTemplate,
            EmbeddingModel embeddingModel) {

        return PgVectorStore.builder(jdbcTemplate, embeddingModel)
            .tableName("vector_store")
            .dimensions(1536)
            .build();
    }

    @Bean
    @ConditionalOnProperty(name = "app.vectorstore.type", havingValue = "qdrant")
    public VectorStore qdrantVectorStore(
            QdrantClient client,
            EmbeddingModel embeddingModel) {

        return QdrantVectorStore.builder(client, embeddingModel)
            .collectionName("documents")
            .dimensions(1536)
            .build();
    }

    @Bean
    @ConditionalOnProperty(name = "app.vectorstore.type", havingValue = "neo4j")
    public VectorStore neo4jVectorStore(
            Driver driver,
            EmbeddingModel embeddingModel) {

        return Neo4jVectorStore.builder(driver, embeddingModel)
            .indexName("document-embeddings")
            .dimensions(1536)
            .build();
    }
}
```

### é…ç½®æ–‡ä»¶

```yaml
# application-dev.yml (é–‹ç™¼ç’°å¢ƒ)
app:
  vectorstore:
    type: memory

# application-prod.yml (ç”Ÿç”¢ç’°å¢ƒ)
app:
  vectorstore:
    type: pgvector

spring:
  datasource:
    url: jdbc:postgresql://db-server:5432/vectordb
```

---

## ğŸ“Š æ€§èƒ½å°æ¯”

### ç°¡åŒ–å°æ¯”è¡¨

| è³‡æ–™åº« | QPS | å»¶é² | æ“´å±•æ€§ | æˆæœ¬ | ç¶­è­·é›£åº¦ |
|--------|-----|------|--------|------|---------|
| Pinecone | â­â­â­â­â­ | <50ms | â­â­â­â­â­ | ğŸ’°ğŸ’°ğŸ’° | â­ |
| Qdrant | â­â­â­â­â­ | <30ms | â­â­â­â­ | ğŸ’° | â­â­ |
| Milvus | â­â­â­â­â­ | <40ms | â­â­â­â­â­ | ğŸ’°ğŸ’° | â­â­â­ |
| pgvector | â­â­â­ | <100ms | â­â­â­ | ğŸ’° | â­â­ |
| Neo4j | â­â­â­â­ | <60ms | â­â­â­â­ | ğŸ’°ğŸ’° | â­â­â­ |

---

## ğŸ“ é‡é»å›é¡§

### å‘é‡è³‡æ–™åº«æ ¸å¿ƒ
âœ… æ”¯æ´èªç¾©ç›¸ä¼¼åº¦æœå°‹
âœ… Spring AI æ”¯æ´ 20+ ç¨®æ–¹æ¡ˆ
âœ… å¯é€é Docker å¿«é€Ÿéƒ¨ç½²

### é¸æ“‡å»ºè­°
- **é–‹ç™¼æ¸¬è©¦**: InMemory, Chroma
- **ä¸­å°ä¼æ¥­**: pgvector, Qdrant
- **å¤§è¦æ¨¡**: Milvus, Qdrant Cluster
- **é›²ç«¯**: Pinecone, Weaviate Cloud

### é—œéµå› ç´ 
1. è³‡æ–™è¦æ¨¡
2. QPS éœ€æ±‚
3. éƒ¨ç½²æ–¹å¼ (é›²ç«¯/è‡ªä¸»)
4. é ç®—è€ƒé‡
5. ç¾æœ‰æŠ€è¡“æ£§

---

## ğŸš€ ä¸‹ä¸€æ­¥

ğŸ‘‰ [6.6 Neo4j é…ç½®èˆ‡éƒ¨ç½²](./6.6-Neo4j-é…ç½®èˆ‡éƒ¨ç½².md) - æ·±å…¥ Neo4j
ğŸ‘‰ [6.7 VectorStoreChatMemoryAdvisor](./6.7-VectorStoreChatMemoryAdvisor.md) - å‘é‡è¨˜æ†¶å¯¦æˆ°

---

**ç›¸é—œç« ç¯€**:
- â† ä¸Šä¸€ç« : [6.4 Advisor è‡ªå®šç¾©é–‹ç™¼](./6.4-Advisor-è‡ªå®šç¾©é–‹ç™¼.md)
- â†’ ä¸‹ä¸€ç« : [6.6 Neo4j é…ç½®èˆ‡éƒ¨ç½²](./6.6-Neo4j-é…ç½®èˆ‡éƒ¨ç½².md)
