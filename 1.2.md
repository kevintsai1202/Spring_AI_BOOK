# 1.2 Spring Boot 專案架構與配置

## 🎯 學習目標

完成本章學習後，您將能夠：

1. **理解分層架構設計原則** - 掌握表現層、業務層、資料層的職責分工
2. **熟悉標準目錄結構** - 了解 Spring Boot 專案的標準組織方式
3. **掌握配置管理策略** - 學會多環境配置和屬性管理
4. **建立可維護的專案結構** - 遵循最佳實踐建立專業級應用架構
5. **理解依賴注入架構** - 掌握 Spring Boot 的核心設計模式

## 為什麼專案架構如此重要？

想像一下，如果您接手一個沒有統一架構規範的專案：
- 程式碼散落在各個角落，找不到邏輯
- 業務邏輯與資料存取混雜在一起
- 配置檔案四處分散，難以管理
- 新功能開發時不知道該放在哪裡

**良好的專案架構就像建築物的藍圖**，它定義了：
- 程式碼的組織方式和放置位置
- 各層級的職責分離和協作關係
- 統一的配置管理和資源組織
- 可擴展和可維護的程式碼結構

💡 **重點提示**：Spring Boot 遵循「約定優於配置」原則，提供了一套經過實戰驗證的架構模式。

## 標準專案結構解析

### 根目錄結構
```
spring-boot-demo/
├── src/main/java/              # Java 原始碼
├── src/main/resources/         # 資源檔案
├── src/test/java/             # 測試程式碼
├── pom.xml                    # Maven 配置
├── mvnw, mvnw.cmd            # Maven Wrapper
└── README.md                  # 專案說明
```

### Java 原始碼組織
```
src/main/java/com/example/demo/
├── DemoApplication.java       # 主程式入口
├── controller/               # 控制器層
├── service/                  # 服務層
├── model/                   # 資料模型
├── config/                  # 配置類別
├── exception/               # 例外處理
└── util/                    # 工具類別
```

✅ **優勢標示**：這種結構按功能分層，便於團隊協作和程式碼維護。

## 分層架構設計

### 三層架構模式
```
┌─────────────────────────────────────┐
│        Presentation Layer          │  ← 表現層 (Controller)
├─────────────────────────────────────┤
│         Business Layer             │  ← 業務層 (Service)
├─────────────────────────────────────┤
│         Data Access Layer          │  ← 資料存取層 (Repository)
└─────────────────────────────────────┘
```

### 各層職責定義

| 層級 | 職責 | 主要元件 | 關鍵特性 |
|------|------|----------|----------|
| **表現層** | 處理 HTTP 請求與回應 | Controller | 輕薄層，不包含業務邏輯 |
| **業務層** | 核心業務邏輯處理 | Service | 事務管理、業務規則驗證 |
| **資料存取層** | 資料庫操作與資料持久化 | Repository | 資料 CRUD 操作 |

💡 **開發順序建議**：按照 Model → Service → Controller 的順序進行開發，確保依賴關係清晰。

## 配置管理架構

### 配置檔案層次結構
```
resources/
├── application.properties          # 基本配置
├── application-dev.properties      # 開發環境
├── application-test.properties     # 測試環境
├── application-prod.properties     # 生產環境
├── static/                        # 靜態資源
├── templates/                     # 模板檔案
└── META-INF/                      # 元資料
```

### 配置優先級順序
1. **命令列參數** - 最高優先級
2. **系統環境變數** - 作業系統層級
3. **application-{profile}.properties** - 環境特定配置
4. **application.properties** - 預設配置
5. **@PropertySource** - 程式碼指定配置

### 核心配置類別

| 配置類型 | 用途 | 範例設定 |
|----------|------|----------|
| **伺服器配置** | 埠號、路徑設定 | `server.port=8080` |
| **資料庫配置** | 連線資訊、連線池 | `spring.datasource.*` |
| **日誌配置** | 日誌等級、輸出格式 | `logging.level.*` |
| **安全配置** | 認證、授權設定 | `spring.security.*` |

## 依賴注入架構

### 注入方式比較

| 注入方式 | 優點 | 缺點 | 建議使用場景 |
|----------|------|------|--------------|
| **建構函式注入** | 不可變、必要依賴 | 建構函式參數多 | 必要依賴 |
| **Setter 注入** | 可選依賴、靈活 | 可變性風險 | 可選依賴 |
| **欄位注入** | 程式碼簡潔 | 測試困難 | 不建議使用 |

### 依賴管理最佳實踐

1. **介面導向設計** - 依賴抽象而非具體實作
2. **單一職責原則** - 每個元件只負責一項功能
3. **依賴倒置原則** - 高層模組不依賴低層模組
4. **開放封閉原則** - 對擴展開放，對修改封閉

## 自動配置機制

### Spring Boot 自動配置特性

| 功能領域 | 自動配置內容 | 觸發條件 |
|----------|--------------|----------|
| **Web MVC** | 控制器、視圖解析器 | spring-boot-starter-web |
| **資料存取** | DataSource、JPA | spring-boot-starter-data-jpa |
| **安全性** | 認證、授權機制 | spring-boot-starter-security |
| **監控** | 健康檢查、指標收集 | spring-boot-starter-actuator |

### 配置覆寫策略

1. **條件化配置** - 根據環境自動啟用/停用功能
2. **屬性綁定** - 將配置屬性綁定到 Java 物件
3. **配置處理器** - 自訂配置邏輯和驗證
4. **外部化配置** - 支援多種配置來源

## 專案結構最佳實踐

### 套件組織原則
```
com.example.demo/
├── controller/          # 按層級分離
│   ├── api/            # API 控制器
│   └── web/            # Web 控制器
├── service/            # 業務服務
│   ├── impl/           # 服務實作
│   └── dto/            # 資料傳輸物件
├── repository/         # 資料存取
├── config/             # 配置類別
├── exception/          # 例外處理
└── util/              # 工具類別
```

### 命名規範建議

| 元件類型 | 命名規範 | 範例 |
|----------|----------|------|
| **Controller** | XxxController | UserController |
| **Service** | XxxService | UserService |
| **Repository** | XxxRepository | UserRepository |
| **Configuration** | XxxConfig | DatabaseConfig |
| **Exception** | XxxException | UserNotFoundException |

## 環境配置管理

### Profile 配置策略

| 環境 | Profile | 特性 | 用途 |
|------|---------|------|------|
| **開發環境** | dev | 詳細日誌、熱重載 | 本地開發 |
| **測試環境** | test | 記憶體資料庫、模擬服務 | 自動化測試 |
| **預發環境** | staging | 接近生產配置 | 上線前驗證 |
| **生產環境** | prod | 效能最佳化、安全強化 | 正式服務 |

### 配置外部化

1. **環境變數** - 容器化部署的首選方式
2. **配置中心** - 集中式配置管理
3. **命令列參數** - 啟動時動態配置
4. **配置檔案** - 傳統檔案式配置

## 📝 重點摘要

1. **分層架構是 Spring Boot 的核心設計模式**，確保職責分離和程式碼可維護性
2. **標準目錄結構有助於團隊協作**，新成員能快速理解專案組織
3. **配置管理支援多環境部署**，透過 Profile 機制適應不同運行環境
4. **自動配置簡化開發流程**，遵循約定優於配置原則
5. **依賴注入提供鬆耦合架構**，提高程式碼可測試性和可維护性
6. **外部化配置支援動態調整**，無需重新編譯即可修改應用行為

透過本章的學習，您已經掌握了 Spring Boot 專案架構的核心概念和配置管理策略。良好的架構設計是成功專案的基石，為後續的功能開發奠定了堅實的基礎。

---

## 💡 架構設計補充：Maven 專案結構與依賴管理

### Maven 標準目錄佈局

Maven 遵循「約定優於配置」的理念，定義了標準的專案目錄結構：

```
project-root/
├── pom.xml                    # 專案物件模型檔案
├── src/
│   ├── main/
│   │   ├── java/             # 主要 Java 原始碼
│   │   ├── resources/        # 主要資源檔案
│   │   └── webapp/           # Web 應用資源 (如適用)
│   └── test/
│       ├── java/             # 測試 Java 原始碼
│       └── resources/        # 測試資源檔案
├── target/                   # 編譯輸出目錄
└── README.md                 # 專案說明文件
```

### 依賴管理策略

| 依賴範圍 | 說明 | 使用時機 |
|----------|------|----------|
| **compile** | 編譯和運行時都需要 | 核心業務依賴 |
| **provided** | 編譯時需要，運行時由容器提供 | Servlet API |
| **runtime** | 運行時需要，編譯時不需要 | 資料庫驅動 |
| **test** | 僅測試時需要 | JUnit、Mockito |
| **system** | 系統路徑依賴 | 特殊情況使用 |

### Spring Boot Starter 架構

Spring Boot Starter 是預配置的依賴描述符，簡化了依賴管理：

| Starter | 功能領域 | 包含的主要依賴 |
|---------|----------|----------------|
| **spring-boot-starter-web** | Web 開發 | Spring MVC、Tomcat、Jackson |
| **spring-boot-starter-data-jpa** | JPA 資料存取 | Hibernate、Spring Data JPA |
| **spring-boot-starter-security** | 安全框架 | Spring Security |
| **spring-boot-starter-test** | 測試支援 | JUnit、Mockito、Spring Test |

### 建構生命週期

Maven 定義了標準的建構生命週期階段：

1. **validate** - 驗證專案結構和資訊
2. **compile** - 編譯主要原始碼
3. **test** - 執行單元測試
4. **package** - 打包編譯後的程式碼
5. **verify** - 執行整合測試和品質檢查
6. **install** - 安裝到本地儲存庫
7. **deploy** - 部署到遠端儲存庫

這種標準化的專案結構和建構流程，確保了不同開發者和環境之間的一致性，是現代 Java 專案開發的基礎架構。