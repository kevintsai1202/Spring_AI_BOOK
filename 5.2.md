# 5.2 å¦‚ä½•è·Ÿ ChatGPT ä¸€æ¨£è™•ç†å¤šæ¨¡æ…‹è³‡æ–™

> **æœ¬ç« é‡é»**ï¼šå­¸ç¿’ä½¿ç”¨ Spring AI è™•ç†å¤šæ¨¡æ…‹è³‡æ–™ï¼Œè®“ AI ä¸åƒ…èƒ½ç†è§£æ–‡å­—ï¼Œé‚„èƒ½åˆ†æåœ–ç‰‡ã€éŸ³è¨Šã€å½±ç‰‡ç­‰å¤šç¨®åª’é«”æ ¼å¼ï¼Œå¯¦ç¾å¦‚åŒ ChatGPT èˆ¬çš„å¤šæ¨¡æ…‹äº’å‹•é«”é©—ã€‚

## ğŸ¯ å­¸ç¿’ç›®æ¨™

å®Œæˆæœ¬ç« å­¸ç¿’å¾Œï¼Œæ‚¨å°‡èƒ½å¤ ï¼š

- ğŸ¯ **ç†è§£å¤šæ¨¡æ…‹æ¦‚å¿µ**ï¼šæŒæ¡å¤šæ¨¡æ…‹ AI çš„æ ¸å¿ƒåŸç†å’Œæ‡‰ç”¨å ´æ™¯
- ğŸ¯ **é¸æ“‡åˆé©çš„ AI æ¨¡å‹**ï¼šäº†è§£å„ç¨® AI æ¨¡å‹çš„å¤šæ¨¡æ…‹èƒ½åŠ›å’Œé™åˆ¶
- ğŸ¯ **å¯¦ç¾åœ–ç‰‡åˆ†æåŠŸèƒ½**ï¼šå»ºç«‹åœ–ç‰‡ä¸Šå‚³å’Œåˆ†æçš„å®Œæ•´åŠŸèƒ½
- ğŸ¯ **è™•ç†å¤šç¨®åª’é«”æ ¼å¼**ï¼šæ”¯æ´åœ–ç‰‡ã€éŸ³è¨Šã€å½±ç‰‡ç­‰å¤šç¨®åª’é«”é¡å‹
- ğŸ¯ **å„ªåŒ–å¤šæ¨¡æ…‹æ‡‰ç”¨**ï¼šæŒæ¡æ•ˆèƒ½å„ªåŒ–å’ŒéŒ¯èª¤è™•ç†çš„æœ€ä½³å¯¦è¸

---

## 5.2.1 ä»€éº¼æ˜¯å¤šæ¨¡æ…‹ AIï¼Ÿ

### å¤šæ¨¡æ…‹å°±æ˜¯åŒæ™‚æä¾›å…©ç¨®ä»¥ä¸Šè³‡æ–™æº

![å¤šæ¨¡æ…‹ AI](https://ithelp.ithome.com.tw/upload/images/20240810/201612905TZ6mYSAy1.jpg)

**å¤šæ¨¡æ…‹ï¼ˆMultimodalityï¼‰** æ˜¯æŒ‡ AI ç³»çµ±èƒ½å¤ åŒæ™‚è™•ç†å’Œç†è§£å¤šç¨®ä¸åŒé¡å‹çš„è³‡æ–™è¼¸å…¥ï¼Œå¦‚æ–‡å­—ã€åœ–ç‰‡ã€éŸ³è¨Šã€å½±ç‰‡ç­‰ã€‚é€™ç¨®èƒ½åŠ›è®“ AI æ›´æ¥è¿‘äººé¡çš„æ„ŸçŸ¥æ–¹å¼ï¼Œèƒ½å¤ ç¶œåˆå¤šç¨®æ„Ÿå®˜è³‡è¨Šä¾†ç†è§£å’Œå›æ‡‰ã€‚

### Spring AI ä¸­çš„å¤šæ¨¡æ…‹æ¶æ§‹

é‚„è¨˜å¾— Message é€™å¼µ UML åœ–ç‰‡å—ï¼Ÿåœ¨ UserMessage ä¸­å…¶å¯¦æ˜¯å¯ä»¥åŒ…å«å¤šåª’é«”æª”æ¡ˆçš„ï¼š

![Spring AI Message æ¶æ§‹](https://ithelp.ithome.com.tw/upload/images/20240806/2016129049tSDbXBcM.jpg)

**é‡è¦èªªæ˜**ï¼šé›–ç„¶ UserMessage é¡åˆ¥æ”¯æ´ç›´æ¥å‚³å…¥ Media ç‰©ä»¶ï¼Œä½†åœ¨å¯¦éš›é–‹ç™¼ä¸­ï¼Œ**å»ºè­°ä½¿ç”¨ ChatClient çš„ fluent API**ï¼Œå› ç‚ºå®ƒæä¾›äº†æ›´å¥½çš„é–‹ç™¼é«”é©—å’ŒéŒ¯èª¤è™•ç†ã€‚

```java
// Spring AI çš„å¤šæ¨¡æ…‹å¯¦ç¾æ–¹å¼ - ä½¿ç”¨ ChatClient fluent API
String response = chatClient.prompt()
    .user(u -> u.text("è«‹åˆ†æé€™å¼µåœ–ç‰‡çš„å…§å®¹")  // æ–‡å­—éƒ¨åˆ†
        .media(MimeTypeUtils.IMAGE_JPEG, imageResource))   // åœ–ç‰‡
    .call()
    .content();

// ä¹Ÿå¯ä»¥æ·»åŠ å¤šå€‹åª’é«”æª”æ¡ˆ
String response = chatClient.prompt()
    .user(u -> u.text("è«‹åˆ†æé€™äº›æª”æ¡ˆ")
        .media(MimeTypeUtils.IMAGE_JPEG, imageResource)
        .media(MimeTypeUtils.parseMediaType("audio/mp3"), audioResource))
    .call()
    .content();

// ğŸ’¡ æœ€ä½³å¯¦è¸ï¼šå»ºè­°å°‡ Resource å’Œ MimeType åˆ†é–‹å®£å‘Šï¼Œä¾¿æ–¼éŒ¯èª¤è™•ç†
Resource imageResource = new ClassPathResource("image.jpg");
MimeType mimeType = MimeTypeUtils.IMAGE_JPEG;

String response = chatClient.prompt()
    .user(u -> u.text("åˆ†æé€™å¼µåœ–ç‰‡")
        .media(mimeType, imageResource))
    .call()
    .content();
```

### å¤šæ¨¡æ…‹çš„æ ¸å¿ƒåƒ¹å€¼

**1. æ›´è±å¯Œçš„äº’å‹•é«”é©—**
- ğŸ“¸ **è¦–è¦ºç†è§£**ï¼šåˆ†æåœ–ç‰‡å…§å®¹ã€è­˜åˆ¥ç‰©é«”ã€ç†è§£å ´æ™¯
- ğŸµ **è½è¦ºè™•ç†**ï¼šèªéŸ³è½‰æ–‡å­—ã€éŸ³æ¨‚åˆ†æã€è²éŸ³è­˜åˆ¥
- ğŸ¬ **å½±ç‰‡åˆ†æ**ï¼šå‹•ä½œè­˜åˆ¥ã€å ´æ™¯ç†è§£ã€å…§å®¹æ‘˜è¦
- ğŸ“„ **æ–‡ä»¶è™•ç†**ï¼šOCR æ–‡å­—è­˜åˆ¥ã€è¡¨æ ¼åˆ†æã€ç‰ˆé¢ç†è§£

**2. æ›´æº–ç¢ºçš„ç†è§£èƒ½åŠ›**
- ğŸ” **ä¸Šä¸‹æ–‡å¢å¼·**ï¼šçµåˆå¤šç¨®è³‡è¨Šæºæä¾›æ›´æº–ç¢ºçš„åˆ†æ
- ğŸ§  **èªç¾©ç†è§£**ï¼šé€éè¦–è¦ºå’Œæ–‡å­—çš„çµåˆæå‡ç†è§£æ·±åº¦
- ğŸ¯ **ç²¾ç¢ºå›æ‡‰**ï¼šåŸºæ–¼å¤šæ¨¡æ…‹è³‡è¨Šæä¾›æ›´ç²¾ç¢ºçš„ç­”æ¡ˆ

**3. æ›´å»£æ³›çš„æ‡‰ç”¨å ´æ™¯**
- ğŸ¥ **é†«ç™‚è¨ºæ–·**ï¼šçµåˆå½±åƒå’Œç—…æ­·è³‡æ–™é€²è¡Œè¼”åŠ©è¨ºæ–·
- ğŸ›’ **é›»å•†æ‡‰ç”¨**ï¼šå•†å“åœ–ç‰‡åˆ†æå’Œæ¨è–¦
- ğŸ“š **æ•™è‚²åŸ¹è¨“**ï¼šå¤šåª’é«”æ•™æçš„æ™ºèƒ½åˆ†æå’Œå•ç­”
- ğŸ­ **å·¥æ¥­æª¢æ¸¬**ï¼šè¨­å‚™åœ–ç‰‡åˆ†æå’Œæ•…éšœè¨ºæ–·

---

## 5.2.2 æ”¯æ´å¤šæ¨¡æ…‹çš„ AI æ¨¡å‹

### ä¸»æµæ¨¡å‹èƒ½åŠ›å°æ¯”

ç›®å‰æœ‰æ”¯æ´å¤šæ¨¡æ…‹çš„æ¨¡å‹å¦‚ä¸‹ï¼Œå…¶ä»–æ¨¡å‹é€å‡ºå¤šåª’é«”æª”æ¡ˆæ™‚å¯æ˜¯æœƒå‡ºç¾éŒ¯èª¤çš„ï¼š

| æ¨¡å‹æä¾›å•† | æ¨¡å‹åç¨± | åœ–åƒ | éŸ³é » | è¦–é » | æ–‡ä»¶ | æˆæœ¬æ•ˆç›Š | æ¨è–¦å ´æ™¯ |
|-----------|---------|------|------|------|------|----------|----------|
| **OpenAI** | GPT-4o | âœ… | âœ… | âœ… | âœ… | é«˜ | å…¨æ–¹ä½å¤šæ¨¡æ…‹æ‡‰ç”¨ |
| **OpenAI** | GPT-4o mini | âœ… | âŒ | âŒ | âœ… | æ¥µé«˜ | åœ–ç‰‡åˆ†æã€æ–‡ä»¶è™•ç† |
| **OpenAI** | GPT-4 Vision | âœ… | âŒ | âŒ | âœ… | ä¸­ | åœ–ç‰‡åˆ†æå°ˆç”¨ |
| **Anthropic** | Claude 3.5 Sonnet | âœ… | âŒ | âŒ | âœ… | é«˜ | åœ–ç‰‡+æ–‡å­—åˆ†æ |
| **Anthropic** | Claude 3 Opus | âœ… | âŒ | âŒ | âœ… | ä¸­ | è¤‡é›œåœ–ç‰‡ç†è§£ |
| **Google** | Gemini 1.5 Pro | âœ… | âœ… | âœ… | âœ… | ä¸­ | å¤šåª’é«”å…§å®¹åˆ†æ |
| **Google** | Gemini Pro Vision | âœ… | âŒ | âŒ | âœ… | é«˜ | åœ–ç‰‡è­˜åˆ¥ |
| **Ollama** | LlaVa | âœ… | âŒ | âŒ | âŒ | æ¥µé«˜(æœ¬åœ°) | æœ¬åœ°åœ–ç‰‡åˆ†æ |
| **Ollama** | Bakllava | âœ… | âŒ | âŒ | âŒ | æ¥µé«˜(æœ¬åœ°) | æœ¬åœ°å¤šæ¨¡æ…‹ |

### è¼¸å…¥è¼¸å‡ºæ ¼å¼æ”¯æ´è¡¨

| Input | Output | Examples | é©ç”¨å ´æ™¯ |
|-------|--------|----------|----------|
| **Language/Code/Images** | Language/Code | GPT-4o, Gemini 1.5 Pro | å¤šæ¨¡æ…‹å•ç­”ã€ç¨‹å¼ç¢¼åˆ†æ |
| **Language/Code** | Language/Code | GPT-3.5, Claude 3 Haiku | ç´”æ–‡å­—å°è©± |
| **Language** | Image | DALL-E 3, Midjourney | æ–‡å­—ç”Ÿæˆåœ–ç‰‡ |
| **Language/Image** | Image | Stable Diffusion | åœ–ç‰‡ç·¨è¼¯ã€é¢¨æ ¼è½‰æ› |
| **Language** | Audio | OpenAI TTS, ElevenLabs | æ–‡å­—è½‰èªéŸ³ |
| **Audio** | Language | OpenAI Whisper | èªéŸ³è½‰æ–‡å­— |
| **Text** | Numbers | Embedding Models | å‘é‡åŒ–ã€ç›¸ä¼¼åº¦è¨ˆç®— |

### æ¨¡å‹é¸æ“‡å»ºè­°

```java
@Configuration
public class MultimodalModelConfig {
    
    @Value("${spring.ai.openai.api-key}")
    private String openaiApiKey;
    
    /**
     * æ ¹æ“šä½¿ç”¨å ´æ™¯é¸æ“‡åˆé©çš„æ¨¡å‹
     */
    @Bean
    @Primary
    public ChatModel primaryMultimodalModel() {
        // GPT-4o miniï¼šæ€§åƒ¹æ¯”æœ€é«˜çš„åœ–ç‰‡åˆ†ææ¨¡å‹
        return OpenAiChatModel.builder()
            .apiKey(openaiApiKey)
            .modelName("gpt-4o-mini")
            .temperature(0.3)  // è¼ƒä½æº«åº¦ç¢ºä¿åˆ†ææº–ç¢ºæ€§
            .maxTokens(1500)
            .build();
    }
    
    /**
     * é«˜ç²¾åº¦åœ–ç‰‡åˆ†ææ¨¡å‹
     */
    @Bean("highAccuracyModel")
    public ChatModel highAccuracyModel() {
        // GPT-4oï¼šæœ€å¼·å¤šæ¨¡æ…‹èƒ½åŠ›
        return OpenAiChatModel.builder()
            .apiKey(openaiApiKey)
            .modelName("gpt-4o")
            .temperature(0.2)
            .maxTokens(2000)
            .build();
    }
    
    /**
     * æœ¬åœ°å¤šæ¨¡æ…‹æ¨¡å‹ï¼ˆç¯€çœæˆæœ¬ï¼‰
     */
    @Bean("localModel")
    @ConditionalOnProperty(name = "app.ai.local.enabled", havingValue = "true")
    public ChatModel localMultimodalModel() {
        // Ollama LlaVaï¼šæœ¬åœ°å…è²»æ–¹æ¡ˆ
        return OllamaChatModel.builder()
            .baseUrl("http://localhost:11434")
            .model("llava")
            .build();
    }
}
```

---

## 5.2.3 åœ–ç‰‡åˆ†æåŠŸèƒ½å¯¦ç¾

### åŸºç¤åœ–ç‰‡ä¸Šå‚³å’Œåˆ†æ

```java
package com.example.controller;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.core.io.Resource;
import org.springframework.http.MediaType;
import org.springframework.util.MimeType;
import org.springframework.util.MimeTypeUtils;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

import java.io.IOException;

@RestController
@RequestMapping("/api/multimodal")
@RequiredArgsConstructor
@Slf4j
public class MultimodalController {
    
    private final ChatClient chatClient;
    
    /**
     * åŸºç¤åœ–ç‰‡åˆ†æ
     * @param file ä¸Šå‚³çš„åœ–ç‰‡æª”æ¡ˆ
     * @param message åˆ†æè¦æ±‚
     * @return AI åˆ†æçµæœ
     */
    @PostMapping(value = "/image-analysis", consumes = MediaType.MULTIPART_FORM_DATA_VALUE)
    public String analyzeImage(
            @RequestParam("file") MultipartFile file,
            @RequestParam("message") String message) {
        
        try {
            // é©—è­‰æª”æ¡ˆé¡å‹
            if (!isValidImageFile(file)) {
                return "âŒ ä¸æ”¯æ´çš„åœ–ç‰‡æ ¼å¼ï¼Œè«‹ä¸Šå‚³ JPGã€PNGã€GIF æˆ– WebP æ ¼å¼çš„åœ–ç‰‡";
            }
            
            // é©—è­‰æª”æ¡ˆå¤§å°ï¼ˆé™åˆ¶ 10MBï¼‰
            if (file.getSize() > 10 * 1024 * 1024) {
                return "âŒ åœ–ç‰‡æª”æ¡ˆéå¤§ï¼Œè«‹ä¸Šå‚³å°æ–¼ 10MB çš„åœ–ç‰‡";
            }
            
            log.info("é–‹å§‹åˆ†æåœ–ç‰‡ï¼š{}ï¼Œå¤§å°ï¼š{} bytes", file.getOriginalFilename(), file.getSize());
            
            // å‰µå»º Spring Resource
            Resource imageResource = file.getResource();
            MimeType mimeType = MimeTypeUtils.parseMimeType(file.getContentType());
            
            // ä½¿ç”¨ ChatClient é€²è¡Œåœ–ç‰‡åˆ†æ
            String response = chatClient.prompt()
                    .user(u -> u.text(message)
                            .media(mimeType, imageResource))
                    .call()
                    .content();
            
            log.info("åœ–ç‰‡åˆ†æå®Œæˆ");
            return response;
            
        } catch (IOException e) {
            log.error("åœ–ç‰‡è™•ç†å¤±æ•—", e);
            return "âŒ åœ–ç‰‡è™•ç†å¤±æ•—ï¼š" + e.getMessage();
        } catch (Exception e) {
            log.error("AI åˆ†æå¤±æ•—", e);
            return "âŒ AI åˆ†æå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ï¼š" + e.getMessage();
        }
    }
    
    /**
     * é©—è­‰åœ–ç‰‡æª”æ¡ˆæ ¼å¼
     */
    private boolean isValidImageFile(MultipartFile file) {
        String contentType = file.getContentType();
        return contentType != null && (
            contentType.equals("image/jpeg") ||
            contentType.equals("image/png") ||
            contentType.equals("image/gif") ||
            contentType.equals("image/webp")
        );
    }
}
```

### é€²éšåœ–ç‰‡åˆ†æåŠŸèƒ½

```java
@RestController
@RequestMapping("/api/advanced-multimodal")
@RequiredArgsConstructor
public class AdvancedMultimodalController {
    
    private final ChatClient chatClient;
    
    /**
     * çµæ§‹åŒ–åœ–ç‰‡åˆ†æ
     * @param file åœ–ç‰‡æª”æ¡ˆ
     * @param analysisType åˆ†æé¡å‹
     * @return çµæ§‹åŒ–åˆ†æçµæœ
     */
    @PostMapping("/structured-analysis")
    public ImageAnalysisResult structuredImageAnalysis(
            @RequestParam("file") MultipartFile file,
            @RequestParam("type") AnalysisType analysisType) {
        
        try {
            String prompt = buildAnalysisPrompt(analysisType);
            
            Resource fileResource = file.getResource();
            MimeType mimeType = MimeTypeUtils.parseMimeType(file.getContentType());
            
            String response = chatClient.prompt()
                    .user(u -> u.text(prompt)
                            .media(mimeType, fileResource))
                    .call()
                    .content();
            
            return parseAnalysisResult(response, analysisType);
            
        } catch (Exception e) {
            log.error("çµæ§‹åŒ–åˆ†æå¤±æ•—", e);
            return ImageAnalysisResult.error("åˆ†æå¤±æ•—ï¼š" + e.getMessage());
        }
    }
    
    /**
     * æ‰¹æ¬¡åœ–ç‰‡åˆ†æ
     * @param files å¤šå€‹åœ–ç‰‡æª”æ¡ˆ
     * @param message åˆ†æè¦æ±‚
     * @return æ‰¹æ¬¡åˆ†æçµæœ
     */
    @PostMapping("/batch-analysis")
    public List<BatchAnalysisResult> batchImageAnalysis(
            @RequestParam("files") MultipartFile[] files,
            @RequestParam("message") String message) {
        
        return Arrays.stream(files)
                .parallel()
                .map(file -> processSingleImage(file, message))
                .collect(Collectors.toList());
    }
    
    /**
     * åœ–ç‰‡æ¯”è¼ƒåˆ†æ
     * @param file1 ç¬¬ä¸€å¼µåœ–ç‰‡
     * @param file2 ç¬¬äºŒå¼µåœ–ç‰‡
     * @param comparisonType æ¯”è¼ƒé¡å‹
     * @return æ¯”è¼ƒçµæœ
     */
    @PostMapping("/compare-images")
    public String compareImages(
            @RequestParam("file1") MultipartFile file1,
            @RequestParam("file2") MultipartFile file2,
            @RequestParam("type") ComparisonType comparisonType) {
        
        try {
            String prompt = buildComparisonPrompt(comparisonType);
            
            Resource resource1 = file1.getResource();
            Resource resource2 = file2.getResource();
            MimeType mimeType1 = MimeTypeUtils.parseMimeType(file1.getContentType());
            MimeType mimeType2 = MimeTypeUtils.parseMimeType(file2.getContentType());
            
            return chatClient.prompt()
                    .user(u -> u.text(prompt)
                            .media(mimeType1, resource1)
                            .media(mimeType2, resource2))
                    .call()
                    .content();
            
        } catch (Exception e) {
            log.error("åœ–ç‰‡æ¯”è¼ƒå¤±æ•—", e);
            return "âŒ åœ–ç‰‡æ¯”è¼ƒå¤±æ•—ï¼š" + e.getMessage();
        }
    }
    
    private String buildAnalysisPrompt(AnalysisType type) {
        return switch (type) {
            case OBJECT_DETECTION -> """
                è«‹åˆ†æé€™å¼µåœ–ç‰‡ä¸­çš„æ‰€æœ‰ç‰©é«”ï¼Œä¸¦æŒ‰ç…§ä»¥ä¸‹æ ¼å¼å›ç­”ï¼š
                
                ## ğŸ” ç‰©é«”è­˜åˆ¥
                - ç‰©é«”åç¨±ï¼š[ä½ç½®æè¿°]
                
                ## ğŸ“Š çµ±è¨ˆè³‡è¨Š
                - ç¸½ç‰©é«”æ•¸é‡ï¼š
                - ä¸»è¦é¡åˆ¥ï¼š
                
                ## ğŸ’¡ å ´æ™¯æè¿°
                [æ•´é«”å ´æ™¯çš„æè¿°]
                """;
                
            case TEXT_EXTRACTION -> """
                è«‹æå–é€™å¼µåœ–ç‰‡ä¸­çš„æ‰€æœ‰æ–‡å­—å…§å®¹ï¼Œä¸¦æŒ‰ç…§ä»¥ä¸‹æ ¼å¼æ•´ç†ï¼š
                
                ## ğŸ“ æ–‡å­—å…§å®¹
                [æŒ‰ç…§åœ¨åœ–ç‰‡ä¸­çš„ä½ç½®é †åºåˆ—å‡ºæ‰€æœ‰æ–‡å­—]
                
                ## ğŸ·ï¸ æ–‡å­—åˆ†é¡
                - æ¨™é¡Œï¼š
                - æ­£æ–‡ï¼š
                - å…¶ä»–ï¼š
                
                ## ğŸ“‹ çµæ§‹åŒ–è³‡è¨Š
                [å¦‚æœæœ‰è¡¨æ ¼ã€æ¸…å–®ç­‰çµæ§‹åŒ–å…§å®¹ï¼Œè«‹æ•´ç†å‡ºä¾†]
                """;
                
            case SCENE_ANALYSIS -> """
                è«‹è©³ç´°åˆ†æé€™å¼µåœ–ç‰‡çš„å ´æ™¯ï¼ŒåŒ…å«ï¼š
                
                ## ğŸŒ å ´æ™¯é¡å‹
                [å®¤å…§/å®¤å¤–ï¼Œå…·é«”å ´æ‰€]
                
                ## ğŸ¨ è¦–è¦ºå…ƒç´ 
                - è‰²å½©ï¼š
                - å…‰ç·šï¼š
                - æ§‹åœ–ï¼š
                
                ## ğŸ‘¥ äººç‰©æ´»å‹•
                [å¦‚æœæœ‰äººç‰©ï¼Œæè¿°ä»–å€‘åœ¨åšä»€éº¼]
                
                ## ğŸ¯ æ•´é«”æ°›åœ
                [å ´æ™¯çµ¦äººçš„æ„Ÿå—å’Œæ°›åœ]
                """;
                
            case QUALITY_ASSESSMENT -> """
                è«‹è©•ä¼°é€™å¼µåœ–ç‰‡çš„å“è³ªï¼ŒåŒ…å«ï¼š
                
                ## ğŸ“¸ æŠ€è¡“å“è³ª
                - æ¸…æ™°åº¦ï¼š[1-10åˆ†]
                - æ›å…‰ï¼š[éæ›/æ­£å¸¸/æ¬ æ›]
                - è‰²å½©ï¼š[1-10åˆ†]
                
                ## ğŸ¨ è—è¡“å“è³ª
                - æ§‹åœ–ï¼š[1-10åˆ†]
                - ç¾æ„Ÿï¼š[1-10åˆ†]
                
                ## ğŸ’¡ æ”¹é€²å»ºè­°
                [å¦‚ä½•æå‡åœ–ç‰‡å“è³ªçš„å…·é«”å»ºè­°]
                """;
        };
    }
    
    private String buildComparisonPrompt(ComparisonType type) {
        return switch (type) {
            case SIMILARITY -> """
                è«‹æ¯”è¼ƒé€™å…©å¼µåœ–ç‰‡çš„ç›¸ä¼¼æ€§ï¼š
                
                ## ğŸ” ç›¸ä¼¼é»
                [åˆ—å‡ºå…©å¼µåœ–ç‰‡çš„ç›¸ä¼¼ä¹‹è™•]
                
                ## ğŸ†š å·®ç•°é»
                [åˆ—å‡ºå…©å¼µåœ–ç‰‡çš„ä¸åŒä¹‹è™•]
                
                ## ğŸ“Š ç›¸ä¼¼åº¦è©•åˆ†
                æ•´é«”ç›¸ä¼¼åº¦ï¼š[0-100%]
                
                ## ğŸ’¡ ç¸½çµ
                [ç°¡è¦ç¸½çµæ¯”è¼ƒçµæœ]
                """;
                
            case QUALITY -> """
                è«‹æ¯”è¼ƒé€™å…©å¼µåœ–ç‰‡çš„å“è³ªï¼š
                
                ## ğŸ“¸ æŠ€è¡“å“è³ªæ¯”è¼ƒ
                - æ¸…æ™°åº¦ï¼šåœ–ç‰‡1 vs åœ–ç‰‡2
                - è‰²å½©ï¼šåœ–ç‰‡1 vs åœ–ç‰‡2
                - æ›å…‰ï¼šåœ–ç‰‡1 vs åœ–ç‰‡2
                
                ## ğŸ† æ¨è–¦çµæœ
                æ¨è–¦åœ–ç‰‡ï¼š[1/2]
                æ¨è–¦ç†ç”±ï¼š[å…·é«”èªªæ˜]
                """;
                
            case CONTENT -> """
                è«‹æ¯”è¼ƒé€™å…©å¼µåœ–ç‰‡çš„å…§å®¹ï¼š
                
                ## ğŸ“‹ å…§å®¹å°æ¯”
                - ä¸»é¡Œï¼š
                - ç‰©é«”ï¼š
                - å ´æ™¯ï¼š
                
                ## ğŸ¯ ç”¨é€”å»ºè­°
                - åœ–ç‰‡1é©åˆï¼š
                - åœ–ç‰‡2é©åˆï¼š
                """;
        };
    }
    
    public enum AnalysisType {
        OBJECT_DETECTION, TEXT_EXTRACTION, SCENE_ANALYSIS, QUALITY_ASSESSMENT
    }
    
    public enum ComparisonType {
        SIMILARITY, QUALITY, CONTENT
    }
}
```

---

## 5.2.4 å¤šåª’é«”æª”æ¡ˆè™•ç†

### éŸ³è¨Šæª”æ¡ˆåˆ†æ

```java
@RestController
@RequestMapping("/api/audio")
@RequiredArgsConstructor
public class AudioAnalysisController {
    
    private final ChatClient chatClient;
    
    /**
     * éŸ³è¨Šå…§å®¹åˆ†æï¼ˆéœ€è¦æ”¯æ´éŸ³è¨Šçš„æ¨¡å‹å¦‚ GPT-4oï¼‰
     * @param file éŸ³è¨Šæª”æ¡ˆ
     * @param analysisType åˆ†æé¡å‹
     * @return åˆ†æçµæœ
     */
    @PostMapping("/analyze")
    public String analyzeAudio(
            @RequestParam("file") MultipartFile file,
            @RequestParam("type") AudioAnalysisType analysisType) {
        
        try {
            // é©—è­‰éŸ³è¨Šæª”æ¡ˆæ ¼å¼
            if (!isValidAudioFile(file)) {
                return "âŒ ä¸æ”¯æ´çš„éŸ³è¨Šæ ¼å¼ï¼Œè«‹ä¸Šå‚³ MP3ã€WAVã€M4A æˆ– OGG æ ¼å¼";
            }
            
            // æª”æ¡ˆå¤§å°é™åˆ¶ï¼ˆ25MBï¼‰
            if (file.getSize() > 25 * 1024 * 1024) {
                return "âŒ éŸ³è¨Šæª”æ¡ˆéå¤§ï¼Œè«‹ä¸Šå‚³å°æ–¼ 25MB çš„æª”æ¡ˆ";
            }
            
            String prompt = buildAudioAnalysisPrompt(analysisType);
            
            Resource audioResource = file.getResource();
            MimeType mimeType = MimeTypeUtils.parseMimeType(file.getContentType());
            
            return chatClient.prompt()
                    .user(u -> u.text(prompt)
                            .media(mimeType, audioResource))
                    .call()
                    .content();
            
        } catch (Exception e) {
            log.error("éŸ³è¨Šåˆ†æå¤±æ•—", e);
            return "âŒ éŸ³è¨Šåˆ†æå¤±æ•—ï¼š" + e.getMessage();
        }
    }
    
    private boolean isValidAudioFile(MultipartFile file) {
        String contentType = file.getContentType();
        return contentType != null && (
            contentType.equals("audio/mpeg") ||     // MP3
            contentType.equals("audio/wav") ||      // WAV
            contentType.equals("audio/mp4") ||      // M4A
            contentType.equals("audio/ogg")        // OGG
        );
    }
    
    private String buildAudioAnalysisPrompt(AudioAnalysisType type) {
        return switch (type) {
            case TRANSCRIPTION -> """
                è«‹å°‡é€™å€‹éŸ³è¨Šæª”æ¡ˆè½‰æ›ç‚ºæ–‡å­—ï¼Œä¸¦æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¼¸å‡ºï¼š
                
                ## ğŸ“ è½‰éŒ„å…§å®¹
                [å®Œæ•´çš„èªéŸ³è½‰æ–‡å­—å…§å®¹]
                
                ## ğŸ¤ éŸ³è¨Šè³‡è¨Š
                - èªè¨€ï¼š
                - èªªè©±è€…æ•¸é‡ï¼š
                - éŸ³è¨Šå“è³ªï¼š
                
                ## â±ï¸ æ™‚é–“è³‡è¨Š
                - ç¸½æ™‚é•·ï¼š
                - èªé€Ÿï¼š
                """;
                
            case SENTIMENT -> """
                è«‹åˆ†æé€™å€‹éŸ³è¨Šçš„æƒ…æ„Ÿå’Œèªèª¿ï¼š
                
                ## ğŸ˜Š æƒ…æ„Ÿåˆ†æ
                - æ•´é«”æƒ…æ„Ÿï¼š[æ­£é¢/ä¸­æ€§/è² é¢]
                - æƒ…æ„Ÿå¼·åº¦ï¼š[1-10]
                
                ## ğŸµ èªèª¿ç‰¹å¾µ
                - èªé€Ÿï¼š[å¿«/ä¸­/æ…¢]
                - éŸ³èª¿ï¼š[é«˜/ä¸­/ä½]
                - èªæ°£ï¼š[æè¿°å…·é«”èªæ°£]
                
                ## ğŸ’¡ å…§å®¹æ‘˜è¦
                [éŸ³è¨Šå…§å®¹çš„ç°¡è¦æ‘˜è¦]
                """;
                
            case MUSIC_ANALYSIS -> """
                è«‹åˆ†æé€™å€‹éŸ³æ¨‚æª”æ¡ˆï¼š
                
                ## ğŸµ éŸ³æ¨‚ç‰¹å¾µ
                - é¢¨æ ¼/é¡å‹ï¼š
                - ç¯€æ‹ï¼š
                - èª¿æ€§ï¼š
                
                ## ğŸ¼ æ¨‚å™¨è­˜åˆ¥
                [è­˜åˆ¥å‡ºçš„æ¨‚å™¨]
                
                ## ğŸ­ æƒ…ç·’æ°›åœ
                [éŸ³æ¨‚çµ¦äººçš„æ„Ÿå—]
                
                ## ğŸ¯ é©ç”¨å ´æ™¯
                [é€™é¦–éŸ³æ¨‚é©åˆçš„ä½¿ç”¨å ´æ™¯]
                """;
        };
    }
    
    public enum AudioAnalysisType {
        TRANSCRIPTION, SENTIMENT, MUSIC_ANALYSIS
    }
}
```

### å½±ç‰‡æª”æ¡ˆåˆ†æ

```java
@RestController
@RequestMapping("/api/video")
@RequiredArgsConstructor
public class VideoAnalysisController {
    
    private final ChatClient chatClient;
    
    /**
     * å½±ç‰‡å…§å®¹åˆ†æï¼ˆéœ€è¦æ”¯æ´å½±ç‰‡çš„æ¨¡å‹å¦‚ GPT-4oã€Gemini 1.5 Proï¼‰
     * @param file å½±ç‰‡æª”æ¡ˆ
     * @param analysisType åˆ†æé¡å‹
     * @return åˆ†æçµæœ
     */
    @PostMapping("/analyze")
    public String analyzeVideo(
            @RequestParam("file") MultipartFile file,
            @RequestParam("type") VideoAnalysisType analysisType) {
        
        try {
            // é©—è­‰å½±ç‰‡æª”æ¡ˆæ ¼å¼
            if (!isValidVideoFile(file)) {
                return "âŒ ä¸æ”¯æ´çš„å½±ç‰‡æ ¼å¼ï¼Œè«‹ä¸Šå‚³ MP4ã€AVIã€MOV æˆ– WebM æ ¼å¼";
            }
            
            // æª”æ¡ˆå¤§å°é™åˆ¶ï¼ˆ100MBï¼‰
            if (file.getSize() > 100 * 1024 * 1024) {
                return "âŒ å½±ç‰‡æª”æ¡ˆéå¤§ï¼Œè«‹ä¸Šå‚³å°æ–¼ 100MB çš„æª”æ¡ˆ";
            }
            
            String prompt = buildVideoAnalysisPrompt(analysisType);
            
            Resource videoResource = file.getResource();
            MimeType mimeType = MimeTypeUtils.parseMimeType(file.getContentType());
            
            return chatClient.prompt()
                    .user(u -> u.text(prompt)
                            .media(mimeType, videoResource))
                    .call()
                    .content();
            
        } catch (Exception e) {
            log.error("å½±ç‰‡åˆ†æå¤±æ•—", e);
            return "âŒ å½±ç‰‡åˆ†æå¤±æ•—ï¼š" + e.getMessage();
        }
    }
    
    private boolean isValidVideoFile(MultipartFile file) {
        String contentType = file.getContentType();
        return contentType != null && (
            contentType.equals("video/mp4") ||      // MP4
            contentType.equals("video/avi") ||      // AVI
            contentType.equals("video/quicktime") || // MOV
            contentType.equals("video/webm")       // WebM
        );
    }
    
    private String buildVideoAnalysisPrompt(VideoAnalysisType type) {
        return switch (type) {
            case CONTENT_SUMMARY -> """
                è«‹åˆ†æé€™å€‹å½±ç‰‡çš„å…§å®¹ä¸¦æä¾›æ‘˜è¦ï¼š
                
                ## ğŸ“¹ å½±ç‰‡æ¦‚è¿°
                - ä¸»é¡Œï¼š
                - é¡å‹ï¼š[æ•™å­¸/å¨›æ¨‚/æ–°è/å…¶ä»–]
                - æ™‚é•·ï¼š
                
                ## ğŸ¬ å…§å®¹æ‘˜è¦
                [å½±ç‰‡çš„ä¸»è¦å…§å®¹æ‘˜è¦]
                
                ## ğŸ‘¥ äººç‰©æ´»å‹•
                [å½±ç‰‡ä¸­çš„äººç‰©å’Œä»–å€‘çš„æ´»å‹•]
                
                ## ğŸ¯ é—œéµæ™‚åˆ»
                [é‡è¦çš„å ´æ™¯æˆ–æ™‚é–“é»]
                """;
                
            case SCENE_DETECTION -> """
                è«‹åˆ†æé€™å€‹å½±ç‰‡çš„å ´æ™¯è®ŠåŒ–ï¼š
                
                ## ğŸ¬ å ´æ™¯åˆ†æ
                [æŒ‰æ™‚é–“é †åºæè¿°ä¸»è¦å ´æ™¯]
                
                ## ğŸ”„ å ´æ™¯è½‰æ›
                [å ´æ™¯ä¹‹é–“çš„è½‰æ›æ–¹å¼]
                
                ## ğŸ“ æ‹æ”åœ°é»
                [è­˜åˆ¥å‡ºçš„æ‹æ”åœ°é»æˆ–ç’°å¢ƒ]
                
                ## ğŸ¨ è¦–è¦ºé¢¨æ ¼
                [å½±ç‰‡çš„è¦–è¦ºé¢¨æ ¼å’Œç‰¹è‰²]
                """;
                
            case ACTION_RECOGNITION -> """
                è«‹è­˜åˆ¥å½±ç‰‡ä¸­çš„å‹•ä½œå’Œæ´»å‹•ï¼š
                
                ## ğŸƒ å‹•ä½œè­˜åˆ¥
                [è­˜åˆ¥å‡ºçš„å…·é«”å‹•ä½œ]
                
                ## ğŸ‘¥ äº’å‹•åˆ†æ
                [äººç‰©ä¹‹é–“çš„äº’å‹•]
                
                ## âš½ é‹å‹•/æ´»å‹•
                [å¦‚æœæ˜¯é‹å‹•å½±ç‰‡ï¼Œåˆ†æé‹å‹•é¡å‹å’ŒæŠ€å·§]
                
                ## ğŸ“Š æ´»å‹•çµ±è¨ˆ
                [å‹•ä½œçš„é »ç‡å’ŒæŒçºŒæ™‚é–“]
                """;
        };
    }
    
    public enum VideoAnalysisType {
        CONTENT_SUMMARY, SCENE_DETECTION, ACTION_RECOGNITION
    }
}
```

---

## 5.2.5 ä¼æ¥­ç´šå¤šæ¨¡æ…‹æ‡‰ç”¨

### æ–‡ä»¶æ™ºèƒ½åˆ†æç³»çµ±

```java
@Service
@RequiredArgsConstructor
public class DocumentAnalysisService {
    
    private final ChatClient chatClient;
    
    /**
     * æ™ºèƒ½æ–‡ä»¶åˆ†æ
     * @param file æ–‡ä»¶æª”æ¡ˆï¼ˆPDFã€åœ–ç‰‡ç­‰ï¼‰
     * @param analysisRequest åˆ†æéœ€æ±‚
     * @return åˆ†æçµæœ
     */
    public DocumentAnalysisResult analyzeDocument(
            MultipartFile file, 
            DocumentAnalysisRequest analysisRequest) {
        
        try {
            String prompt = buildDocumentAnalysisPrompt(analysisRequest);
            
            Resource fileResource = file.getResource();
            MimeType mimeType = MimeTypeUtils.parseMimeType(file.getContentType());
            
            String response = chatClient.prompt()
                    .user(u -> u.text(prompt)
                            .media(mimeType, fileResource))
                    .call()
                    .content();
            
            return DocumentAnalysisResult.builder()
                    .fileName(file.getOriginalFilename())
                    .fileSize(file.getSize())
                    .analysisType(analysisRequest.getType())
                    .result(response)
                    .timestamp(LocalDateTime.now())
                    .build();
            
        } catch (Exception e) {
            log.error("æ–‡ä»¶åˆ†æå¤±æ•—ï¼š{}", file.getOriginalFilename(), e);
            return DocumentAnalysisResult.error(e.getMessage());
        }
    }
    
    /**
     * æ‰¹æ¬¡æ–‡ä»¶è™•ç†
     * @param files å¤šå€‹æ–‡ä»¶
     * @param analysisRequest åˆ†æéœ€æ±‚
     * @return æ‰¹æ¬¡è™•ç†çµæœ
     */
    public List<DocumentAnalysisResult> batchAnalyzeDocuments(
            List<MultipartFile> files,
            DocumentAnalysisRequest analysisRequest) {
        
        return files.parallelStream()
                .map(file -> analyzeDocument(file, analysisRequest))
                .collect(Collectors.toList());
    }
    
    private String buildDocumentAnalysisPrompt(DocumentAnalysisRequest request) {
        String basePrompt = switch (request.getType()) {
            case OCR_EXTRACTION -> """
                è«‹æå–é€™å€‹æ–‡ä»¶ä¸­çš„æ‰€æœ‰æ–‡å­—å…§å®¹ï¼Œä¸¦æŒ‰ç…§åŸå§‹æ ¼å¼æ•´ç†ï¼š
                
                ## ğŸ“„ æ–‡å­—å…§å®¹
                [ä¿æŒåŸå§‹æ ¼å¼çš„æ–‡å­—å…§å®¹]
                
                ## ğŸ“Š æ–‡ä»¶çµæ§‹
                - æ¨™é¡Œï¼š
                - æ®µè½æ•¸ï¼š
                - è¡¨æ ¼ï¼š[å¦‚æœæœ‰]
                - æ¸…å–®ï¼š[å¦‚æœæœ‰]
                
                ## ğŸ” é—œéµè³‡è¨Š
                [æå–å‡ºçš„é‡è¦è³‡è¨Šï¼Œå¦‚æ—¥æœŸã€é‡‘é¡ã€å§“åç­‰]
                """;
                
            case FORM_ANALYSIS -> """
                è«‹åˆ†æé€™å€‹è¡¨å–®æ–‡ä»¶ï¼Œæå–æ‰€æœ‰æ¬„ä½å’Œå€¼ï¼š
                
                ## ğŸ“‹ è¡¨å–®è³‡è¨Š
                - è¡¨å–®é¡å‹ï¼š
                - è¡¨å–®æ¨™é¡Œï¼š
                
                ## ğŸ“ æ¬„ä½å…§å®¹
                [ä»¥ã€Œæ¬„ä½åç¨±ï¼šå€¼ã€çš„æ ¼å¼åˆ—å‡ºæ‰€æœ‰æ¬„ä½]
                
                ## âœ… å®Œæ•´æ€§æª¢æŸ¥
                - å·²å¡«å¯«æ¬„ä½ï¼š
                - ç©ºç™½æ¬„ä½ï¼š
                - å¿…å¡«æ¬„ä½ç‹€æ…‹ï¼š
                """;
                
            case CONTRACT_REVIEW -> """
                è«‹åˆ†æé€™ä»½åˆç´„æ–‡ä»¶çš„é—œéµå…§å®¹ï¼š
                
                ## ğŸ“œ åˆç´„åŸºæœ¬è³‡è¨Š
                - åˆç´„é¡å‹ï¼š
                - ç•¶äº‹äººï¼š
                - ç°½ç½²æ—¥æœŸï¼š
                - æœ‰æ•ˆæœŸé™ï¼š
                
                ## ğŸ’° è²¡å‹™æ¢æ¬¾
                - é‡‘é¡ï¼š
                - ä»˜æ¬¾æ–¹å¼ï¼š
                - ä»˜æ¬¾æœŸé™ï¼š
                
                ## âš–ï¸ é‡è¦æ¢æ¬¾
                [åˆ—å‡ºé‡è¦çš„æ¬Šåˆ©ç¾©å‹™æ¢æ¬¾]
                
                ## âš ï¸ é¢¨éšªæé†’
                [è­˜åˆ¥å‡ºçš„æ½›åœ¨é¢¨éšªé»]
                """;
                
            case INVOICE_PROCESSING -> """
                è«‹è™•ç†é€™å¼µç™¼ç¥¨ï¼Œæå–æ‰€æœ‰ç›¸é—œè³‡è¨Šï¼š
                
                ## ğŸ§¾ ç™¼ç¥¨åŸºæœ¬è³‡è¨Š
                - ç™¼ç¥¨è™Ÿç¢¼ï¼š
                - é–‹ç«‹æ—¥æœŸï¼š
                - è³£æ–¹ï¼š
                - è²·æ–¹ï¼š
                
                ## ğŸ’µ é‡‘é¡æ˜ç´°
                - å°è¨ˆï¼š
                - ç¨…é¡ï¼š
                - ç¸½è¨ˆï¼š
                
                ## ğŸ“¦ å•†å“/æœå‹™æ˜ç´°
                [åˆ—å‡ºæ‰€æœ‰å•†å“æˆ–æœå‹™é …ç›®]
                
                ## âœ… é©—è­‰ç‹€æ…‹
                [æª¢æŸ¥ç™¼ç¥¨è³‡è¨Šçš„å®Œæ•´æ€§å’Œåˆç†æ€§]
                """;
        };
        
        // åŠ å…¥å®¢è£½åŒ–è¦æ±‚
        if (request.getCustomRequirements() != null && !request.getCustomRequirements().isEmpty()) {
            basePrompt += "\n\n## ğŸ¯ ç‰¹æ®Šè¦æ±‚\n" + request.getCustomRequirements();
        }
        
        return basePrompt;
    }
}

@Data
@Builder
public class DocumentAnalysisRequest {
    private DocumentType type;
    private String customRequirements;
    private boolean extractTables;
    private boolean detectSignatures;
    private String targetLanguage;
    
    public enum DocumentType {
        OCR_EXTRACTION, FORM_ANALYSIS, CONTRACT_REVIEW, INVOICE_PROCESSING
    }
}

@Data
@Builder
public class DocumentAnalysisResult {
    private String fileName;
    private Long fileSize;
    private DocumentAnalysisRequest.DocumentType analysisType;
    private String result;
    private LocalDateTime timestamp;
    private boolean success;
    private String errorMessage;
    
    public static DocumentAnalysisResult error(String errorMessage) {
        return DocumentAnalysisResult.builder()
                .success(false)
                .errorMessage(errorMessage)
                .timestamp(LocalDateTime.now())
                .build();
    }
}
```

---

## 5.2.6 æ•ˆèƒ½å„ªåŒ–èˆ‡æœ€ä½³å¯¦è¸

### æª”æ¡ˆè™•ç†å„ªåŒ–

```java
@Service
@RequiredArgsConstructor
public class OptimizedMultimodalService {
    
    private final ChatClient chatClient;
    private final RedisTemplate<String, Object> redisTemplate;
    
    /**
     * å¸¶å¿«å–çš„åœ–ç‰‡åˆ†æ
     */
    @Cacheable(value = "imageAnalysis", key = "#file.originalFilename + '_' + #message.hashCode()")
    public String analyzeImageWithCache(MultipartFile file, String message) {
        // ç”Ÿæˆæª”æ¡ˆé›œæ¹Šå€¼ä½œç‚ºå¿«å–éµ
        String fileHash = generateFileHash(file);
        String cacheKey = "image_analysis:" + fileHash + ":" + message.hashCode();
        
        // æª¢æŸ¥å¿«å–
        String cachedResult = (String) redisTemplate.opsForValue().get(cacheKey);
        if (cachedResult != null) {
            log.info("å¾å¿«å–è¿”å›åˆ†æçµæœï¼š{}", file.getOriginalFilename());
            return cachedResult;
        }
        
        // åŸ·è¡Œåˆ†æ
        String result = performImageAnalysis(file, message);
        
        // å„²å­˜åˆ°å¿«å–ï¼ˆ24å°æ™‚ï¼‰
        redisTemplate.opsForValue().set(cacheKey, result, Duration.ofHours(24));
        
        return result;
    }
    
    /**
     * éåŒæ­¥æ‰¹æ¬¡è™•ç†
     */
    @Async
    public CompletableFuture<List<String>> batchAnalyzeAsync(
            List<MultipartFile> files, 
            String message) {
        
        List<CompletableFuture<String>> futures = files.stream()
                .map(file -> CompletableFuture.supplyAsync(() -> 
                    analyzeImageWithCache(file, message)))
                .collect(Collectors.toList());
        
        return CompletableFuture.allOf(futures.toArray(new CompletableFuture[0]))
                .thenApply(v -> futures.stream()
                        .map(CompletableFuture::join)
                        .collect(Collectors.toList()));
    }
    
    /**
     * åœ–ç‰‡å£“ç¸®å’Œå„ªåŒ–
     */
    public MultipartFile optimizeImage(MultipartFile originalFile) {
        try {
            BufferedImage originalImage = ImageIO.read(originalFile.getInputStream());
            
            // å¦‚æœåœ–ç‰‡å¤ªå¤§ï¼Œé€²è¡Œå£“ç¸®
            if (originalFile.getSize() > 5 * 1024 * 1024) { // 5MB
                BufferedImage resizedImage = resizeImage(originalImage, 1920, 1080);
                return convertToMultipartFile(resizedImage, originalFile.getOriginalFilename());
            }
            
            return originalFile;
            
        } catch (IOException e) {
            log.warn("åœ–ç‰‡å„ªåŒ–å¤±æ•—ï¼Œä½¿ç”¨åŸå§‹æª”æ¡ˆï¼š{}", e.getMessage());
            return originalFile;
        }
    }
    
    private BufferedImage resizeImage(BufferedImage original, int maxWidth, int maxHeight) {
        int originalWidth = original.getWidth();
        int originalHeight = original.getHeight();
        
        // è¨ˆç®—ç¸®æ”¾æ¯”ä¾‹
        double scaleX = (double) maxWidth / originalWidth;
        double scaleY = (double) maxHeight / originalHeight;
        double scale = Math.min(scaleX, scaleY);
        
        if (scale >= 1.0) {
            return original; // ä¸éœ€è¦ç¸®æ”¾
        }
        
        int newWidth = (int) (originalWidth * scale);
        int newHeight = (int) (originalHeight * scale);
        
        BufferedImage resized = new BufferedImage(newWidth, newHeight, BufferedImage.TYPE_INT_RGB);
        Graphics2D g2d = resized.createGraphics();
        g2d.setRenderingHint(RenderingHints.KEY_INTERPOLATION, RenderingHints.VALUE_INTERPOLATION_BILINEAR);
        g2d.drawImage(original, 0, 0, newWidth, newHeight, null);
        g2d.dispose();
        
        return resized;
    }
    
    private String generateFileHash(MultipartFile file) {
        try {
            MessageDigest md = MessageDigest.getInstance("MD5");
            byte[] hash = md.digest(file.getBytes());
            return DatatypeConverter.printHexBinary(hash).toLowerCase();
        } catch (Exception e) {
            return String.valueOf(file.getOriginalFilename().hashCode());
        }
    }
}
```

### éŒ¯èª¤è™•ç†å’Œç›£æ§

```java
@Component
@Slf4j
public class MultimodalErrorHandler {
    
    private final MeterRegistry meterRegistry;
    private final Counter successCounter;
    private final Counter errorCounter;
    private final Timer processingTimer;
    
    public MultimodalErrorHandler(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        this.successCounter = Counter.builder("multimodal.analysis.success")
                .description("Successful multimodal analysis count")
                .register(meterRegistry);
        this.errorCounter = Counter.builder("multimodal.analysis.error")
                .description("Failed multimodal analysis count")
                .register(meterRegistry);
        this.processingTimer = Timer.builder("multimodal.analysis.duration")
                .description("Multimodal analysis processing time")
                .register(meterRegistry);
    }
    
    public <T> T executeWithMonitoring(
            String operation, 
            Supplier<T> supplier, 
            Function<Exception, T> errorHandler) {
        
        Timer.Sample sample = Timer.start(meterRegistry);
        
        try {
            T result = supplier.get();
            successCounter.increment(Tags.of("operation", operation));
            return result;
            
        } catch (Exception e) {
            errorCounter.increment(Tags.of(
                "operation", operation,
                "error_type", e.getClass().getSimpleName()
            ));
            
            log.error("å¤šæ¨¡æ…‹æ“ä½œå¤±æ•—ï¼š{}", operation, e);
            return errorHandler.apply(e);
            
        } finally {
            sample.stop(processingTimer.tag("operation", operation));
        }
    }
}
```

---

## ğŸ“ æœ¬ç« é‡é»å›é¡§

1. **å¤šæ¨¡æ…‹æ¦‚å¿µç†è§£**ï¼šæŒæ¡äº†å¤šæ¨¡æ…‹ AI çš„æ ¸å¿ƒåƒ¹å€¼å’Œæ‡‰ç”¨å ´æ™¯
2. **æ¨¡å‹é¸æ“‡ç­–ç•¥**ï¼šäº†è§£äº†å„ç¨® AI æ¨¡å‹çš„å¤šæ¨¡æ…‹èƒ½åŠ›å’Œé©ç”¨å ´æ™¯
3. **åœ–ç‰‡åˆ†æå¯¦ç¾**ï¼šå»ºç«‹äº†å®Œæ•´çš„åœ–ç‰‡ä¸Šå‚³ã€åˆ†æå’Œæ‰¹æ¬¡è™•ç†åŠŸèƒ½
4. **å¤šåª’é«”è™•ç†**ï¼šå¯¦ç¾äº†éŸ³è¨Šã€å½±ç‰‡ç­‰å¤šç¨®åª’é«”æ ¼å¼çš„åˆ†æåŠŸèƒ½
5. **ä¼æ¥­ç´šæ‡‰ç”¨**ï¼šè¨­è¨ˆäº†æ–‡ä»¶æ™ºèƒ½åˆ†æç­‰å¯¦éš›æ¥­å‹™å ´æ™¯çš„è§£æ±ºæ–¹æ¡ˆ

### æŠ€è¡“è¦é»ç¸½çµ

| æŠ€è¡“é» | é‡è¦æ€§ | å¯¦ç¾é›£åº¦ | ä½¿ç”¨å ´æ™¯ |
|--------|--------|----------|----------|
| **åœ–ç‰‡åˆ†æ** | â­â­â­ | ä¸­ | æ‰€æœ‰è¦–è¦º AI æ‡‰ç”¨ |
| **æ–‡ä»¶ OCR** | â­â­â­ | ä¸­ | ä¼æ¥­æ–‡ä»¶è™•ç† |
| **éŸ³è¨Šè™•ç†** | â­â­ | é«˜ | èªéŸ³æ‡‰ç”¨ã€å…§å®¹åˆ†æ |
| **å½±ç‰‡åˆ†æ** | â­â­ | é«˜ | å½±ç‰‡å…§å®¹ç†è§£ |
| **æ‰¹æ¬¡è™•ç†** | â­â­ | ä¸­ | å¤§é‡æª”æ¡ˆè™•ç† |
| **æ•ˆèƒ½å„ªåŒ–** | â­â­ | é«˜ | ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½² |

### æœ€ä½³å¯¦è¸å»ºè­°

1. **æª”æ¡ˆé©—è­‰**ï¼šå§‹çµ‚é©—è­‰æª”æ¡ˆæ ¼å¼ã€å¤§å°å’Œå…§å®¹
2. **éŒ¯èª¤è™•ç†**ï¼šæä¾›å‹å–„çš„éŒ¯èª¤è¨Šæ¯å’Œé™ç´šæ–¹æ¡ˆ
3. **æ•ˆèƒ½å„ªåŒ–**ï¼šä½¿ç”¨å¿«å–ã€å£“ç¸®å’ŒéåŒæ­¥è™•ç†
4. **æˆæœ¬æ§åˆ¶**ï¼šç›£æ§ API ä½¿ç”¨é‡ï¼Œç‰¹åˆ¥æ˜¯å¤šæ¨¡æ…‹è«‹æ±‚æˆæœ¬è¼ƒé«˜
5. **å®‰å…¨è€ƒé‡**ï¼šæ³¨æ„æª”æ¡ˆä¸Šå‚³çš„å®‰å…¨æ€§å’Œéš±ç§ä¿è­·

### ä¸‹ä¸€æ­¥å­¸ç¿’æ–¹å‘

åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘å€‘å°‡å­¸ç¿’å¦‚ä½•ä½¿ç”¨ Spring AI ç”Ÿæˆåœ–ç‰‡ï¼Œæ¢ç´¢ AI çš„å‰µä½œèƒ½åŠ›ï¼Œå»ºç«‹å®Œæ•´çš„åœ–ç‰‡ç”Ÿæˆå’Œç·¨è¼¯åŠŸèƒ½ã€‚

---

**åƒè€ƒè³‡æ–™ï¼š**
- [Spring AI Multimodality Documentation](https://docs.spring.io/spring-ai/reference/api/multimodality.html)
- [OpenAI Vision API](https://platform.openai.com/docs/guides/vision)
- [Anthropic Claude Vision](https://docs.anthropic.com/claude/docs/vision)
- [Google Gemini Multimodal](https://ai.google.dev/docs/multimodal_concepts)