# 3.1 è³‡æ–™é©—è­‰èˆ‡éŒ¯èª¤è™•ç†

> **ç¬¬ä¸‰ç« å°è®€**ï¼šæœ¬ç« å°‡å¸¶æ‚¨é€²å…¥ç”Ÿç”¢ç´š API é–‹ç™¼å¯¦è¸ï¼ŒæŒæ¡è³‡æ–™é©—è­‰ã€éŒ¯èª¤è™•ç†ç­‰æ ¸å¿ƒæŠ€è¡“ï¼Œç‚º Spring AI æ‡‰ç”¨å»ºç«‹å …å¯¦çš„å“è³ªä¿è­‰åŸºç¤ã€‚

## ğŸ¯ å­¸ç¿’ç›®æ¨™

å®Œæˆæœ¬ç« å­¸ç¿’å¾Œï¼Œæ‚¨å°‡èƒ½å¤ ï¼š

- ğŸ¯ **ç†è§£è³‡æ–™é©—è­‰çš„é‡è¦æ€§**ï¼šæŒæ¡ Web æ‡‰ç”¨ä¸­è³‡æ–™é©—è­‰çš„æ ¸å¿ƒæ¦‚å¿µå’Œå¿…è¦æ€§
- ğŸ¯ **æŒæ¡ Bean Validation**ï¼šç†Ÿç·´ä½¿ç”¨ Spring Boot å…§å»ºçš„è³‡æ–™é©—è­‰æ¡†æ¶
- ğŸ¯ **å¯¦ç¾çµ±ä¸€ä¾‹å¤–è™•ç†**ï¼šå»ºç«‹å®Œå–„çš„å…¨åŸŸéŒ¯èª¤è™•ç†æ©Ÿåˆ¶
- ğŸ¯ **è¨­è¨ˆå‹å–„çš„éŒ¯èª¤å›æ‡‰**ï¼šç‚ºä½¿ç”¨è€…å’Œé–‹ç™¼è€…æä¾›æ¸…æ™°çš„éŒ¯èª¤è¨Šæ¯
- ğŸ¯ **ç‚º AI æœå‹™åšæº–å‚™**ï¼šå»ºç«‹é©åˆ AI æ‡‰ç”¨çš„é©—è­‰å’ŒéŒ¯èª¤è™•ç†ç­–ç•¥

---

## 3.1.1 ç‚ºä»€éº¼éœ€è¦è³‡æ–™é©—è­‰ï¼Ÿ

### è³‡æ–™é©—è­‰çš„é‡è¦æ€§

åœ¨ Web æ‡‰ç”¨é–‹ç™¼ä¸­ï¼Œè³‡æ–™é©—è­‰æ˜¯ç¢ºä¿ç³»çµ±å®‰å…¨æ€§å’Œè³‡æ–™å®Œæ•´æ€§çš„ç¬¬ä¸€é“é˜²ç·šã€‚ç‰¹åˆ¥æ˜¯åœ¨ AI æ‡‰ç”¨ä¸­ï¼Œè¼¸å…¥è³‡æ–™çš„å“è³ªç›´æ¥å½±éŸ¿ AI æ¨¡å‹çš„è¡¨ç¾ã€‚

> **æ€è€ƒå•é¡Œ**ï¼šå¦‚æœæ‚¨çš„ AI æ‡‰ç”¨æ¥æ”¶åˆ°ä»¥ä¸‹è³‡æ–™ï¼Œæœƒç™¼ç”Ÿä»€éº¼å•é¡Œï¼Ÿ
> - ä½¿ç”¨è€…åç¨±ç‚ºç©ºå­—ä¸²
> - é›»å­éƒµä»¶æ ¼å¼ä¸æ­£ç¢º
> - ä¸Šå‚³çš„åœ–ç‰‡æ ¼å¼ä¸æ”¯æ´
> - AI æç¤ºè©åŒ…å«æƒ¡æ„å…§å®¹

### å¸¸è¦‹çš„è³‡æ–™å•é¡Œ

**1. è³‡æ–™å®Œæ•´æ€§å•é¡Œ**
```java
// æ²’æœ‰é©—è­‰çš„æƒ…æ³ä¸‹å¯èƒ½å‡ºç¾çš„å•é¡Œ
public class User {
    private String name;     // å¯èƒ½ç‚º null æˆ–ç©ºå­—ä¸²
    private String email;    // å¯èƒ½æ ¼å¼ä¸æ­£ç¢º
    private Integer age;     // å¯èƒ½ç‚ºè² æ•¸
    private String password; // å¯èƒ½å¤ªçŸ­æˆ–å¤ªç°¡å–®
}
```

**2. å®‰å…¨æ€§å•é¡Œ**
- SQL æ³¨å…¥æ”»æ“Š
- XSS è·¨ç«™è…³æœ¬æ”»æ“Š
- æª”æ¡ˆä¸Šå‚³æ¼æ´
- AI æç¤ºæ³¨å…¥æ”»æ“Š

**3. æ¥­å‹™é‚è¼¯å•é¡Œ**
- ä¸ç¬¦åˆæ¥­å‹™è¦å‰‡çš„è³‡æ–™
- è³‡æ–™æ ¼å¼ä¸ä¸€è‡´
- ç¼ºå°‘å¿…è¦çš„é—œè¯è³‡æ–™

---

## 3.1.2 Spring Boot Bean Validation

### åŸºæœ¬é©—è­‰è¨»è§£

Spring Boot å…§å»ºäº† Bean Validation æ”¯æ´ï¼Œæä¾›äº†è±å¯Œçš„é©—è­‰è¨»è§£ï¼š

```java
/**
 * ä½¿ç”¨è€…è¨»å†Šè«‹æ±‚ DTO
 * å±•ç¤ºåŸºæœ¬çš„è³‡æ–™é©—è­‰è¨»è§£ä½¿ç”¨
 */
public class UserRegistrationRequest {
    
    @NotBlank(message = "ä½¿ç”¨è€…åç¨±ä¸èƒ½ç‚ºç©º")
    @Size(min = 2, max = 50, message = "ä½¿ç”¨è€…åç¨±é•·åº¦å¿…é ˆåœ¨ 2-50 å­—å…ƒä¹‹é–“")
    private String username;
    
    @NotBlank(message = "é›»å­éƒµä»¶ä¸èƒ½ç‚ºç©º")
    @Email(message = "é›»å­éƒµä»¶æ ¼å¼ä¸æ­£ç¢º")
    private String email;
    
    @NotBlank(message = "å¯†ç¢¼ä¸èƒ½ç‚ºç©º")
    @Size(min = 8, max = 128, message = "å¯†ç¢¼é•·åº¦å¿…é ˆåœ¨ 8-128 å­—å…ƒä¹‹é–“")
    @Pattern(regexp = "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).*$", 
             message = "å¯†ç¢¼å¿…é ˆåŒ…å«å¤§å°å¯«å­—æ¯å’Œæ•¸å­—")
    private String password;
    
    @NotNull(message = "å¹´é½¡ä¸èƒ½ç‚ºç©º")
    @Min(value = 18, message = "å¹´é½¡å¿…é ˆå¤§æ–¼ç­‰æ–¼ 18 æ­²")
    @Max(value = 120, message = "å¹´é½¡å¿…é ˆå°æ–¼ç­‰æ–¼ 120 æ­²")
    private Integer age;
    
    @NotEmpty(message = "èˆˆè¶£æ„›å¥½ä¸èƒ½ç‚ºç©º")
    @Size(max = 10, message = "èˆˆè¶£æ„›å¥½æœ€å¤š 10 å€‹")
    private List<String> hobbies;
    
    // Getters and Setters
}
```

### å¸¸ç”¨é©—è­‰è¨»è§£ç¸½è¦½

| è¨»è§£ | é©ç”¨é¡å‹ | èªªæ˜ | ç¯„ä¾‹ |
|------|----------|------|------|
| **@NotNull** | ä»»ä½•é¡å‹ | ä¸èƒ½ç‚º null | `@NotNull Integer age` |
| **@NotBlank** | String | ä¸èƒ½ç‚º nullã€ç©ºå­—ä¸²æˆ–åªæœ‰ç©ºç™½å­—å…ƒ | `@NotBlank String name` |
| **@NotEmpty** | Collection, Map, Array | ä¸èƒ½ç‚º null æˆ–ç©ºé›†åˆ | `@NotEmpty List<String> tags` |
| **@Size** | String, Collection, Map, Array | é•·åº¦æˆ–å¤§å°é™åˆ¶ | `@Size(min=2, max=50)` |
| **@Min/@Max** | æ•¸å€¼é¡å‹ | æ•¸å€¼ç¯„åœé™åˆ¶ | `@Min(18) @Max(120)` |
| **@Email** | String | é›»å­éƒµä»¶æ ¼å¼é©—è­‰ | `@Email String email` |
| **@Pattern** | String | æ­£è¦è¡¨é”å¼é©—è­‰ | `@Pattern(regexp="...")` |
| **@Valid** | ç‰©ä»¶ | å·¢ç‹€ç‰©ä»¶é©—è­‰ | `@Valid Address address` |

### åœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨é©—è­‰

```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    private final UserService userService;
    
    public UserController(UserService userService) {
        this.userService = userService;
    }
    
    /**
     * ä½¿ç”¨è€…è¨»å†Š
     * @Valid è¨»è§£è§¸ç™¼é©—è­‰ï¼ŒBindingResult æ¥æ”¶é©—è­‰çµæœ
     */
    @PostMapping("/register")
    public ResponseEntity<ApiResponse<User>> registerUser(
            @Valid @RequestBody UserRegistrationRequest request,
            BindingResult bindingResult) {
        
        // æ‰‹å‹•æª¢æŸ¥é©—è­‰çµæœ
        if (bindingResult.hasErrors()) {
            StringBuilder errorMessage = new StringBuilder("é©—è­‰å¤±æ•—ï¼š");
            bindingResult.getFieldErrors().forEach(error -> 
                errorMessage.append(error.getField())
                           .append(" ")
                           .append(error.getDefaultMessage())
                           .append("; ")
            );
            return ResponseEntity.badRequest()
                    .body(ApiResponse.error(400, errorMessage.toString()));
        }
        
        User user = userService.registerUser(request);
        return ResponseEntity.status(HttpStatus.CREATED)
                .body(ApiResponse.success("è¨»å†ŠæˆåŠŸ", user));
    }
    
    /**
     * æ›´æ–°ä½¿ç”¨è€…è³‡è¨Š
     * ä½¿ç”¨å…¨åŸŸç•°å¸¸è™•ç†ï¼Œç„¡éœ€æ‰‹å‹•æª¢æŸ¥ BindingResult
     */
    @PutMapping("/{id}")
    public ResponseEntity<ApiResponse<User>> updateUser(
            @PathVariable Long id,
            @Valid @RequestBody UserUpdateRequest request) {
        
        User user = userService.updateUser(id, request);
        return ResponseEntity.ok(ApiResponse.success("æ›´æ–°æˆåŠŸ", user));
    }
}
```

---

## 3.1.3 è‡ªè¨‚é©—è­‰è¨»è§£

### å»ºç«‹è‡ªè¨‚é©—è­‰è¨»è§£

æœ‰æ™‚å€™å…§å»ºçš„é©—è­‰è¨»è§£ç„¡æ³•æ»¿è¶³ç‰¹æ®Šçš„æ¥­å‹™éœ€æ±‚ï¼Œæˆ‘å€‘å¯ä»¥å»ºç«‹è‡ªè¨‚çš„é©—è­‰è¨»è§£ï¼š

```java
/**
 * è‡ªè¨‚é©—è­‰è¨»è§£ï¼šæª¢æŸ¥å¯†ç¢¼å¼·åº¦
 */
@Target({ElementType.FIELD, ElementType.PARAMETER})
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = StrongPasswordValidator.class)
@Documented
public @interface StrongPassword {
    
    String message() default "å¯†ç¢¼å¼·åº¦ä¸è¶³";
    
    Class<?>[] groups() default {};
    
    Class<? extends Payload>[] payload() default {};
    
    /**
     * æ˜¯å¦è¦æ±‚åŒ…å«ç‰¹æ®Šå­—å…ƒ
     */
    boolean requireSpecialChar() default true;
    
    /**
     * æœ€å°é•·åº¦
     */
    int minLength() default 8;
}
```

### å¯¦ç¾é©—è­‰é‚è¼¯

```java
/**
 * å¯†ç¢¼å¼·åº¦é©—è­‰å™¨
 */
public class StrongPasswordValidator implements ConstraintValidator<StrongPassword, String> {
    
    private boolean requireSpecialChar;
    private int minLength;
    
    @Override
    public void initialize(StrongPassword annotation) {
        this.requireSpecialChar = annotation.requireSpecialChar();
        this.minLength = annotation.minLength();
    }
    
    @Override
    public boolean isValid(String password, ConstraintValidatorContext context) {
        if (password == null) {
            return false;
        }
        
        // æª¢æŸ¥é•·åº¦
        if (password.length() < minLength) {
            return false;
        }
        
        // æª¢æŸ¥æ˜¯å¦åŒ…å«å¤§å¯«å­—æ¯
        if (!password.matches(".*[A-Z].*")) {
            return false;
        }
        
        // æª¢æŸ¥æ˜¯å¦åŒ…å«å°å¯«å­—æ¯
        if (!password.matches(".*[a-z].*")) {
            return false;
        }
        
        // æª¢æŸ¥æ˜¯å¦åŒ…å«æ•¸å­—
        if (!password.matches(".*\\d.*")) {
            return false;
        }
        
        // æª¢æŸ¥æ˜¯å¦åŒ…å«ç‰¹æ®Šå­—å…ƒï¼ˆå¦‚æœéœ€è¦ï¼‰
        if (requireSpecialChar && !password.matches(".*[!@#$%^&*()_+\\-=\\[\\]{};':,.<>?].*")) {
            return false;
        }
        
        return true;
    }
}
```

### ä½¿ç”¨è‡ªè¨‚é©—è­‰è¨»è§£

```java
public class ChangePasswordRequest {
    
    @NotBlank(message = "èˆŠå¯†ç¢¼ä¸èƒ½ç‚ºç©º")
    private String oldPassword;
    
    @StrongPassword(minLength = 10, requireSpecialChar = true, 
                   message = "æ–°å¯†ç¢¼å¿…é ˆè‡³å°‘ 10 å­—å…ƒï¼ŒåŒ…å«å¤§å°å¯«å­—æ¯ã€æ•¸å­—å’Œç‰¹æ®Šå­—å…ƒ")
    private String newPassword;
    
    // Getters and Setters
}
```

---

## 3.1.4 å…¨åŸŸç•°å¸¸è™•ç†

### å»ºç«‹å…¨åŸŸç•°å¸¸è™•ç†å™¨

```java
/**
 * å…¨åŸŸç•°å¸¸è™•ç†å™¨
 * çµ±ä¸€è™•ç†æ‡‰ç”¨ç¨‹å¼ä¸­çš„å„ç¨®ç•°å¸¸æƒ…æ³
 */
@RestControllerAdvice
@Slf4j
public class GlobalExceptionHandler {
    
    /**
     * è™•ç†åƒæ•¸é©—è­‰ç•°å¸¸
     */
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<ApiResponse<Void>> handleValidationException(
            MethodArgumentNotValidException e) {
        
        log.warn("åƒæ•¸é©—è­‰å¤±æ•—ï¼š{}", e.getMessage());
        
        Map<String, String> errors = new HashMap<>();
        e.getBindingResult().getFieldErrors().forEach(error -> 
            errors.put(error.getField(), error.getDefaultMessage())
        );
        
        ApiResponse<Void> response = ApiResponse.error(400, "åƒæ•¸é©—è­‰å¤±æ•—", errors);
        return ResponseEntity.badRequest().body(response);
    }
    
    /**
     * è™•ç†è«‹æ±‚åƒæ•¸ç¶å®šç•°å¸¸
     */
    @ExceptionHandler(BindException.class)
    public ResponseEntity<ApiResponse<Void>> handleBindException(BindException e) {
        log.warn("åƒæ•¸ç¶å®šå¤±æ•—ï¼š{}", e.getMessage());
        
        Map<String, String> errors = new HashMap<>();
        e.getBindingResult().getFieldErrors().forEach(error -> 
            errors.put(error.getField(), error.getDefaultMessage())
        );
        
        ApiResponse<Void> response = ApiResponse.error(400, "åƒæ•¸ç¶å®šå¤±æ•—", errors);
        return ResponseEntity.badRequest().body(response);
    }
    
    /**
     * è™•ç†è³‡æºä¸å­˜åœ¨ç•°å¸¸
     */
    @ExceptionHandler(ResourceNotFoundException.class)
    public ResponseEntity<ApiResponse<Void>> handleResourceNotFoundException(
            ResourceNotFoundException e) {
        log.warn("è³‡æºä¸å­˜åœ¨ï¼š{}", e.getMessage());
        
        ApiResponse<Void> response = ApiResponse.error(404, e.getMessage());
        return ResponseEntity.status(HttpStatus.NOT_FOUND).body(response);
    }
    
    /**
     * è™•ç†æ¥­å‹™é‚è¼¯ç•°å¸¸
     */
    @ExceptionHandler(BusinessException.class)
    public ResponseEntity<ApiResponse<Void>> handleBusinessException(
            BusinessException e) {
        log.warn("æ¥­å‹™é‚è¼¯ç•°å¸¸ï¼š{}", e.getMessage());
        
        ApiResponse<Void> response = ApiResponse.error(e.getCode(), e.getMessage());
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(response);
    }
    
    /**
     * è™•ç†è³‡æ–™åº«ç´„æŸé•åç•°å¸¸
     */
    @ExceptionHandler(DataIntegrityViolationException.class)
    public ResponseEntity<ApiResponse<Void>> handleDataIntegrityViolationException(
            DataIntegrityViolationException e) {
        log.error("è³‡æ–™åº«ç´„æŸé•åï¼š{}", e.getMessage());
        
        String message = "è³‡æ–™æ“ä½œå¤±æ•—ï¼Œå¯èƒ½å­˜åœ¨é‡è¤‡è³‡æ–™æˆ–é•åç´„æŸæ¢ä»¶";
        ApiResponse<Void> response = ApiResponse.error(409, message);
        return ResponseEntity.status(HttpStatus.CONFLICT).body(response);
    }
    
    /**
     * è™•ç†ä¸€èˆ¬ç•°å¸¸
     */
    @ExceptionHandler(Exception.class)
    public ResponseEntity<ApiResponse<Void>> handleGeneralException(Exception e) {
        log.error("ç³»çµ±ç•°å¸¸ï¼š", e);
        
        ApiResponse<Void> response = ApiResponse.error(500, "ç³»çµ±å…§éƒ¨éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦");
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(response);
    }
}
```

### è‡ªè¨‚æ¥­å‹™ç•°å¸¸

```java
/**
 * æ¥­å‹™ç•°å¸¸åŸºé¡
 */
public class BusinessException extends RuntimeException {
    
    private final int code;
    
    public BusinessException(int code, String message) {
        super(message);
        this.code = code;
    }
    
    public BusinessException(String message) {
        this(400, message);
    }
    
    public int getCode() {
        return code;
    }
}

/**
 * è³‡æºä¸å­˜åœ¨ç•°å¸¸
 */
public class ResourceNotFoundException extends BusinessException {
    
    public ResourceNotFoundException(String resource, Object id) {
        super(404, String.format("%s (ID: %s) ä¸å­˜åœ¨", resource, id));
    }
}

/**
 * ä½¿ç”¨è€…ç›¸é—œç•°å¸¸
 */
public class UserException {
    
    public static class UserAlreadyExistsException extends BusinessException {
        public UserAlreadyExistsException(String email) {
            super(409, "é›»å­éƒµä»¶ " + email + " å·²è¢«è¨»å†Š");
        }
    }
    
    public static class InvalidCredentialsException extends BusinessException {
        public InvalidCredentialsException() {
            super(401, "å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤");
        }
    }
}
```

---

## 3.1.5 ç‚º Spring AI åšæº–å‚™

### AI æœå‹™çš„ç‰¹æ®Šé©—è­‰éœ€æ±‚

åœ¨ AI æ‡‰ç”¨ä¸­ï¼Œæˆ‘å€‘éœ€è¦è€ƒæ…®ç‰¹æ®Šçš„é©—è­‰éœ€æ±‚ï¼š

```java
/**
 * AI å°è©±è«‹æ±‚é©—è­‰
 */
public class ChatRequest {
    
    @NotBlank(message = "ä½¿ç”¨è€…è¨Šæ¯ä¸èƒ½ç‚ºç©º")
    @Size(max = 4000, message = "è¨Šæ¯é•·åº¦ä¸èƒ½è¶…é 4000 å­—å…ƒ")
    @SafeContent(message = "è¨Šæ¯åŒ…å«ä¸ç•¶å…§å®¹")
    private String message;
    
    @Valid
    private ChatContext context;
    
    @Min(value = 0, message = "æº«åº¦å€¼å¿…é ˆå¤§æ–¼ç­‰æ–¼ 0")
    @Max(value = 2, message = "æº«åº¦å€¼å¿…é ˆå°æ–¼ç­‰æ–¼ 2")
    private Double temperature = 0.7;
    
    @Min(value = 1, message = "æœ€å¤§ token æ•¸å¿…é ˆå¤§æ–¼ 0")
    @Max(value = 4096, message = "æœ€å¤§ token æ•¸ä¸èƒ½è¶…é 4096")
    private Integer maxTokens = 1000;
    
    // Getters and Setters
}

/**
 * å®‰å…¨å…§å®¹é©—è­‰è¨»è§£
 */
@Target({ElementType.FIELD})
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = SafeContentValidator.class)
public @interface SafeContent {
    String message() default "å…§å®¹åŒ…å«ä¸ç•¶è³‡è¨Š";
    Class<?>[] groups() default {};
    Class<? extends Payload>[] payload() default {};
}

/**
 * å®‰å…¨å…§å®¹é©—è­‰å™¨
 */
public class SafeContentValidator implements ConstraintValidator<SafeContent, String> {
    
    private static final List<String> FORBIDDEN_KEYWORDS = Arrays.asList(
        "æš´åŠ›", "è‰²æƒ…", "æ”¿æ²»æ•æ„Ÿ", "ä»‡æ¨è¨€è«–"
        // å¯¦éš›æ‡‰ç”¨ä¸­æ‡‰è©²æœ‰æ›´å®Œæ•´çš„é—œéµè©åº«
    );
    
    @Override
    public boolean isValid(String content, ConstraintValidatorContext context) {
        if (content == null) {
            return true;
        }
        
        // ç°¡å–®çš„é—œéµè©æª¢æŸ¥ï¼ˆå¯¦éš›æ‡‰ç”¨ä¸­æ‡‰è©²ä½¿ç”¨æ›´sophisticatedçš„æ–¹æ³•ï¼‰
        String lowerContent = content.toLowerCase();
        return FORBIDDEN_KEYWORDS.stream()
                .noneMatch(lowerContent::contains);
    }
}
```

### å¤šåª’é«”å…§å®¹é©—è­‰

```java
/**
 * å¤šåª’é«” AI è«‹æ±‚é©—è­‰
 */
public class MultimodalAIRequest {
    
    @NotBlank(message = "æ–‡å­—å…§å®¹ä¸èƒ½ç‚ºç©º")
    private String text;
    
    @ValidImage(message = "åœ–ç‰‡æ ¼å¼ä¸æ”¯æ´æˆ–å¤§å°è¶…é™")
    private String imageBase64;
    
    @ValidAudio(message = "éŸ³è¨Šæ ¼å¼ä¸æ”¯æ´æˆ–å¤§å°è¶…é™")
    private String audioBase64;
    
    // Getters and Setters
}

/**
 * åœ–ç‰‡é©—è­‰è¨»è§£
 */
@Target({ElementType.FIELD})
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = ImageValidator.class)
public @interface ValidImage {
    String message() default "åœ–ç‰‡æ ¼å¼ä¸æ­£ç¢º";
    Class<?>[] groups() default {};
    Class<? extends Payload>[] payload() default {};
    
    long maxSize() default 5 * 1024 * 1024; // 5MB
    String[] allowedFormats() default {"JPEG", "PNG", "GIF"};
}
```

### AI æœå‹™ç•°å¸¸è™•ç†

```java
/**
 * AI æœå‹™ç•°å¸¸è™•ç†
 */
@RestControllerAdvice
public class AIServiceExceptionHandler {
    
    /**
     * è™•ç† AI æœå‹™è¶…æ™‚ç•°å¸¸
     */
    @ExceptionHandler(AIServiceTimeoutException.class)
    public ResponseEntity<ApiResponse<Void>> handleAIServiceTimeout(
            AIServiceTimeoutException e) {
        
        ApiResponse<Void> response = ApiResponse.error(408, 
            "AI æœå‹™å›æ‡‰è¶…æ™‚ï¼Œè«‹ç¨å¾Œå†è©¦");
        return ResponseEntity.status(HttpStatus.REQUEST_TIMEOUT).body(response);
    }
    
    /**
     * è™•ç† AI æœå‹™é…é¡è¶…é™ç•°å¸¸
     */
    @ExceptionHandler(AIQuotaExceededException.class)
    public ResponseEntity<ApiResponse<Void>> handleAIQuotaExceeded(
            AIQuotaExceededException e) {
        
        ApiResponse<Void> response = ApiResponse.error(429, 
            "AI æœå‹™ä½¿ç”¨é‡å·²é”ä¸Šé™ï¼Œè«‹ç¨å¾Œå†è©¦");
        return ResponseEntity.status(HttpStatus.TOO_MANY_REQUESTS).body(response);
    }
    
    /**
     * è™•ç†å…§å®¹å®‰å…¨æª¢æŸ¥å¤±æ•—ç•°å¸¸
     */
    @ExceptionHandler(ContentSafetyException.class)
    public ResponseEntity<ApiResponse<Void>> handleContentSafety(
            ContentSafetyException e) {
        
        ApiResponse<Void> response = ApiResponse.error(400, 
            "å…§å®¹æœªé€šéå®‰å…¨æª¢æŸ¥ï¼Œè«‹ä¿®æ”¹å¾Œé‡è©¦");
        return ResponseEntity.badRequest().body(response);
    }
}
```

---

## ğŸ“ æœ¬ç« é‡é»å›é¡§

1. **è³‡æ–™é©—è­‰é‡è¦æ€§**ï¼šç†è§£äº†è³‡æ–™é©—è­‰åœ¨ç³»çµ±å®‰å…¨å’Œè³‡æ–™å“è³ªä¸­çš„é—œéµä½œç”¨
2. **Bean Validation**ï¼šæŒæ¡äº† Spring Boot å…§å»ºé©—è­‰æ¡†æ¶çš„ä½¿ç”¨æ–¹æ³•
3. **è‡ªè¨‚é©—è­‰è¨»è§£**ï¼šå­¸æœƒäº†å»ºç«‹ç¬¦åˆæ¥­å‹™éœ€æ±‚çš„è‡ªè¨‚é©—è­‰é‚è¼¯
4. **å…¨åŸŸç•°å¸¸è™•ç†**ï¼šå»ºç«‹äº†çµ±ä¸€çš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
5. **AI æœå‹™æº–å‚™**ï¼šç‚º Spring AI çš„ç‰¹æ®Šé©—è­‰éœ€æ±‚åšå¥½äº†æº–å‚™

### ä¸‹ä¸€æ­¥å­¸ç¿’æ–¹å‘

åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘å€‘å°‡å­¸ç¿’æª”æ¡ˆè™•ç†èˆ‡å¤šåª’é«”æ”¯æ´ï¼Œé€™å°æ–¼ Spring AI çš„å¤šæ¨¡æ…‹æ‡‰ç”¨è‡³é—œé‡è¦ã€‚

---

**åƒè€ƒè³‡æ–™ï¼š**
- [Bean Validation Specification](https://beanvalidation.org/)
- [Spring Boot Validation](https://docs.spring.io/spring-boot/docs/current/reference/html/web.html#web.servlet.spring-mvc.validation)
- [Spring MVC Exception Handling](https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-exceptionhandlers)