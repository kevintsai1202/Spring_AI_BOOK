# 2.7 RESTful API è¨­è¨ˆèˆ‡å¯¦è¸

## ğŸ¯ å­¸ç¿’ç›®æ¨™

å®Œæˆæœ¬ç« å­¸ç¿’å¾Œï¼Œæ‚¨å°‡èƒ½å¤ ï¼š

- ğŸ¯ **ç†è§£ REST æ¶æ§‹åŸç†**ï¼šæ·±å…¥æŒæ¡ REST æ¶æ§‹ç´„æŸæ¢ä»¶å’Œè¨­è¨ˆç†å¿µ
- ğŸ¯ **è¨­è¨ˆè³‡æºå°å‘ API**ï¼šé‹ç”¨è³‡æºå°å‘æ€ç¶­è¨­è¨ˆæ¸…æ™°ã€ç›´è§€çš„ API çµæ§‹
- ğŸ¯ **å¯¦ç¾ HTTP èªç¾©åŒ–**ï¼šæ­£ç¢ºä½¿ç”¨ HTTP æ–¹æ³•ã€ç‹€æ…‹ç¢¼å’Œæ¨™é ­é€²è¡Œ API é€šä¿¡
- ğŸ¯ **å»ºç«‹ URL è¨­è¨ˆè¦ç¯„**ï¼šåˆ¶å®šä¸€è‡´æ€§ã€å¯é æ¸¬çš„ URL å‘½åå’Œçµæ§‹æ¨™æº–
- ğŸ¯ **æ‡‰ç”¨ç¾ä»£åŒ–å¯¦è¸**ï¼šæ•´åˆç‰ˆæœ¬æ§åˆ¶ã€å¿«å–ç­–ç•¥ç­‰é€²éšæŠ€è¡“

---

## REST æ¶æ§‹é¢¨æ ¼æ·±åº¦è§£æ

### ç‚ºä»€éº¼éœ€è¦ RESTful APIï¼Ÿ

åœ¨ç¾ä»£åˆ†æ•£å¼ç³»çµ±ä¸­ï¼Œä¸åŒçš„æ‡‰ç”¨ç¨‹å¼éœ€è¦é€éç¶²è·¯é€²è¡Œé€šä¿¡ã€‚æ‚¨æ˜¯å¦é‡åˆ°éä»¥ä¸‹å•é¡Œï¼Ÿ

> **å¸¸è¦‹ API è¨­è¨ˆå•é¡Œ**ï¼š
> - API ç«¯é»å‘½åæ··äº‚ï¼Œé›£ä»¥ç†è§£å’Œè¨˜æ†¶
> - HTTP æ–¹æ³•ä½¿ç”¨ä¸ç•¶ï¼Œèªç¾©ä¸æ¸…
> - ç‹€æ…‹ç¢¼é¸æ“‡éš¨æ„ï¼ŒéŒ¯èª¤è™•ç†ä¸ä¸€è‡´
> - ç¼ºä¹çµ±ä¸€çš„è¨­è¨ˆæ¨™æº–ï¼Œç¶­è­·å›°é›£

RESTful API é€éçµ±ä¸€çš„æ¶æ§‹é¢¨æ ¼è§£æ±ºäº†é€™äº›å•é¡Œï¼Œæä¾›äº†ä¸€å¥—æ¨™æº–åŒ–çš„è¨­è¨ˆåŸå‰‡ã€‚

### REST æ¶æ§‹ç´„æŸæ¢ä»¶

RESTï¼ˆRepresentational State Transferï¼‰å®šç¾©äº†å…­å€‹æ ¸å¿ƒç´„æŸæ¢ä»¶ï¼š

| ç´„æŸæ¢ä»¶ | èªªæ˜ | å„ªå‹¢ |
|----------|------|------|
| **å®¢æˆ¶ç«¯-ä¼ºæœå™¨** | åˆ†é›¢ä½¿ç”¨è€…ä»‹é¢å’Œè³‡æ–™å„²å­˜é—œæ³¨é» | æé«˜å¯ç§»æ¤æ€§å’Œå¯æ“´å±•æ€§ |
| **ç„¡ç‹€æ…‹** | æ¯å€‹è«‹æ±‚åŒ…å«è™•ç†æ‰€éœ€çš„å®Œæ•´è³‡è¨Š | æé«˜å¯è¦‹æ€§ã€å¯é æ€§å’Œå¯æ“´å±•æ€§ |
| **å¯å¿«å–** | å›æ‡‰è³‡æ–™å¯ä»¥è¢«æ¨™è¨˜ç‚ºå¯å¿«å–æˆ–ä¸å¯å¿«å– | æé«˜ç¶²è·¯æ•ˆç‡å’Œä½¿ç”¨è€…é«”é©— |
| **çµ±ä¸€ä»‹é¢** | ä½¿ç”¨çµ±ä¸€çš„ä»‹é¢ç´„æŸ | ç°¡åŒ–æ¶æ§‹ï¼Œæé«˜å¯è¦‹æ€§ |
| **åˆ†å±¤ç³»çµ±** | å…è¨±æ¶æ§‹ç”±åˆ†å±¤çµ„æˆ | æé«˜å¯æ“´å±•æ€§å’Œå®‰å…¨æ€§ |
| **æŒ‰éœ€ç¨‹å¼ç¢¼** | å¯é¸ç´„æŸï¼Œå…è¨±ä¸‹è¼‰å’ŒåŸ·è¡Œç¨‹å¼ç¢¼ | æé«˜å¯æ“´å±•æ€§ |

### åŸºç¤ RESTful Controller å¯¦ç¾

```java
/**
 * åŸºç¤ RESTful API æ§åˆ¶å™¨
 * å±•ç¤ºæ¨™æº–çš„è³‡æºå°å‘è¨­è¨ˆæ¨¡å¼
 */
@RestController
@RequestMapping("/api/v1/users")
@Validated
public class UserRestController {
    
    private final UserService userService;
    private final UserMapper userMapper;
    
    public UserRestController(UserService userService, UserMapper userMapper) {
        this.userService = userService;
        this.userMapper = userMapper;
    }
    
    /**
     * ç²å–ä½¿ç”¨è€…åˆ—è¡¨
     * GET /api/v1/users
     * æ”¯æ´åˆ†é å’Œç¯©é¸åƒæ•¸
     */
    @GetMapping
    public ResponseEntity<PagedResponse<UserDto>> getUsers(
            @RequestParam(defaultValue = "0") int page,
            @RequestParam(defaultValue = "20") int size,
            @RequestParam(required = false) String name,
            @RequestParam(required = false) String email
    ) {
        // å»ºç«‹æŸ¥è©¢æ¢ä»¶
        UserSearchCriteria criteria = UserSearchCriteria.builder()
                .name(name)
                .email(email)
                .build();
        
        // åŸ·è¡Œåˆ†é æŸ¥è©¢
        Page<User> userPage = userService.findUsers(criteria, PageRequest.of(page, size));
        
        // è½‰æ›ç‚º DTO
        List<UserDto> userDtos = userPage.getContent().stream()
                .map(userMapper::toDto)
                .collect(Collectors.toList());
        
        // å»ºç«‹åˆ†é å›æ‡‰
        PagedResponse<UserDto> response = PagedResponse.<UserDto>builder()
                .content(userDtos)
                .page(page)
                .size(size)
                .totalElements(userPage.getTotalElements())
                .totalPages(userPage.getTotalPages())
                .first(userPage.isFirst())
                .last(userPage.isLast())
                .build();
        
        return ResponseEntity.ok()
                .header("X-Total-Count", String.valueOf(userPage.getTotalElements()))
                .body(response);
    }
    
    /**
     * æ ¹æ“š ID ç²å–å–®ä¸€ä½¿ç”¨è€…
     * GET /api/v1/users/{id}
     */
    @GetMapping("/{id}")
    public ResponseEntity<UserDto> getUserById(@PathVariable Long id) {
        User user = userService.findById(id);
        UserDto userDto = userMapper.toDto(user);
        
        return ResponseEntity.ok()
                .cacheControl(CacheControl.maxAge(Duration.ofMinutes(5)))
                .body(userDto);
    }
}
```

---

## HTTP æ–¹æ³•èªç¾©åŒ–ä½¿ç”¨

### HTTP æ–¹æ³•å°ç…§è¡¨

| HTTP æ–¹æ³• | ç”¨é€” | å†ªç­‰æ€§ | å®‰å…¨æ€§ | å…¸å‹ä½¿ç”¨å ´æ™¯ |
|-----------|------|--------|--------|--------------|
| **GET** | ç²å–è³‡æº | âœ… | âœ… | æŸ¥è©¢è³‡æ–™ã€ç²å–åˆ—è¡¨ |
| **POST** | å»ºç«‹è³‡æº | âŒ | âŒ | æ–°å¢è³‡æ–™ã€æäº¤è¡¨å–® |
| **PUT** | æ›´æ–°/æ›¿æ›è³‡æº | âœ… | âŒ | å®Œæ•´æ›´æ–°è³‡æº |
| **PATCH** | éƒ¨åˆ†æ›´æ–°è³‡æº | âŒ | âŒ | éƒ¨åˆ†æ¬„ä½æ›´æ–° |
| **DELETE** | åˆªé™¤è³‡æº | âœ… | âŒ | åˆªé™¤è³‡æ–™ |
| **HEAD** | ç²å–è³‡æºæ¨™é ­ | âœ… | âœ… | æª¢æŸ¥è³‡æºå­˜åœ¨æ€§ |
| **OPTIONS** | ç²å–æ”¯æ´çš„æ–¹æ³• | âœ… | âœ… | CORS é æª¢è«‹æ±‚ |

### å®Œæ•´ CRUD æ“ä½œå¯¦ç¾

```java
/**
 * å®Œæ•´çš„ CRUD æ“ä½œå¯¦ç¾
 * å±•ç¤ºå„ç¨® HTTP æ–¹æ³•çš„æ­£ç¢ºä½¿ç”¨
 */
@RestController
@RequestMapping("/api/v1/products")
public class ProductRestController {
    
    private final ProductService productService;
    private final ProductMapper productMapper;
    
    public ProductRestController(ProductService productService, ProductMapper productMapper) {
        this.productService = productService;
        this.productMapper = productMapper;
    }
    
    /**
     * å»ºç«‹æ–°ç”¢å“
     * POST /api/v1/products
     * å›å‚³ 201 Created å’Œ Location æ¨™é ­
     */
    @PostMapping
    public ResponseEntity<ProductDto> createProduct(@RequestBody @Valid CreateProductRequest request) {
        // è½‰æ›è«‹æ±‚ç‚ºå¯¦é«”
        Product product = productMapper.toEntity(request);
        
        // å„²å­˜ç”¢å“
        Product savedProduct = productService.save(product);
        
        // è½‰æ›ç‚º DTO
        ProductDto productDto = productMapper.toDto(savedProduct);
        
        // å»ºç«‹è³‡æºä½ç½® URI
        URI location = ServletUriComponentsBuilder
                .fromCurrentRequest()
                .path("/{id}")
                .buildAndExpand(savedProduct.getId())
                .toUri();
        
        return ResponseEntity.created(location)
                .body(productDto);
    }
    
    /**
     * å®Œæ•´æ›´æ–°ç”¢å“
     * PUT /api/v1/products/{id}
     * å†ªç­‰æ“ä½œï¼Œå®Œæ•´æ›¿æ›è³‡æº
     */
    @PutMapping("/{id}")
    public ResponseEntity<ProductDto> updateProduct(
            @PathVariable Long id,
            @RequestBody @Valid UpdateProductRequest request
    ) {
        // æª¢æŸ¥ç”¢å“æ˜¯å¦å­˜åœ¨
        if (!productService.existsById(id)) {
            throw new ProductNotFoundException("Product not found with id: " + id);
        }
        
        // è½‰æ›è«‹æ±‚ç‚ºå¯¦é«”
        Product product = productMapper.toEntity(request);
        product.setId(id);
        
        // æ›´æ–°ç”¢å“
        Product updatedProduct = productService.update(product);
        
        // è½‰æ›ç‚º DTO
        ProductDto productDto = productMapper.toDto(updatedProduct);
        
        return ResponseEntity.ok(productDto);
    }
    
    /**
     * éƒ¨åˆ†æ›´æ–°ç”¢å“
     * PATCH /api/v1/products/{id}
     * åªæ›´æ–°æä¾›çš„æ¬„ä½
     */
    @PatchMapping("/{id}")
    public ResponseEntity<ProductDto> patchProduct(
            @PathVariable Long id,
            @RequestBody Map<String, Object> updates
    ) {
        // åŸ·è¡Œéƒ¨åˆ†æ›´æ–°
        Product updatedProduct = productService.partialUpdate(id, updates);
        
        // è½‰æ›ç‚º DTO
        ProductDto productDto = productMapper.toDto(updatedProduct);
        
        return ResponseEntity.ok(productDto);
    }
    
    /**
     * åˆªé™¤ç”¢å“
     * DELETE /api/v1/products/{id}
     * å†ªç­‰æ“ä½œï¼Œé‡è¤‡åˆªé™¤ä¸æœƒç”¢ç”ŸéŒ¯èª¤
     */
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteProduct(@PathVariable Long id) {
        // æª¢æŸ¥ç”¢å“æ˜¯å¦å­˜åœ¨
        if (!productService.existsById(id)) {
            // å†ªç­‰æ€§ï¼šå³ä½¿è³‡æºä¸å­˜åœ¨ä¹Ÿå›å‚³ 204
            return ResponseEntity.noContent().build();
        }
        
        // åˆªé™¤ç”¢å“
        productService.deleteById(id);
        
        return ResponseEntity.noContent().build();
    }
}
```

---

## RESTful URL è¨­è¨ˆåŸå‰‡

### URL è¨­è¨ˆæœ€ä½³å¯¦è¸

| åŸå‰‡ | èªªæ˜ | å¥½çš„ç¯„ä¾‹ | ä¸å¥½çš„ç¯„ä¾‹ |
|------|------|----------|------------|
| **ä½¿ç”¨åè©** | URL æ‡‰è©²è¡¨ç¤ºè³‡æºï¼Œè€Œéå‹•ä½œ | `/api/users` | `/api/getUsers` |
| **è¤‡æ•¸å½¢å¼** | é›†åˆè³‡æºä½¿ç”¨è¤‡æ•¸åè© | `/api/products` | `/api/product` |
| **éšå±¤çµæ§‹** | åæ˜ è³‡æºä¹‹é–“çš„é—œä¿‚ | `/api/users/123/orders` | `/api/getUserOrders?userId=123` |
| **å°å¯«å­—æ¯** | çµ±ä¸€ä½¿ç”¨å°å¯«å­—æ¯ | `/api/user-profiles` | `/api/UserProfiles` |
| **é€£å­—ç¬¦åˆ†éš”** | ä½¿ç”¨é€£å­—ç¬¦è€Œéåº•ç·š | `/api/order-items` | `/api/order_items` |

### è³‡æºé—œä¿‚è¨­è¨ˆ

```java
/**
 * å·¢ç‹€è³‡æºé—œä¿‚çš„ RESTful è¨­è¨ˆ
 * å±•ç¤ºçˆ¶å­è³‡æºçš„ URL çµæ§‹
 */
@RestController
@RequestMapping("/api/v1/users/{userId}/orders")
public class UserOrderController {
    
    private final OrderService orderService;
    private final UserService userService;
    
    /**
     * ç²å–ä½¿ç”¨è€…çš„æ‰€æœ‰è¨‚å–®
     * GET /api/v1/users/{userId}/orders
     */
    @GetMapping
    public ResponseEntity<List<OrderDto>> getUserOrders(
            @PathVariable Long userId,
            @RequestParam(defaultValue = "0") int page,
            @RequestParam(defaultValue = "20") int size,
            @RequestParam(required = false) String status
    ) {
        // é©—è­‰ä½¿ç”¨è€…å­˜åœ¨
        userService.validateUserExists(userId);
        
        // å»ºç«‹æŸ¥è©¢æ¢ä»¶
        OrderSearchCriteria criteria = OrderSearchCriteria.builder()
                .userId(userId)
                .status(status)
                .build();
        
        // åŸ·è¡ŒæŸ¥è©¢
        Page<Order> orderPage = orderService.findOrders(criteria, PageRequest.of(page, size));
        
        // è½‰æ›ç‚º DTO
        List<OrderDto> orderDtos = orderPage.getContent().stream()
                .map(orderMapper::toDto)
                .collect(Collectors.toList());
        
        return ResponseEntity.ok(orderDtos);
    }
    
    /**
     * ç‚ºä½¿ç”¨è€…å»ºç«‹æ–°è¨‚å–®
     * POST /api/v1/users/{userId}/orders
     */
    @PostMapping
    public ResponseEntity<OrderDto> createUserOrder(
            @PathVariable Long userId,
            @RequestBody @Valid CreateOrderRequest request
    ) {
        // é©—è­‰ä½¿ç”¨è€…å­˜åœ¨
        User user = userService.findById(userId);
        
        // å»ºç«‹è¨‚å–®
        Order order = orderMapper.toEntity(request);
        order.setUser(user);
        
        Order savedOrder = orderService.save(order);
        OrderDto orderDto = orderMapper.toDto(savedOrder);
        
        // å»ºç«‹è³‡æºä½ç½®
        URI location = ServletUriComponentsBuilder
                .fromCurrentRequest()
                .path("/{orderId}")
                .buildAndExpand(savedOrder.getId())
                .toUri();
        
        return ResponseEntity.created(location).body(orderDto);
    }
}
```

---

## HTTP ç‹€æ…‹ç¢¼æœ€ä½³å¯¦è¸

### å¸¸ç”¨ç‹€æ…‹ç¢¼å°ç…§è¡¨

| ç‹€æ…‹ç¢¼ | åç¨± | ä½¿ç”¨å ´æ™¯ | ç¯„ä¾‹ |
|--------|------|----------|------|
| **200** | OK | è«‹æ±‚æˆåŠŸ | GETã€PUTã€PATCH æˆåŠŸ |
| **201** | Created | è³‡æºå»ºç«‹æˆåŠŸ | POST å»ºç«‹è³‡æº |
| **204** | No Content | è«‹æ±‚æˆåŠŸä½†ç„¡å…§å®¹å›å‚³ | DELETE æˆåŠŸ |
| **400** | Bad Request | è«‹æ±‚æ ¼å¼éŒ¯èª¤ | é©—è­‰å¤±æ•— |
| **401** | Unauthorized | æœªèªè­‰ | ç¼ºå°‘æˆ–ç„¡æ•ˆçš„èªè­‰è³‡è¨Š |
| **403** | Forbidden | å·²èªè­‰ä½†ç„¡æ¬Šé™ | æ¬Šé™ä¸è¶³ |
| **404** | Not Found | è³‡æºä¸å­˜åœ¨ | æ‰¾ä¸åˆ°æŒ‡å®šè³‡æº |
| **409** | Conflict | è³‡æºè¡çª | é‡è¤‡å»ºç«‹ã€ç‰ˆæœ¬è¡çª |
| **422** | Unprocessable Entity | èªç¾©éŒ¯èª¤ | æ¥­å‹™é‚è¼¯é©—è­‰å¤±æ•— |
| **500** | Internal Server Error | ä¼ºæœå™¨å…§éƒ¨éŒ¯èª¤ | æœªé æœŸçš„ç³»çµ±éŒ¯èª¤ |

### å…¨åŸŸç•°å¸¸è™•ç†

```java
/**
 * å…¨åŸŸç•°å¸¸è™•ç†å™¨
 * çµ±ä¸€è™•ç†å„ç¨®ç•°å¸¸ä¸¦å›å‚³é©ç•¶çš„ç‹€æ…‹ç¢¼
 */
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    private static final Logger logger = LoggerFactory.getLogger(GlobalExceptionHandler.class);
    
    /**
     * è™•ç†é©—è­‰ç•°å¸¸
     * 400 Bad Request
     */
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<ErrorResponse> handleValidationException(MethodArgumentNotValidException e) {
        List<FieldError> fieldErrors = e.getBindingResult().getFieldErrors();
        
        Map<String, String> errors = fieldErrors.stream()
                .collect(Collectors.toMap(
                        FieldError::getField,
                        FieldError::getDefaultMessage,
                        (existing, replacement) -> existing
                ));
        
        ErrorResponse errorResponse = ErrorResponse.builder()
                .status(HttpStatus.BAD_REQUEST.value())
                .error("Validation Failed")
                .message("Request validation failed")
                .details(errors)
                .timestamp(Instant.now())
                .path(getCurrentPath())
                .build();
        
        return ResponseEntity.badRequest().body(errorResponse);
    }
    
    /**
     * è™•ç†è³‡æºæœªæ‰¾åˆ°ç•°å¸¸
     * 404 Not Found
     */
    @ExceptionHandler(ResourceNotFoundException.class)
    public ResponseEntity<ErrorResponse> handleResourceNotFoundException(ResourceNotFoundException e) {
        ErrorResponse errorResponse = ErrorResponse.builder()
                .status(HttpStatus.NOT_FOUND.value())
                .error("Resource Not Found")
                .message(e.getMessage())
                .timestamp(Instant.now())
                .path(getCurrentPath())
                .build();
        
        return ResponseEntity.status(HttpStatus.NOT_FOUND).body(errorResponse);
    }
    
    /**
     * è™•ç†ç³»çµ±ç•°å¸¸
     * 500 Internal Server Error
     */
    @ExceptionHandler(Exception.class)
    public ResponseEntity<ErrorResponse> handleGenericException(Exception e) {
        logger.error("Unexpected error occurred", e);
        
        ErrorResponse errorResponse = ErrorResponse.builder()
                .status(HttpStatus.INTERNAL_SERVER_ERROR.value())
                .error("Internal Server Error")
                .message("An unexpected error occurred")
                .timestamp(Instant.now())
                .path(getCurrentPath())
                .build();
        
        return ResponseEntity.internalServerError().body(errorResponse);
    }
    
    private String getCurrentPath() {
        RequestAttributes requestAttributes = RequestContextHolder.getRequestAttributes();
        if (requestAttributes instanceof ServletRequestAttributes) {
            HttpServletRequest request = ((ServletRequestAttributes) requestAttributes).getRequest();
            return request.getRequestURI();
        }
        return "unknown";
    }
}
```

---

## API ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥

### ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥æ¯”è¼ƒ

| ç­–ç•¥ | å¯¦ç¾æ–¹å¼ | å„ªé» | ç¼ºé» | é©ç”¨å ´æ™¯ |
|------|----------|------|------|----------|
| **URL è·¯å¾‘** | `/api/v1/users` | æ¸…æ™°æ˜ç¢ºã€æ˜“æ–¼ç†è§£ | URL è¼ƒé•·ã€è·¯ç”±è¤‡é›œ | å…¬é–‹ API |
| **æŸ¥è©¢åƒæ•¸** | `/api/users?version=1` | éˆæ´»ã€æ˜“æ–¼å¯¦ç¾ | å®¹æ˜“è¢«å¿½ç•¥ | å…§éƒ¨ API |
| **æ¨™é ­ç‰ˆæœ¬** | `Accept: application/vnd.api.v1+json` | èªç¾©æ¸…æ™°ã€ç¬¦åˆ HTTP æ¨™æº– | å¯¦ç¾è¤‡é›œ | ä¼æ¥­ç´š API |

### URL è·¯å¾‘ç‰ˆæœ¬æ§åˆ¶å¯¦ç¾

```java
/**
 * URL è·¯å¾‘ç‰ˆæœ¬æ§åˆ¶å¯¦ç¾
 * æœ€å¸¸è¦‹å’Œç›´è§€çš„ç‰ˆæœ¬æ§åˆ¶æ–¹å¼
 */
@RestController
public class VersionedUserController {
    
    private final UserService userService;
    private final UserMapperV1 userMapperV1;
    private final UserMapperV2 userMapperV2;
    
    /**
     * API v1 - åŸºç¤ä½¿ç”¨è€…è³‡è¨Š
     * GET /api/v1/users/{id}
     */
    @GetMapping("/api/v1/users/{id}")
    public ResponseEntity<UserV1Dto> getUserV1(@PathVariable Long id) {
        User user = userService.findById(id);
        UserV1Dto userDto = userMapperV1.toDto(user);
        
        return ResponseEntity.ok()
                .header("API-Version", "1.0")
                .body(userDto);
    }
    
    /**
     * API v2 - å¢å¼·çš„ä½¿ç”¨è€…è³‡è¨Šï¼ˆåŒ…å«åå¥½è¨­å®šï¼‰
     * GET /api/v2/users/{id}
     */
    @GetMapping("/api/v2/users/{id}")
    public ResponseEntity<UserV2Dto> getUserV2(@PathVariable Long id) {
        User user = userService.findById(id);
        UserV2Dto userDto = userMapperV2.toDto(user);
        
        return ResponseEntity.ok()
                .header("API-Version", "2.0")
                .body(userDto);
    }
}
```

---

## å¿«å–ç­–ç•¥è¨­è¨ˆ

### HTTP å¿«å–æ¨™é ­å°ç…§è¡¨

| æ¨™é ­ | é¡å‹ | ç”¨é€” | ç¯„ä¾‹ |
|------|------|------|------|
| **Cache-Control** | å›æ‡‰/è«‹æ±‚ | æ§åˆ¶å¿«å–è¡Œç‚º | `max-age=3600, public` |
| **ETag** | å›æ‡‰ | è³‡æºç‰ˆæœ¬æ¨™è­˜ | `"abc123"` |
| **Last-Modified** | å›æ‡‰ | æœ€å¾Œä¿®æ”¹æ™‚é–“ | `Wed, 21 Oct 2015 07:28:00 GMT` |
| **If-None-Match** | è«‹æ±‚ | æ¢ä»¶å¼è«‹æ±‚ï¼ˆETagï¼‰ | `"abc123"` |
| **If-Modified-Since** | è«‹æ±‚ | æ¢ä»¶å¼è«‹æ±‚ï¼ˆæ™‚é–“ï¼‰ | `Wed, 21 Oct 2015 07:28:00 GMT` |

### å¿«å–ç­–ç•¥å¯¦ç¾

```java
/**
 * RESTful API å¿«å–ç­–ç•¥å¯¦ç¾
 * å±•ç¤ºå„ç¨®å¿«å–æ§åˆ¶æŠ€è¡“
 */
@RestController
@RequestMapping("/api/v1/articles")
public class ArticleCacheController {
    
    private final ArticleService articleService;
    
    /**
     * ç²å–æ–‡ç« åˆ—è¡¨ï¼ˆå…¬é–‹å¿«å–ï¼‰
     * GET /api/v1/articles
     */
    @GetMapping
    public ResponseEntity<List<ArticleDto>> getArticles() {
        List<Article> articles = articleService.findPublishedArticles();
        List<ArticleDto> articleDtos = articles.stream()
                .map(articleMapper::toDto)
                .collect(Collectors.toList());
        
        return ResponseEntity.ok()
                .cacheControl(CacheControl.maxAge(Duration.ofMinutes(15))
                        .cachePublic()
                        .mustRevalidate())
                .body(articleDtos);
    }
    
    /**
     * ç²å–æ–‡ç« è©³æƒ…ï¼ˆETag å¿«å–ï¼‰
     * GET /api/v1/articles/{id}
     */
    @GetMapping("/{id}")
    public ResponseEntity<ArticleDto> getArticle(
            @PathVariable Long id,
            HttpServletRequest request
    ) {
        Article article = articleService.findById(id);
        
        // ç”Ÿæˆ ETag
        String etag = generateETag(article);
        
        // æª¢æŸ¥æ¢ä»¶å¼è«‹æ±‚
        String ifNoneMatch = request.getHeader("If-None-Match");
        if (etag.equals(ifNoneMatch)) {
            return ResponseEntity.status(HttpStatus.NOT_MODIFIED)
                    .eTag(etag)
                    .build();
        }
        
        ArticleDto articleDto = articleMapper.toDto(article);
        
        return ResponseEntity.ok()
                .eTag(etag)
                .cacheControl(CacheControl.maxAge(Duration.ofMinutes(30))
                        .cachePrivate())
                .body(articleDto);
    }
    
    /**
     * ç”Ÿæˆ ETag
     */
    private String generateETag(Article article) {
        String content = article.getId() + ":" + 
                        article.getTitle() + ":" + 
                        article.getUpdatedAt().toString();
        
        return "\"" + DigestUtils.md5DigestAsHex(content.getBytes()) + "\"";
    }
}
```

---

## RESTful API è¨­è¨ˆæœ€ä½³å¯¦è¸ç¸½çµ

### API è¨­è¨ˆæª¢æŸ¥æ¸…å–®

åœ¨è¨­è¨ˆ RESTful API æ™‚ï¼Œè«‹åƒè€ƒä»¥ä¸‹æª¢æŸ¥æ¸…å–®ï¼š

| æª¢æŸ¥é …ç›® | èªªæ˜ | ç¯„ä¾‹ |
|---------|------|------|
| **è³‡æºå°å‘** | ä½¿ç”¨åè©è€Œéå‹•è© | `/api/users` è€Œé `/api/getUsers` |
| **HTTP æ–¹æ³•** | æ­£ç¢ºä½¿ç”¨ HTTP å‹•è© | GET æŸ¥è©¢ã€POST å»ºç«‹ã€PUT æ›´æ–°ã€DELETE åˆªé™¤ |
| **ç‹€æ…‹ç¢¼** | èªç¾©åŒ–çš„ HTTP ç‹€æ…‹ç¢¼ | 201 Createdã€404 Not Foundã€409 Conflict |
| **çµ±ä¸€æ ¼å¼** | ä¸€è‡´çš„å›æ‡‰çµæ§‹ | çµ±ä¸€çš„éŒ¯èª¤æ ¼å¼å’ŒæˆåŠŸæ ¼å¼ |
| **ç‰ˆæœ¬æ§åˆ¶** | æ˜ç¢ºçš„ç‰ˆæœ¬ç­–ç•¥ | `/api/v1/` æˆ–æ¨™é ­ç‰ˆæœ¬æ§åˆ¶ |
| **å¿«å–æ”¯æ´** | é©ç•¶çš„å¿«å–æ§åˆ¶ | ETagã€Cache-Controlã€Last-Modified |

âœ… **æœ€ä½³å¯¦è¸æ¨™è¨˜**ï¼š
- ä½¿ç”¨è³‡æºå°å‘çš„ URL è¨­è¨ˆ
- æ­£ç¢ºé‹ç”¨ HTTP æ–¹æ³•èªç¾©
- å¯¦ç¾çµ±ä¸€çš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
- æ”¯æ´é©ç•¶çš„å¿«å–ç­–ç•¥
- è€ƒæ…® API ç‰ˆæœ¬æ¼”é€²éœ€æ±‚

âš ï¸ **å¸¸è¦‹é™·é˜±**ï¼š
- URL ä¸­ä½¿ç”¨å‹•è©è€Œéåè©
- æ‰€æœ‰æ“ä½œéƒ½ä½¿ç”¨ POST æ–¹æ³•
- å¿½ç•¥ HTTP ç‹€æ…‹ç¢¼çš„èªç¾©
- ç¼ºä¹çµ±ä¸€çš„éŒ¯èª¤è™•ç†
- æ²’æœ‰è€ƒæ…®å¿«å–å’Œæ•ˆèƒ½

---

## ğŸ“ é‡é»æ‘˜è¦

æœ¬ç« æ·±å…¥æ¢è¨äº† RESTful API è¨­è¨ˆèˆ‡å¯¦è¸çš„æ ¸å¿ƒæ¦‚å¿µå’Œæœ€ä½³å¯¦è¸ã€‚ä»¥ä¸‹æ˜¯é—œéµè¦é»ï¼š

### ğŸ¯ æ ¸å¿ƒæ¦‚å¿µå›é¡§

1. **REST æ¶æ§‹ç´„æŸ**
   - å®¢æˆ¶ç«¯-ä¼ºæœå™¨åˆ†é›¢
   - ç„¡ç‹€æ…‹é€šä¿¡
   - çµ±ä¸€ä»‹é¢è¨­è¨ˆ
   - åˆ†å±¤ç³»çµ±æ¶æ§‹

2. **HTTP èªç¾©åŒ–ä½¿ç”¨**
   - GETï¼šå®‰å…¨ä¸”å†ªç­‰çš„è³‡æºç²å–
   - POSTï¼šéå†ªç­‰çš„è³‡æºå»ºç«‹
   - PUTï¼šå†ªç­‰çš„å®Œæ•´è³‡æºæ›´æ–°
   - DELETEï¼šå†ªç­‰çš„è³‡æºåˆªé™¤

3. **URL è¨­è¨ˆåŸå‰‡**
   - ä½¿ç”¨åè©è¡¨ç¤ºè³‡æº
   - æ¡ç”¨éšå±¤çµæ§‹åæ˜ é—œä¿‚
   - çµ±ä¸€å‘½åè¦ç¯„
   - æ”¯æ´æŸ¥è©¢åƒæ•¸ç¯©é¸

### ğŸ’¡ å¯¦è¸æŠ€å·§ç¸½çµ

| æŠ€å·§é¡åˆ¥ | é—œéµè¦é» | å¯¦éš›æ•ˆç›Š |
|---------|---------|---------|
| **è³‡æºè¨­è¨ˆ** | åè©å°å‘çš„ URL çµæ§‹ | æå‡ API å¯ç†è§£æ€§ |
| **HTTP èªç¾©** | æ­£ç¢ºä½¿ç”¨ HTTP æ–¹æ³•å’Œç‹€æ…‹ç¢¼ | ç¬¦åˆ Web æ¨™æº–ï¼Œæå‡äº’æ“ä½œæ€§ |
| **éŒ¯èª¤è™•ç†** | çµ±ä¸€çš„ç•°å¸¸è™•ç†æ©Ÿåˆ¶ | ç°¡åŒ–å®¢æˆ¶ç«¯éŒ¯èª¤è™•ç†é‚è¼¯ |
| **ç‰ˆæœ¬æ§åˆ¶** | æ˜ç¢ºçš„ç‰ˆæœ¬æ¼”é€²ç­–ç•¥ | æ”¯æ´ API æŒçºŒæ¼”é€² |
| **æ•ˆèƒ½å„ªåŒ–** | é©ç•¶çš„å¿«å–æ§åˆ¶ç­–ç•¥ | æå‡ç³»çµ±æ•ˆèƒ½å’Œä½¿ç”¨è€…é«”é©— |

### âœ… é–‹ç™¼æª¢æŸ¥æ¸…å–®

åœ¨å¯¦éš›é–‹ç™¼ä¸­ï¼Œè«‹ç¢ºä¿ï¼š

- [ ] **URL è¨­è¨ˆ**ï¼šä½¿ç”¨è³‡æºå°å‘çš„å‘½åè¦ç¯„
- [ ] **HTTP æ–¹æ³•**ï¼šæ­£ç¢ºé¸æ“‡å’Œä½¿ç”¨ HTTP å‹•è©
- [ ] **ç‹€æ…‹ç¢¼**ï¼šå›å‚³èªç¾©åŒ–çš„ HTTP ç‹€æ…‹ç¢¼
- [ ] **éŒ¯èª¤è™•ç†**ï¼šå¯¦ç¾çµ±ä¸€çš„ç•°å¸¸è™•ç†æ©Ÿåˆ¶
- [ ] **ç‰ˆæœ¬æ§åˆ¶**ï¼šåˆ¶å®šæ˜ç¢ºçš„ç‰ˆæœ¬ç®¡ç†ç­–ç•¥
- [ ] **å¿«å–ç­–ç•¥**ï¼šå¯¦ç¾é©ç•¶çš„å¿«å–æ§åˆ¶æ©Ÿåˆ¶

### ğŸš€ ä¸‹ä¸€æ­¥å­¸ç¿’æ–¹å‘

æŒæ¡äº† RESTful API è¨­è¨ˆå¾Œï¼Œå»ºè­°æ‚¨ç¹¼çºŒå­¸ç¿’ï¼š

1. **API å®‰å…¨æ€§**ï¼šå¯¦ç¾èªè­‰æˆæ¬Šå’Œè³‡æ–™ä¿è­·
2. **API æ–‡ä»¶åŒ–**ï¼šä½¿ç”¨ OpenAPI/Swagger ç”Ÿæˆæ–‡ä»¶
3. **API æ¸¬è©¦**ï¼šå»ºç«‹å®Œæ•´çš„ API æ¸¬è©¦ç­–ç•¥
4. **å¾®æœå‹™æ¶æ§‹**ï¼šåœ¨åˆ†æ•£å¼ç³»çµ±ä¸­æ‡‰ç”¨ RESTful è¨­è¨ˆ

ğŸ’¡ **å­¸ç¿’æç¤º**ï¼šRESTful API è¨­è¨ˆæ˜¯ç¾ä»£ Web é–‹ç™¼çš„åŸºç¤æŠ€èƒ½ï¼Œè‰¯å¥½çš„è¨­è¨ˆä¸åƒ…æå‡é–‹ç™¼æ•ˆç‡ï¼Œæ›´èƒ½æ”¹å–„ç³»çµ±çš„å¯ç¶­è­·æ€§å’Œæ“´å±•æ€§ã€‚

---

**æ­å–œæ‚¨å®Œæˆæœ¬ç« å­¸ç¿’ï¼** ğŸ‰

æ‚¨ç¾åœ¨å·²ç¶“æŒæ¡äº† RESTful API è¨­è¨ˆèˆ‡å¯¦è¸çš„æ ¸å¿ƒæŠ€èƒ½ã€‚é€™äº›çŸ¥è­˜å°‡ç‚ºæ‚¨çš„ Web API é–‹ç™¼å¥ å®šå …å¯¦çš„åŸºç¤ã€‚åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘å€‘å°‡æ¢è¨ Controller çš„è·¯å¾‘åŒ¹é…èˆ‡æ–¹æ³•è¨»è§£ï¼Œé€²ä¸€æ­¥æå‡æ‚¨çš„ Spring MVC é–‹ç™¼èƒ½åŠ›ã€‚