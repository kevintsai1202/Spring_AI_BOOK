# 使用 Spring AI 打造企業 RAG 知識庫

## 前言

### Java 在 AI 看到了春天

![Spring AI](https://ithelp.ithome.com.tw/upload/images/20240810/20161290cAV3EcKpVN.jpg)

Spring AI 在2024年2月推出了0.8版本，經過一年多的快速迭代，於2025年5月20日正式發佈了**1.0.0 GA穩定版**。從早期的 Milestone 版本（1.0.0-M1到M8）到 RC1 版本，最終迎來了正式的 GA 版本，如同 AI 的發展一樣迅速。實際使用後，會發現它與 **LangChain4j** 有幾分相似。讓我們看看 Spring AI 官網是如何詮釋：

> Spring AI 創建的目的在簡化開發 AI 功能的應用程式，同時避免不必要的複雜性。專案汲取了 LangChain 和 LlamaIndex 等知名 Python 專案的靈感，但 Spring AI 並不是這些專案的直接移植。我們相信，下一波生成式人工智慧應用程式不僅適用於 Python 開發人員，還將廣泛適用於許多程式設計語言。
>
> Spring AI 的核心在於解決 AI 整合的根本挑戰，即將 **企業數據** / **API** / **AI** 串聯起來。
>
> ![Spring AI 架構](https://ithelp.ithome.com.tw/upload/images/20240801/20161290yEyOlVWozQ.png)
>
> (以上由 [Spring AI官網](https://docs.spring.io/spring-ai/reference/index.html) 翻譯而來)

原來 Spring AI 是跟 LangChain 致敬，Spring 框架能發展到這麼龐大，最關鍵的就是其整合以及簡化的能力，面對這麼龐大的模型以及種類，雖然跟 Python 比起來起步較慢，不過能與 Spring 其他框架整合在一起，讓憋了好久的 Java 開發人員也能大展身手了。

### 為什麼要先學習 Spring Boot 和 Spring MVC？

歡迎來到 Spring AI 的學習之旅！在正式進入 Spring AI 的精彩世界之前，您可能會疑問：「為什麼需要先了解 Spring Boot 和 Spring MVC？」

#### Spring AI 與 Spring 生態系統的關係

雖然 **Spring AI** 是專門針對 AI 應用開發所設計的現代化框架，但它並非憑空而生，而是深深植根於 Spring 生態系統之中：

- 🏗️ **架構基礎**：Spring AI 完全建構在 Spring Boot 之上，繼承了其所有核心特性和設計理念
- 🔧 **配置方式**：採用相同的自動配置（Auto Configuration）和「約定優於配置」（Convention over Configuration）原則
- 📦 **依賴管理**：透過 Spring Boot Starter 的方式提供各種 AI 功能模組
- 🚀 **部署模式**：使用 Spring Boot 的內嵌伺服器和 JAR 打包方式進行部署
- 🔄 **生命週期管理**：依賴 Spring 的 IoC 容器進行 Bean 管理和依賴注入

#### API 開發在 Spring AI 中的核心地位

更重要的是，Spring AI 的許多核心功能都需要透過 **API** 來實現和整合：

- 🔗 **Function Calling**：AI 模型需要透過 API 呼叫外部工具和服務，實現與真實世界的互動
- 🖥️ **MCP Server**：模型控制協議（Model Context Protocol）伺服器需要 HTTP 端點來處理各種請求
- 🌐 **系統整合**：企業級 AI 應用通常需要與現有系統透過 API 進行整合
- 📊 **資料交換**：RAG（檢索增強生成）系統需要透過 API 獲取和處理各種資料來源
- 🔄 **即時互動**：聊天機器人和對話系統需要透過 WebSocket 或 Server-Sent Events 提供即時回應

#### Java 兩大 AI 框架比較 (2025年更新版)

既然是參考 LangChain 的概念，Java 開發人員該使用 LangChain4j 還是 Spring AI 做為開發框架？以下是詳細比較：

|  | Spring AI | LangChain4j |
| --- | --- | --- |
| **推出時間** | 2024年二月推出0.8版，2025年5月正式發佈1.0.0 GA | 2023年六月推出0.1版 |
| **適用Java版本** | JDK 17+ | JDK 8+ |
| **當前版本** | 1.0.3 GA (穩定版) | 1.7.1，已有80+版本 |
| **功能性** | 整合性更佳，支援20+個AI模型，統一的ChatClient API，支援多模態輸入輸出 | 個別功能較強，部分功能針對不同大語言模型特性開發 |
| **整合性** | 原生支援Spring Boot 3.4.x，完美的自動配置和依賴注入 | 雖然也能在Spring中使用，但整合性不如Spring原生 |
| **核心特色** | ChatClient API、Advisor攔截器鏈、強化版LLM能力 | 豐富的工具生態、活躍的社群支援 |
| **向量資料庫支援** | 支援12+種向量資料庫（Chroma、PGVector、Redis等） | 支援多種向量資料庫 |
| **相關資料** | 官方文檔完整，1.0 GA版本文檔齊全 | 發展時間較長，社群資源豐富 |

#### Spring AI 1.0 GA 的重大特色

**ChatClient - 核心API**
Spring AI 的核心是 ChatClient，這是一個可攜式且易於使用的 API，是與 AI 模型互動的主要介面。Spring AI 的 ChatClient 支援調用 20 個 AI 模型，從 Anthropic 到智譜AI。它支援多模態輸入和輸出（當底層模型支援時）以及結構化回應。

**增強版LLM功能**
增強版LLM的概念是在基本模型互動的基礎上增加功能，如資料檢索、對話記憶和工具調用。這些功能讓您可以直接將自己的資料和外部API帶入模型的推理過程中。

**Advisor API**
Spring AI ChatClient 的一個關鍵特色是 Advisor API。這是一個攔截器鏈，允許您透過注入檢索到的資料和對話記憶來修改傳入的提示詞。

#### AI框架挑選建議 (2025年更新)

- 如果公司還在使用 Java 8，LangChain4j 是不二選擇
- 如果公司已使用 Spring Boot 3.4+ 以上，當然就直接使用 Spring AI 1.0 GA
- 如果使用 Java 17+ 卻沒使用 Spring Boot 框架呢？建議你趕快學 Spring Boot
- 想嘗試最新功能或是單純開發 AI 的程式可使用 LangChain4j，若要將 AI 結合企業內部其他資訊系統則建議使用 Spring AI，因為開發企業使用的程式往往需要更高的穩定性以及精準的內容
- **2025年重點**：Spring AI 1.0 GA 已經達到生產就緒標準，適合企業級應用開發

#### 本書的學習架構

基於以上考量，本書採用循序漸進的學習方式：

**第一部分：Spring Boot 基礎**
- 建立堅實的 Spring Boot 開發基礎
- 掌握現代 Java 企業級開發的核心技能
- 理解 Spring AI 所依賴的核心框架特性

**第二部分：Spring MVC 與 API 開發**
- 學習如何建立和配置 RESTful API
- 掌握請求處理、回應格式化和錯誤處理
- 熟悉企業級 API 開發的最佳實踐
- 為 Spring AI 的 Function Calling 和 MCP Server 奠定基礎

**第三部分：生產級 API 開發實踐**
- 深入學習資料驗證、錯誤處理和檔案上傳
- 掌握 API 測試和文件自動生成
- 建立完整的生產級 API 開發技能

**第四部分：Spring AI 實戰**
- 在前三部分的基礎上，深入學習 Spring AI
- 建構實際的企業級 RAG 知識庫系統
- 整合各種 AI 服務和工具

#### 學習建議

> 💡 **給有經驗的開發者**：如果您對 Spring Boot 和 Spring MVC 已經非常熟悉，可以快速瀏覽前三部分，或直接跳至第四部份開始學習 Spring AI。

> 🎯 **給初學者**：強烈建議按照順序學習。紮實的基礎將讓您在後續的 Spring AI 學習中事半功倍，更能理解框架設計的精妙之處。

> 🚀 **給企業開發者**：本書不僅教授技術實現，更注重企業級應用的實際需求，包括安全性、效能優化、監控和維護等方面。

讓我們開始這趟精彩的學習之旅，從 Spring Boot 的基礎開始，一步步建構您的 AI 應用開發能力！

---

# 內容

**第一章：Spring Boot 基礎**
- 1.1 Spring Boot 快速入門
- 1.2 專案架構與配置
- 1.3 核心註解與依賴注入
- 1.4 第一個 Spring Boot 應用

**第二章：Spring MVC & RESTful API**
- 2.1 Spring MVC API 開發基礎
- 2.2 RESTful API 設計與實踐
- 2.3 API 請求與回應處理

**第三章：生產級 API 開發實踐**
- 3.1 資料驗證與錯誤處理
- 3.2 檔案處理與多媒體支援
- 3.3 API 測試與文件化

**第四章：認識 Spring AI**
- 4.1 取得 AI 入門鑰匙 API key
- 4.2 Hello AI World
- 4.3 如何像 ChatGPT 產生流式輸出
- 4.4 深入瞭解 ChatModel
- 4.5 前端該如何處理流式輸出

**第五章：個性化 ChatBot**
- 5.1 懶得打字問 AI？用提示詞範本吧
- 5.2 如何跟 ChatGPT 一樣處理多模態資料
- 5.3 透過 Spring AI 生成美女圖
- 5.4 做一個字幕產生器
- 5.5 聲優太花錢？找 AI 幫你配音
- 5.6 Function Calling (上)-請支援 AI
- 5.7 Function Calling (中)-讓 AI 讀取企業資訊
- 5.8 Function Calling (下)-最終組合技
- 5.9 取得實際氣象資訊
- 5.10 結構化資料轉換器
- 5.11 ChatClient vs ChatModel

**第六章：讓 ChatBot 不再金魚腦**
- 6.1 魔鏡~誰是 Spring AI 的專家?
- 6.2 讓 AI 記住對話
- 6.3 Spring AI 官方記憶
- 6.4 Spring AI 的鏈式增強器
- 6.5 自行開發 Spring AI 插件
- 6.6 安裝 Neo4j 向量資料庫 (使用 docker)
- 6.7 使用向量資料庫作為對話的長久記憶

**第七章：讓企業不再卻步的技術-RAG**
- 7.1 RAG 流程詳解
- 7.2 如何將內容向量化
- 7.3 ETL (上) - RAG 的知識來源
- 7.4 ETL (中) - 擷取進階文件類型
- 7.5 ETL (下) - 給向量資料加上 Buff
- 7.6 企業 RAG 真正的資料來源
- 7.7 RAG 的最後一哩路

**第八章：提升 RAG 性能-Advanced RAG**
- 8.1 簡述 Advanced RAG
- 8.2 提高 RAG 準確率從 Embedding 換起
- 8.3 在 Spring AI 實作 Re-ranking
- 8.4 內容審核與評估測試

**第九章：整合 MCP (模型上下文協議)**
- 9.1 甚麼是 MCP？
- 9.2 引入 Spring MCP
- 9.3 在 Spring AI 程式中使用 MCP 工具
- 9.4 開發 MCP Server 工具