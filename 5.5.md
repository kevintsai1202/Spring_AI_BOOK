# 5.5 è²å„ªå¤ªèŠ±éŒ¢ï¼Ÿæ‰¾ AI å¹«ä½ é…éŸ³

> **æœ¬ç« é‡é»**ï¼šå­¸ç¿’ä½¿ç”¨ Spring AI çš„æ–‡å­—è½‰èªéŸ³åŠŸèƒ½ï¼Œå»ºç«‹å®Œæ•´çš„ AI é…éŸ³ç³»çµ±ï¼ŒæŒæ¡èªéŸ³åˆæˆå’ŒéŸ³è¨Šè™•ç†æŠ€è¡“ï¼Œç‚ºå¤šåª’é«”å…§å®¹å‰µä½œæä¾›å°ˆæ¥­çš„èªéŸ³è§£æ±ºæ–¹æ¡ˆã€‚

## ğŸ¯ å­¸ç¿’ç›®æ¨™

å®Œæˆæœ¬ç« å­¸ç¿’å¾Œï¼Œæ‚¨å°‡èƒ½å¤ ï¼š

- ğŸ¯ **ç†è§£æ–‡å­—è½‰èªéŸ³æŠ€è¡“**ï¼šæŒæ¡ TTS æŠ€è¡“çš„å·¥ä½œåŸç†å’Œæ‡‰ç”¨å ´æ™¯
- ğŸ¯ **å¯¦ç¾å¤šç¨®èªéŸ³é¢¨æ ¼**ï¼šæ”¯æ´ä¸åŒè²éŸ³ã€èªé€Ÿã€èªèª¿çš„èªéŸ³ç”Ÿæˆ
- ğŸ¯ **å»ºç«‹é…éŸ³ç®¡ç†ç³»çµ±**ï¼šå®Œæ•´çš„èªéŸ³ç”Ÿæˆã€å„²å­˜å’Œä¸‹è¼‰åŠŸèƒ½
- ğŸ¯ **å„ªåŒ–èªéŸ³å“è³ª**ï¼šæŒæ¡èªéŸ³åƒæ•¸èª¿æ•´å’Œå“è³ªæ§åˆ¶æŠ€å·§
- ğŸ¯ **ä¼æ¥­ç´šæ‡‰ç”¨è¨­è¨ˆ**ï¼šå»ºç«‹å¯å•†ç”¨çš„ AI é…éŸ³æœå‹™å¹³å°

---

## 5.5.1 AI é…éŸ³æŠ€è¡“é©å‘½

### AI æœ‰ ABC è…”èª¿

![AI é…éŸ³](https://ithelp.ithome.com.tw/upload/images/20240810/20161290YGtkKt0BkG.jpg)

æ˜¨å¤©æ•™å¤§å®¶ä¸Šå­—å¹•ï¼Œä»Šå¤©å‰‡æ˜¯åéä¾†ï¼Œçµ¦æ–‡å­—è®“ AI å¹«ä½ é…éŸ³ï¼

æ¯”èµ·ä»¥å‰æ–‡å­—è½‰è²éŸ³çš„è»Ÿé«”ï¼ŒAI çš„è²éŸ³æ›´ç‚ºè‡ªç„¶ï¼Œè§’è‰²è·Ÿé€Ÿåº¦ä¹Ÿéƒ½èƒ½èª¿æ•´ï¼Œè®“æˆ‘å€‘çœ‹çœ‹å¦‚ä½•æ“ä½œå§ã€‚

### AI é…éŸ³ vs å‚³çµ±é…éŸ³å°æ¯”

| æ¯”è¼ƒé …ç›® | AI é…éŸ³ | å‚³çµ±é…éŸ³ | å„ªå‹¢åˆ†æ |
|----------|---------|----------|----------|
| **æˆæœ¬** | $0.015/1Kå­—å…ƒ | $50-200/åˆ†é˜ | AI ç¯€çœ 95%+ æˆæœ¬ |
| **é€Ÿåº¦** | å³æ™‚ç”Ÿæˆ | æ•¸å¤©è£½ä½œ | AI å¿« 100+ å€ |
| **ä¸€è‡´æ€§** | å®Œå…¨ä¸€è‡´ | äººç‚ºè®ŠåŒ– | AI å“è³ªç©©å®š |
| **å¯èª¿æ€§** | éš¨æ™‚èª¿æ•´ | é‡æ–°éŒ„è£½ | AI å½ˆæ€§æ¥µé«˜ |
| **èªè¨€æ”¯æ´** | å¤šèªè¨€ | é™åˆ¶è¼ƒå¤š | AI æ”¯æ´æ›´å»£ |
| **æƒ…æ„Ÿè¡¨é”** | æŒçºŒæ”¹å–„ | è‡ªç„¶è±å¯Œ | å‚³çµ±ä»æœ‰å„ªå‹¢ |

### AI é…éŸ³çš„æ ¸å¿ƒåƒ¹å€¼

**1. æˆæœ¬æ•ˆç›Šé¡¯è‘—**
- ğŸ’° **å¤§å¹…é™ä½æˆæœ¬**ï¼šç›¸æ¯”å°ˆæ¥­é…éŸ³å“¡ç¯€çœ 95% ä»¥ä¸Šè²»ç”¨
- â° **å³æ™‚ç”Ÿæˆ**ï¼šå¾æ–‡å­—åˆ°èªéŸ³å¹¾ç§’é˜å®Œæˆ
- ğŸ”„ **ç„¡é™ä¿®æ”¹**ï¼šéš¨æ™‚èª¿æ•´å…§å®¹ç„¡é¡å¤–æˆæœ¬
- ğŸ“ˆ **è¦æ¨¡åŒ–ç”Ÿç”¢**ï¼šæ‰¹æ¬¡è™•ç†å¤§é‡å…§å®¹

**2. å“è³ªæŒçºŒæå‡**
- ğŸ­ **å¤šç¨®è²éŸ³é¸æ“‡**ï¼šç”·è²ã€å¥³è²ã€ä¸åŒå¹´é½¡å’Œé¢¨æ ¼
- ğŸµ **èªèª¿æ§åˆ¶**ï¼šèª¿æ•´èªé€Ÿã€éŸ³èª¿ã€æƒ…æ„Ÿè¡¨é”
- ğŸŒ **å¤šèªè¨€æ”¯æ´**ï¼šæ”¯æ´æ•¸åç¨®èªè¨€å’Œæ–¹è¨€
- ğŸ”Š **é«˜å“è³ªéŸ³è¨Š**ï¼šCD ç´šéŸ³è³ªè¼¸å‡º

**3. æ‡‰ç”¨å ´æ™¯å»£æ³›**
- ğŸ“š **æ•™è‚²åŸ¹è¨“**ï¼šèª²ç¨‹è¬›è§£ã€æœ‰è²æ›¸è£½ä½œ
- ğŸ¬ **å½±ç‰‡è£½ä½œ**ï¼šæ—ç™½é…éŸ³ã€è§’è‰²å°è©±
- ğŸ“¢ **å»£å‘Šè¡ŒéŠ·**ï¼šå»£å‘Šé…éŸ³ã€ç”¢å“ä»‹ç´¹
- ğŸ¤– **æ™ºèƒ½åŠ©æ‰‹**ï¼šèªéŸ³å›æ‡‰ã€å®¢æœç³»çµ±
- ğŸ® **éŠæˆ²é–‹ç™¼**ï¼šè§’è‰²é…éŸ³ã€åŠ‡æƒ…å°è©±

---

## 5.5.2 Spring AI èªéŸ³ç”Ÿæˆæœå‹™

### ä¸»è¦æ”¯æ´çš„èªéŸ³æœå‹™

| æœå‹™å•† | æ¨¡å‹ | èªéŸ³é¸é … | å“è³ª | æˆæœ¬ | æ¨è–¦å ´æ™¯ |
|--------|------|----------|------|------|----------|
| **OpenAI** | TTS-1, TTS-1-HD | 6ç¨®è²éŸ³ | æ¥µé«˜ | ä¸­ | é€šç”¨é…éŸ³ã€å°ˆæ¥­è£½ä½œ |
| **Azure OpenAI** | TTS-1, TTS-1-HD | 6ç¨®è²éŸ³ | æ¥µé«˜ | ä¸­ | ä¼æ¥­ç´šæ‡‰ç”¨ |
| **ElevenLabs** | å¤šç¨®æ¨¡å‹ | è‡ªè¨‚è²éŸ³ | æ¥µé«˜ | é«˜ | é«˜ç«¯é…éŸ³ã€è²éŸ³å…‹éš† |
| **Google Cloud** | WaveNet | å¤šç¨®è²éŸ³ | é«˜ | ä½ | å¤§é‡ç”Ÿæˆã€æˆæœ¬æ•æ„Ÿ |

### OpenAI TTS èªéŸ³é¸é …è©³è§£

æ–‡å­—è½‰èªéŸ³ä¹Ÿæ˜¯åŠƒåˆ†åœ¨ **Audio Model** çš„éƒ¨åˆ†ï¼ŒSpring AI ç›®å‰ä¸»è¦æ”¯æ´ OpenAI å’Œ Azure OpenAIï¼š

![Spring AI èªéŸ³æ”¯æ´](https://ithelp.ithome.com.tw/upload/images/20240809/20161290wi54q7gekg.png)

**OpenAI TTS å¯ç”¨è²éŸ³**ï¼š

| è²éŸ³åç¨± | ç‰¹è‰² | é©ç”¨å ´æ™¯ | èªè¨€æ”¯æ´ |
|----------|------|----------|----------|
| **alloy** | ä¸­æ€§ã€æ¸…æ™° | æ–°èæ’­å ±ã€æ•™å­¸ | å¤šèªè¨€ |
| **echo** | ç”·æ€§ã€æ²‰ç©© | å•†æ¥­ç°¡å ±ã€ç´€éŒ„ç‰‡ | å¤šèªè¨€ |
| **fable** | å¥³æ€§ã€æº«æš– | æ•…äº‹è¬›è¿°ã€å®¢æœ | å¤šèªè¨€ |
| **onyx** | ç”·æ€§ã€æ·±æ²‰ | å»£å‘Šé…éŸ³ã€æ—ç™½ | å¤šèªè¨€ |
| **nova** | å¥³æ€§ã€æ´»æ½‘ | å»£å‘Šã€å¨›æ¨‚å…§å®¹ | å¤šèªè¨€ |
| **shimmer** | å¥³æ€§ã€æŸ”å’Œ | å†¥æƒ³ã€æ”¾é¬†å…§å®¹ | å¤šèªè¨€ |

**æ¨¡å‹å·®ç•°**ï¼š
- **TTS-1**ï¼šæ¨™æº–å“è³ªï¼Œé€Ÿåº¦å¿«ï¼Œæˆæœ¬ä½
- **TTS-1-HD**ï¼šé«˜å“è³ªï¼ŒéŸ³è³ªæ›´ä½³ï¼Œæˆæœ¬ç¨é«˜

---

## 5.5.3 å°ˆæ¡ˆå»ºç«‹èˆ‡é…ç½®

### Maven ä¾è³´é…ç½®

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0">
    <modelVersion>4.0.0</modelVersion>
    
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.3.0</version>
        <relativePath/>
    </parent>
    
    <groupId>com.example</groupId>
    <artifactId>ai-voice-generator</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>ai-voice-generator</name>
    <description>AI-powered voice generation using Spring AI</description>
    
    <properties>
        <java.version>17</java.version>
    </properties>
    
    <!-- ä½¿ç”¨ Spring AI BOM ç®¡ç†ç‰ˆæœ¬ -->
    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>org.springframework.ai</groupId>
                <artifactId>spring-ai-bom</artifactId>
                <version>1.0.0</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
        </dependencies>
    </dependencyManagement>
    
    <dependencies>
        <!-- Spring AI OpenAI Starter -->
        <dependency>
            <groupId>org.springframework.ai</groupId>
            <artifactId>spring-ai-starter-model-openai</artifactId>
        </dependency>
        
        <!-- Spring Boot Web -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        
        <!-- Spring Boot Validation -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-validation</artifactId>
        </dependency>
        
        <!-- Audio Processing -->
        <dependency>
            <groupId>org.apache.tika</groupId>
            <artifactId>tika-core</artifactId>
            <version>2.9.2</version>
        </dependency>
        
        <!-- File Processing -->
        <dependency>
            <groupId>commons-io</groupId>
            <artifactId>commons-io</artifactId>
            <version>2.15.1</version>
        </dependency>
        
        <!-- Lombok -->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>
        
        <!-- Test Dependencies -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>
</project>
```

### æ‡‰ç”¨ç¨‹å¼é…ç½®

```yaml
# application.yml
spring:
  application:
    name: ai-voice-generator
  ai:
    model:
      audio:
        speech: openai  # å•Ÿç”¨ OpenAI éŸ³è¨ŠèªéŸ³æ¨¡å‹
    openai:
      api-key: ${OPENAI_API_KEY}
      base-url: https://api.openai.com
      audio:
        speech:
          options:
            model: tts-1-hd  # é«˜å“è³ªæ¨¡å‹
            voice: alloy     # é è¨­è²éŸ³
            response-format: mp3  # éŸ³è¨Šæ ¼å¼
            speed: 1.0       # èªé€Ÿï¼ˆ0.25-4.0ï¼‰

# æ‡‰ç”¨ç¨‹å¼é…ç½®
app:
  voice:
    output-directory: ./generated-voices
    supported-formats: ["mp3", "opus", "aac", "flac"]
    max-text-length: 4096  # OpenAI TTS é™åˆ¶
    default-voice: alloy
    default-model: tts-1-hd

# ä¼ºæœå™¨é…ç½®
server:
  port: 8080
  servlet:
    context-path: /api

# æ—¥èªŒé…ç½®
logging:
  level:
    org.springframework.ai: DEBUG
    com.example: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
```

---

## 5.5.4 åŸºç¤èªéŸ³ç”ŸæˆåŠŸèƒ½

### èªéŸ³ç”Ÿæˆæ§åˆ¶å™¨

```java
package com.example.controller;

import com.example.dto.VoiceRequest;
import com.example.dto.VoiceResponse;
import com.example.service.VoiceGenerationService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.core.io.ByteArrayResource;
import org.springframework.core.io.Resource;
import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import javax.validation.Valid;
import java.nio.charset.StandardCharsets;
import java.util.List;

@RestController
@RequestMapping("/voice")
@RequiredArgsConstructor
@Slf4j
public class VoiceController {
    
    private final VoiceGenerationService voiceService;
    
    /**
     * åŸºç¤èªéŸ³ç”Ÿæˆ
     * @param text è¦è½‰æ›çš„æ–‡å­—
     * @param voice è²éŸ³é¸æ“‡ï¼ˆå¯é¸ï¼‰
     * @param speed èªé€Ÿï¼ˆå¯é¸ï¼‰
     * @return éŸ³è¨Šæª”æ¡ˆ
     */
    @GetMapping("/generate")
    public ResponseEntity<Resource> generateVoice(
            @RequestParam String text,
            @RequestParam(value = "voice", defaultValue = "alloy") String voice,
            @RequestParam(value = "speed", defaultValue = "1.0") Float speed) {
        
        try {
            // é©—è­‰æ–‡å­—é•·åº¦
            if (text.length() > 4096) {
                throw new IllegalArgumentException("æ–‡å­—é•·åº¦ä¸èƒ½è¶…é 4096 å­—å…ƒ");
            }
            
            log.info("é–‹å§‹ç”ŸæˆèªéŸ³ï¼šæ–‡å­—é•·åº¦={}, è²éŸ³={}, èªé€Ÿ={}", 
                    text.length(), voice, speed);
            
            // ç”ŸæˆèªéŸ³
            byte[] audioData = voiceService.generateVoice(text, voice, speed);
            
            // å»ºç«‹å›æ‡‰
            ByteArrayResource resource = new ByteArrayResource(audioData);
            
            String fileName = String.format("é…éŸ³_%s_%s.mp3", 
                    voice, 
                    System.currentTimeMillis());
            
            return ResponseEntity.ok()
                    .header(HttpHeaders.CONTENT_DISPOSITION,
                            "attachment; filename=\"" + fileName + "\"")
                    .contentType(MediaType.parseMediaType("audio/mpeg"))
                    .contentLength(audioData.length)
                    .body(resource);
            
        } catch (Exception e) {
            log.error("èªéŸ³ç”Ÿæˆå¤±æ•—ï¼š{}", text, e);
            
            String errorMessage = "èªéŸ³ç”Ÿæˆå¤±æ•—: " + e.getMessage();
            ByteArrayResource errorResource = new ByteArrayResource(
                    errorMessage.getBytes(StandardCharsets.UTF_8)
            );
            
            return ResponseEntity.badRequest()
                    .contentType(MediaType.TEXT_PLAIN)
                    .body(errorResource);
        }
    }
    
    /**
     * é€²éšèªéŸ³ç”Ÿæˆï¼ˆJSON APIï¼‰
     * @param request èªéŸ³ç”Ÿæˆè«‹æ±‚
     * @return JSON æ ¼å¼å›æ‡‰
     */
    @PostMapping("/generate-advanced")
    public ResponseEntity<VoiceResponse> generateAdvancedVoice(
            @RequestBody @Valid VoiceRequest request) {
        
        try {
            log.info("é€²éšèªéŸ³ç”Ÿæˆè«‹æ±‚ï¼š{}", request);
            
            VoiceResponse response = voiceService.generateAdvancedVoice(request);
            
            return ResponseEntity.ok(response);
            
        } catch (Exception e) {
            log.error("é€²éšèªéŸ³ç”Ÿæˆå¤±æ•—", e);
            
            VoiceResponse errorResponse = VoiceResponse.builder()
                    .success(false)
                    .error(e.getMessage())
                    .text(request.getText())
                    .build();
            
            return ResponseEntity.badRequest().body(errorResponse);
        }
    }
    
    /**
     * æ‰¹æ¬¡èªéŸ³ç”Ÿæˆ
     * @param requests å¤šå€‹èªéŸ³ç”Ÿæˆè«‹æ±‚
     * @return æ‰¹æ¬¡è™•ç†çµæœ
     */
    @PostMapping("/batch-generate")
    public ResponseEntity<List<VoiceResponse>> batchGenerateVoice(
            @RequestBody @Valid List<VoiceRequest> requests) {
        
        try {
            log.info("æ‰¹æ¬¡èªéŸ³ç”Ÿæˆï¼š{} å€‹è«‹æ±‚", requests.size());
            
            List<VoiceResponse> responses = voiceService.batchGenerateVoice(requests);
            
            return ResponseEntity.ok(responses);
            
        } catch (Exception e) {
            log.error("æ‰¹æ¬¡èªéŸ³ç”Ÿæˆå¤±æ•—", e);
            return ResponseEntity.badRequest().build();
        }
    }
    
    /**
     * ç²å–å¯ç”¨è²éŸ³åˆ—è¡¨
     * @return è²éŸ³é¸é …
     */
    @GetMapping("/voices")
    public ResponseEntity<List<VoiceOption>> getAvailableVoices() {
        List<VoiceOption> voices = voiceService.getAvailableVoices();
        return ResponseEntity.ok(voices);
    }
    
    /**
     * èªéŸ³é è¦½ï¼ˆçŸ­æ–‡å­—ï¼‰
     * @param voice è²éŸ³é¸æ“‡
     * @return é è¦½éŸ³è¨Š
     */
    @GetMapping("/preview/{voice}")
    public ResponseEntity<Resource> previewVoice(@PathVariable String voice) {
        try {
            String previewText = "æ‚¨å¥½ï¼Œé€™æ˜¯ " + voice + " è²éŸ³çš„é è¦½ã€‚";
            byte[] audioData = voiceService.generateVoice(previewText, voice, 1.0f);
            
            ByteArrayResource resource = new ByteArrayResource(audioData);
            
            return ResponseEntity.ok()
                    .contentType(MediaType.parseMediaType("audio/mpeg"))
                    .body(resource);
            
        } catch (Exception e) {
            log.error("èªéŸ³é è¦½å¤±æ•—ï¼š{}", voice, e);
            return ResponseEntity.badRequest().build();
        }
    }
}
```

### èªéŸ³ç”Ÿæˆæœå‹™

```java
package com.example.service;

import com.example.dto.VoiceRequest;
import com.example.dto.VoiceResponse;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.ai.audio.speech.SpeechModel;
import org.springframework.ai.audio.speech.SpeechPrompt;
import org.springframework.ai.audio.speech.SpeechResponse;
import org.springframework.ai.openai.OpenAiAudioSpeechOptions;
import org.springframework.stereotype.Service;

import java.time.LocalDateTime;
import java.util.List;
import java.util.concurrent.CompletableFuture;
import java.util.stream.Collectors;

@Service
@RequiredArgsConstructor
@Slf4j
public class VoiceGenerationService {
    
    private final SpeechModel speechModel;
    private final VoiceStorageService storageService;
    
    /**
     * åŸºç¤èªéŸ³ç”Ÿæˆ
     * @param text æ–‡å­—å…§å®¹
     * @param voice è²éŸ³é¸æ“‡
     * @param speed èªé€Ÿ
     * @return éŸ³è¨Šè³‡æ–™
     */
    public byte[] generateVoice(String text, String voice, Float speed) {
        try {
            // å»ºç«‹èªéŸ³é¸é …
            OpenAiAudioSpeechOptions options = OpenAiAudioSpeechOptions.builder()
                    .model("tts-1-hd")
                    .voice(OpenAiAudioApi.SpeechRequest.Voice.valueOf(voice.toUpperCase()))
                    .responseFormat(OpenAiAudioApi.SpeechRequest.AudioResponseFormat.MP3)
                    .speed(speed)
                    .build();
            
            // å»ºç«‹èªéŸ³è«‹æ±‚
            SpeechPrompt speechPrompt = new SpeechPrompt(text, options);
            
            // åŸ·è¡ŒèªéŸ³ç”Ÿæˆ
            SpeechResponse response = speechModel.call(speechPrompt);
            
            return response.getResult().getOutput();
            
        } catch (Exception e) {
            log.error("èªéŸ³ç”Ÿæˆå¤±æ•—ï¼š{}", text, e);
            throw new RuntimeException("èªéŸ³ç”Ÿæˆå¤±æ•—ï¼š" + e.getMessage(), e);
        }
    }
    
    /**
     * é€²éšèªéŸ³ç”Ÿæˆ
     * @param request èªéŸ³ç”Ÿæˆè«‹æ±‚
     * @return èªéŸ³å›æ‡‰
     */
    public VoiceResponse generateAdvancedVoice(VoiceRequest request) {
        try {
            // å»ºç«‹é€²éšèªéŸ³é¸é …
            OpenAiAudioSpeechOptions options = OpenAiAudioSpeechOptions.builder()
                    .model(request.getModel())
                    .voice(OpenAiAudioApi.SpeechRequest.Voice.valueOf(
                            request.getVoice().toUpperCase()))
                    .responseFormat(OpenAiAudioApi.SpeechRequest.AudioResponseFormat
                            .valueOf(request.getFormat().toUpperCase()))
                    .speed(request.getSpeed())
                    .build();
            
            SpeechPrompt speechPrompt = new SpeechPrompt(request.getText(), options);
            SpeechResponse response = speechModel.call(speechPrompt);
            
            byte[] audioData = response.getResult().getOutput();
            
            // å„²å­˜éŸ³è¨Šæª”æ¡ˆï¼ˆå¦‚æœéœ€è¦ï¼‰
            String filePath = null;
            if (request.isSaveFile()) {
                filePath = storageService.saveAudioFile(
                        audioData, 
                        request.getText(), 
                        request.getVoice(), 
                        request.getFormat()
                );
            }
            
            return VoiceResponse.builder()
                    .success(true)
                    .text(request.getText())
                    .voice(request.getVoice())
                    .model(request.getModel())
                    .format(request.getFormat())
                    .speed(request.getSpeed())
                    .audioData(audioData)
                    .filePath(filePath)
                    .fileSize((long) audioData.length)
                    .duration(estimateAudioDuration(request.getText(), request.getSpeed()))
                    .timestamp(LocalDateTime.now())
                    .build();
            
        } catch (Exception e) {
            log.error("é€²éšèªéŸ³ç”Ÿæˆå¤±æ•—ï¼š{}", request.getText(), e);
            throw new RuntimeException("é€²éšèªéŸ³ç”Ÿæˆå¤±æ•—ï¼š" + e.getMessage(), e);
        }
    }
    
    /**
     * æ‰¹æ¬¡èªéŸ³ç”Ÿæˆ
     * @param requests è«‹æ±‚åˆ—è¡¨
     * @return æ‰¹æ¬¡è™•ç†çµæœ
     */
    public List<VoiceResponse> batchGenerateVoice(List<VoiceRequest> requests) {
        log.info("é–‹å§‹æ‰¹æ¬¡è™•ç† {} å€‹èªéŸ³ç”Ÿæˆè«‹æ±‚", requests.size());
        
        List<CompletableFuture<VoiceResponse>> futures = requests.stream()
                .map(request -> CompletableFuture.supplyAsync(() -> {
                    try {
                        return generateAdvancedVoice(request);
                    } catch (Exception e) {
                        log.error("æ‰¹æ¬¡è™•ç†å¤±æ•—ï¼š{}", request.getText(), e);
                        return VoiceResponse.builder()
                                .success(false)
                                .text(request.getText())
                                .error(e.getMessage())
                                .build();
                    }
                }))
                .collect(Collectors.toList());
        
        // ç­‰å¾…æ‰€æœ‰ä»»å‹™å®Œæˆ
        CompletableFuture<Void> allFutures = CompletableFuture.allOf(
                futures.toArray(new CompletableFuture[0])
        );
        
        return allFutures.thenApply(v -> 
                futures.stream()
                        .map(CompletableFuture::join)
                        .collect(Collectors.toList())
        ).join();
    }
    
    /**
     * ç²å–å¯ç”¨è²éŸ³é¸é …
     */
    public List<VoiceOption> getAvailableVoices() {
        return List.of(
            new VoiceOption("alloy", "ä¸­æ€§ã€æ¸…æ™°", "æ–°èæ’­å ±ã€æ•™å­¸"),
            new VoiceOption("echo", "ç”·æ€§ã€æ²‰ç©©", "å•†æ¥­ç°¡å ±ã€ç´€éŒ„ç‰‡"),
            new VoiceOption("fable", "å¥³æ€§ã€æº«æš–", "æ•…äº‹è¬›è¿°ã€å®¢æœ"),
            new VoiceOption("onyx", "ç”·æ€§ã€æ·±æ²‰", "å»£å‘Šé…éŸ³ã€æ—ç™½"),
            new VoiceOption("nova", "å¥³æ€§ã€æ´»æ½‘", "å»£å‘Šã€å¨›æ¨‚å…§å®¹"),
            new VoiceOption("shimmer", "å¥³æ€§ã€æŸ”å’Œ", "å†¥æƒ³ã€æ”¾é¬†å…§å®¹")
        );
    }
    
    /**
     * ä¼°ç®—éŸ³è¨Šæ™‚é•·ï¼ˆç§’ï¼‰
     */
    private Double estimateAudioDuration(String text, Float speed) {
        // ç²—ç•¥ä¼°ç®—ï¼šå¹³å‡æ¯åˆ†é˜ 150 å€‹å­—å…ƒ
        double baseMinutes = text.length() / 150.0;
        return (baseMinutes * 60) / speed;
    }
}
```

---

## 5.5.5 è«‹æ±‚å’Œå›æ‡‰ DTO

### èªéŸ³è«‹æ±‚ DTO

```java
package com.example.dto;

import lombok.Data;
import javax.validation.constraints.*;

@Data
public class VoiceRequest {
    
    @NotBlank(message = "æ–‡å­—å…§å®¹ä¸èƒ½ç‚ºç©º")
    @Size(max = 4096, message = "æ–‡å­—é•·åº¦ä¸èƒ½è¶…é 4096 å­—å…ƒ")
    private String text;
    
    @Pattern(regexp = "^(alloy|echo|fable|onyx|nova|shimmer)$", 
             message = "è²éŸ³å¿…é ˆæ˜¯ alloyã€echoã€fableã€onyxã€nova æˆ– shimmer")
    private String voice = "alloy";
    
    @Pattern(regexp = "^(tts-1|tts-1-hd)$", 
             message = "æ¨¡å‹å¿…é ˆæ˜¯ tts-1 æˆ– tts-1-hd")
    private String model = "tts-1-hd";
    
    @Pattern(regexp = "^(mp3|opus|aac|flac)$", 
             message = "æ ¼å¼å¿…é ˆæ˜¯ mp3ã€opusã€aac æˆ– flac")
    private String format = "mp3";
    
    @DecimalMin(value = "0.25", message = "èªé€Ÿä¸èƒ½å°æ–¼ 0.25")
    @DecimalMax(value = "4.0", message = "èªé€Ÿä¸èƒ½å¤§æ–¼ 4.0")
    private Float speed = 1.0f;
    
    private boolean saveFile = false;
    
    private String category;  // åˆ†é¡æ¨™ç±¤
    private String description;  // æè¿°
}
```

### èªéŸ³å›æ‡‰ DTO

```java
package com.example.dto;

import lombok.Builder;
import lombok.Data;
import java.time.LocalDateTime;

@Data
@Builder
public class VoiceResponse {
    
    private boolean success;
    private String text;
    private String voice;
    private String model;
    private String format;
    private Float speed;
    private byte[] audioData;
    private String filePath;
    private Long fileSize;
    private Double duration;  // éŸ³è¨Šæ™‚é•·ï¼ˆç§’ï¼‰
    private String error;
    private LocalDateTime timestamp;
    
    // çµ±è¨ˆè³‡è¨Š
    private Integer characterCount;
    private String audioUrl;  // å¦‚æœä¸Šå‚³åˆ°é›²ç«¯å„²å­˜
    
    /**
     * å»ºç«‹æˆåŠŸå›æ‡‰
     */
    public static VoiceResponse success(String text, String voice, byte[] audioData) {
        return VoiceResponse.builder()
                .success(true)
                .text(text)
                .voice(voice)
                .audioData(audioData)
                .fileSize((long) audioData.length)
                .characterCount(text.length())
                .timestamp(LocalDateTime.now())
                .build();
    }
    
    /**
     * å»ºç«‹éŒ¯èª¤å›æ‡‰
     */
    public static VoiceResponse error(String text, String error) {
        return VoiceResponse.builder()
                .success(false)
                .text(text)
                .error(error)
                .timestamp(LocalDateTime.now())
                .build();
    }
}
```

### è²éŸ³é¸é … DTO

```java
package com.example.dto;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@AllArgsConstructor
@NoArgsConstructor
public class VoiceOption {
    private String name;
    private String description;
    private String suitableFor;
    private String gender;
    private String style;
    
    public VoiceOption(String name, String description, String suitableFor) {
        this.name = name;
        this.description = description;
        this.suitableFor = suitableFor;
        
        // æ ¹æ“šè²éŸ³åç¨±è¨­å®šæ€§åˆ¥å’Œé¢¨æ ¼
        switch (name) {
            case "alloy" -> {
                this.gender = "ä¸­æ€§";
                this.style = "æ¸…æ™°";
            }
            case "echo", "onyx" -> {
                this.gender = "ç”·æ€§";
                this.style = name.equals("echo") ? "æ²‰ç©©" : "æ·±æ²‰";
            }
            case "fable", "nova", "shimmer" -> {
                this.gender = "å¥³æ€§";
                this.style = switch (name) {
                    case "fable" -> "æº«æš–";
                    case "nova" -> "æ´»æ½‘";
                    case "shimmer" -> "æŸ”å’Œ";
                    default -> "è‡ªç„¶";
                };
            }
        }
    }
}
```

---

## 5.5.6 é€²éšåŠŸèƒ½å¯¦ç¾

### èªéŸ³å„²å­˜æœå‹™

```java
package com.example.service;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Service;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.List;
import java.util.UUID;
import java.util.stream.Collectors;

@Service
@RequiredArgsConstructor
@Slf4j
public class VoiceStorageService {
    
    @Value("${app.voice.output-directory:./generated-voices}")
    private String outputDirectory;
    
    /**
     * å„²å­˜éŸ³è¨Šæª”æ¡ˆ
     * @param audioData éŸ³è¨Šè³‡æ–™
     * @param text åŸå§‹æ–‡å­—
     * @param voice è²éŸ³é¡å‹
     * @param format éŸ³è¨Šæ ¼å¼
     * @return æª”æ¡ˆè·¯å¾‘
     */
    public String saveAudioFile(byte[] audioData, String text, String voice, String format) {
        try {
            // å»ºç«‹è¼¸å‡ºç›®éŒ„
            Path outputPath = Paths.get(outputDirectory);
            if (!Files.exists(outputPath)) {
                Files.createDirectories(outputPath);
            }
            
            // ç”Ÿæˆæª”æ¡ˆåç¨±
            String fileName = generateFileName(text, voice, format);
            Path filePath = outputPath.resolve(fileName);
            
            // å¯«å…¥æª”æ¡ˆ
            Files.write(filePath, audioData);
            
            log.info("éŸ³è¨Šæª”æ¡ˆå·²å„²å­˜ï¼š{}", filePath.toString());
            return filePath.toString();
            
        } catch (IOException e) {
            log.error("éŸ³è¨Šæª”æ¡ˆå„²å­˜å¤±æ•—", e);
            throw new RuntimeException("éŸ³è¨Šæª”æ¡ˆå„²å­˜å¤±æ•—ï¼š" + e.getMessage());
        }
    }
    
    /**
     * ç”Ÿæˆæª”æ¡ˆåç¨±
     */
    private String generateFileName(String text, String voice, String format) {
        String timestamp = LocalDateTime.now().format(
            DateTimeFormatter.ofPattern("yyyyMMdd_HHmmss")
        );
        String uuid = UUID.randomUUID().toString().substring(0, 8);
        String sanitizedText = sanitizeText(text);
        
        return String.format("%s_%s_%s_%s.%s", 
                timestamp, voice, uuid, sanitizedText, format);
    }
    
    /**
     * æ¸…ç†æ–‡å­—ä½œç‚ºæª”æ¡ˆåç¨±
     */
    private String sanitizeText(String text) {
        return text.replaceAll("[^a-zA-Z0-9\u4e00-\u9fa5]", "_")
                  .substring(0, Math.min(text.length(), 20));
    }
    
    /**
     * æ‰¹æ¬¡å„²å­˜éŸ³è¨Šæª”æ¡ˆ
     */
    public List<String> batchSaveAudioFiles(List<VoiceResponse> responses) {
        return responses.stream()
                .filter(VoiceResponse::isSuccess)
                .filter(response -> response.getAudioData() != null)
                .map(response -> saveAudioFile(
                        response.getAudioData(),
                        response.getText(),
                        response.getVoice(),
                        response.getFormat()
                ))
                .collect(Collectors.toList());
    }
}
```

### èªéŸ³å“è³ªå„ªåŒ–æœå‹™

```java
package com.example.service;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;

import java.util.regex.Pattern;

@Service
@RequiredArgsConstructor
@Slf4j
public class VoiceOptimizationService {
    
    /**
     * å„ªåŒ–æ–‡å­—å…§å®¹ä»¥æå‡èªéŸ³å“è³ª
     * @param text åŸå§‹æ–‡å­—
     * @param voice è²éŸ³é¡å‹
     * @return å„ªåŒ–å¾Œçš„æ–‡å­—
     */
    public String optimizeTextForSpeech(String text, String voice) {
        String optimized = text;
        
        // è™•ç†æ•¸å­—
        optimized = processNumbers(optimized);
        
        // è™•ç†ç¸®å¯«
        optimized = processAbbreviations(optimized);
        
        // è™•ç†æ¨™é»ç¬¦è™Ÿ
        optimized = processPunctuation(optimized);
        
        // è™•ç†èªéŸ³åœé “
        optimized = addSpeechPauses(optimized);
        
        // æ ¹æ“šè²éŸ³é¡å‹èª¿æ•´
        optimized = adjustForVoiceType(optimized, voice);
        
        return optimized;
    }
    
    /**
     * è™•ç†æ•¸å­—è½‰æ›
     */
    private String processNumbers(String text) {
        // å°‡é˜¿æ‹‰ä¼¯æ•¸å­—è½‰æ›ç‚ºä¸­æ–‡æ•¸å­—ï¼ˆæå‡ä¸­æ–‡èªéŸ³å“è³ªï¼‰
        text = text.replaceAll("\\b(\\d{4})\\b", "$1å¹´");
        text = text.replaceAll("\\b(\\d{1,2})æœˆ(\\d{1,2})æ—¥\\b", "$1æœˆ$2æ—¥");
        text = text.replaceAll("\\b(\\d+)%\\b", "ç™¾åˆ†ä¹‹$1");
        
        return text;
    }
    
    /**
     * è™•ç†ç¸®å¯«
     */
    private String processAbbreviations(String text) {
        // å¸¸è¦‹ç¸®å¯«å±•é–‹
        text = text.replaceAll("\\bAI\\b", "äººå·¥æ™ºæ…§");
        text = text.replaceAll("\\bAPI\\b", "æ‡‰ç”¨ç¨‹å¼ä»‹é¢");
        text = text.replaceAll("\\bURL\\b", "ç¶²å€");
        text = text.replaceAll("\\bHTTP\\b", "è¶…æ–‡æœ¬å‚³è¼¸å”å®š");
        
        return text;
    }
    
    /**
     * è™•ç†æ¨™é»ç¬¦è™Ÿ
     */
    private String processPunctuation(String text) {
        // åœ¨å¥è™Ÿå¾Œæ·»åŠ è¼ƒé•·åœé “
        text = text.replaceAll("ã€‚", "ã€‚ ");
        
        // åœ¨é€—è™Ÿå¾Œæ·»åŠ çŸ­åœé “
        text = text.replaceAll("ï¼Œ", "ï¼Œ ");
        
        // åœ¨å•è™Ÿå’Œé©šå˜†è™Ÿå¾Œæ·»åŠ åœé “
        text = text.replaceAll("[ï¼Ÿï¼]", "$0 ");
        
        return text;
    }
    
    /**
     * æ·»åŠ èªéŸ³åœé “
     */
    private String addSpeechPauses(String text) {
        // åœ¨é•·å¥ä¸­é–“æ·»åŠ é©ç•¶åœé “
        if (text.length() > 100) {
            text = text.replaceAll("([ï¼Œã€‚ï¼ï¼Ÿ])(?=.{30,})", "$1 ");
        }
        
        return text;
    }
    
    /**
     * æ ¹æ“šè²éŸ³é¡å‹èª¿æ•´
     */
    private String adjustForVoiceType(String text, String voice) {
        switch (voice) {
            case "nova", "shimmer" -> {
                // å¥³æ€§è²éŸ³ï¼Œèªèª¿å¯ä»¥æ›´æº«å’Œ
                text = text.replaceAll("ï¼", "ã€‚");
            }
            case "echo", "onyx" -> {
                // ç”·æ€§è²éŸ³ï¼Œå¯ä»¥ä¿æŒè¼ƒå¼·èªèª¿
                // ä¿æŒåŸæ¨£
            }
            case "alloy" -> {
                // ä¸­æ€§è²éŸ³ï¼Œå¹³è¡¡è™•ç†
                text = text.replaceAll("ï¼{2,}", "ï¼");
            }
        }
        
        return text;
    }
    
    /**
     * é©—è­‰æ–‡å­—é©åˆèªéŸ³è½‰æ›
     * @param text æ–‡å­—å…§å®¹
     * @return å“è³ªè©•åˆ†ï¼ˆ0-100ï¼‰
     */
    public int evaluateTextQuality(String text) {
        int score = 100;
        
        // æª¢æŸ¥ç‰¹æ®Šå­—å…ƒ
        if (Pattern.compile("[#@$%^&*()\\[\\]{}|\\\\]").matcher(text).find()) {
            score -= 20;  // åŒ…å«ç‰¹æ®Šå­—å…ƒ
        }
        
        // æª¢æŸ¥æ•¸å­—æ¯”ä¾‹
        long digitCount = text.chars().filter(Character::isDigit).count();
        double digitRatio = (double) digitCount / text.length();
        if (digitRatio > 0.3) {
            score -= 15;  // æ•¸å­—å¤ªå¤š
        }
        
        // æª¢æŸ¥è‹±æ–‡æ¯”ä¾‹
        long englishCount = text.chars().filter(ch -> (ch >= 'a' && ch <= 'z') || (ch >= 'A' && ch <= 'Z')).count();
        double englishRatio = (double) englishCount / text.length();
        if (englishRatio > 0.5) {
            score -= 10;  // è‹±æ–‡å¤ªå¤šï¼ˆä¸­æ–‡èªéŸ³ï¼‰
        }
        
        // æª¢æŸ¥å¥å­é•·åº¦
        String[] sentences = text.split("[ã€‚ï¼ï¼Ÿ]");
        for (String sentence : sentences) {
            if (sentence.length() > 200) {
                score -= 5;  // å¥å­å¤ªé•·
            }
        }
        
        return Math.max(0, score);
    }
}
```

---

## ğŸ“ æœ¬ç« é‡é»å›é¡§

1. **æ–‡å­—è½‰èªéŸ³æŠ€è¡“**ï¼šæŒæ¡äº† TTS æŠ€è¡“çš„å·¥ä½œåŸç†å’Œ AI é…éŸ³å„ªå‹¢
2. **å¤šè²éŸ³æ”¯æ´**ï¼šå¯¦ç¾äº† 6 ç¨®ä¸åŒé¢¨æ ¼çš„ AI è²éŸ³é¸æ“‡
3. **ä¼æ¥­ç´šåŠŸèƒ½**ï¼šå»ºç«‹äº†å®Œæ•´çš„èªéŸ³ç”Ÿæˆã€å„²å­˜å’Œç®¡ç†ç³»çµ±
4. **å“è³ªå„ªåŒ–æŠ€è¡“**ï¼šæŒæ¡äº†æ–‡å­—é è™•ç†å’ŒèªéŸ³åƒæ•¸èª¿æ•´æ–¹æ³•
5. **æ‰¹æ¬¡è™•ç†èƒ½åŠ›**ï¼šæ”¯æ´å¤§é‡æ–‡å­—çš„ä¸¦è¡ŒèªéŸ³ç”Ÿæˆ

### æŠ€è¡“è¦é»ç¸½çµ

| æŠ€è¡“é» | é‡è¦æ€§ | å¯¦ç¾é›£åº¦ | ä½¿ç”¨å ´æ™¯ |
|--------|--------|----------|----------|
| **åŸºç¤èªéŸ³ç”Ÿæˆ** | â­â­â­ | ä½ | æ‰€æœ‰é…éŸ³æ‡‰ç”¨ |
| **å¤šè²éŸ³é¸æ“‡** | â­â­â­ | ä½ | å€‹æ€§åŒ–é…éŸ³ |
| **æ‰¹æ¬¡è™•ç†** | â­â­ | ä¸­ | å¤§é‡å…§å®¹ç”Ÿæˆ |
| **å“è³ªå„ªåŒ–** | â­â­ | é«˜ | å°ˆæ¥­é…éŸ³è£½ä½œ |
| **æª”æ¡ˆç®¡ç†** | â­â­ | ä¸­ | ä¼æ¥­ç´šéƒ¨ç½² |
| **æ–‡å­—é è™•ç†** | â­ | ä¸­ | èªéŸ³å“è³ªæå‡ |

### æˆæœ¬æ•ˆç›Šåˆ†æ

**OpenAI TTS å®šåƒ¹**ï¼š
- ğŸ’° **æˆæœ¬**ï¼š$0.015 per 1K characters
- â±ï¸ **é€Ÿåº¦**ï¼šå³æ™‚ç”Ÿæˆï¼Œç„¡ç­‰å¾…æ™‚é–“
- ğŸ¯ **å“è³ª**ï¼šæ¥è¿‘äººè²çš„è‡ªç„¶åº¦
- ğŸ“Š **æ€§åƒ¹æ¯”**ï¼šç›¸æ¯”å°ˆæ¥­é…éŸ³ç¯€çœ 95%+ æˆæœ¬

### æœ€ä½³å¯¦è¸å»ºè­°

1. **æ–‡å­—é è™•ç†**ï¼šå„ªåŒ–æ•¸å­—ã€ç¸®å¯«å’Œæ¨™é»ç¬¦è™Ÿ
2. **è²éŸ³é¸æ“‡**ï¼šæ ¹æ“šå…§å®¹é¡å‹é¸æ“‡åˆé©çš„è²éŸ³
3. **èªé€Ÿèª¿æ•´**ï¼šæ ¹æ“šè½çœ¾å’Œå ´æ™¯èª¿æ•´èªé€Ÿ
4. **æ‰¹æ¬¡è™•ç†**ï¼šå¤§é‡å…§å®¹ä½¿ç”¨éåŒæ­¥è™•ç†æå‡æ•ˆç‡
5. **å“è³ªæ§åˆ¶**ï¼šå¯¦æ–½æ–‡å­—å“è³ªè©•ä¼°å’ŒèªéŸ³å¾Œè™•ç†

### ä¸‹ä¸€æ­¥å­¸ç¿’æ–¹å‘

åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘å€‘å°‡å­¸ç¿’ Function Calling æŠ€è¡“ï¼Œæ¢ç´¢å¦‚ä½•è®“ AI èª¿ç”¨å¤–éƒ¨å·¥å…·å’Œæœå‹™ï¼Œå¯¦ç¾æ›´å¼·å¤§çš„åŠŸèƒ½æ•´åˆã€‚

---

**åƒè€ƒè³‡æ–™ï¼š**
- [Spring AI Audio Speech Documentation](https://docs.spring.io/spring-ai/reference/api/audio.html)
- [OpenAI Text-to-Speech API](https://platform.openai.com/docs/guides/text-to-speech)
- [Audio Format Specifications](https://en.wikipedia.org/wiki/Audio_file_format)
- [Speech Synthesis Markup Language (SSML)](https://www.w3.org/TR/speech-synthesis/)