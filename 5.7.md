# 5.7 Function Calling (ä¸­) - è®“ AI è®€å–ä¼æ¥­è³‡è¨Š

> **æœ¬ç« é‡é»**ï¼šå­¸ç¿’å¦‚ä½•è®“ AI é€é Tool Calling å­˜å–ä¼æ¥­å…§éƒ¨è³‡æ–™ï¼Œå¯¦ç¾ AI èˆ‡ä¼æ¥­ç³»çµ±çš„æ·±åº¦æ•´åˆï¼Œå»ºç«‹æ™ºèƒ½åŒ–çš„ä¼æ¥­è³‡æ–™åˆ†æå’ŒæŸ¥è©¢ç³»çµ±ã€‚

## ğŸ¯ å­¸ç¿’ç›®æ¨™

å®Œæˆæœ¬ç« å­¸ç¿’å¾Œï¼Œæ‚¨å°‡èƒ½å¤ ï¼š

- ğŸ¯ **ä¼æ¥­è³‡æ–™æ•´åˆ**ï¼šè®“ AI èƒ½å¤ å­˜å–å’Œåˆ†æä¼æ¥­å…§éƒ¨è³‡æ–™
- ğŸ¯ **è¤‡é›œå·¥å…·è¨­è¨ˆ**ï¼šå»ºç«‹å¸¶åƒæ•¸å’Œçµæ§‹åŒ–å›æ‡‰çš„é€²éšå·¥å…·
- ğŸ¯ **å¤šå·¥å…·å”ä½œ**ï¼šå¯¦ç¾å¤šå€‹å·¥å…·çš„çµ„åˆä½¿ç”¨å’Œå”åŒå·¥ä½œ
- ğŸ¯ **è³‡æ–™æ¨¡å‹è¨­è¨ˆ**ï¼šæŒæ¡ä¼æ¥­ç´šè³‡æ–™æ¨¡å‹çš„è¨­è¨ˆå’Œå¯¦ç¾
- ğŸ¯ **æ™ºèƒ½åˆ†æç³»çµ±**ï¼šå»ºç«‹ AI é©…å‹•çš„ä¼æ¥­è³‡æ–™åˆ†æå¹³å°

---

## 5.7.1 ä¼æ¥­ AI æ•´åˆçš„é‡è¦æ€§

### åœ¨åœ°åŒ–çš„ç¬¬ä¸€æ­¥

![ä¼æ¥­è³‡æ–™æ•´åˆ](https://ithelp.ithome.com.tw/upload/images/20240811/20161290JBnMyu335V.jpg)

åªæ˜¯å•æ™‚é–“ä¼¼ä¹ç„¡æ³•é«”æœƒ Tool Calling æœ‰ä»€éº¼ç‰¹åˆ¥ä¹‹è™•ï¼Œä»Šå¤©æˆ‘å€‘æ¨¡æ“¬å¾å¾Œç«¯å–å¾—è³‡æ–™ä¸¦é€é AI å¹«æˆ‘å€‘åˆ†æï¼Œçœ‹çœ‹å·¥å…·è©²å¦‚ä½•æ’°å¯«ã€‚

### ä¼æ¥­ AI æ‡‰ç”¨çš„æ ¸å¿ƒæŒ‘æˆ°

**1. è³‡æ–™å­¤å³¶å•é¡Œ**
- ğŸ¢ **åˆ†æ•£çš„ä¼æ¥­ç³»çµ±**ï¼šERPã€CRMã€è²¡å‹™ã€äººäº‹ç­‰ç³»çµ±å„è‡ªç¨ç«‹
- ğŸ“Š **è³‡æ–™æ ¼å¼ä¸ä¸€**ï¼šä¸åŒç³»çµ±ä½¿ç”¨ä¸åŒçš„è³‡æ–™æ ¼å¼å’Œæ¨™æº–
- ğŸ”’ **å­˜å–æ¬Šé™è¤‡é›œ**ï¼šä¼æ¥­è³‡æ–™æ¶‰åŠå®‰å…¨æ€§å’Œæ¬Šé™ç®¡ç†
- ğŸ”„ **å³æ™‚æ€§è¦æ±‚**ï¼šæ¥­å‹™æ±ºç­–éœ€è¦å³æ™‚çš„è³‡æ–™åˆ†æ

**2. å‚³çµ±è§£æ±ºæ–¹æ¡ˆçš„é™åˆ¶**
- ğŸ“ˆ **BI å·¥å…·è¤‡é›œ**ï¼šéœ€è¦å°ˆæ¥­æŠ€èƒ½æ‰èƒ½æ“ä½œ
- ğŸ’° **é–‹ç™¼æˆæœ¬é«˜**ï¼šæ¯å€‹æŸ¥è©¢éœ€æ±‚éƒ½è¦å–®ç¨é–‹ç™¼
- â° **å›æ‡‰é€Ÿåº¦æ…¢**ï¼šå¾éœ€æ±‚åˆ°å¯¦ç¾é€±æœŸé•·
- ğŸ¯ **éˆæ´»æ€§ä¸è¶³**ï¼šé›£ä»¥æ‡‰å°è‡¨æ™‚æ€§çš„åˆ†æéœ€æ±‚

**3. AI + Tool Calling çš„å„ªå‹¢**
- ğŸ—£ï¸ **è‡ªç„¶èªè¨€æŸ¥è©¢**ï¼šç”¨æ—¥å¸¸èªè¨€æè¿°åˆ†æéœ€æ±‚
- ğŸ”„ **å³æ™‚è³‡æ–™å­˜å–**ï¼šé€é API å³æ™‚ç²å–æœ€æ–°è³‡æ–™
- ğŸ§  **æ™ºèƒ½åˆ†æ**ï¼šAI è‡ªå‹•é€²è¡Œè³‡æ–™åˆ†æå’Œæ´å¯Ÿ
- ğŸ¨ **éˆæ´»çµ„åˆ**ï¼šå¤šå€‹è³‡æ–™æºçš„æ™ºèƒ½æ•´åˆ

### ä¼æ¥­ AI æ‡‰ç”¨å ´æ™¯

| æ‡‰ç”¨é ˜åŸŸ | å…·é«”å ´æ™¯ | Tool Calling è§£æ±ºæ–¹æ¡ˆ |
|----------|----------|----------------------|
| **éŠ·å”®åˆ†æ** | ç”¢å“éŠ·é‡çµ±è¨ˆã€è¶¨å‹¢åˆ†æ | éŠ·å”®è³‡æ–™æŸ¥è©¢å·¥å…· |
| **è²¡å‹™ç®¡ç†** | æ”¶æ”¯åˆ†æã€é ç®—æ§åˆ¶ | è²¡å‹™è³‡æ–™å­˜å–å·¥å…· |
| **äººåŠ›è³‡æº** | å“¡å·¥ç¸¾æ•ˆã€è–ªè³‡åˆ†æ | HR ç³»çµ±æ•´åˆå·¥å…· |
| **åº«å­˜ç®¡ç†** | åº«å­˜ç‹€æ…‹ã€è£œè²¨å»ºè­° | åº«å­˜æŸ¥è©¢å·¥å…· |
| **å®¢æˆ¶æœå‹™** | å®¢æˆ¶è³‡è¨Šã€æœå‹™è¨˜éŒ„ | CRM ç³»çµ±å·¥å…· |
| **ç‡Ÿé‹åˆ†æ** | KPI ç›£æ§ã€ç•°å¸¸æª¢æ¸¬ | ç‡Ÿé‹è³‡æ–™å·¥å…· |

---

## 5.7.2 ä¼æ¥­è³‡æ–™å·¥å…·è¨­è¨ˆ

### ç¨‹å¼ç›®æ¨™è¨­å®š

**å¯¦æˆ°å ´æ™¯**ï¼šè©¢å• AI å…¬å¸æ¯å€‹ç”¢å“å»å¹´çš„éŠ·é‡ï¼Œä¸¦çµ±è¨ˆå éŠ·é‡çš„æ¯”ä¾‹æ˜¯å¤šå°‘

**æŠ€è¡“è¦æ±‚**ï¼š
- ğŸ“Š å¾ä¼æ¥­è³‡æ–™åº«ç²å–ç”¢å“éŠ·å”®è³‡æ–™
- ğŸ”¢ æ”¯æ´å¹´ä»½å’Œç”¢å“å‹è™Ÿçš„ç¯©é¸æŸ¥è©¢
- ğŸ“ˆ æä¾›çµæ§‹åŒ–çš„è³‡æ–™å›æ‡‰
- ğŸ§® è®“ AI é€²è¡Œè‡ªå‹•åˆ†æå’Œè¨ˆç®—

### ç”¢å“éŠ·å”®å·¥å…·å¯¦ç¾

**æ­¥é©Ÿ 1ï¼šè³‡æ–™æ¨¡å‹è¨­è¨ˆ**

```java
package com.example.model;

import com.fasterxml.jackson.annotation.JsonProperty;
import com.fasterxml.jackson.annotation.JsonPropertyDescription;
import com.fasterxml.jackson.annotation.JsonClassDescription;
import lombok.Data;
import lombok.Builder;

import java.math.BigDecimal;
import java.time.LocalDate;
import java.util.List;

/**
 * ç”¢å“éŠ·å”®è³‡æ–™æ¨¡å‹
 */
@Data
@Builder
public class Product {
    
    @JsonProperty("year")
    @JsonPropertyDescription("éŠ·å”®å¹´ä»½")
    private String year;
    
    @JsonProperty("model")
    @JsonPropertyDescription("ç”¢å“å‹è™Ÿ")
    private String model;
    
    @JsonProperty("name")
    @JsonPropertyDescription("ç”¢å“åç¨±")
    private String name;
    
    @JsonProperty("quantity")
    @JsonPropertyDescription("éŠ·å”®æ•¸é‡")
    private Integer quantity;
    
    @JsonProperty("revenue")
    @JsonPropertyDescription("éŠ·å”®é‡‘é¡")
    private BigDecimal revenue;
    
    @JsonProperty("category")
    @JsonPropertyDescription("ç”¢å“é¡åˆ¥")
    private String category;
    
    @JsonProperty("launch_date")
    @JsonPropertyDescription("ä¸Šå¸‚æ—¥æœŸ")
    private LocalDate launchDate;
}

/**
 * ç”¢å“éŠ·å”®æŸ¥è©¢å›æ‡‰
 */
@Data
@Builder
@JsonClassDescription("å…¬å¸ç”¢å“éŠ·å”®è³‡æ–™å›æ‡‰")
public class ProductSalesResponse {
    
    @JsonProperty("products")
    @JsonPropertyDescription("ç”¢å“éŠ·å”®æ¸…å–®")
    private List<Product> products;
    
    @JsonProperty("total_quantity")
    @JsonPropertyDescription("ç¸½éŠ·å”®æ•¸é‡")
    private Integer totalQuantity;
    
    @JsonProperty("total_revenue")
    @JsonPropertyDescription("ç¸½éŠ·å”®é‡‘é¡")
    private BigDecimal totalRevenue;
    
    @JsonProperty("query_year")
    @JsonPropertyDescription("æŸ¥è©¢å¹´ä»½")
    private String queryYear;
    
    @JsonProperty("query_product")
    @JsonPropertyDescription("æŸ¥è©¢ç”¢å“")
    private String queryProduct;
}

/**
 * éŠ·å”®çµ±è¨ˆè³‡æ–™
 */
@Data
@Builder
@JsonClassDescription("éŠ·å”®çµ±è¨ˆåˆ†æçµæœ")
public class SalesStatistics {
    
    @JsonProperty("top_products")
    @JsonPropertyDescription("éŠ·é‡å‰äº”åç”¢å“")
    private List<Product> topProducts;
    
    @JsonProperty("category_stats")
    @JsonPropertyDescription("å„é¡åˆ¥éŠ·å”®çµ±è¨ˆ")
    private List<CategoryStat> categoryStats;
    
    @JsonProperty("year_over_year_growth")
    @JsonPropertyDescription("å¹´åº¦æˆé•·ç‡")
    private BigDecimal yearOverYearGrowth;
    
    @Data
    @Builder
    public static class CategoryStat {
        private String category;
        private Integer quantity;
        private BigDecimal revenue;
        private Double percentage;
    }
}
```

**æ­¥é©Ÿ 2ï¼šä¼æ¥­è³‡æ–™å­˜å–æœå‹™**

```java
package com.example.service;

import com.example.model.Product;
import com.example.model.ProductSalesResponse;
import com.example.model.SalesStatistics;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;

import java.math.BigDecimal;
import java.time.LocalDate;
import java.util.List;
import java.util.stream.Collectors;

@Service
@RequiredArgsConstructor
@Slf4j
public class EnterpriseDataService {
    
    /**
     * æ¨¡æ“¬ä¼æ¥­è³‡æ–™åº«æŸ¥è©¢
     * å¯¦éš›æ‡‰ç”¨ä¸­é€™è£¡æœƒé€£æ¥åˆ°çœŸå¯¦çš„ä¼æ¥­è³‡æ–™åº«
     */
    public List<Product> getProductSalesData() {
        return List.of(
            Product.builder()
                .year("2022")
                .model("PD-1405")
                .name("æ™ºèƒ½æ‰‹æ©Ÿ Pro")
                .quantity(12500)
                .revenue(new BigDecimal("625000000"))
                .category("é›»å­ç”¢å“")
                .launchDate(LocalDate.of(2021, 3, 15))
                .build(),
            
            Product.builder()
                .year("2023")
                .model("PD-1234")
                .name("ç­†è¨˜å‹é›»è…¦ Ultra")
                .quantity(10000)
                .revenue(new BigDecimal("800000000"))
                .category("é›»è…¦è¨­å‚™")
                .launchDate(LocalDate.of(2022, 6, 20))
                .build(),
            
            Product.builder()
                .year("2023")
                .model("PD-1235")
                .name("å¹³æ¿é›»è…¦ Lite")
                .quantity(1500)
                .revenue(new BigDecimal("45000000"))
                .category("é›»å­ç”¢å“")
                .launchDate(LocalDate.of(2022, 9, 10))
                .build(),
            
            Product.builder()
                .year("2023")
                .model("PD-1385")
                .name("æ™ºèƒ½æ‰‹éŒ¶ Sport")
                .quantity(15000)
                .revenue(new BigDecimal("300000000"))
                .category("ç©¿æˆ´è£ç½®")
                .launchDate(LocalDate.of(2023, 1, 5))
                .build(),
            
            Product.builder()
                .year("2024")
                .model("PD-1255")
                .name("ç„¡ç·šè€³æ©Ÿ Pro")
                .quantity(15000)
                .revenue(new BigDecimal("225000000"))
                .category("éŸ³éŸ¿è¨­å‚™")
                .launchDate(LocalDate.of(2023, 8, 12))
                .build(),
            
            Product.builder()
                .year("2024")
                .model("PD-1300")
                .name("æ™ºèƒ½éŸ³ç®± Home")
                .quantity(12000)
                .revenue(new BigDecimal("180000000"))
                .category("æ™ºèƒ½å®¶å±…")
                .launchDate(LocalDate.of(2023, 11, 25))
                .build(),
            
            Product.builder()
                .year("2024")
                .model("PD-1405")
                .name("æ™ºèƒ½æ‰‹æ©Ÿ Pro Max")
                .quantity(12500)
                .revenue(new BigDecimal("750000000"))
                .category("é›»å­ç”¢å“")
                .launchDate(LocalDate.of(2024, 2, 14))
                .build(),
            
            Product.builder()
                .year("2024")
                .model("PD-1235")
                .name("å¹³æ¿é›»è…¦ Pro")
                .quantity(15000)
                .revenue(new BigDecimal("600000000"))
                .category("é›»å­ç”¢å“")
                .launchDate(LocalDate.of(2024, 4, 8))
                .build(),
            
            Product.builder()
                .year("2024")
                .model("PD-1385")
                .name("æ™ºèƒ½æ‰‹éŒ¶ Ultra")
                .quantity(15000)
                .revenue(new BigDecimal("450000000"))
                .category("ç©¿æˆ´è£ç½®")
                .launchDate(LocalDate.of(2024, 6, 18))
                .build()
        );
    }
    
    /**
     * æ ¹æ“šæ¢ä»¶ç¯©é¸ç”¢å“è³‡æ–™
     */
    public List<Product> filterProducts(String year, String productModel) {
        List<Product> allProducts = getProductSalesData();
        
        return allProducts.stream()
                .filter(product -> year == null || product.getYear().equals(year))
                .filter(product -> productModel == null || 
                        product.getModel().toLowerCase().contains(productModel.toLowerCase()) ||
                        product.getName().toLowerCase().contains(productModel.toLowerCase()))
                .collect(Collectors.toList());
    }
    
    /**
     * è¨ˆç®—éŠ·å”®çµ±è¨ˆè³‡æ–™
     */
    public SalesStatistics calculateSalesStatistics(List<Product> products) {
        // è¨ˆç®—ç¸½éŠ·é‡
        int totalQuantity = products.stream()
                .mapToInt(Product::getQuantity)
                .sum();
        
        // è¨ˆç®—å„é¡åˆ¥çµ±è¨ˆ
        List<SalesStatistics.CategoryStat> categoryStats = products.stream()
                .collect(Collectors.groupingBy(Product::getCategory))
                .entrySet().stream()
                .map(entry -> {
                    String category = entry.getKey();
                    List<Product> categoryProducts = entry.getValue();
                    
                    int categoryQuantity = categoryProducts.stream()
                            .mapToInt(Product::getQuantity)
                            .sum();
                    
                    BigDecimal categoryRevenue = categoryProducts.stream()
                            .map(Product::getRevenue)
                            .reduce(BigDecimal.ZERO, BigDecimal::add);
                    
                    double percentage = totalQuantity > 0 ? 
                            (double) categoryQuantity / totalQuantity * 100 : 0;
                    
                    return SalesStatistics.CategoryStat.builder()
                            .category(category)
                            .quantity(categoryQuantity)
                            .revenue(categoryRevenue)
                            .percentage(percentage)
                            .build();
                })
                .collect(Collectors.toList());
        
        // å–å¾—éŠ·é‡å‰äº”å
        List<Product> topProducts = products.stream()
                .sorted((p1, p2) -> Integer.compare(p2.getQuantity(), p1.getQuantity()))
                .limit(5)
                .collect(Collectors.toList());
        
        return SalesStatistics.builder()
                .topProducts(topProducts)
                .categoryStats(categoryStats)
                .yearOverYearGrowth(calculateYearOverYearGrowth(products))
                .build();
    }
    
    private BigDecimal calculateYearOverYearGrowth(List<Product> products) {
        // ç°¡åŒ–çš„å¹´åº¦æˆé•·ç‡è¨ˆç®—
        // å¯¦éš›æ‡‰ç”¨ä¸­æœƒæ¯”è¼ƒä¸åŒå¹´ä»½çš„è³‡æ–™
        return new BigDecimal("15.5"); // æ¨¡æ“¬ 15.5% æˆé•·ç‡
    }
}
```

**æ­¥é©Ÿ 3ï¼šç”¢å“éŠ·å”®å·¥å…·å¯¦ç¾**

```java
package com.example.tools;

import com.example.model.Product;
import com.example.model.ProductSalesResponse;
import com.example.model.SalesStatistics;
import com.example.service.EnterpriseDataService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.ai.tool.annotation.Tool;
import org.springframework.stereotype.Component;

import java.math.BigDecimal;
import java.util.List;

@Component
@RequiredArgsConstructor
@Slf4j
public class ProductSalesTools {
    
    private final EnterpriseDataService dataService;
    
    /**
     * æŸ¥è©¢ç”¢å“éŠ·å”®è³‡æ–™
     * @param year éŠ·å”®å¹´ä»½ï¼ˆå¯é¸ï¼‰
     * @param product ç”¢å“å‹è™Ÿæˆ–åç¨±ï¼ˆå¯é¸ï¼‰
     * @return ç”¢å“éŠ·å”®è³‡æ–™
     */
    @Tool(description = "Get company product sales information by year and product model. " +
          "Can filter by year (e.g., '2023', '2024') and product (model or name). " +
          "Returns detailed sales data including quantity, revenue, and product information.")
    public ProductSalesResponse getProductSales(String year, String product) {
        try {
            log.info("æŸ¥è©¢ç”¢å“éŠ·å”®è³‡æ–™ï¼šå¹´ä»½={}, ç”¢å“={}", year, product);
            
            // å¾ä¼æ¥­è³‡æ–™æœå‹™ç²å–è³‡æ–™
            List<Product> products = dataService.filterProducts(year, product);
            
            // è¨ˆç®—ç¸½è¨ˆ
            int totalQuantity = products.stream()
                    .mapToInt(Product::getQuantity)
                    .sum();
            
            BigDecimal totalRevenue = products.stream()
                    .map(Product::getRevenue)
                    .reduce(BigDecimal.ZERO, BigDecimal::add);
            
            ProductSalesResponse response = ProductSalesResponse.builder()
                    .products(products)
                    .totalQuantity(totalQuantity)
                    .totalRevenue(totalRevenue)
                    .queryYear(year)
                    .queryProduct(product)
                    .build();
            
            log.info("æŸ¥è©¢å®Œæˆï¼Œæ‰¾åˆ° {} ç­†ç”¢å“è³‡æ–™ï¼Œç¸½éŠ·é‡ï¼š{}", 
                    products.size(), totalQuantity);
            
            return response;
            
        } catch (Exception e) {
            log.error("æŸ¥è©¢ç”¢å“éŠ·å”®è³‡æ–™å¤±æ•—", e);
            throw new RuntimeException("æŸ¥è©¢ç”¢å“éŠ·å”®è³‡æ–™å¤±æ•—ï¼š" + e.getMessage());
        }
    }
    
    /**
     * ç²å–éŠ·å”®çµ±è¨ˆåˆ†æ
     * @param year åˆ†æå¹´ä»½
     * @return éŠ·å”®çµ±è¨ˆè³‡æ–™
     */
    @Tool(description = "Get sales statistics and analysis for a specific year. " +
          "Returns top-selling products, category breakdown, and growth metrics.")
    public SalesStatistics getSalesStatistics(String year) {
        try {
            log.info("ç²å–éŠ·å”®çµ±è¨ˆåˆ†æï¼šå¹´ä»½={}", year);
            
            List<Product> products = dataService.filterProducts(year, null);
            SalesStatistics statistics = dataService.calculateSalesStatistics(products);
            
            log.info("çµ±è¨ˆåˆ†æå®Œæˆï¼Œå…±åˆ†æ {} ç­†ç”¢å“è³‡æ–™", products.size());
            
            return statistics;
            
        } catch (Exception e) {
            log.error("ç²å–éŠ·å”®çµ±è¨ˆå¤±æ•—", e);
            throw new RuntimeException("ç²å–éŠ·å”®çµ±è¨ˆå¤±æ•—ï¼š" + e.getMessage());
        }
    }
    
    /**
     * æ¯”è¼ƒä¸åŒå¹´ä»½çš„éŠ·å”®è¡¨ç¾
     * @param year1 ç¬¬ä¸€å€‹å¹´ä»½
     * @param year2 ç¬¬äºŒå€‹å¹´ä»½
     * @return æ¯”è¼ƒçµæœ
     */
    @Tool(description = "Compare sales performance between two years. " +
          "Returns detailed comparison including growth rates and product performance changes.")
    public String compareSalesByYear(String year1, String year2) {
        try {
            log.info("æ¯”è¼ƒå¹´åº¦éŠ·å”®è¡¨ç¾ï¼š{} vs {}", year1, year2);
            
            List<Product> products1 = dataService.filterProducts(year1, null);
            List<Product> products2 = dataService.filterProducts(year2, null);
            
            int total1 = products1.stream().mapToInt(Product::getQuantity).sum();
            int total2 = products2.stream().mapToInt(Product::getQuantity).sum();
            
            BigDecimal revenue1 = products1.stream()
                    .map(Product::getRevenue)
                    .reduce(BigDecimal.ZERO, BigDecimal::add);
            
            BigDecimal revenue2 = products2.stream()
                    .map(Product::getRevenue)
                    .reduce(BigDecimal.ZERO, BigDecimal::add);
            
            double quantityGrowth = total1 > 0 ? 
                    ((double) (total2 - total1) / total1 * 100) : 0;
            
            double revenueGrowth = revenue1.compareTo(BigDecimal.ZERO) > 0 ?
                    revenue2.subtract(revenue1)
                            .divide(revenue1, 4, java.math.RoundingMode.HALF_UP)
                            .multiply(new BigDecimal("100"))
                            .doubleValue() : 0;
            
            String result = String.format(
                    "å¹´åº¦éŠ·å”®æ¯”è¼ƒåˆ†æ (%s vs %s):\n" +
                    "éŠ·å”®æ•¸é‡ï¼š%d â†’ %d (æˆé•·ç‡ï¼š%.2f%%)\n" +
                    "éŠ·å”®é‡‘é¡ï¼š%s â†’ %s (æˆé•·ç‡ï¼š%.2f%%)\n" +
                    "ç”¢å“æ•¸é‡ï¼š%d â†’ %d",
                    year1, year2,
                    total1, total2, quantityGrowth,
                    revenue1, revenue2, revenueGrowth,
                    products1.size(), products2.size()
            );
            
            log.info("å¹´åº¦æ¯”è¼ƒå®Œæˆ");
            return result;
            
        } catch (Exception e) {
            log.error("å¹´åº¦éŠ·å”®æ¯”è¼ƒå¤±æ•—", e);
            return "å¹´åº¦éŠ·å”®æ¯”è¼ƒå¤±æ•—ï¼š" + e.getMessage();
        }
    }
}
```

---

## 5.7.3 å¤šå·¥å…·å”ä½œç³»çµ±

### å·¥å…·çµ„åˆé…ç½®

**ChatClient é…ç½®**ï¼š

```java
package com.example.config;

import com.example.tools.DateTimeTools;
import com.example.tools.ProductSalesTools;
import com.example.tools.CalculatorTools;
import lombok.RequiredArgsConstructor;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.chat.model.ChatModel;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
@RequiredArgsConstructor
public class AiConfig {
    
    private final ProductSalesTools productSalesTools;
    private final DateTimeTools dateTimeTools;
    private final CalculatorTools calculatorTools;
    
    /**
     * é…ç½®ä¼æ¥­ç´š ChatClient
     * æ•´åˆå¤šå€‹å·¥å…·ä»¥æ”¯æ´è¤‡é›œçš„ä¼æ¥­æŸ¥è©¢
     */
    @Bean
    public ChatClient enterpriseChatClient(ChatModel chatModel) {
        return ChatClient.builder(chatModel)
                .defaultTools(
                    productSalesTools,    // ç”¢å“éŠ·å”®è³‡æ–™å·¥å…·
                    dateTimeTools,        // æ—¥æœŸæ™‚é–“å·¥å…·
                    calculatorTools       // è¨ˆç®—å·¥å…·
                )
                .defaultSystem("""
                    ä½ æ˜¯ä¸€å€‹å°ˆæ¥­çš„ä¼æ¥­è³‡æ–™åˆ†æå¸«ï¼Œæ“…é•·åˆ†æéŠ·å”®è³‡æ–™å’Œæä¾›å•†æ¥­æ´å¯Ÿã€‚
                    
                    ç•¶ç”¨æˆ¶è©¢å•ä¼æ¥­è³‡æ–™æ™‚ï¼Œè«‹ï¼š
                    1. ä½¿ç”¨é©ç•¶çš„å·¥å…·ç²å–æœ€æ–°è³‡æ–™
                    2. é€²è¡Œæ·±å…¥çš„è³‡æ–™åˆ†æ
                    3. æä¾›æ¸…æ™°çš„æ´å¯Ÿå’Œå»ºè­°
                    4. ç”¨å°ˆæ¥­ä½†æ˜“æ‡‚çš„èªè¨€å›ç­”
                    
                    å¯ç”¨çš„å·¥å…·ï¼š
                    - ç”¢å“éŠ·å”®è³‡æ–™æŸ¥è©¢
                    - éŠ·å”®çµ±è¨ˆåˆ†æ
                    - å¹´åº¦æ¯”è¼ƒåˆ†æ
                    - æ—¥æœŸæ™‚é–“æŸ¥è©¢
                    - æ•¸å­¸è¨ˆç®—
                    """)
                .build();
    }
    
    /**
     * ç°¡åŒ–ç‰ˆ ChatClientï¼ˆåƒ…åŸºç¤åŠŸèƒ½ï¼‰
     */
    @Bean("basicChatClient")
    public ChatClient basicChatClient(ChatModel chatModel) {
        return ChatClient.builder(chatModel)
                .defaultTools(dateTimeTools)
                .build();
    }
}
```

### ä¼æ¥­ç´šæ§åˆ¶å™¨å¯¦ç¾

```java
package com.example.controller;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.web.bind.annotation.*;

import java.time.LocalDateTime;
import java.util.Map;
import java.util.stream.Collectors;

@RestController
@RequestMapping("/api/enterprise")
@RequiredArgsConstructor
@Slf4j
public class EnterpriseAiController {
    
    private final ChatClient enterpriseChatClient;
    
    /**
     * ä¼æ¥­è³‡æ–™æŸ¥è©¢å’Œåˆ†æ
     * @param prompt è‡ªç„¶èªè¨€æŸ¥è©¢
     * @return AI åˆ†æçµæœ
     */
    @GetMapping("/query")
    public String enterpriseQuery(@RequestParam String prompt) {
        try {
            log.info("æ”¶åˆ°ä¼æ¥­æŸ¥è©¢è«‹æ±‚ï¼š{}", prompt);
            
            long startTime = System.currentTimeMillis();
            
            String response = enterpriseChatClient
                    .prompt(prompt)
                    .call()
                    .content();
            
            long endTime = System.currentTimeMillis();
            
            log.info("ä¼æ¥­æŸ¥è©¢å®Œæˆï¼Œè€—æ™‚ï¼š{}ms", endTime - startTime);
            
            return response;
            
        } catch (Exception e) {
            log.error("ä¼æ¥­æŸ¥è©¢å¤±æ•—ï¼š{}", prompt, e);
            return "æŸ¥è©¢å¤±æ•—ï¼š" + e.getMessage();
        }
    }
    
    /**
     * éŠ·å”®è³‡æ–™å°ˆç”¨æŸ¥è©¢
     * @param request éŠ·å”®æŸ¥è©¢è«‹æ±‚
     * @return çµæ§‹åŒ–å›æ‡‰
     */
    @PostMapping("/sales-analysis")
    public SalesAnalysisResponse salesAnalysis(@RequestBody SalesAnalysisRequest request) {
        try {
            log.info("éŠ·å”®åˆ†æè«‹æ±‚ï¼š{}", request);
            
            long startTime = System.currentTimeMillis();
            
            // æ§‹å»ºé‡å°æ€§çš„æç¤ºè©
            String prompt = buildSalesAnalysisPrompt(request);
            
            String aiResponse = enterpriseChatClient
                    .prompt(prompt)
                    .call()
                    .content();
            
            long endTime = System.currentTimeMillis();
            
            return SalesAnalysisResponse.builder()
                    .success(true)
                    .query(request.getQuery())
                    .analysis(aiResponse)
                    .executionTime(endTime - startTime)
                    .timestamp(LocalDateTime.now())
                    .build();
            
        } catch (Exception e) {
            log.error("éŠ·å”®åˆ†æå¤±æ•—", e);
            
            return SalesAnalysisResponse.builder()
                    .success(false)
                    .query(request.getQuery())
                    .error(e.getMessage())
                    .timestamp(LocalDateTime.now())
                    .build();
        }
    }
    
    /**
     * æ‰¹æ¬¡ä¼æ¥­æŸ¥è©¢
     * @param queries å¤šå€‹æŸ¥è©¢è«‹æ±‚
     * @return æ‰¹æ¬¡è™•ç†çµæœ
     */
    @PostMapping("/batch-query")
    public Map<String, String> batchEnterpriseQuery(@RequestBody BatchQueryRequest queries) {
        try {
            log.info("æ‰¹æ¬¡ä¼æ¥­æŸ¥è©¢ï¼š{} å€‹è«‹æ±‚", queries.getQueries().size());
            
            return queries.getQueries().parallelStream()
                    .collect(java.util.stream.Collectors.toMap(
                            query -> query,
                            query -> {
                                try {
                                    return enterpriseChatClient
                                            .prompt(query)
                                            .call()
                                            .content();
                                } catch (Exception e) {
                                    log.error("æ‰¹æ¬¡æŸ¥è©¢å¤±æ•—ï¼š{}", query, e);
                                    return "æŸ¥è©¢å¤±æ•—ï¼š" + e.getMessage();
                                }
                            }
                    ));
            
        } catch (Exception e) {
            log.error("æ‰¹æ¬¡ä¼æ¥­æŸ¥è©¢å¤±æ•—", e);
            return Map.of("error", "æ‰¹æ¬¡æŸ¥è©¢å¤±æ•—ï¼š" + e.getMessage());
        }
    }
    
    private String buildSalesAnalysisPrompt(SalesAnalysisRequest request) {
        StringBuilder prompt = new StringBuilder();
        
        prompt.append("è«‹åˆ†æä»¥ä¸‹éŠ·å”®è³‡æ–™æŸ¥è©¢ï¼š\n");
        prompt.append("æŸ¥è©¢å…§å®¹ï¼š").append(request.getQuery()).append("\n");
        
        if (request.getYear() != null) {
            prompt.append("æŒ‡å®šå¹´ä»½ï¼š").append(request.getYear()).append("\n");
        }
        
        if (request.getProduct() != null) {
            prompt.append("æŒ‡å®šç”¢å“ï¼š").append(request.getProduct()).append("\n");
        }
        
        prompt.append("\nè«‹æä¾›ï¼š\n");
        prompt.append("1. ç›¸é—œçš„éŠ·å”®è³‡æ–™\n");
        prompt.append("2. è³‡æ–™åˆ†æå’Œæ´å¯Ÿ\n");
        prompt.append("3. å•†æ¥­å»ºè­°\n");
        
        return prompt.toString();
    }
}
```

### è«‹æ±‚å’Œå›æ‡‰ DTO

```java
package com.example.dto;

import lombok.Data;
import lombok.Builder;
import java.time.LocalDateTime;
import java.util.List;

@Data
public class SalesAnalysisRequest {
    private String query;
    private String year;
    private String product;
    private String analysisType;  // trend, comparison, forecast
}

@Data
@Builder
public class SalesAnalysisResponse {
    private boolean success;
    private String query;
    private String analysis;
    private Long executionTime;
    private String error;
    private LocalDateTime timestamp;
}

@Data
public class BatchQueryRequest {
    private List<String> queries;
}
```

---

## 5.7.4 å¯¦éš›æ‡‰ç”¨å ´æ™¯

### éŠ·å”®åˆ†æå°è©±ç¯„ä¾‹

**å ´æ™¯ 1ï¼šåŸºç¤éŠ·å”®æŸ¥è©¢**

```
ç”¨æˆ¶ï¼šã€Œè«‹å‘Šè¨´æˆ‘ 2023 å¹´æ‰€æœ‰ç”¢å“çš„éŠ·å”®æƒ…æ³ã€

AI å›æ‡‰ï¼š
æ ¹æ“šæŸ¥è©¢çµæœï¼Œ2023å¹´å…¬å¸å…±æœ‰4æ¬¾ç”¢å“çš„éŠ·å”®è³‡æ–™ï¼š

ğŸ“Š **2023å¹´éŠ·å”®ç¸½è¦½**
- ç¸½éŠ·å”®æ•¸é‡ï¼š26,500 å°
- ç¸½éŠ·å”®é‡‘é¡ï¼š11.45 å„„å…ƒ

ğŸ“ˆ **å„ç”¢å“è¡¨ç¾**
1. PD-1385 æ™ºèƒ½æ‰‹éŒ¶ Sportï¼š15,000å° (56.6%)
2. PD-1234 ç­†è¨˜å‹é›»è…¦ Ultraï¼š10,000å° (37.7%)
3. PD-1235 å¹³æ¿é›»è…¦ Liteï¼š1,500å° (5.7%)

ğŸ’¡ **åˆ†ææ´å¯Ÿ**
- æ™ºèƒ½æ‰‹éŒ¶æ˜¯ä¸»åŠ›ç”¢å“ï¼Œå ç¸½éŠ·é‡è¶…éä¸€åŠ
- ç­†è¨˜å‹é›»è…¦é›–ç„¶éŠ·é‡ç¬¬äºŒï¼Œä½†å–®åƒ¹è¼ƒé«˜ï¼Œè²¢ç»æœ€å¤šç‡Ÿæ”¶
- å¹³æ¿é›»è…¦éŠ·é‡è¼ƒä½ï¼Œå¯èƒ½éœ€è¦é‡æ–°è©•ä¼°å¸‚å ´ç­–ç•¥
```

**å ´æ™¯ 2ï¼šæ¯”è¼ƒåˆ†æ**

```
ç”¨æˆ¶ï¼šã€Œæ¯”è¼ƒä¸€ä¸‹ 2023 å¹´å’Œ 2024 å¹´çš„éŠ·å”®è¡¨ç¾ã€

AI å›æ‡‰ï¼š
ğŸ“Š **2023 vs 2024 å¹´åº¦éŠ·å”®æ¯”è¼ƒ**

**æ•´é«”è¡¨ç¾**
- éŠ·å”®æ•¸é‡ï¼š26,500 â†’ 54,500 å° (+105.7%)
- éŠ·å”®é‡‘é¡ï¼š11.45 â†’ 20.55 å„„å…ƒ (+79.5%)
- ç”¢å“ç·šï¼š4 â†’ 5 æ¬¾ç”¢å“

**æˆé•·äº®é»**
1. æ–°å¢ç”¢å“ç·šå¸¶ä¾†é¡¯è‘—æˆé•·
2. æ—¢æœ‰ç”¢å“ PD-1235 å’Œ PD-1385 éƒ½æœ‰å¤§å¹…æå‡
3. å¹³å‡å–®åƒ¹æœ‰æ‰€ä¸‹é™ï¼Œä½†ç¸½ç‡Ÿæ”¶å¤§å¹…æˆé•·

**ç­–ç•¥å»ºè­°**
- ç¹¼çºŒæ“´å±•ç”¢å“ç·šå¤šæ¨£åŒ–
- åŠ å¼·æ™ºèƒ½å®¶å±…å’ŒéŸ³éŸ¿è¨­å‚™å¸‚å ´å¸ƒå±€
- å„ªåŒ–å®šåƒ¹ç­–ç•¥ä»¥æå‡åˆ©æ½¤ç‡
```

**å ´æ™¯ 3ï¼šæ·±åº¦åˆ†æ**

```
ç”¨æˆ¶ï¼šã€Œåˆ†æä¸€ä¸‹æˆ‘å€‘åœ¨ç©¿æˆ´è£ç½®é¡åˆ¥çš„è¡¨ç¾ï¼Œä¸¦çµ¦å‡ºå¸‚å ´å»ºè­°ã€

AI å›æ‡‰ï¼š
ğŸ” **ç©¿æˆ´è£ç½®é¡åˆ¥æ·±åº¦åˆ†æ**

**ç”¢å“è¡¨ç¾**
- PD-1385 æ™ºèƒ½æ‰‹éŒ¶ç³»åˆ—ï¼š2023å¹´ 15,000å° â†’ 2024å¹´ 15,000å°
- å¸‚å ´å æœ‰ç‡ï¼šåœ¨å…¬å¸ç¸½éŠ·é‡ä¸­å æ¯”å¾ 56.6% é™è‡³ 27.5%

**å¸‚å ´æ´å¯Ÿ**
1. **éŠ·é‡ç©©å®šä½†ç›¸å°æˆé•·æ”¾ç·©**ï¼šé›–ç„¶çµ•å°æ•¸é‡ç¶­æŒï¼Œä½†åœ¨å…¬å¸å¿«é€Ÿæˆé•·ä¸­ç›¸å°æ¯”é‡ä¸‹é™
2. **ç”¢å“å‡ç´šæˆåŠŸ**ï¼šå¾ Sport ç‰ˆå‡ç´šåˆ° Ultra ç‰ˆï¼Œå–®åƒ¹æå‡ 50%
3. **å¸‚å ´ç«¶çˆ­åŠ åŠ‡**ï¼šç©¿æˆ´è£ç½®å¸‚å ´è¶¨æ–¼é£½å’Œ

**ç­–ç•¥å»ºè­°**
1. **ç”¢å“å·®ç•°åŒ–**ï¼šé–‹ç™¼å°ˆæ¥­é‹å‹•ã€å¥åº·ç›£æ¸¬ç­‰ç´°åˆ†å¸‚å ´ç”¢å“
2. **ç”Ÿæ…‹ç³»çµ±æ•´åˆ**ï¼šèˆ‡å…¶ä»–ç”¢å“ç·šå½¢æˆäº’è£œï¼Œæå‡ç”¨æˆ¶é»æ€§
3. **æœå‹™åŒ–è½‰å‹**ï¼šå¢åŠ è»Ÿé«”æœå‹™å’Œè¨‚é–±æ¨¡å¼æ”¶å…¥
4. **åœ‹éš›å¸‚å ´æ‹“å±•**ï¼šå°‹æ‰¾æ–°èˆˆå¸‚å ´æ©Ÿæœƒ
```

---

## ğŸ“ æœ¬ç« é‡é»å›é¡§

1. **ä¼æ¥­è³‡æ–™æ•´åˆ**ï¼šå­¸æœƒäº†è®“ AI å­˜å–å’Œåˆ†æä¼æ¥­å…§éƒ¨è³‡æ–™çš„å®Œæ•´æ–¹æ³•
2. **è¤‡é›œå·¥å…·è¨­è¨ˆ**ï¼šæŒæ¡äº†å¸¶åƒæ•¸å’Œçµæ§‹åŒ–å›æ‡‰çš„é€²éšå·¥å…·å¯¦ç¾
3. **å¤šå·¥å…·å”ä½œ**ï¼šå¯¦ç¾äº†å¤šå€‹å·¥å…·çš„æ™ºèƒ½çµ„åˆå’Œå”åŒå·¥ä½œ
4. **è³‡æ–™æ¨¡å‹è¨­è¨ˆ**ï¼šå»ºç«‹äº†ä¼æ¥­ç´šè³‡æ–™æ¨¡å‹å’Œå›æ‡‰çµæ§‹
5. **å¯¦éš›æ‡‰ç”¨å ´æ™¯**ï¼šå±•ç¤ºäº†çœŸå¯¦çš„ä¼æ¥­ AI åˆ†æå°è©±å’Œæ´å¯Ÿç”Ÿæˆ

### æŠ€è¡“è¦é»ç¸½çµ

| æŠ€è¡“é» | é‡è¦æ€§ | å¯¦ç¾é›£åº¦ | ä½¿ç”¨å ´æ™¯ |
|--------|--------|----------|----------|
| **ä¼æ¥­è³‡æ–™å­˜å–** | â­â­â­ | ä¸­ | æ‰€æœ‰ä¼æ¥­ AI æ‡‰ç”¨ |
| **çµæ§‹åŒ–å›æ‡‰** | â­â­â­ | ä¸­ | è³‡æ–™åˆ†æç³»çµ± |
| **å¤šå·¥å…·å”ä½œ** | â­â­ | é«˜ | è¤‡é›œæ¥­å‹™å ´æ™¯ |
| **è³‡æ–™æ¨¡å‹è¨­è¨ˆ** | â­â­ | ä¸­ | ä¼æ¥­ç´šæ‡‰ç”¨ |
| **æ™ºèƒ½åˆ†æ** | â­â­ | é«˜ | å•†æ¥­æ´å¯Ÿç³»çµ± |
| **æ‰¹æ¬¡è™•ç†** | â­ | ä¸­ | å¤§é‡æŸ¥è©¢å ´æ™¯ |

### ä¼æ¥­æ‡‰ç”¨åƒ¹å€¼

**1. é™ä½åˆ†æé–€æª»**
- ğŸ—£ï¸ **è‡ªç„¶èªè¨€æŸ¥è©¢**ï¼šæ¥­å‹™äººå“¡ç„¡éœ€å­¸ç¿’è¤‡é›œçš„ BI å·¥å…·
- âš¡ **å³æ™‚å›æ‡‰**ï¼šå¾æ•¸å¤©çš„å ±è¡¨è£½ä½œç¸®çŸ­åˆ°å¹¾ç§’é˜
- ğŸ¯ **ç²¾æº–æ´å¯Ÿ**ï¼šAI è‡ªå‹•ç™¼ç¾è³‡æ–™ä¸­çš„æ¨¡å¼å’Œè¶¨å‹¢

**2. æå‡æ±ºç­–æ•ˆç‡**
- ğŸ“Š **å³æ™‚è³‡æ–™**ï¼šåŸºæ–¼æœ€æ–°è³‡æ–™é€²è¡Œæ±ºç­–
- ğŸ” **æ·±åº¦åˆ†æ**ï¼šå¤šç¶­åº¦çš„è³‡æ–™åˆ†æå’Œæ¯”è¼ƒ
- ğŸ’¡ **æ™ºèƒ½å»ºè­°**ï¼šåŸºæ–¼è³‡æ–™çš„å•†æ¥­å»ºè­°å’Œç­–ç•¥

**3. æ“´å±•æ‡‰ç”¨å ´æ™¯**
- ğŸ“ˆ **éŠ·å”®åˆ†æ**ï¼šç”¢å“è¡¨ç¾ã€å¸‚å ´è¶¨å‹¢ã€å®¢æˆ¶è¡Œç‚º
- ğŸ’° **è²¡å‹™ç®¡ç†**ï¼šæ”¶æ”¯åˆ†æã€æˆæœ¬æ§åˆ¶ã€é ç®—è¦åŠƒ
- ğŸ‘¥ **äººåŠ›è³‡æº**ï¼šå“¡å·¥ç¸¾æ•ˆã€è–ªè³‡åˆ†æã€äººæ‰è¦åŠƒ
- ğŸ“¦ **ç‡Ÿé‹ç®¡ç†**ï¼šåº«å­˜å„ªåŒ–ã€ä¾›æ‡‰éˆåˆ†æã€å“è³ªæ§åˆ¶

### ä¸‹ä¸€æ­¥å­¸ç¿’æ–¹å‘

åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘å€‘å°‡å­¸ç¿’ Function Calling çš„æœ€çµ‚çµ„åˆæŠ€ï¼ŒåŒ…æ‹¬è¤‡é›œå·¥å…·éˆã€æ¢ä»¶å¼èª¿ç”¨å’Œä¼æ¥­ç´šå·¥å…·ç”Ÿæ…‹ç³»çµ±çš„å»ºç«‹ã€‚

---

**åƒè€ƒè³‡æ–™ï¼š**
- [Spring AI Tool Calling Advanced Guide](https://docs.spring.io/spring-ai/reference/api/tools.html)
- [Enterprise AI Integration Patterns](https://docs.spring.io/spring-ai/reference/concepts.html)
- [JSON Schema for Tool Parameters](https://json-schema.org/)
- [Business Intelligence with AI](https://www.mckinsey.com/capabilities/quantumblack/our-insights/the-age-of-ai)