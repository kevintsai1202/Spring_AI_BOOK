# 4.1 å–å¾— AI å…¥é–€é‘°åŒ™ API key

> **ç¬¬å››ç« å°è®€**ï¼šæ­¡è¿é€²å…¥ Spring AI çš„ä¸–ç•Œï¼æœ¬ç« å°‡å¸¶æ‚¨å¾é›¶é–‹å§‹å­¸ç¿’ Spring AI çš„æ ¸å¿ƒæ¦‚å¿µå’ŒåŸºç¤æ‡‰ç”¨ï¼Œç‚ºå¾ŒçºŒçš„ä¼æ¥­ç´š RAG çŸ¥è­˜åº«é–‹ç™¼å¥ å®šå …å¯¦åŸºç¤ã€‚

## ğŸ¯ å­¸ç¿’ç›®æ¨™

å®Œæˆæœ¬ç« å­¸ç¿’å¾Œï¼Œæ‚¨å°‡èƒ½å¤ ï¼š

- ğŸ¯ **å–å¾— AI æœå‹™ API Key**ï¼šå­¸æœƒç”³è«‹å’Œé…ç½®å„ç¨® AI æœå‹™çš„ API é‡‘é‘°
- ğŸ¯ **ç†è§£ AI æœå‹™æˆæœ¬**ï¼šæŒæ¡ä¸åŒ AI æ¨¡å‹çš„å®šåƒ¹ç­–ç•¥å’Œæˆæœ¬æ§åˆ¶
- ğŸ¯ **é…ç½®é–‹ç™¼ç’°å¢ƒ**ï¼šç‚º Spring AI é–‹ç™¼æº–å‚™å¿…è¦çš„èªè­‰è³‡è¨Š
- ğŸ¯ **é¸æ“‡åˆé©çš„ AI æœå‹™**ï¼šäº†è§£å„ç¨® AI æœå‹™æä¾›å•†çš„ç‰¹é»å’Œé©ç”¨å ´æ™¯
- ğŸ¯ **å»ºç«‹å®‰å…¨çš„é…ç½®ç®¡ç†**ï¼šå­¸æœƒå®‰å…¨åœ°ç®¡ç† API é‡‘é‘°å’Œæ•æ„Ÿè³‡è¨Š

---

## 4.1.1 ç‚ºä»€éº¼éœ€è¦ API Keyï¼Ÿ

### é–‹å•Ÿ AI çš„é‘°åŒ™

![AI API Key](https://ithelp.ithome.com.tw/upload/images/20240810/20161290sQLWvAdoDT.jpg)

å¹³å¸¸ä½¿ç”¨ ChatGPT æˆ–å…¶ä»–é¡ä¼¼çš„å°è©± AI éƒ½å¯ç›´æ¥ä½¿ç”¨ï¼Œå¤§ä¸äº†é¡åº¦æ²’äº†æœƒé™ç‚ºæ•ˆæœæ¯”è¼ƒå·®çš„æ¨¡å‹ï¼Œä¸éè¦é€²è¡Œç¨‹å¼é–‹ç™¼å°±éœ€è¦å…ˆç”³è«‹ API keyï¼Œé™¤éä½¿ç”¨æœ¬åœ°çš„ LLMã€‚

**API Key çš„é‡è¦æ€§**ï¼š
- ğŸ” **èº«ä»½èªè­‰**ï¼šè­‰æ˜æ‚¨æœ‰æ¬Šé™ä½¿ç”¨ AI æœå‹™
- ğŸ’° **è¨ˆè²»ç®¡ç†**ï¼šè¿½è¹¤å’Œæ§åˆ¶ API ä½¿ç”¨æˆæœ¬
- ğŸš¦ **æµé‡æ§åˆ¶**ï¼šç®¡ç† API å‘¼å«é »ç‡å’Œé…é¡
- ğŸ“Š **ä½¿ç”¨çµ±è¨ˆ**ï¼šç›£æ§ API ä½¿ç”¨æƒ…æ³å’Œæ•ˆèƒ½
- ğŸ›¡ï¸ **å®‰å…¨ä¿è­·**ï¼šé˜²æ­¢æœªæˆæ¬Šçš„ API å­˜å–

### AI æœå‹™æˆæœ¬é©å‘½

åŸæœ¬å‡±æ–‡å¤§å”æ¸¬è©¦ AI éƒ½ä»¥æœ¬åœ° LLM æˆ–æ˜¯ä¸€äº›å…è²»çš„æœå‹™ç‚ºä¸»ï¼Œä¸é 2025 å¹´ 8 æœˆ [OpenAI æ­£å¼ç™¼å¸ƒ GPT-5](https://openai.com/index/introducing-gpt-5/) ç³»åˆ—æ¨¡å‹å¾Œå°±å®Œå…¨æ”¹è§€äº†ï¼š

**GPT-5 é©å‘½æ€§å„ªå‹¢**ï¼š
- ğŸš€ **çµ±ä¸€ç³»çµ±**ï¼šçµåˆæ¨ç†å’Œå¿«é€Ÿå›æ‡‰çš„çµ±ä¸€ AI æ¨¡å‹
- ğŸ’¡ **è¶…å¼·æ€§èƒ½**ï¼šæ•¸å­¸èƒ½åŠ› 94.6%ï¼Œç·¨ç¨‹èƒ½åŠ› 74.9%ï¼Œæ¸›å°‘ 45% éŒ¯èª¤ç‡
- ğŸ’° **å½ˆæ€§å®šåƒ¹**ï¼šGPT-5 Nano åªéœ€ $0.05/ç™¾è¬ Tokenï¼Œè¶…ä½æˆæœ¬å…¥é–€
- âš¡ **å¤šå±¤é¸æ“‡**ï¼šå¾ Nano åˆ°å®Œæ•´ç‰ˆ GPT-5ï¼Œæ»¿è¶³ä¸åŒéœ€æ±‚
- ğŸ¯ **é™ä½é–€æª»**ï¼šè®“åŸæœ¬çŒ¶è±«ä¸æ±ºçš„é–‹ç™¼äººå“¡ä¸€èµ·åŠ å…¥ AI çš„è³½é“

---

## 4.1.2 ä¸»è¦ AI æœå‹™æä¾›å•†

### OpenAI - æ¥­ç•Œæ¨™ç«¿

**ç”³è«‹æ­¥é©Ÿ**ï¼š
1. **è¨»å†Šå¸³è™Ÿ**ï¼šå‰å¾€ [OpenAI Platform](https://platform.openai.com/)
2. **é©—è­‰èº«ä»½**ï¼šæä¾›æ‰‹æ©Ÿè™Ÿç¢¼é€²è¡Œé©—è­‰
3. **å»ºç«‹ API Key**ï¼š
   - é»æ“Šå³ä¸Šè§’å€‹äººé ­åƒ
   - é¸æ“‡ã€ŒView API keysã€
   - é»æ“Šã€ŒCreate new secret keyã€
   - ç‚º Key å‘½åï¼ˆå¦‚ï¼šspring-ai-demoï¼‰
   - è¤‡è£½ä¸¦å®‰å…¨ä¿å­˜ API Key

**é‡è¦æé†’**ï¼š
```
âš ï¸ API Key åªæœƒé¡¯ç¤ºä¸€æ¬¡ï¼Œè«‹å‹™å¿…ç«‹å³è¤‡è£½ä¸¦å®‰å…¨ä¿å­˜ï¼
```

**OpenAI æ¨¡å‹é¸æ“‡**ï¼š

| æ¨¡å‹ | é©ç”¨å ´æ™¯ | æˆæœ¬ | ç‰¹é» | å®šåƒ¹ (æ¯ç™¾è¬ Token) |
|------|----------|------|------|-------------------|
| **GPT-5** | æœ€è¤‡é›œä»»å‹™ã€å°ˆæ¥­ç´šæ‡‰ç”¨ | æ¥µé«˜ | ğŸš€ 2025æœ€æ–°æ——è‰¦ï¼Œçµ±ä¸€æ¨ç†ç³»çµ± | è¼¸å…¥$1.25 / è¼¸å‡º$10 |
| **GPT-5 Mini** | å¹³è¡¡å‹é¸æ“‡ã€å•†æ¥­æ‡‰ç”¨ | ä¸­é«˜ | âš¡ ä¸­ç­‰æ€§èƒ½ï¼Œæ”¯æ´æ¨ç†åŠŸèƒ½ | è¼¸å…¥$0.25 / è¼¸å‡º$2 |
| **GPT-5 Nano** | é–‹ç™¼æ¸¬è©¦ã€è¼•é‡æ‡‰ç”¨ | ä½ | ğŸ’¡ è¼•é‡é«˜æ•ˆï¼Œå…¥é–€æ¨è–¦ | è¼¸å…¥$0.05 / è¼¸å‡º$0.40 |
| **o1** | è¤‡é›œæ¨ç†ã€æ•¸å­¸ã€ç·¨ç¨‹ | æ¥µé«˜ | ğŸ§  æ·±åº¦æ€è€ƒæ¨ç†å°ˆå®¶ | - |
| **GPT-4o mini** | èˆŠç‰ˆè¼•é‡é¸æ“‡ | ä½ | ğŸ“Š ç¶“å…¸æ€§åƒ¹æ¯”é¸æ“‡ | - |

### Groq - é«˜é€Ÿæ¨ç†

**ç‰¹è‰²**ï¼š
- âš¡ **è¶…é«˜é€Ÿåº¦**ï¼šæ¨ç†é€Ÿåº¦æ¥µå¿«
- ğŸ†“ **å…è²»ä½¿ç”¨**ï¼šç›®å‰æä¾›å…è²»æœå‹™
- ğŸ¯ **é–‹ç™¼å‹å¥½**ï¼šé©åˆé–‹ç™¼å’Œæ¸¬è©¦éšæ®µ

**ç”³è«‹æ­¥é©Ÿ**ï¼š
1. å‰å¾€ [Groq Console](https://console.groq.com/)
2. ä½¿ç”¨ Google æˆ– GitHub å¸³è™Ÿç™»å…¥
3. åœ¨ API Keys é é¢å»ºç«‹æ–°çš„ API Key
4. è¤‡è£½ä¸¦ä¿å­˜ API Key

### Anthropic Claude - æœ€æ–°æ™ºèƒ½é¸æ“‡

**2025 å¹´æœ€å¼·å¯«ç¨‹å¼ AI**ï¼š
- ğŸ§  **Claude 4 ç³»åˆ—**ï¼šæ¥­ç•Œæœ€æ–°çš„æ™ºèƒ½æ¨¡å‹
- ğŸ¯ **å¤šæ¨¡æ…‹èƒ½åŠ›**ï¼šæ”¯æ´æ–‡å­—ã€åœ–ç‰‡ã€PDF è™•ç†
- ğŸ’¡ **æ€è€ƒåŠŸèƒ½**ï¼šClaude Opus 4.1 å…·å‚™é€æ˜æ¨ç†éç¨‹
- ğŸ”§ **å·¥å…·æ•´åˆ**ï¼šå®Œæ•´æ”¯æ´å‡½æ•¸èª¿ç”¨å’Œå·¥å…·ä½¿ç”¨
- ğŸ’° **å½ˆæ€§å®šåƒ¹**ï¼šå¾ä¾¿å®œçš„ Haiku åˆ°å¼·å¤§çš„ Opus

**ç”³è«‹æ­¥é©Ÿ**ï¼š
1. **è¨»å†Šå¸³è™Ÿ**ï¼šå‰å¾€ [Anthropic Console](https://console.anthropic.com/)
2. **å»ºç«‹ API Key**ï¼š
   - ç™»å…¥å¾Œé€²å…¥ [API Keys](https://console.anthropic.com/settings/keys)
   - é»æ“Šã€ŒCreate Keyã€
   - ç‚º Key å‘½åä¸¦è¨­å®šæ¬Šé™
   - è¤‡è£½ä¸¦å®‰å…¨ä¿å­˜ API Key

**Claude æ¨¡å‹é¸æ“‡**ï¼š

| æ¨¡å‹ | é©ç”¨å ´æ™¯ | æˆæœ¬ | ç‰¹é» |
|------|----------|------|------|
| **Claude Opus 4.1** | æœ€è¤‡é›œçš„æ¨ç†ä»»å‹™ | æ¥µé«˜ | æœ€å¼·æ™ºèƒ½ï¼Œç·¨ç¢¼å°ˆå®¶ |
| **Claude Sonnet 4** | å¹³è¡¡å‹é¸æ“‡ | é«˜ | é«˜æ•ˆèƒ½ï¼Œ100è¬ Token èªå¢ƒ |

---

## 4.1.3 API Key é…ç½®èˆ‡ç®¡ç†

### Spring Boot é…ç½®æ–¹å¼

**1. application.yml é…ç½®**
```yaml
spring:
  ai:
    openai:
      api-key: ${OPENAI_API_KEY}
      base-url: https://api.openai.com
      chat:
        options:
          model: gpt-5-nano
    
    # Anthropic Claude é…ç½®
    anthropic:
      api-key: ${ANTHROPIC_API_KEY}
      chat:
        options:
          model: claude-sonnet-4-0
    
    # Groq é…ç½®ç¯„ä¾‹
    groq:
      api-key: ${GROQ_API_KEY}
      chat:
        options:
          model: llama-3.1-70b-versatile
```

**2. ç’°å¢ƒè®Šæ•¸è¨­å®š**
```bash
# Windows PowerShell
$env:OPENAI_API_KEY="your-openai-api-key-here"
$env:ANTHROPIC_API_KEY="your-anthropic-api-key-here"
$env:GROQ_API_KEY="your-groq-api-key-here"

# Linux/macOS
export OPENAI_API_KEY="your-openai-api-key-here"
export ANTHROPIC_API_KEY="your-anthropic-api-key-here"
export GROQ_API_KEY="your-groq-api-key-here"
```

**3. IDE ç’°å¢ƒè®Šæ•¸é…ç½®**

åœ¨ STS4 ä¸­é…ç½®ç’°å¢ƒè®Šæ•¸ï¼š
1. å³éµé»æ“Šå°ˆæ¡ˆ â†’ Run As â†’ Run Configurations
2. é¸æ“‡ Spring Boot App
3. åˆ‡æ›åˆ° Environment æ¨™ç±¤
4. æ–°å¢ç’°å¢ƒè®Šæ•¸ï¼š
   - Name: `OPENAI_API_KEY`
   - Value: `your-api-key-here`

### å®‰å…¨æœ€ä½³å¯¦è¸

**1. çµ•ä¸å°‡ API Key å¯«å…¥ç¨‹å¼ç¢¼**
```java
// âŒ éŒ¯èª¤åšæ³• - ç¡¬ç·¨ç¢¼ API Key
public class BadExample {
    private static final String API_KEY = "sk-1234567890abcdef"; // å±éšªï¼
}

// âœ… æ­£ç¢ºåšæ³• - ä½¿ç”¨ç’°å¢ƒè®Šæ•¸æˆ–æ³¨å…¥ OpenAiApi
@Value("${spring.ai.openai.api-key}")
private String apiKey;

// æˆ–è€…ä½¿ç”¨å®˜æ–¹æ¨è–¦çš„æ–¹å¼
@Autowired
private OpenAiApi openAiApi;
```

**2. ä½¿ç”¨ .env æª”æ¡ˆï¼ˆé–‹ç™¼ç’°å¢ƒï¼‰**
```properties
# .env æª”æ¡ˆ
OPENAI_API_KEY=your-openai-api-key-here
GROQ_API_KEY=your-groq-api-key-here
```

**é‡è¦æé†’**ï¼š
```
âš ï¸ å‹™å¿…å°‡ .env æª”æ¡ˆåŠ å…¥ .gitignoreï¼Œé¿å…æ„å¤–æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»çµ±ï¼
```

---

## 4.1.4 æˆæœ¬æ§åˆ¶èˆ‡ç›£æ§

### OpenAI æˆæœ¬ç®¡ç†

**1. è¨­å®šä½¿ç”¨é™åˆ¶**
- åœ¨ OpenAI Platform è¨­å®šæœˆåº¦é ç®—ä¸Šé™
- é…ç½®ä½¿ç”¨é‡è­¦å‘Šé€šçŸ¥
- ç›£æ§ API å‘¼å«çµ±è¨ˆ

**2. æ¨¡å‹é¸æ“‡ç­–ç•¥**
```java
@Service
public class AIModelSelector {
    
    // é–‹ç™¼ç’°å¢ƒä½¿ç”¨ä¾¿å®œçš„æ¨¡å‹
    @Profile("dev")
    @Bean
    public OpenAiChatModel devChatModel(OpenAiApi openAiApi) {
        return OpenAiChatModel.builder()
            .openAiApi(openAiApi)
            .options(OpenAiChatOptions.builder()
                .model("gpt-5-nano") // æœ€ä¾¿å®œçš„é¸é …
                .build())
            .build();
    }
    
    // ç”Ÿç”¢ç’°å¢ƒä½¿ç”¨é«˜æ€§èƒ½æ¨¡å‹
    @Profile("prod")
    @Bean
    public OpenAiChatModel prodChatModel(OpenAiApi openAiApi) {
        return OpenAiChatModel.builder()
            .openAiApi(openAiApi)
            .options(OpenAiChatOptions.builder()
                .model("gpt-5") // æœ€å¼·çµ±ä¸€ç³»çµ±
                .build())
            .build();
    }
}
```

### ä½¿ç”¨é‡ç›£æ§

**1. å»ºç«‹ä½¿ç”¨çµ±è¨ˆ**
```java
@Component
public class AIUsageTracker {
    
    private final MeterRegistry meterRegistry;
    private final Counter apiCallCounter;
    private final Timer responseTimer;
    
    public AIUsageTracker(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        this.apiCallCounter = Counter.builder("ai.api.calls")
            .description("AI API calls count")
            .register(meterRegistry);
        this.responseTimer = Timer.builder("ai.api.response.time")
            .description("AI API response time")
            .register(meterRegistry);
    }
    
    public void recordApiCall(String model, Duration responseTime) {
        apiCallCounter.increment(Tags.of("model", model));
        responseTimer.record(responseTime);
    }
}
```

**2. æˆæœ¬é ä¼°å·¥å…·**
```java
@Service
public class CostEstimator {
    
    // GPT-5 nano å®šåƒ¹ï¼ˆæ¯ 1M tokensï¼‰- 2025å¹´8æœˆæœ€æ–°
    private static final double INPUT_COST_PER_MILLION = 0.05;  // $0.05
    private static final double OUTPUT_COST_PER_MILLION = 0.40; // $0.40
    
    public double estimateCost(int inputTokens, int outputTokens) {
        double inputCost = (inputTokens / 1_000_000.0) * INPUT_COST_PER_MILLION;
        double outputCost = (outputTokens / 1_000_000.0) * OUTPUT_COST_PER_MILLION;
        return inputCost + outputCost;
    }
}
```

---

## 4.1.5 å¤šæœå‹™æä¾›å•†é…ç½®

### å½ˆæ€§åˆ‡æ›ç­–ç•¥

```java
@Configuration
public class MultiAIProviderConfig {
    
    @Value("${app.ai.provider:openai}")
    private String aiProvider;
    
    @Bean
    @Primary
    public ChatModel primaryChatModel(
            @Qualifier("openaiChatModel") ChatModel openaiModel,
            @Qualifier("anthropicChatModel") ChatModel anthropicModel,
            @Qualifier("groqChatModel") ChatModel groqModel) {
        
        return switch (aiProvider.toLowerCase()) {
            case "anthropic", "claude" -> anthropicModel;
            case "groq" -> groqModel;
            case "openai" -> openaiModel;
            default -> openaiModel;
        };
    }
    
    @Bean("openaiChatModel")
    public OpenAiChatModel openaiChatModel(OpenAiApi openAiApi) {
        return OpenAiChatModel.builder()
            .openAiApi(openAiApi)
            .options(OpenAiChatOptions.builder()
                .model("gpt-5-nano")
                .build())
            .build();
    }
    
    @Bean("anthropicChatModel")
    public AnthropicChatModel anthropicChatModel() {
        var anthropicApi = new AnthropicApi(anthropicApiKey);
        return AnthropicChatModel.builder()
            .anthropicApi(anthropicApi)
            .defaultOptions(AnthropicChatOptions.builder()
                .model("claude-sonnet-4-0")
                .temperature(0.7)
                .maxTokens(1000)
                .build())
            .build();
    }
    
    @Bean("groqChatModel")
    public OpenAiChatModel groqChatModel() {
        // Groq ä½¿ç”¨ OpenAI ç›¸å®¹ API
        var groqApi = OpenAiApi.builder()
            .apiKey(groqApiKey)
            .baseUrl("https://api.groq.com/openai/v1")
            .build();
        
        return OpenAiChatModel.builder()
            .openAiApi(groqApi)
            .options(OpenAiChatOptions.builder()
                .model("llama-3.1-70b-versatile")
                .build())
            .build();
    }
}
```

### å®¹éŒ¯æ©Ÿåˆ¶

```java
@Service
public class ResilientAIService {
    
    private final List<ChatModel> chatModels;
    
    public ResilientAIService(
            @Qualifier("openaiChatModel") ChatModel openaiModel,
            @Qualifier("anthropicChatModel") ChatModel anthropicModel,
            @Qualifier("groqChatModel") ChatModel groqModel) {
        this.chatModels = List.of(openaiModel, anthropicModel, groqModel);
    }
    
    public String chat(String message) {
        for (ChatModel model : chatModels) {
            try {
                return model.call(message);
            } catch (Exception e) {
                log.warn("AI service failed, trying next provider: {}", e.getMessage());
            }
        }
        throw new RuntimeException("All AI services are unavailable");
    }
}
```

---

## ğŸ“ æœ¬ç« é‡é»å›é¡§

1. **API Key é‡è¦æ€§**ï¼šç†è§£äº† API Key åœ¨ AI æœå‹™ä¸­çš„é—œéµä½œç”¨
2. **æœå‹™æä¾›å•†é¸æ“‡**ï¼šæŒæ¡äº† OpenAIã€Groqã€Azure ç­‰ä¸»è¦æœå‹™å•†çš„ç‰¹é»
3. **å®‰å…¨é…ç½®ç®¡ç†**ï¼šå­¸æœƒäº†å®‰å…¨åœ°ç®¡ç†å’Œé…ç½® API é‡‘é‘°
4. **æˆæœ¬æ§åˆ¶ç­–ç•¥**ï¼šäº†è§£äº†å¦‚ä½•ç›£æ§å’Œæ§åˆ¶ AI æœå‹™ä½¿ç”¨æˆæœ¬
5. **å¤šæœå‹™å•†æ•´åˆ**ï¼šå»ºç«‹äº†å½ˆæ€§çš„å¤šæœå‹™å•†åˆ‡æ›æ©Ÿåˆ¶

### ä¸‹ä¸€æ­¥å­¸ç¿’æ–¹å‘

åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘å€‘å°‡ä½¿ç”¨å–å¾—çš„ API Key å»ºç«‹ç¬¬ä¸€å€‹ Spring AI æ‡‰ç”¨ç¨‹å¼ï¼Œé«”é©—ã€ŒHello AI Worldã€çš„é­…åŠ›ã€‚

---

**åƒè€ƒè³‡æ–™ï¼š**
- [OpenAI Platform Documentation](https://platform.openai.com/docs)
- [Groq API Documentation](https://console.groq.com/docs)
- [Azure OpenAI Service](https://azure.microsoft.com/en-us/products/ai-services/openai-service)
- [Spring AI Reference Guide](https://docs.spring.io/spring-ai/reference/)