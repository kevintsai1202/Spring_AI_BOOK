# 5.1 æ‡¶å¾—æ‰“å­—å• AIï¼Ÿç”¨æç¤ºè©ç¯„æœ¬å§

> **æœ¬ç« é‡é»**ï¼šå­¸ç¿’ä½¿ç”¨æç¤ºè©ç¯„æœ¬ï¼ˆPrompt Templateï¼‰ä¾†æ¨™æº–åŒ–å’Œå„ªåŒ– AI äº’å‹•ï¼Œæå‡æç¤ºè©çš„å“è³ªå’Œä¸€è‡´æ€§ï¼Œç‚ºå€‹æ€§åŒ– ChatBot å¥ å®šåŸºç¤ã€‚

## ğŸ¯ å­¸ç¿’ç›®æ¨™

å®Œæˆæœ¬ç« å­¸ç¿’å¾Œï¼Œæ‚¨å°‡èƒ½å¤ ï¼š

- ğŸ¯ **ç†è§£æç¤ºè©ç¯„æœ¬çš„é‡è¦æ€§**ï¼šæŒæ¡ã€ŒGarbage in, Garbage outã€åŸå‰‡åœ¨ AI ä¸­çš„æ‡‰ç”¨
- ğŸ¯ **ä½¿ç”¨ PromptTemplate é¡åˆ¥**ï¼šå­¸æœƒå»ºç«‹å’Œä½¿ç”¨å‹•æ…‹æç¤ºè©ç¯„æœ¬
- ğŸ¯ **æ•´åˆ ChatClient API**ï¼šå°‡ç¯„æœ¬èˆ‡ç¾ä»£åŒ–çš„ ChatClient æµæš¢ API çµåˆ
- ğŸ¯ **å»ºç«‹ç¯„æœ¬åº«**ï¼šè¨­è¨ˆå¯é‡è¤‡ä½¿ç”¨çš„æç¤ºè©ç¯„æœ¬ç³»çµ±
- ğŸ¯ **å„ªåŒ–æç¤ºè©å“è³ª**ï¼šæŒæ¡æç¤ºè©è¨­è¨ˆçš„æœ€ä½³å¯¦è¸

---

## 5.1.1 ç‚ºä»€éº¼éœ€è¦æç¤ºè©ç¯„æœ¬ï¼Ÿ

### Garbage in, Garbage out

![æç¤ºè©ç¯„æœ¬](https://ithelp.ithome.com.tw/upload/images/20240810/201612907PBWefpaFK.jpg)

**Garbage in, Garbage out** ä¹Ÿé©ç”¨åœ¨ AI é ˜åŸŸã€‚æœ‰äº›äººå°±æ˜¯ä¸çŸ¥å¦‚ä½•å• AIï¼Œå¾—åˆ°çš„è§£ç­”è‡ªç„¶ä¹Ÿä¸å…·åƒè€ƒåƒ¹å€¼ï¼Œé€™æ™‚æç¤ºè©ç¯„æœ¬å°±æ´¾ä¸Šç”¨å ´äº†ã€‚

### æç¤ºè©ç¯„æœ¬çš„æ ¸å¿ƒåƒ¹å€¼

**1. æ¨™æº–åŒ–äº’å‹•æ¨¡å¼**
```
âŒ ä¸è‰¯æç¤ºè©ï¼š
"å‘Šè¨´æˆ‘é—œæ–¼ Spring Boot"

âœ… å„ªè³ªæç¤ºè©ç¯„æœ¬ï¼š
"ä½œç‚ºä¸€å€‹è³‡æ·±çš„ Java é–‹ç™¼å°ˆå®¶ï¼Œè«‹è©³ç´°èªªæ˜ {topic} çš„æ ¸å¿ƒæ¦‚å¿µã€
ä¸»è¦ç‰¹æ€§ã€ä½¿ç”¨å ´æ™¯ï¼Œä¸¦æä¾›ä¸€å€‹å¯¦éš›çš„ç¨‹å¼ç¢¼ç¯„ä¾‹ã€‚
è«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ï¼Œä¸¦ç¢ºä¿å…§å®¹é©åˆ {experience_level} é–‹ç™¼è€…ã€‚"
```

**2. æå‡å›æ‡‰å“è³ª**
- ğŸ¯ **æ˜ç¢ºçš„è§’è‰²è¨­å®š**ï¼šè®“ AI æ‰®æ¼”ç‰¹å®šå°ˆæ¥­è§’è‰²
- ğŸ“‹ **çµæ§‹åŒ–è¦æ±‚**ï¼šæŒ‡å®šå›æ‡‰çš„æ ¼å¼å’Œå…§å®¹çµæ§‹
- ğŸŒ **èªè¨€å’Œé¢¨æ ¼**ï¼šçµ±ä¸€å›æ‡‰çš„èªè¨€å’Œè¡¨é”é¢¨æ ¼
- ğŸšï¸ **é›£åº¦æ§åˆ¶**ï¼šæ ¹æ“šä½¿ç”¨è€…ç¨‹åº¦èª¿æ•´å…§å®¹æ·±åº¦

**3. æé«˜é–‹ç™¼æ•ˆç‡**
- ğŸ”„ **å¯é‡è¤‡ä½¿ç”¨**ï¼šä¸€æ¬¡è¨­è¨ˆï¼Œå¤šæ¬¡ä½¿ç”¨
- ğŸ› ï¸ **åƒæ•¸åŒ–è¨­è¨ˆ**ï¼šé€éè®Šæ•¸å‹•æ…‹èª¿æ•´å…§å®¹
- ğŸ“š **ç¯„æœ¬åº«ç®¡ç†**ï¼šå»ºç«‹ä¼æ¥­ç´šæç¤ºè©è³‡ç”¢
- ğŸš€ **å¿«é€Ÿéƒ¨ç½²**ï¼šæ¸›å°‘é‡è¤‡çš„æç¤ºè©è¨­è¨ˆå·¥ä½œ

---

## 5.1.2 PromptTemplate åŸºç¤ä½¿ç”¨

### åŸºæœ¬ç¯„æœ¬èªæ³•

```java
package com.example.service;

import org.springframework.ai.chat.prompt.Prompt;
import org.springframework.ai.chat.prompt.PromptTemplate;
import org.springframework.stereotype.Service;

import java.util.Map;

@Service
public class PromptTemplateService {
    
    /**
     * åŸºæœ¬ç¯„æœ¬ä½¿ç”¨ç¯„ä¾‹
     */
    public Prompt createBasicPrompt(String topic, String level) {
        // å®šç¾©ç¯„æœ¬å­—ä¸²ï¼Œä½¿ç”¨ {è®Šæ•¸å} ä½œç‚ºä½”ä½ç¬¦
        String template = """
            ä½œç‚ºä¸€å€‹è³‡æ·±çš„æŠ€è¡“å°ˆå®¶ï¼Œè«‹è©³ç´°èªªæ˜ {topic} çš„ç›¸é—œçŸ¥è­˜ã€‚
            
            è«‹åŒ…å«ä»¥ä¸‹å…§å®¹ï¼š
            1. æ ¸å¿ƒæ¦‚å¿µå’Œå®šç¾©
            2. ä¸»è¦ç‰¹æ€§å’Œå„ªå‹¢
            3. å¯¦éš›æ‡‰ç”¨å ´æ™¯
            4. ç°¡å–®çš„ç¨‹å¼ç¢¼ç¯„ä¾‹
            
            ç›®æ¨™å—çœ¾ï¼š{level} é–‹ç™¼è€…
            å›ç­”èªè¨€ï¼šç¹é«”ä¸­æ–‡
            å›ç­”é¢¨æ ¼ï¼šå°ˆæ¥­ä¸”æ˜“æ‡‚
            """;
        
        // å»ºç«‹ PromptTemplate å¯¦ä¾‹
        PromptTemplate promptTemplate = new PromptTemplate(template);
        
        // æä¾›è®Šæ•¸å€¼
        Map<String, Object> variables = Map.of(
            "topic", topic,
            "level", level
        );
        
        // ç”Ÿæˆæœ€çµ‚çš„ Prompt
        return promptTemplate.create(variables);
    }
}
```

### èˆ‡ ChatClient æ•´åˆ

```java
package com.example.controller;

import com.example.service.PromptTemplateService;
import lombok.RequiredArgsConstructor;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.chat.prompt.Prompt;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/template")
@RequiredArgsConstructor
public class TemplateController {
    
    private final ChatClient chatClient;
    private final PromptTemplateService promptTemplateService;
    
    /**
     * ä½¿ç”¨ç¯„æœ¬é€²è¡Œ AI å°è©±
     * @param topic ä¸»é¡Œ
     * @param level ç¨‹åº¦ï¼ˆåˆç´š/ä¸­ç´š/é«˜ç´šï¼‰
     * @return AI å›æ‡‰
     */
    @GetMapping("/explain")
    public String explainTopic(
            @RequestParam String topic,
            @RequestParam(defaultValue = "ä¸­ç´š") String level) {
        
        // ä½¿ç”¨ç¯„æœ¬æœå‹™å»ºç«‹ Prompt
        Prompt prompt = promptTemplateService.createBasicPrompt(topic, level);
        
        // ä½¿ç”¨ ChatClient åŸ·è¡Œå°è©±
        return chatClient.prompt(prompt)
                .call()
                .content();
    }
    
    /**
     * ç°¡åŒ–çš„ç¯„æœ¬ä½¿ç”¨æ–¹å¼
     * @param framework æ¡†æ¶åç¨±
     * @return AI å›æ‡‰
     */
    @GetMapping("/framework")
    public String explainFramework(@RequestParam String framework) {
        return chatClient.prompt("è«‹å• {framework} ç›®å‰æœ‰å“ªäº›ç‰ˆæœ¬ï¼Œå„æœ‰ä»€éº¼ç‰¹æ®Šèƒ½åŠ›å’Œæ”¹é€²ï¼Ÿ")
                .user(Map.of("framework", framework))
                .call()
                .content();
    }
}
```

---

## 5.1.3 é€²éšç¯„æœ¬è¨­è¨ˆ

### å¤šåƒæ•¸ç¯„æœ¬

```java
@Service
public class AdvancedPromptService {
    
    /**
     * ç¨‹å¼ç¢¼ç”Ÿæˆç¯„æœ¬
     */
    public Prompt createCodeGenerationPrompt(String language, String functionality) {
        String template = """
            ä½ æ˜¯ {language} é–‹ç™¼å°ˆå®¶ã€‚
            
            è«‹ç”Ÿæˆ {functionality} çš„ç¨‹å¼ç¢¼ï¼š
            1. å®Œæ•´ç¨‹å¼ç¢¼å¯¦ç¾
            2. ç°¡å–®ä½¿ç”¨èªªæ˜
            """;
        
        PromptTemplate promptTemplate = new PromptTemplate(template);
        return promptTemplate.create(Map.of(
            "language", language,
            "functionality", functionality
        ));
    }
    
    /**
     * éŒ¯èª¤è¨ºæ–·ç¯„æœ¬
     */
    public Prompt createDiagnosisPrompt(String technology, String errorMessage) {
        String template = """
            ä½ æ˜¯ {technology} å°ˆå®¶ï¼Œè«‹åˆ†æéŒ¯èª¤ï¼š
            
            éŒ¯èª¤è¨Šæ¯ï¼š{errorMessage}
            
            è«‹æä¾›ï¼š
            1. éŒ¯èª¤åŸå› 
            2. è§£æ±ºæ–¹æ³•
            """;
        
        PromptTemplate promptTemplate = new PromptTemplate(template);
        return promptTemplate.create(Map.of(
            "technology", technology,
            "errorMessage", errorMessage
        ));
    }
}
```

### æ¢ä»¶å¼ç¯„æœ¬

```java
@Service
public class ConditionalPromptService {
    
    public Prompt createUserSpecificPrompt(String topic, String level) {
        String template = switch (level) {
            case "åˆç´š" -> """
                ä½ æ˜¯è€å¿ƒçš„å°å¸«ã€‚è«‹ç”¨ç°¡å–®èªè¨€èªªæ˜ {topic}ï¼š
                1. åŸºæœ¬æ¦‚å¿µ
                2. ç‚ºä»€éº¼é‡è¦
                3. å­¸ç¿’å»ºè­°
                """;
            case "ä¸­ç´š" -> """
                ä½ æ˜¯æŠ€è¡“å°ˆå®¶ã€‚è«‹èªªæ˜ {topic}ï¼š
                1. æ ¸å¿ƒåŸç†
                2. æ‡‰ç”¨å ´æ™¯
                3. ç¨‹å¼ç¢¼ç¯„ä¾‹
                """;
            default -> """
                ä½ æ˜¯è³‡æ·±æ¶æ§‹å¸«ã€‚è«‹æ·±åº¦åˆ†æ {topic}ï¼š
                1. å¯¦ç¾åŸç†
                2. æ¶æ§‹è¨­è¨ˆ
                3. æœ€ä½³å¯¦è¸
                """;
        };
        
        return new PromptTemplate(template).create(Map.of("topic", topic));
    }
}
```

---

## 5.1.4 ç¯„æœ¬åº«ç®¡ç†ç³»çµ±

### ç¯„æœ¬é…ç½®é¡

```java
package com.example.config;

import lombok.Data;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.stereotype.Component;

import java.util.Map;

@Data
@Component
@ConfigurationProperties(prefix = "app.prompt.templates")
public class PromptTemplateConfig {
    
    /**
     * é å®šç¾©ç¯„æœ¬åº«
     */
    private Map<String, String> library = Map.of(
        "explain", """
            ä½œç‚ºä¸€å€‹ {role} å°ˆå®¶ï¼Œè«‹è©³ç´°èªªæ˜ {topic}ã€‚
            
            è«‹åŒ…å«ï¼š
            1. æ ¸å¿ƒæ¦‚å¿µ
            2. ä¸»è¦ç‰¹æ€§
            3. ä½¿ç”¨å ´æ™¯
            4. å¯¦éš›ç¯„ä¾‹
            
            ç›®æ¨™å—çœ¾ï¼š{audience}
            å›ç­”èªè¨€ï¼š{language}
            """,
            
        "code-review", """
            ä½ æ˜¯ä¸€å€‹è³‡æ·±çš„ {language} ç¨‹å¼ç¢¼å¯©æŸ¥å°ˆå®¶ã€‚
            
            è«‹å¯©æŸ¥ä»¥ä¸‹ç¨‹å¼ç¢¼ï¼š
            ```{language}
            {code}
            ```
            
            è«‹æä¾›ï¼š
            1. ç¨‹å¼ç¢¼å“è³ªè©•ä¼°
            2. æ½›åœ¨å•é¡Œè­˜åˆ¥
            3. æ”¹é€²å»ºè­°
            4. æœ€ä½³å¯¦è¸å»ºè­°
            
            è«‹ç”¨ {language} å›ç­”ã€‚
            """,
            
        "troubleshoot", """
            ä½ æ˜¯ä¸€å€‹ {technology} æ•…éšœæ’é™¤å°ˆå®¶ã€‚
            
            **å•é¡Œæè¿°**ï¼š{problem}
            **éŒ¯èª¤è¨Šæ¯**ï¼š{error}
            **ç’°å¢ƒè³‡è¨Š**ï¼š{environment}
            
            è«‹æä¾›ï¼š
            ## ğŸ” å•é¡Œè¨ºæ–·
            ## ğŸ› ï¸ è§£æ±ºæ­¥é©Ÿ
            ## ğŸš€ é é˜²æªæ–½
            
            è«‹æä¾›å…·é«”å¯åŸ·è¡Œçš„è§£æ±ºæ–¹æ¡ˆã€‚
            """
    );
    
    /**
     * é è¨­åƒæ•¸å€¼
     */
    private Map<String, String> defaults = Map.of(
        "language", "ç¹é«”ä¸­æ–‡",
        "role", "æŠ€è¡“å°ˆå®¶",
        "audience", "ä¸­ç´šé–‹ç™¼è€…"
    );
}
```

### ç¯„æœ¬ç®¡ç†æœå‹™

```java
package com.example.service;

import com.example.config.PromptTemplateConfig;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.ai.chat.prompt.Prompt;
import org.springframework.ai.chat.prompt.PromptTemplate;
import org.springframework.stereotype.Service;

import java.util.HashMap;
import java.util.Map;

@Service
@RequiredArgsConstructor
@Slf4j
public class PromptTemplateManager {
    
    private final PromptTemplateConfig config;
    
    /**
     * æ ¹æ“šç¯„æœ¬åç¨±å»ºç«‹ Prompt
     * @param templateName ç¯„æœ¬åç¨±
     * @param variables è®Šæ•¸å€¼
     * @return å»ºç«‹çš„ Prompt
     */
    public Prompt createPrompt(String templateName, Map<String, Object> variables) {
        String template = config.getLibrary().get(templateName);
        if (template == null) {
            throw new IllegalArgumentException("ç¯„æœ¬ä¸å­˜åœ¨: " + templateName);
        }
        
        // åˆä½µé è¨­å€¼å’Œä½¿ç”¨è€…æä¾›çš„è®Šæ•¸
        Map<String, Object> mergedVariables = new HashMap<>(config.getDefaults());
        mergedVariables.putAll(variables);
        
        log.debug("ä½¿ç”¨ç¯„æœ¬ '{}' å»ºç«‹ Promptï¼Œè®Šæ•¸ï¼š{}", templateName, mergedVariables);
        
        PromptTemplate promptTemplate = new PromptTemplate(template);
        return promptTemplate.create(mergedVariables);
    }
    
    /**
     * å‹•æ…‹è¨»å†Šæ–°ç¯„æœ¬
     * @param name ç¯„æœ¬åç¨±
     * @param template ç¯„æœ¬å…§å®¹
     */
    public void registerTemplate(String name, String template) {
        config.getLibrary().put(name, template);
        log.info("è¨»å†Šæ–°ç¯„æœ¬ï¼š{}", name);
    }
    
    /**
     * ç²å–æ‰€æœ‰å¯ç”¨ç¯„æœ¬åç¨±
     * @return ç¯„æœ¬åç¨±åˆ—è¡¨
     */
    public Set<String> getAvailableTemplates() {
        return config.getLibrary().keySet();
    }
    
    /**
     * é©—è­‰ç¯„æœ¬èªæ³•
     * @param template ç¯„æœ¬å…§å®¹
     * @param variables æ¸¬è©¦è®Šæ•¸
     * @return æ˜¯å¦æœ‰æ•ˆ
     */
    public boolean validateTemplate(String template, Map<String, Object> variables) {
        try {
            PromptTemplate promptTemplate = new PromptTemplate(template);
            promptTemplate.create(variables);
            return true;
        } catch (Exception e) {
            log.warn("ç¯„æœ¬é©—è­‰å¤±æ•—ï¼š{}", e.getMessage());
            return false;
        }
    }
}
```

---

## 5.1.5 å¯¦éš›æ‡‰ç”¨ç¯„ä¾‹

### æ™ºèƒ½å®¢æœç¯„æœ¬ç³»çµ±

```java
package com.example.controller;

import com.example.service.PromptTemplateManager;
import lombok.RequiredArgsConstructor;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.chat.prompt.Prompt;
import org.springframework.web.bind.annotation.*;

import java.util.Map;

@RestController
@RequestMapping("/api/customer-service")
@RequiredArgsConstructor
public class CustomerServiceController {
    
    private final ChatClient chatClient;
    private final PromptTemplateManager templateManager;
    
    /**
     * æŠ€è¡“æ”¯æ´
     * @param product ç”¢å“åç¨±
     * @param issue å•é¡Œæè¿°
     * @param severity åš´é‡ç¨‹åº¦
     * @return æ”¯æ´å›æ‡‰
     */
    @PostMapping("/technical-support")
    public String technicalSupport(
            @RequestParam String product,
            @RequestParam String issue,
            @RequestParam(defaultValue = "medium") String severity) {
        
        // è¨»å†ŠæŠ€è¡“æ”¯æ´ç¯„æœ¬ï¼ˆå¦‚æœå°šæœªå­˜åœ¨ï¼‰
        String supportTemplate = """
            ä½ æ˜¯ {product} çš„è³‡æ·±æŠ€è¡“æ”¯æ´å°ˆå®¶ã€‚
            
            **å®¢æˆ¶å•é¡Œ**ï¼š{issue}
            **åš´é‡ç¨‹åº¦**ï¼š{severity}
            
            è«‹æä¾›å°ˆæ¥­çš„æŠ€è¡“æ”¯æ´å›æ‡‰ï¼š
            
            ## ğŸ” å•é¡Œç†è§£
            é‡è¿°ä¸¦ç¢ºèªå•é¡Œçš„æ ¸å¿ƒ
            
            ## ğŸ› ï¸ è§£æ±ºæ–¹æ¡ˆ
            æä¾›å…·é«”çš„è§£æ±ºæ­¥é©Ÿ
            
            ## ğŸ“‹ å¾ŒçºŒè¿½è¹¤
            å»ºè­°çš„å¾ŒçºŒè¡Œå‹•
            
            è«‹ä¿æŒå°ˆæ¥­ã€å‹å–„çš„èªèª¿ï¼Œç”¨ç¹é«”ä¸­æ–‡å›ç­”ã€‚
            """;
        
        templateManager.registerTemplate("technical-support", supportTemplate);
        
        // å»ºç«‹ Prompt
        Prompt prompt = templateManager.createPrompt("technical-support", Map.of(
            "product", product,
            "issue", issue,
            "severity", severity
        ));
        
        return chatClient.prompt(prompt)
                .call()
                .content();
    }
    
    /**
     * ç”¢å“è«®è©¢
     * @param category ç”¢å“é¡åˆ¥
     * @param budget é ç®—ç¯„åœ
     * @param requirements éœ€æ±‚æè¿°
     * @return è«®è©¢å›æ‡‰
     */
    @PostMapping("/product-consultation")
    public String productConsultation(
            @RequestParam String category,
            @RequestParam String budget,
            @RequestParam String requirements) {
        
        String consultationTemplate = """
            ä½ æ˜¯ä¸€å€‹å°ˆæ¥­çš„ {category} ç”¢å“é¡§å•ã€‚
            
            **å®¢æˆ¶éœ€æ±‚**ï¼š{requirements}
            **é ç®—ç¯„åœ**ï¼š{budget}
            
            è«‹æä¾›å€‹äººåŒ–çš„ç”¢å“å»ºè­°ï¼š
            
            ## ğŸ¯ éœ€æ±‚åˆ†æ
            åˆ†æå®¢æˆ¶çš„æ ¸å¿ƒéœ€æ±‚
            
            ## ğŸ’¡ ç”¢å“æ¨è–¦
            æ¨è–¦æœ€é©åˆçš„ç”¢å“æ–¹æ¡ˆ
            
            ## ğŸ’° åƒ¹å€¼èªªæ˜
            èªªæ˜æ¨è–¦ç”¢å“çš„åƒ¹å€¼å’Œå„ªå‹¢
            
            ## ğŸ“ ä¸‹ä¸€æ­¥è¡Œå‹•
            å»ºè­°å®¢æˆ¶çš„ä¸‹ä¸€æ­¥è¡Œå‹•
            
            è«‹ç”¨å°ˆæ¥­ä¸”è¦ªåˆ‡çš„èªèª¿å›ç­”ã€‚
            """;
        
        templateManager.registerTemplate("product-consultation", consultationTemplate);
        
        Prompt prompt = templateManager.createPrompt("product-consultation", Map.of(
            "category", category,
            "budget", budget,
            "requirements", requirements
        ));
        
        return chatClient.prompt(prompt)
                .call()
                .content();
    }
}
```

### æ•™è‚²è¨“ç·´ç¯„æœ¬ç³»çµ±

```java
@RestController
@RequestMapping("/api/education")
@RequiredArgsConstructor
public class EducationController {
    
    private final ChatClient chatClient;
    private final PromptTemplateManager templateManager;
    
    /**
     * èª²ç¨‹å…§å®¹ç”Ÿæˆ
     * @param subject ç§‘ç›®
     * @param level ç¨‹åº¦
     * @param duration æ™‚é•·ï¼ˆåˆ†é˜ï¼‰
     * @return èª²ç¨‹å…§å®¹
     */
    @PostMapping("/generate-lesson")
    public String generateLesson(
            @RequestParam String subject,
            @RequestParam String level,
            @RequestParam int duration) {
        
        String lessonTemplate = """
            ä½ æ˜¯ä¸€å€‹ç¶“é©—è±å¯Œçš„ {subject} æ•™å¸«ã€‚
            
            è«‹ç‚º {level} å­¸ç”Ÿè¨­è¨ˆä¸€å ‚ {duration} åˆ†é˜çš„èª²ç¨‹ï¼š
            
            ## ğŸ“š èª²ç¨‹ç›®æ¨™
            æ˜ç¢ºçš„å­¸ç¿’ç›®æ¨™ï¼ˆ3-5å€‹ï¼‰
            
            ## ğŸ• èª²ç¨‹å¤§ç¶±
            è©³ç´°çš„æ™‚é–“åˆ†é…å’Œå…§å®¹å®‰æ’
            
            ## ğŸ’¡ æ•™å­¸æ´»å‹•
            äº’å‹•å¼çš„æ•™å­¸æ´»å‹•è¨­è¨ˆ
            
            ## ğŸ“ è©•é‡æ–¹å¼
            æª¢é©—å­¸ç¿’æˆæ•ˆçš„æ–¹æ³•
            
            ## ğŸ  èª²å¾Œä½œæ¥­
            éå›ºå­¸ç¿’çš„ç·´ç¿’é¡Œç›®
            
            è«‹ç¢ºä¿å…§å®¹é©åˆç›®æ¨™å­¸ç”Ÿç¨‹åº¦ï¼Œä¸¦å…·æœ‰å¯¦ç”¨æ€§ã€‚
            """;
        
        templateManager.registerTemplate("lesson-plan", lessonTemplate);
        
        Prompt prompt = templateManager.createPrompt("lesson-plan", Map.of(
            "subject", subject,
            "level", level,
            "duration", String.valueOf(duration)
        ));
        
        return chatClient.prompt(prompt)
                .call()
                .content();
    }
}
```

---

## 5.1.6 ç¯„æœ¬è¨­è¨ˆæœ€ä½³å¯¦è¸

### è¨­è¨ˆåŸå‰‡

**1. æ¸…æ™°çš„è§’è‰²å®šç¾©**
```java
// âœ… å¥½çš„ç¯„æœ¬
String template = """
    ä½ æ˜¯ä¸€å€‹æ“æœ‰10å¹´ç¶“é©—çš„ Spring Boot æ¶æ§‹å¸«ï¼Œ
    å°ˆç²¾æ–¼å¾®æœå‹™æ¶æ§‹è¨­è¨ˆå’Œæ•ˆèƒ½å„ªåŒ–ã€‚
    
    è«‹é‡å° {question} æä¾›å°ˆæ¥­å»ºè­°...
    """;

// âŒ ä¸å¥½çš„ç¯„æœ¬
String template = "è«‹å›ç­” {question}";
```

**2. çµæ§‹åŒ–è¼¸å‡ºæ ¼å¼**
```java
String template = """
    è«‹æŒ‰ç…§ä»¥ä¸‹æ ¼å¼å›ç­”ï¼š
    
    ## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ
    [ç°¡æ½”çš„æ¦‚å¿µèªªæ˜]
    
    ## ğŸ”§ å¯¦ä½œæ–¹æ³•
    [å…·é«”çš„å¯¦ä½œæ­¥é©Ÿ]
    
    ## ğŸ’¡ æœ€ä½³å¯¦è¸
    [ç›¸é—œçš„æœ€ä½³å¯¦è¸å»ºè­°]
    
    ## âš ï¸ æ³¨æ„äº‹é …
    [é‡è¦çš„æ³¨æ„äº‹é …]
    """;
```

**3. åƒæ•¸é©—è­‰å’Œé è¨­å€¼**
```java
@Service
public class ValidatedPromptService {
    
    public Prompt createValidatedPrompt(String template, Map<String, Object> variables) {
        // é©—è­‰å¿…è¦åƒæ•¸
        validateRequiredParameters(template, variables);
        
        // è¨­å®šé è¨­å€¼
        Map<String, Object> mergedVariables = applyDefaults(variables);
        
        // æ¸…ç†å’Œæ ¼å¼åŒ–åƒæ•¸
        Map<String, Object> cleanedVariables = cleanParameters(mergedVariables);
        
        PromptTemplate promptTemplate = new PromptTemplate(template);
        return promptTemplate.create(cleanedVariables);
    }
    
    private void validateRequiredParameters(String template, Map<String, Object> variables) {
        // æå–ç¯„æœ¬ä¸­çš„æ‰€æœ‰è®Šæ•¸
        Set<String> templateVariables = extractTemplateVariables(template);
        
        // æª¢æŸ¥å¿…è¦åƒæ•¸æ˜¯å¦å­˜åœ¨
        for (String var : templateVariables) {
            if (!variables.containsKey(var) || variables.get(var) == null) {
                throw new IllegalArgumentException("ç¼ºå°‘å¿…è¦åƒæ•¸: " + var);
            }
        }
    }
    
    private Map<String, Object> applyDefaults(Map<String, Object> variables) {
        Map<String, Object> result = new HashMap<>(variables);
        
        // è¨­å®šé è¨­å€¼
        result.putIfAbsent("language", "ç¹é«”ä¸­æ–‡");
        result.putIfAbsent("style", "å°ˆæ¥­ä¸”å‹å–„");
        result.putIfAbsent("format", "çµæ§‹åŒ–");
        
        return result;
    }
    
    private Map<String, Object> cleanParameters(Map<String, Object> variables) {
        return variables.entrySet().stream()
            .collect(Collectors.toMap(
                Map.Entry::getKey,
                entry -> cleanParameterValue(entry.getValue())
            ));
    }
    
    private Object cleanParameterValue(Object value) {
        if (value instanceof String str) {
            // æ¸…ç†å­—ä¸²ï¼šç§»é™¤å¤šé¤˜ç©ºç™½ã€ç‰¹æ®Šå­—å…ƒç­‰
            return str.trim().replaceAll("\\s+", " ");
        }
        return value;
    }
}
```

### æ•ˆèƒ½å„ªåŒ–

```java
@Service
@Slf4j
public class OptimizedPromptService {
    
    // å¿«å–ç·¨è­¯å¾Œçš„ç¯„æœ¬
    private final Map<String, PromptTemplate> templateCache = new ConcurrentHashMap<>();
    
    /**
     * å¿«å–ç¯„æœ¬ä»¥æå‡æ•ˆèƒ½
     */
    public Prompt createCachedPrompt(String templateKey, String templateContent, Map<String, Object> variables) {
        PromptTemplate template = templateCache.computeIfAbsent(templateKey, key -> {
            log.debug("ç·¨è­¯ä¸¦å¿«å–ç¯„æœ¬ï¼š{}", key);
            return new PromptTemplate(templateContent);
        });
        
        return template.create(variables);
    }
    
    /**
     * æ‰¹æ¬¡è™•ç†å¤šå€‹ç¯„æœ¬
     */
    public List<Prompt> createBatchPrompts(String templateContent, List<Map<String, Object>> variablesList) {
        PromptTemplate template = new PromptTemplate(templateContent);
        
        return variablesList.parallelStream()
            .map(template::create)
            .collect(Collectors.toList());
    }
    
    /**
     * æ¸…ç†å¿«å–
     */
    @EventListener
    public void clearCache() {
        templateCache.clear();
        log.info("ç¯„æœ¬å¿«å–å·²æ¸…ç†");
    }
}
```

---

## ğŸ“ æœ¬ç« é‡é»å›é¡§

1. **æç¤ºè©ç¯„æœ¬çš„åƒ¹å€¼**ï¼šç†è§£äº†ã€ŒGarbage in, Garbage outã€åŸå‰‡å’Œç¯„æœ¬çš„é‡è¦æ€§
2. **PromptTemplate ä½¿ç”¨**ï¼šæŒæ¡äº†åŸºæœ¬å’Œé€²éšçš„ç¯„æœ¬å»ºç«‹æ–¹æ³•
3. **ChatClient æ•´åˆ**ï¼šå­¸æœƒäº†å°‡ç¯„æœ¬èˆ‡ç¾ä»£åŒ–çš„ ChatClient API çµåˆ
4. **ç¯„æœ¬åº«ç®¡ç†**ï¼šå»ºç«‹äº†ä¼æ¥­ç´šçš„ç¯„æœ¬ç®¡ç†ç³»çµ±
5. **æœ€ä½³å¯¦è¸**ï¼šæŒæ¡äº†ç¯„æœ¬è¨­è¨ˆã€é©—è­‰å’Œå„ªåŒ–çš„æœ€ä½³å¯¦è¸

### é—œéµæŠ€è¡“è¦é»

| æŠ€è¡“é» | é‡è¦æ€§ | å¯¦ç¾é›£åº¦ | ä½¿ç”¨å ´æ™¯ |
|--------|--------|----------|----------|
| **åŸºç¤ç¯„æœ¬** | â­â­â­ | ä½ | æ‰€æœ‰ AI æ‡‰ç”¨ |
| **åƒæ•¸åŒ–è¨­è¨ˆ** | â­â­â­ | ä¸­ | å‹•æ…‹å…§å®¹ç”Ÿæˆ |
| **ç¯„æœ¬åº«ç®¡ç†** | â­â­ | ä¸­ | ä¼æ¥­ç´šæ‡‰ç”¨ |
| **æ¢ä»¶å¼ç¯„æœ¬** | â­â­ | é«˜ | è¤‡é›œæ¥­å‹™é‚è¼¯ |
| **æ•ˆèƒ½å„ªåŒ–** | â­ | ä¸­ | é«˜ä½µç™¼å ´æ™¯ |

### ä¸‹ä¸€æ­¥å­¸ç¿’æ–¹å‘

åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘å€‘å°‡å­¸ç¿’å¦‚ä½•è™•ç†å¤šæ¨¡æ…‹è³‡æ–™ï¼Œè®“ AI ä¸åƒ…èƒ½ç†è§£æ–‡å­—ï¼Œé‚„èƒ½è™•ç†åœ–ç‰‡ã€éŸ³è¨Šç­‰å¤šç¨®åª’é«”æ ¼å¼ï¼Œé€²ä¸€æ­¥æå‡ ChatBot çš„æ™ºèƒ½åŒ–ç¨‹åº¦ã€‚

---

**åƒè€ƒè³‡æ–™ï¼š**
- [Spring AI Prompt Template Documentation](https://docs.spring.io/spring-ai/reference/api/prompt.html)
- [ChatClient API Reference](https://docs.spring.io/spring-ai/reference/api/chatclient.html)
- [Prompt Engineering Best Practices](https://platform.openai.com/docs/guides/prompt-engineering)